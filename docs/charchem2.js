(()=>{"use strict";var e={5256:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemSys=void 0;const o=n(5736),s=n(2458),r=n(9701),i=n(285),a=n(7513),c=n(800),d=n(8706),l=n(7185),u=n(6887),h=n(2559),p=n(3022),m=n(3341),f=n(5815),g=n(4665),v=n(6963),b=n(8),C=n(871),y=n(4326),P=n(6290),w=n(5604),x=n(5041),M=n(1239),B=n(9046),S=n(1947),_=n(4576);t.ChemSys=Object.freeze({addDict(e){d.Lang.addDict(e)},get ver(){return(0,i.getVersion)()},get verStr(){return(0,i.getVersionStr)()},compile:e=>(0,s.compile)(e),documentCompile:(e={})=>(0,p.documentCompile)(e),draw:(e,t,n)=>((0,o.renderFormulaCfg)(e,t,null!=n?n:{}),!0),makeSVG(e,t){const n="string"==typeof e?(0,s.compile)(e):e;return(0,M.makeFormulaSvgText)(n,t)},makeTextFormula(e,t){const n="string"==typeof e?(0,s.compile)(e):e;return(0,S.makeTextFormula)(n,t)},dictTextRules:_.dictTextRules,makeBruttoKey:e=>(0,a.makeBruttoKey)(e),makeBrutto:e=>(0,s.compile)((0,a.makeBruttoKey)(e)),lang:(e,t,n)=>d.Lang.tr(e,t,n),get curLang(){return d.Lang.curLang},set curLang(e){d.Lang.curLang=e},get navLang(){return d.Lang.navLang},get Dict(){return d.Lang.dict},isAbstract:e=>(0,c.isAbstract)(e),calcMass:(e,t)=>(0,l.calcMass)(e,t),roundMass:e=>(0,x.roundMass)(e),calcCharge:e=>(0,w.calcCharge)(e),findElem:e=>(0,u.findElement)(e),drawTable:e=>(0,h.drawPeriodicTable)(e),findCategory:(e,t,n)=>(0,C.findCategory)(e,t,n),TblRules:{Std:m.tableRulesStd,Wide:f.tableRulesWide,Short:v.tableRulesShort,EasyChemistry:g.tableRulesEasyChemistry},TblCategory:{block:b.categoryBlock,blockDLa:b.categoryBlockDLa,props:b.categoryProps},drawTag:(e,t,n)=>void 0===n?(0,y.drawTag)(e,t,!0):`${(0,y.drawTag)(e,t)}${(0,P.escapeXml)(String(n))}</${e}>`,esc:e=>(0,P.escapeXml)(String(e)),equalize(e){const t=new B.ChemEquation;return t.initBySrc(e),t.solve(),t.isSolved()?t.getExpr():r.ChemExpr.createWithError(t.makeError(),e)}})},6244:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DrawSysIds=void 0,t.DrawSysIds={svg:!0,canvas:!0}},5952:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addClass=void 0,t.addClass=(e,t)=>{if(e.classList)e.classList.add(t);else{const n=e.getAttribute("class"),o=n?n.split(" "):[],s=new Set(o);s.add(t),e.setAttribute("class",Array.from(s).join(" "))}}},829:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addAutoCompileEvent=t.autoCompile=t.fontPropsCache=void 0;const o=n(9106),s=n(6244),r=n(3022);t.fontPropsCache=new o.WebFontCache,t.autoCompile=()=>{if(!document)return;const e=document.querySelectorAll(".easyChemConfig,.CharChemConfig,body.echem-auto-compile");if(0===e.length)return;const n=e[e.length-1],o={fontPropsCache:t.fontPropsCache},i=n.getAttribute("data-drawsys");if("string"==typeof i){const e=i.toLowerCase();e in s.DrawSysIds&&(o.drawSysId=e)}const a=n.getAttribute("data-usetext");if("string"==typeof a){const e=a.toLowerCase();o.nonText="no"===e}(0,r.documentCompile)(o)},t.addAutoCompileEvent=()=>{null===window||void 0===window||window.addEventListener("DOMContentLoaded",t.autoCompile)}},3022:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(s,r){function i(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.elementCompile=t.documentCompile=void 0;const s=n(9825),r=n(5736);t.documentCompile=e=>o(void 0,void 0,void 0,(function*(){var n;if(!document)return Promise.reject(new Error("Document expected"));try{const o=null!==(n=e.formulaSelector)&&void 0!==n?n:".echem-formula",r=document.querySelectorAll(o);let i=0,a=r[i++];for(;a;)(0,t.elementCompile)(a,e),a=r[i++],yield(0,s.delay)(1)}catch(e){return Promise.reject(e)}return Promise.resolve()})),t.elementCompile=(e,t)=>{var n;const o=null!==(n=e.textContent)&&void 0!==n?n:e.innerText;(0,r.renderFormulaCfg)(e,o,t)}},2695:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderFormulaCanvas=void 0;const o=n(3177),s=n(8429),r=n(4278),i=n(3938),a=n(5952);t.renderFormulaCanvas=(e,t,n)=>{if(!document)return;e.innerHTML="";const c=document.createElement("canvas");e.append(c);const d=new r.HtmlCanvasSurface(c,n),l=(0,o.createChemImgProps)(e,d);(0,s.renderTopFrame)((0,i.buildFrame)(t,l),d),(0,a.addClass)(e,"echem-is-canvas")}},5736:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderFormulaCfg=void 0;const o=n(2458),s=n(9701),r=n(9059),i=n(1947),a=n(4900),c=n(2695),d=n(1239),l=n(5952);t.renderFormulaCfg=(e,t,n)=>{var u;const h="string"==typeof t?(0,o.compile)(t):t;h instanceof s.ChemExpr&&!h.isOk()?(null===(u=e.classList)||void 0===u||u.add("echem-error"),e.setAttribute("title",h.getMessage())):(!n.nonText&&(0,r.isTextFormula)(h)?(e.innerHTML=(0,i.makeTextFormula)(h,a.rulesHtml),(0,l.addClass)(e,"echem-is-text")):"canvas"===n.drawSysId?(0,c.renderFormulaCanvas)(e,h,n.fontPropsCache):(0,d.renderFormulaSvg)(e,h,n.fontPropsCache),h instanceof s.ChemExpr&&e.setAttribute("data-src",h.src0.trim()))}},1239:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeFormulaSvgText=t.renderFormulaSvg=void 0;const o=n(7236),s=n(3177),r=n(8429),i=n(3938),a=n(3524),c=n(5952);t.renderFormulaSvg=(e,t,n)=>{if("undefined"==typeof document)return;const a=new o.SvgWebSurface(n),d=(0,s.createChemImgProps)(e,a),l=(0,i.buildFrame)(t,d);(0,r.renderTopFrame)(l,a);const{bounds:u}=l;e.innerHTML=a.exportText({width:`${u.width}px`,height:`${u.height}px`}),(0,c.addClass)(e,"echem-is-svg")},t.makeFormulaSvgText=(e,t)=>{if("undefined"==typeof document)return"";const n=document.createElement("div");n.setAttribute("class","echem-formula");try{document.body.append(n);const c=new o.SvgWebSurface(t),d=(0,s.createChemImgProps)(n,c),l=(0,i.buildFrame)(e,d);(0,r.renderTopFrame)(l,c);const{bounds:u}=l;return c.exportText(Object.assign(Object.assign({},a.standaloneExportOptions),{width:`${u.width}px`,height:`${u.height}px`}))}finally{n.remove()}}},5244:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChainSys=void 0;const o=n(4018);let s=1,r=1;t.ChainSys=class{constructor(e){this.chainsDict={},this.subChainsDict={},this.curChainId=0,this.curSubChainId=0,this.stack=[],this.compiler=e}getLastBond(){return this.lastBond}onBranchBegin(){this.stack.unshift(this.lastBond)}onBranchEnd(){this.lastBond=this.stack.shift()}createChain(){this.lastBond=void 0;const e=s++;return this.chainsDict[e]=new Set,e}getCurChain(){return 0===this.curChainId&&(this.curChainId=this.createChain()),this.chainsDict[this.curChainId]}createSubChain(){this.lastBond=void 0;const e=r++;return this.curSubChainId=e,this.subChainsDict[e]=[],this.getCurChain().add(e),e}getCurSubChain(){return 0===this.curSubChainId&&(this.curSubChainId=this.createSubChain()),this.subChainsDict[this.curSubChainId]}addNode(e){0===e.chain?(this.getCurSubChain().push(e),e.chain=this.curChainId,e.subChain=this.curSubChainId):(this.curChainId=e.chain,this.curSubChainId=e.subChain)}setCurNode(e){this.curChainId=e.chain,this.curSubChainId=e.subChain}addBond(e){e.soft&&this.createSubChain(),this.lastBond=e}mergeSubChains(e,t,n){if(e===t)return;const o=this.subChainsDict[t];o.forEach((t=>{t.subChain=e,t.pt.iadd(n)}));const s=this.subChainsDict[e];s&&o.forEach((e=>s.push(e))),delete this.subChainsDict[t],this.curSubChainId===t&&(this.curSubChainId=e)}mergeChains(e,t){const n=e.chain,o=t.chain;n!==o&&this.compiler.curAgent.nodes.filter((e=>e.chain===n)).forEach((e=>{e.chain=o}))}makeTransitionBond(e){e.soft=!1,e.dir=void 0;const t=e.nodes[1];t&&this.addNode(t)}bondToRef(e){const[t,n]=e.nodes;if(!t||!n)return;const o=t.subChain,s=n.subChain;if(o!==s){if(!e.soft)if(t.chain!==n.chain){this.mergeChains(t,n);const r=n.pt.minus(t.pt).minus(e.dir);this.mergeSubChains(s,o,r)}else this.makeTransitionBond(e)}else e.dir=n.pt.minus(t.pt);this.compiler.curNode=n,this.curChainId=n.chain,this.curSubChainId=n.subChain}changeBondToHard(e){var t;const n=e.nodes[0];if(n){const s=e.nodes[1];if(s){if(s.chain!==n.chain)throw Error("Different chains");this.mergeSubChains(n.subChain,s.subChain,null!==(t=e.dir)&&void 0!==t?t:new o.Point)}this.curSubChainId=n.subChain,this.curChainId=n.chain}}closeChain(){this.curChainId=0,this.curSubChainId=0,this.lastBond=void 0}closeSubChain(){this.curSubChainId=0,this.lastBond=void 0}findNode(e){return this.getCurSubChain().find((t=>t.pt.equals(e)))}}},7455:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createTestCompiler=t.ChemCompiler=void 0;const o=n(9701),s=n(4086),r=n(5244),i=n(8326),a=n(8219),c=n(4074),d=n(4724),l=n(2302);class u{constructor(e,t){this.expr=new o.ChemExpr,this.text="",this.pos=0,this.curState=c.stateBegin,this.curPart=0,this.elementStartPos=0,this.chainSys=new r.ChainSys(this),this.references={},this.mulCounter=new i.MulCounter,this.varsDict={},this.curWidth=0,this.nodesBranch=new a.NodesBranch,this.bracketsCtrl=new l.BracketsCtrl,this.middlePoints=[],this.stack=[],this.altFlag=!1,this.varSlope=0,this.varLength=1,this.varPadding=[],this.centralNode=!1,this.varDots=void 0,this.varPos=void 0,this.srcText=e,this.options=null!=t?t:{},this.options.srcMap&&(this.srcMap=[],this.expr.srcMap=this.srcMap)}push(e){this.stack.unshift(e)}pop(){return this.stack.shift()}setAltFlag(){this.altFlag=!0}getAltFlag(){const e=this.altFlag;return this.altFlag=!1,e}eject(e){const t=this[e];return this[e]=void 0,t}curChar(){return this.text[this.pos]}nextChar(){return this.text[this.pos+1]}subStr(e){return this.text.slice(e,this.pos)}isFinish(){return this.pos>=this.text.length}isCurPosEq(e){return e===this.text.slice(this.pos,Math.min(this.text.length,this.pos+e.length))}error(e,t){const n=Object.assign({},t),{pos:o}=n;throw"number"==typeof o&&(n.pos=o+1),new s.ChemError(e,n)}setState(e,t=0){return this.curState=e,t}addSrcMapItem(e,t,n){const{srcMap:o,pos:s}=this;void 0!==t&&o&&o.push({begin:t,end:s,obj:e,part:n})}}t.ChemCompiler=u,t.createTestCompiler=e=>{const t=new u(e);return(0,d.prepareText)(t),t}},2458:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.compile=void 0;const o=n(7455),s=n(3289),r=n(4724);t.compile=(e,t)=>{const n=new o.ChemCompiler(e,t);try{for((0,r.prepareText)(n);!n.isFinish();){const e=n.curState(n);n.pos+=e}(0,s.closeEntity)(n)}catch(e){n.expr.error=e}return n.expr}},8899:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseBackgroundArgs=t.funcBackground=void 0;const o=n(7289),s=n(5762),r=n(9063),i=n(9217);t.funcBackground=(e,n,s)=>{var r;e.background&&(null===(r=e.curAgent)||void 0===r||r.commands.push(new o.ChemBackground(e.background))),e.background=(0,t.parseBackgroundArgs)(e,n,s)};const a=new Set(["rect","round","ellipse"]);t.parseBackgroundArgs=(e,t,n)=>{const o={};return t.forEach(((t,r)=>{const d=n[r],l=t.trim();if("*"===l)o.isAll=!0;else{const n=t.indexOf(":");if(n<0)a.has(l)?o.shape=l:o.fill||(o.fill=t);else{const r=t.slice(0,n),a=t.slice(n+1),l=d+n+1;switch(r){case"":case"to":o.nodes=c(e,a,l);break;case"fill":case"f":o.fill=a.trim();break;case"stroke":case"s":o.stroke=a.trim();break;case"width":case"w":o.strokeWidth=(0,s.parseNum)(e,a,l);break;case"padding":case"p":o.padding=(0,i.parsePadding)(e,a,l);break;case"r":o.borderRadius=(0,s.parseNum)(e,a,l)}}}})),o};const c=(e,t,n)=>{const o=t.split(";");let s=0;return o.map((t=>{const o=(0,r.findNodeEx)(e,t,s+n);return s+=t.length+1,o}))}},7489:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcC=void 0,t.funcC=e=>{e.centralNode=!0}},4672:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcAtomColor1=t.funcAtomColor=t.funcItemColor1=t.funcItemColor=t.funcColor=void 0,t.funcColor=(e,[t],n)=>{e.varColor=t},t.funcItemColor=(e,[t],n)=>{e.varItemColor=t},t.funcItemColor1=(e,[t],n)=>{e.varItemColor1=t},t.funcAtomColor=(e,[t],n)=>{e.varAtomColor=t},t.funcAtomColor1=(e,[t],n)=>{e.varAtomColor1=t}},5376:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcDblAlign=void 0;const n={r:1,R:1,l:1,L:1,m:1,M:1};t.funcDblAlign=(e,t)=>{e.varAlign=t[0]in n?t[0][0].toLowerCase():void 0}},604:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcDots=t.parseDotsArgs=t.parseSingleDotArg=t.splitDotPositions=void 0;const o=n(5762),s=/^!?([LR][dbtu]?|[UTDB][lr]?)+$/;t.splitDotPositions=e=>{const t=[],n="!"===e[0];let o=n?1:0;const s=(n,s)=>n.indexOf(e[o])>=0&&(t.push(s),o++,!0),r=(e,n,o,r)=>{s(e,n)||s(o,r)||t.push(n,r)};for(;o<e.length;){const t=e[o++];"R"===t?r("db",0,"tu",7):"L"===t?r("db",3,"tu",4):"U"===t||"T"===t?r("l",5,"r",6):"B"!==t&&"D"!==t||r("r",1,"l",2)}if(!n)return t;const i=t.reduce(((e,t)=>(e.delete(t),e)),new Set([0,1,2,3,4,5,6,7]));return Array.from(i)},t.parseSingleDotArg=(e,n,r)=>{if(n){if(n.startsWith("c:")||n.startsWith("color:"))return{cmd:"color",color:n.slice(n.indexOf(":")+1)||void 0};if(n.startsWith("m:")||n.startsWith("margin:")){const t=n.slice(n.indexOf(":")+1);return{cmd:"margin",margin:t?(0,o.parseNum)(e,t,r):void 0}}return"!"===n||s.test(n)?{cmd:"dirs",dirs:(0,t.splitDotPositions)(n)}:{cmd:"num",num:(0,o.parseNum)(e,n,r)}}},t.parseDotsArgs=(e,n,o)=>{const s=[];let r,i;const a=()=>{const e={};return r&&(e.color=r),i&&(e.margin=i),e};return n.forEach(((n,c)=>{const d=(0,t.parseSingleDotArg)(e,n,o[c]);switch(null==d?void 0:d.cmd){case"dirs":d.dirs.forEach((e=>{return t=e,void s.push(Object.assign(Object.assign({},a()),{pos:t}));var t}));break;case"num":l=d.num,s.push(Object.assign(Object.assign({},a()),{angle:l}));break;case"color":r=d.color;break;case"margin":i=d.margin}var l})),s},t.funcDots=(e,n,o)=>{const s=(0,t.parseDotsArgs)(e,n,o);e.varDots=s}},3845:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcL=void 0;const o=n(5762);t.funcL=(e,t,n)=>{e.varLength=0===t.length?1:(0,o.parseNum)(e,t[0],n[0])}},2640:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcM=void 0;const o=n(5762);t.funcM=(e,t,n)=>{t.length>0&&(e.varMass=(0,o.parseNum)(e,t[0],n[0]))}},3107:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcPadding=void 0;const o=n(5762);t.funcPadding=(e,t,n)=>{e.varPadding=t.map(((t,s)=>(0,o.parseNum)(e,t,n[s])))}},6966:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcPos=void 0;const o=n(599),s=n(5762);t.funcPos=(e,t,n)=>{const r=t[0];r&&(o.rxCoeffPos.test(r)?e.varPos=r:e.varPos=(0,s.parseNum)(e,r,n[0]))}},8020:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcSlope=void 0;const o=n(5762);t.funcSlope=(e,t,n)=>{e.varSlope=0===t.length?0:(0,o.parseNum)(e,t[0],n[0])}},9294:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcVer=t.parseVerParameter=void 0;const o=n(285),s=n(6445),r=(e="")=>+e||0;t.parseVerParameter=e=>{var t,n;const[o,i]=e,a=(null!==(n=null!==(t=(0,s.ifDef)(o,(e=>{var t;return null!==(t=(0,s.ifDef)(i,(t=>`${e}.${t}`)))&&void 0!==t?t:o})))&&void 0!==t?t:i)&&void 0!==n?n:"0.0").split("."),c=[0===a.length?"0":a[0],a.length<2?"0":a[1]];return[r(c[0]),r(c[1])]},t.funcVer=(e,n)=>{const[s,r]=(0,t.parseVerParameter)(n),i=(0,o.getVersion)();(s>i[0]||s===i[0]&&r>i[1])&&e.error("Invalid version",{cur:`${i[0]}.${i[1]}`,need:`${s}.${r}`})}},6282:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcnM=void 0;const o=n(2640);t.funcnM=(e,t,n)=>{(0,o.funcM)(e,t,n),e.varAtomNumber=t.length>1&&+t[1]||-1}},8391:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcsDict=void 0;const o=n(8899),s=n(7489),r=n(4672),i=n(5376),a=n(604),c=n(3845),d=n(2640),l=n(6282),u=n(3107),h=n(6966),p=n(8020),m=n(9294);t.funcsDict={atomColor:r.funcAtomColor,atomColor1:r.funcAtomColor1,background:o.funcBackground,bg:o.funcBackground,C:s.funcC,color:r.funcColor,dblAlign:i.funcDblAlign,dots:a.funcDots,itemColor:r.funcItemColor,itemColor1:r.funcItemColor1,L:c.funcL,M:d.funcM,nM:l.funcnM,padding:u.funcPadding,pos:h.funcPos,slope:p.funcSlope,ver:m.funcVer}},2302:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BracketsCtrl=void 0,t.BracketsCtrl=class{constructor(){this.queue=[]}clear(){this.queue.length=0}onNode(e){this.queue.forEach((t=>{t.nodes[1]=e})),this.clear()}onBracket(e){this.queue.push(e)}}},8326:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MulCounter=void 0,t.MulCounter=class{constructor(){this.bracketCounter=0}onOpenBracket(){this.mul&&++this.bracketCounter}onNode(e){const{mul:t}=this;t&&!t.nodes[1]&&(t.nodes[1]=e)}onCloseBracket(){this.mul&&--this.bracketCounter}close(){this.mul=void 0}create(e){this.mul=e}getMulForBracket(){return this.bracketCounter>0?void 0:this.mul}getMulForced(){return this.mul}}},8219:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NodesBranch=void 0,t.NodesBranch=class{constructor(){this.nbStack=[],this.nodes=[]}onBranchBegin(){const e=[...this.nodes];this.nbStack.unshift(e)}onBranchEnd(){const e=this.nbStack.shift();e&&(this.nodes=e)}onSubChain(){this.nodes.length=0}onNode(e){this.nodes.push(e)}}},7889:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StackItem=void 0,t.StackItem=class{constructor(e){this.pos=e}}},1242:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addNodeItem=void 0;const o=n(2390),s=n(4403),r=n(1297),i=n(2321),a=n(6445);t.addNodeItem=(e,t)=>{(0,r.closeItem)(e);const n=new o.ChemNodeItem(t);return(0,a.ifDef)(e.varMass,(t=>{n.mass=t,e.varMass=void 0})),n.color=(0,i.getItemColor)(e),n.atomColor=(0,i.getAtomColor)(e),n.atomNum=e.varAtomNumber,n.bCenter=e.getAltFlag(),n.dots=e.varDots,e.varDots=void 0,e.varAtomNumber=void 0,(0,s.getNodeForced)(e,!1).items.push(n),n}},7525:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.finalUpdateAutoNodes=t.finalUpdateBondsForNodes=t.star=t.onCloseAgent=t.closeChain=t.createAgent=void 0;const o=n(8978),s=n(759),r=n(3289),i=n(1242),a=n(4403),c=n(503),d=n(2933),l=n(4444),u=n(5235),h=n(9963),p=n(7289);t.createAgent=e=>{var t;let{pos:n}=e;const{preComm:s}=e;(0,r.closeEntity)(e);const a=new o.ChemAgent;return a.part=e.curPart,e.curAgent=a,(0,r.onCreateEntity)(e,a),s&&(n=null!==(t=e.eject("preCommPos"))&&void 0!==t?t:n,(0,i.addNodeItem)(e,s)),e.references={},e.varMass=void 0,e.curWidth=0,e.centralNode=!1,e.varPadding=[],e.varDots=void 0,e.nodesBranch.onSubChain(),e.bracketsCtrl.clear(),e.srcMap&&(e.entityBegin=n),a},t.closeChain=e=>{const{curBond:t}=e;t&&(2!==t.nodes.length||t.nodes[1]||(0,a.openNode)(e,!0)),e.curBond=void 0,(0,a.closeNode)(e),e.chainSys.closeChain(),e.nodesBranch.onSubChain(),e.bracketsCtrl.clear()},t.onCloseAgent=e=>{const{curAgent:n}=e;n&&((0,c.checkMul)(e),(0,u.checkMiddlePoints)(e),(0,t.closeChain)(e),e.curAgent=void 0,e.getAltFlag(),e.curBond=void 0,(0,d.checkBranch)(e),(0,t.finalUpdateBondsForNodes)(n),(0,t.finalUpdateAutoNodes)(n),e.background&&n.commands.push(new p.ChemBackground(e.background)),e.background=void 0,n.bonds.forEach(((e,t)=>{e.index=t})),e.addSrcMapItem(n,e.entityBegin),e.agentMode=void 0)},t.star=e=>{var t;return e.pos++,")"===e.curChar()?(0,d.closeBranch)(e):((0,c.checkMul)(e),(0,c.startMul)(e,null!==(t=(0,l.scanCoeff)(e))&&void 0!==t?t:new s.ChemK(1),!1),e.setState(h.stateAgentMid))},t.finalUpdateBondsForNodes=e=>{e.walk({bond(e){e.nodes.forEach((t=>null==t?void 0:t.addBond(e)))}})},t.finalUpdateAutoNodes=e=>{e.walk({nodePre(e){e.autoMode&&(0,a.updateAutoNode)(e)}})}},5780:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.agentAnalyse=void 0;const o=n(6793),s=n(7525),r=n(7685),i=n(2933),a=n(1242),c=n(5718),d=n(4403),l=n(9963),u=n(9831),h=n(7824),p=n(1999),m=n(1309),f=n(559),g=n(2048),v=n(7548),b=n(8702),C=n(2960);t.agentAnalyse=(e,t)=>{e.agentMode="in";const n=e.curChar(),a=e.pos,c=(0,o.scanSimpleBond)(e);if(c)return(0,o.createSimpleBond)(e,c,a),e.setState(l.stateAgentMid);if(n>="A"&&n<="Z")return e.elementStartPos=e.pos,e.setState(u.stateElement,1);switch(n){case"`":return e.setAltFlag(),e.setState(l.stateAgentMid,1);case"{":return e.setState(p.stateCustom,1);case'"':return e.setState(h.stateCommentIn,1);case";":return(0,s.closeChain)(e),e.setState(m.stateAgentSpace,1);case":":return(0,r.createLabel)(e);case"#":return e.setState(f.stateNodeRef,1);case"^":return e.setState(g.stateCharge,1);case"$":return e.setState(C.stateFuncName,1);case"<":return(0,i.openBranch)(e);case">":return(0,i.closeBranch)(e);case"(":return(0,v.openParentheses)(e);case"[":return(0,v.openSquareBracket)(e);case")":case"]":case"}":return(0,v.closeBracketShort)(e);case"*":return(0,s.star)(e);case",":return y(e);case"_":return e.setState(b.stateUniBond,1);case"c":return(0,d.getNodeForced)(e,!0),e.setState(l.stateAgentMid,1);default:return t()}};const y=e=>((0,a.addNodeItem)(e,c.instChemComma),e.setState(l.stateAgentMid,1))},479:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.autoCorrection=void 0;const o=n(6445),s=n(6793),r=n(8079),i=n(3081),a=[-60,120,0,0,60,-120],c=(e,t)=>{e.dir=(0,s.makeBondStep)((e=>a[2*(e.slope+1)+(e.isNeg?1:0)])(e),null!=t?t:e.dir.length()),e.isCorr=!0,(0,o.ifDef)(e.nodes[1],(t=>{t.pt=e.calcPt()}))},d=(e,t,n)=>{var o;if(null===(o=t.nodes[1])||void 0===o?void 0:o.fixed)return;const s=t.nodes[1];if(!s)return void c(t,n);const{subChain:r}=s,i=s.pt;c(t,n);const a=s.pt.minus(i),d=e.curAgent.nodes.slice(s.index+1).filter((e=>e.subChain===r));d.reverse(),d.forEach((e=>{e.pt.iadd(a)}))};t.autoCorrection=(e,t,n)=>{if(0!==e.varSlope)return;const o=(0,r.getLastBond)(e);if(!o)return;if(!o.isAuto)return;const{dir:s}=o;if(o.isAuto&&s&&(0,i.is0)(s.y)&&0!==n)c(t,e.varLength);else{if(0===o.slope||!o.isCorr||0===n||o.isNeg===t.isNeg)return 0===o.slope||o.isCorr||0===n||o.isNeg===t.isNeg||o.slope===t.slope?void(0!==o.slope&&!o.isCorr&&t.isHorizontal()&&d(e,o)):(d(e,o),void c(t,e.varLength));c(t,e.varLength)}}},8006:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mergeBonds=t.onOpenBond=t.getNodeForBondStart=t.findBondBetweenNodes=t.bindNodeToCurrentBond=t.bindNodeToBond=t.changeBondToHard=t.createCommonBond=void 0;const o=n(7367),s=n(1560),r=n(4403),i=n(4061),a=n(9568),c=n(5235);t.createCommonBond=e=>{const t=new o.ChemBond;return t.color=e.varColor,t},t.changeBondToHard=(e,t)=>{t.soft=!1,e.chainSys.changeBondToHard(t)},t.bindNodeToBond=(e,n,o)=>{var s;e.curNode=n,o.nodes[1]=n;const r=o.nodes[0],i=null!==(s=null==r?void 0:r.autoMode)&&void 0!==s&&s;o.soft&&(i||n.autoMode)&&(0,t.changeBondToHard)(e,o),o.soft&&(e.nodesBranch.onSubChain(),e.nodesBranch.onNode(n)),e.curBond=void 0;const{dir:a}=o;a&&r&&!o.soft&&!a.isZero()&&(n.pt=r.pt.plus(a))},t.bindNodeToCurrentBond=(e,n)=>{const{curBond:o}=e;o&&(0,t.bindNodeToBond)(e,null!=n?n:(0,r.openNode)(e,!0),o)},t.findBondBetweenNodes=(e,t,n)=>e.curAgent.bonds.find((e=>{const{nodes:o}=e;return!e.middlePoints&&2===o.length&&(o[0]===t&&o[1]===n||o[0]===n&&o[1]===t)})),t.getNodeForBondStart=(e,t)=>{const{curNode:n}=e;if(n)return n;const o=(0,i.lastItem)(e.curAgent.commands),a=o instanceof s.ChemBracketEnd?o:void 0;if(a){const{nodeIn:e}=a;if(e)return a.bond=t,e}return(0,r.openNode)(e,!0)},t.onOpenBond=(e,n,o)=>{e.srcMap&&e.srcMap.push({begin:o,end:e.pos,obj:n});const s=(0,t.getNodeForBondStart)(e,n);(0,r.closeNode)(e),(0,c.applyMiddlePoints)(e,n),2!==n.n||n.align||(n.align=e.varAlign),n.nodes[0]=s,n.isAuto&&s.autoMode&&(n.soft=!1),n.color=e.varColor,e.curAgent.addBond(n),e.curBond=n,e.chainSys.addBond(n)},t.mergeBonds=(e,t,n,o)=>{t.n+=n.n,e.curNode=o,e.curBond=t,o.fixed=!0,n.isAuto=!1,n.soft=!1,n.nodes[1]=o;const[s,r]=n.nodes;s&&r&&(n.dir=r.pt.minus(s.pt)),e.chainSys.addBond(n),(0,a.removeItem)(e.curAgent.bonds,n),(0,a.removeItem)(e.curAgent.commands,n)}},8249:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createPolygonalBond=void 0;const o=n(6625),s=n(8006),r=n(8079),i=n(1476);t.createPolygonalBond=e=>{const t=e.pos-1,n=e.curChar();let a=1,c=0;"p"===n?c=1:"q"===n&&(c=-1),c||e.error("Invalid polygonal bond descriptor [c]",{c:n}),e.pos++,e.curChar()===n&&(a++,e.pos++);let d="";for(;(0,o.isDigit)(e.curChar());)d+=e.curChar(),e.pos++;const l=+d||0,u=(0,s.createCommonBond)(e);u.n=a,u.dir=(0,r.createPolygonStep)(e,c*(l||5),e.varLength),(0,i.scanBondSuffix)(e,u),u.tx=e.subStr(t),(0,s.onOpenBond)(e,u,t)}},6380:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createRingBond=t.findRingNodesEx=t.findRingNodes=void 0;const o=n(4403),s=n(8006);t.findRingNodes=e=>{const t=(0,o.getNodeForced)(e,!0),n=e.nodesBranch.nodes,s=n.slice(0,n.length-1),r=s.lastIndexOf(t);return r<0?void 0:s.slice(r)},t.findRingNodesEx=e=>{var n;return null!==(n=(0,t.findRingNodes)(e))&&void 0!==n?n:e.error("Cant close ring",{pos:e.pos-2})},t.createRingBond=(e,n)=>{e.pos+=n;const o=(0,s.createCommonBond)(e);o.nodes=(0,t.findRingNodesEx)(e),o.n=1,o.tx="o",o.ext="o",o.isCycle=!0,e.curAgent.addBond(o),e.curBond=void 0}},6793:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSimpleBond=t.scanSimpleBond=t.makeBondStep=void 0;const o=n(4018),s=n(8006),r=n(1476),i=n(479);t.makeBondStep=(e,t)=>(0,o.pointFromDeg)(e).times(0===t?1:t);class a{constructor(e,t,n,o=!1,s){this.n=e,this.angle=t,this.slope=n,this.soft=o,this.text=s}create(e,t){var n;const o=(0,s.createCommonBond)(e);return o.tx=null!==(n=this.text)&&void 0!==n?n:t,o.n=this.n,o.soft=this.soft,o.dir=this.calcDir(e,o),o.slope=this.slope,o.isAuto=!0,o.isText=0===this.angle&&0===this.slope,(0,i.autoCorrection)(e,o,this.slope),o}calcDir(e,n){let o;return 0===this.slope?o=this.angle:(n.slope=this.slope,o=(0===e.varSlope?30:e.varSlope)*this.slope),e.getAltFlag()&&(o+=180,n.isNeg=!0),(0,t.makeBondStep)(o,e.varLength)}}const c=new a(1,0,0,!0,"-"),d=new a(3,0,0,!0,"≡"),l={"-":c,"–":c,"−":c,"=":new a(2,0,0,!0),"%":d,"≡":d,"--":new a(1,0,0,!1,"-"),"==":new a(2,0,0,!1,"="),"%%":new a(3,0,0,!1,"≡"),"|":new a(1,90,0),"||":new a(2,90,0),"|||":new a(3,90,0),"/":new a(1,0,-1),"//":new a(2,0,-1),"///":new a(3,0,-1),"\\":new a(1,0,1),"\\\\":new a(2,0,1),"\\\\\\":new a(3,0,1)};t.scanSimpleBond=e=>{let t="",n=null;for(;;){const o=t+e.curChar(),s=l[o];if(!s)return null==n?void 0:n.create(e,t);t=o,n=s,e.pos++}},t.createSimpleBond=(e,t,n)=>{(0,r.scanBondSuffix)(e,t),(0,s.onOpenBond)(e,t,n)}},9472:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSplineBond=t.parseNodesListDef=void 0;const o=n(9063),s=n(6380),r=n(6445),i=n(4061),a=n(4403),c=n(3147),d=n(8079),l=n(8006),u=(e,t,n)=>{const s=(0,o.findNodeEx)(e,t[0],n),r=(0,o.findNodeEx)(e,t[1],n+t[0].length+1),i=Math.min(s.index,r.index),a=Math.max(s.index,r.index);return e.curAgent.nodes.slice(i,a+1)};t.parseNodesListDef=(e,t,n)=>{if(!t)return;const s=t.split(";");let r=n;return s.reduce(((t,n)=>{const s=n.split(":"),i=1===s.length?[...t,(0,o.findNodeEx)(e,n,r)]:[...t,...u(e,s,r)];return r+=n.length+1,i}),[])},t.createSplineBond=e=>{let n;e.pos++,(0,a.getNodeForced)(e,!0),"("!==e.curChar()?n={args:[],argPos:[]}:(e.pos++,n=(0,c.scanArgs)(e));const o=(0,d.makeParamsDict)(n.args,n.argPos),u=(0,l.createCommonBond)(e);u.isCycle=!1,u.tx="s",(0,d.setBondProperties)(e,u,o);const h=(0,r.ifDef)(o["#"],(n=>(0,t.parseNodesListDef)(e,n.value,n.valuePos))),p=h?(e=>e.length>1&&e[0]===(0,i.lastItem)(e)?{nodes:e.slice(0,e.length-1),isCycle:!0}:{nodes:e,isCycle:!1})(h):(e=>{var t;return null!==(t=(0,r.ifDef)((0,s.findRingNodes)(e),(e=>({nodes:e,isCycle:!0}))))&&void 0!==t?t:{nodes:[...e.nodesBranch.nodes],isCycle:!1}})(e);u.nodes=p.nodes,u.isCycle="o"in o||p.isCycle,u.ext="s",e.curAgent.addBond(u),e.curBond=void 0}},8079:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createUniversalBond=t.setBondProperties=t.parseStyle=t.parseBondMultiplicity=t.calcBondDirection=t.getLastBond=t.parseAxisCoordinate=t.parseRefsList=t.createPolygonStep=t.calcPolygonDir=t.makeParamsDict=void 0;const o=n(4018),s=n(6113),r=n(4583),i=n(9063),a=n(6445),c=n(5762),d=n(8006);t.makeParamsDict=(e,t)=>{const n=e.map(((e,n)=>e?{key:e[0],value:e.substring(1),valuePos:t[n]+1}:null)).filter((e=>e));return(0,r.listToDict)(n,(({key:e})=>e))},t.calcPolygonDir=(e,t)=>(0,o.pointFromRad)(e.polarAngle()+2*Math.PI/t).times(e.length()),t.createPolygonStep=(e,n,s)=>{var r,i;const c=null===(r=(0,t.getLastBond)(e))||void 0===r?void 0:r.dir;return null!==(i=(0,a.ifDef)(c,(e=>(0,t.calcPolygonDir)(e,n))))&&void 0!==i?i:new o.Point(s,0)},t.parseRefsList=(e,t,n)=>{var s;t||e.error("Invalid node reference '[ref]'",{ref:"",pos:n});let r=n;const a=t.split(";").map((t=>{const n=(0,i.findNodeEx)(e,t,r);return r+=t.length+1,n.pt})),c=a.reduce(((e,t)=>e.iadd(t)),new o.Point).times(1/a.length),d=null!==(s=e.curNode)&&void 0!==s?s:e.error("Expected node before bond",{pos:n});return c.minus(d.pt)},t.parseAxisCoordinate=(e,n,o,s)=>{if(!o.startsWith("#"))return(0,c.parseNum)(e,o,s);const r=(0,t.parseRefsList)(e,o.slice(1),s+1);return n?r.x:r.y},t.getLastBond=e=>e.chainSys.getLastBond(),t.calcBondDirection=(e,n)=>{var r,i,d,l,u;const h=()=>{const t=n.L;return t?(0,c.parseNum)(e,t.value,t.valuePos):e.varLength},p=e=>(0,o.pointFromDeg)(e).times(h()),m=null!==(u=null!==(l=null!==(d=null!==(i=null!==(r=(0,a.ifDef)(n.p,(n=>(0,t.parseRefsList)(e,n.value,n.valuePos))))&&void 0!==r?r:(0,a.ifDef)(n.P,(n=>{const o=""===n.value?5:(0,c.parseNum)(e,n.value,n.valuePos);return(0,t.createPolygonStep)(e,o||5,h())})))&&void 0!==i?i:(0,a.ifDef)(n.a,(n=>{var o,r;const i=null!==(r=(0,a.ifDef)(null===(o=(0,t.getLastBond)(e))||void 0===o?void 0:o.dir,(e=>(0,s.rad2deg)(e.polarAngle()))))&&void 0!==r?r:0;return p(i+(0,c.parseNum)(e,n.value,n.valuePos))})))&&void 0!==d?d:(0,a.ifDef)(n.A,(t=>p((0,c.parseNum)(e,t.value,t.valuePos)))))&&void 0!==l?l:(0,a.ifDef)(n.L,(()=>p(0))))&&void 0!==u?u:new o.Point(0,0);return(0,a.ifDef)(n.x,(n=>{m.x+=(0,t.parseAxisCoordinate)(e,!0,n.value,n.valuePos)})),(0,a.ifDef)(n.y,(n=>{m.y+=(0,t.parseAxisCoordinate)(e,!1,n.value,n.valuePos)})),m};const l={x:1,l:1,r:1,m:1};t.parseBondMultiplicity=(e,t,n)=>{const{value:o}=n,s=()=>o[1].toLowerCase();2===o.length&&"2"===o[0]&&s()in l?("x"===s()?t.setCross():t.align=s(),t.n=2):t.n=o?(0,c.parseNum)(e,o,n.valuePos):1};const u={m:1,l:1,r:1};t.parseStyle=(e,t)=>{t&&t[t.length-1].toLowerCase()in u?(e.align=t[t.length-1].toLowerCase(),e.style=t.slice(0,t.length-1)):e.style=t},t.setBondProperties=(e,n,o)=>{var s,r,i,c;(0,a.ifDef)(o.N,(o=>(0,t.parseBondMultiplicity)(e,n,o))),(0,a.ifDef)(o.h,(e=>{n.soft=!0;const t=e=>{n.n=0,n.dir&&0===n.dir.x&&(n.dir.x=.02*e)};"+"===e.value?t(1):"-"===e.value&&t(-1)})),(0,a.ifDef)(o.T,(e=>{n.tx=e.value})),1===n.n&&"H"in o&&n.setHydrogen(),(0,a.ifDef)(o.C,(e=>{switch(e.value){case"-":n.arr0=!0;break;case"+":n.arr0=!0,n.arr1=!0;break;default:n.arr1=!0}})),o["<"]&&(n.arr0=!0),o[">"]&&(n.arr1=!0),o["~"]&&(n.style="~"),(0,a.ifDef)(o.S,(e=>(0,t.parseStyle)(n,e.value)));const[d,l,u]=null!==(c=null!==(i=null!==(r=null!==(s=(0,a.ifDef)(o.w,(e=>[e.value,1,!1])))&&void 0!==s?s:(0,a.ifDef)(o.d,(e=>[e.value,-1,!1])))&&void 0!==r?r:(0,a.ifDef)(o.W,(e=>[e.value,1,!0])))&&void 0!==i?i:(0,a.ifDef)(o.D,(e=>[e.value,-1,!0])))&&void 0!==c?c:["",0,!1];((t,o,s)=>{const[r,i]=(()=>{switch(t){case"+":return[0,o];case"-":return[o,0];case"0":case"1":return[0,0];case"2":return[o,o];default:return[null,null]}})();n.w0=null!=r?r:e.curWidth,n.w1=null!=i?i:e.curWidth,s&&(e.curWidth=null!=i?i:e.curWidth)})(d,l,u)},t.createUniversalBond=(e,n,o,s)=>{const r=(0,d.createCommonBond)(e);e.curNode||(e.curNode=(0,d.getNodeForBondStart)(e,r));const i=(0,t.makeParamsDict)(n,o);r.dir=(0,t.calcBondDirection)(e,i),(0,t.setBondProperties)(e,r,i),(0,d.onOpenBond)(e,r,s)}},7548:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.closeBracketShort=t.closeBracket=t.getNodeForBracketEnd=t.openBrace=t.openSquareBracket=t.openParentheses=void 0;const o=n(7889),s=n(1560),r=n(2933),i=n(4403),a=n(5507),c=n(4061),d=n(6445),l=n(503),u=n(828),h=n(9963),p=n(1298);class m extends o.StackItem{constructor(e,t){super(e),this.begin=t}msgInvalidClose(){return"It is necessary to close the bracket"}}t.openParentheses=e=>(e.pos++,"*"===e.curChar()?(0,r.openBranch)(e):(f(e,"(",e.pos-1),e.setState(p.stateBracketBegin))),t.openSquareBracket=e=>(f(e,"[",e.pos++),e.setState(p.stateBracketBegin)),t.openBrace=e=>(f(e,"{",e.pos-1),e.pos++,e.setState(p.stateBracketBegin));const f=(e,t,n)=>{const o=new s.ChemBracketBegin(t);o.color=e.varColor,e.mulCounter.onOpenBracket(),e.curAgent.commands.push(o),e.push(new m(n,o)),e.bracketsCtrl.onBracket(o),e.varPadding.length&&(o.padding=e.varPadding,e.varPadding=[]),e.curBond?(o.bond=e.curBond,o.nodes[0]=o.bond.nodes[0]):(o.nodes[0]=e.curNode,(0,i.closeNode)(e),e.chainSys.createSubChain())},g={"(":")","[":"]","{":"}"};t.getNodeForBracketEnd=e=>{const{curNode:t}=e;if(t)return t;const{commands:n}=e.curAgent;let o=(0,c.lastItem)(n);if(o instanceof a.ChemMulEnd&&(o=n[n.length-2]),o instanceof s.ChemBracketEnd){const{nodeIn:e}=o;if(e)return e}return(0,i.openNode)(e,!0)},t.closeBracket=(e,n,o)=>{var r;return null!==(r=(0,d.ifDef)(e.pop(),(r=>{var a;if(r instanceof m){const c=null!==(a=g[r.begin.text])&&void 0!==a?a:e.error("Invalid bracket pair [s]",{s:r.begin.text+n});c!==n&&e.error("Expected [must] instead of [have]",{must:c,have:n,pos:o,pos0:r.pos}),(0,l.checkMulBeforeBracket)(e),e.mulCounter.onCloseBracket();const d=new s.ChemBracketEnd(n,r.begin,(0,t.getNodeForBracketEnd)(e)),{commands:u}=e.curAgent;return u.push(d),r.begin.end=d,(0,i.closeNode)(e),e.chargeOwner=d,e.bracketsCtrl.onBracket(d),d}return e.error("Cant close bracket before branch",{pos:o,pos0:r.pos+1})})))&&void 0!==r?r:e.error("Invalid bracket close",{pos:o})},t.closeBracketShort=e=>{const n=e.curChar();let o=1;"}"===n&&"}"===e.nextChar()&&(o=2);const s=(0,t.closeBracket)(e,n,e.pos);return e.pos+=o,(0,u.scanPostItem)(e,(e=>{s.n=e})),e.setState(h.stateAgentMid)}},2933:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkBranch=t.closeBranch=t.openBranch=t.BranchDecl=void 0;const o=n(7889),s=n(4403),r=n(8006),i=n(9963);class a extends o.StackItem{constructor(e,t,n){super(e),this.node=t,this.bond=n}msgInvalidClose(){return"It is necessary to close the branch"}}t.BranchDecl=a,t.openBranch=e=>{const t=(0,r.getNodeForBondStart)(e,void 0);return e.push(new a(e.pos,t,e.curBond)),e.chainSys.onBranchBegin(),e.nodesBranch.onBranchBegin(),e.setState(i.stateAgentMid,1)},t.closeBranch=e=>{const t=e.pop();if(t){if(t instanceof a)return(0,r.bindNodeToCurrentBond)(e,e.curNode),(0,s.closeNode)(e),e.curNode=t.node,e.chainSys.onBranchEnd(),e.nodesBranch.onBranchEnd(),e.chainSys.setCurNode(t.node),e.setState(i.stateAgentMid,1);e.error("Cant close branch before bracket",{pos:e.pos,pos0:t.pos+1})}return e.error("Invalid branch close",{pos:e.pos})},t.checkBranch=e=>{const t=e.pop();t&&e.error(t.msgInvalidClose(),{pos:t.pos})}},2121:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createChemOp=t.onCloseOp=t.opsList=t.OpDef=void 0;const o=n(1429),s=n(3289);class r{constructor(e,t=null,n=!1){this.src=e,this.dst=t,this.div=n}opCode(){var e;return null!==(e=this.dst)&&void 0!==e?e:this.src}}t.OpDef=r,t.opsList=[new r("+"),new r("--\x3e","—→",!0),new r("--|>","—→",!0),new r("->","→",!0),new r("®","→",!0),new r("→",null,!0),new r("=",null,!0),new r("↔",null,!0),new r("<->","↔",!0),new r("<=>","⇌",!0),new r("<==>","⇌",!0),new r("*","∙"),new r("!=","≠",!0)],t.onCloseOp=e=>{e.curOp=void 0},t.createChemOp=(e,t)=>{var n;const{preComm:r}=e;(0,s.closeEntity)(e);const i=new o.ChemOp(t.src,t.opCode(),t.div);i.color=e.varColor,i.commentPre=r,e.srcMap&&(e.entityBegin=null!==(n=e.eject("preCommPos"))&&void 0!==n?n:e.pos-t.src.length),(0,s.onCreateEntity)(e,i),e.curOp=i,t.div&&e.curPart++}},2321:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getAtomColor=t.getItemColor=void 0;const o=n(6445);t.getItemColor=e=>{var t,n;return null!==(n=null!==(t=(0,o.ifDef)(e.varItemColor1,(t=>(e.varItemColor1=void 0,t))))&&void 0!==t?t:e.varItemColor)&&void 0!==n?n:e.varColor},t.getAtomColor=e=>{var t;return null!==(t=(0,o.ifDef)(e.varAtomColor1,(t=>(e.varAtomColor1=void 0,t))))&&void 0!==t?t:e.varAtomColor}},7685:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createLabel=void 0;const o=n(60),s=n(4403),r=n(9963);t.createLabel=e=>{e.pos++;const t=(0,o.scanId)(e);return t?e.references[t]=(0,s.getNodeForced)(e,!0):e.error("Invalid label",{pos:e.pos}),e.setState(r.stateAgentMid)}},3289:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.closeEntity=t.onCreateEntity=void 0;const o=n(2121),s=n(7525);t.onCreateEntity=(e,t)=>{e.curEntity=t,e.expr.entities.push(t)},t.closeEntity=e=>{e.curEntity&&(e.curEntity=void 0,(0,s.onCloseAgent)(e),(0,o.onCloseOp)(e)),e.preComm=void 0}},9063:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.findNodeEx=t.findNode=void 0;const o=n(6887);t.findNode=(e,t)=>{const{nodes:n}=e.curAgent,s=+t;if(!Number.isNaN(s))return n[s<0?s+n.length:s-1];const r=e.references[t];if(r)return r;const i=(0,o.findElement)(t);if(i){const e=n.find((e=>1===e.items.length&&e.items[0].obj===i));if(e)return e}},t.findNodeEx=(e,n,o)=>{const s=(0,t.findNode)(e,n);return s||e.error("Invalid node reference '[ref]'",{ref:n,pos:o}),s}},1297:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getLastItem=t.closeItem=void 0;const o=n(4061);t.closeItem=e=>{},t.getLastItem=e=>{var t;return(0,o.lastItem)(null===(t=e.curNode)||void 0===t?void 0:t.items)}},5235:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createMiddlePoint=t.checkMiddlePoints=t.applyMiddlePoints=void 0;const o=n(4018),s=n(4403),r=n(3147),i=n(8079);t.applyMiddlePoints=(e,t)=>{const{middlePoints:n}=e;if(0===n.length)return;const s=n.map((e=>e.pt));s.push(t.dir),t.middlePoints=s,t.dir=s.reduce(((e,t)=>e.iadd(t)),new o.Point),t.soft=!1,n.length=0},t.checkMiddlePoints=e=>{0!==e.middlePoints.length&&e.error("Invalid middle point",{pos:e.middlePoints[0].pos})},t.createMiddlePoint=e=>{const t=e.pos-1;e.pos++,"("!==e.curChar()&&e.error("Expected '(' after [S]",{pos:e.pos-1,S:"_m"}),(0,s.getNodeForced)(e,!0),e.pos++;const n=(0,r.scanArgs)(e),o=(0,i.makeParamsDict)(n.args,n.argPos),a=(0,i.calcBondDirection)(e,o);e.middlePoints.push({pt:a,pos:t})}},503:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkMul=t.checkMulBeforeBracket=t.stopMul=t.startMul=void 0;const o=n(5507),s=n(4403),r=n(6445);t.startMul=(e,t,n)=>{const i=new o.ChemMul(t,n,e.varColor),{curNode:a,curBond:c}=e;i.nodes[0]=a||(0,r.ifDef)(c,(()=>(0,s.openNode)(e,!0))),(0,s.closeNode)(e),e.chainSys.closeSubChain(),e.curAgent.commands.push(i),e.mulCounter.create(i),e.bracketsCtrl.clear()},t.stopMul=(e,t)=>{e.mulCounter.close(),e.curAgent.commands.push(new o.ChemMulEnd(t))},t.checkMulBeforeBracket=e=>{const n=e.mulCounter.getMulForBracket();n&&(0,t.stopMul)(e,n)},t.checkMul=e=>{const n=e.mulCounter.getMulForced();n&&(0,t.stopMul)(e,n)}},4403:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateAutoNode=t.getNodeForced=t.openNode=t.closeNode=void 0;const o=n(8666),s=n(2390),r=n(6887),i=n(759),a=n(5235),c=n(8006),d=n(1297),l=n(4061),u=n(1560),h=n(7289);t.closeNode=e=>{(0,d.closeItem)(e),e.curNode=void 0,e.chargeOwner=void 0},t.openNode=(e,n=!1)=>{var s;const r=e.curBond;if(r){const{dir:t}=r;if(r.soft&&n&&(0,c.changeBondToHard)(e,r),t&&!t.isZero()){if(!r.soft){const t=r.calcPt(),n=e.chainSys.findNode(t);if(n){if(e.nodesBranch.onNode(n),(!r.soft||n.autoMode)&&!r.middlePoints){n.fixed=!0;const t=r.nodes[0],o=(0,c.findBondBetweenNodes)(e,t,n);if(o)return(0,c.mergeBonds)(e,o,r,n),n}return(0,c.bindNodeToBond)(e,n,r),n}}const n=null===(s=e.curAgent)||void 0===s?void 0:s.bonds.find((({soft:e,nodes:n,dir:o})=>{var s,i;return e&&2===n.length&&(null===(s=n[0])||void 0===s?void 0:s.index)===(null===(i=r.nodes[0])||void 0===i?void 0:i.index)&&!!n[1]&&o&&t.equals(o)}));if(n){const t=n.nodes[1];return(0,c.mergeBonds)(e,n,r,t),e.chainSys.setCurNode(t),t}}}(0,t.closeNode)(e),(0,a.checkMiddlePoints)(e),(0,l.lastItem)(e.curAgent.commands)instanceof u.ChemBracketEnd&&e.chainSys.createSubChain();const i=e.curAgent.addNode(new o.ChemNode);return i.index=e.curAgent.nodes.length-1,i.autoMode=n,i.color=e.varColor,e.curNode=i,e.chargeOwner=i,e.chainSys.addNode(i),e.nodesBranch.onNode(i),e.mulCounter.onNode(i),i.bCenter=e.centralNode,e.centralNode=!1,(0,c.bindNodeToCurrentBond)(e,i),e.bracketsCtrl.onNode(i),e.background&&(e.curAgent.commands.push((0,h.createBackground)(e.background,i)),e.background=void 0),i},t.getNodeForced=(e,n)=>{var o;return null!==(o=e.curNode)&&void 0!==o?o:(0,t.openNode)(e,n)},t.updateAutoNode=e=>{var t,n;e.items.push(new s.ChemNodeItem(r.PeriodicTable.dict.C));const o=Array.from(e.bonds).reduce(((e,t)=>e+t.n),0),a=4+(null!==(n=null===(t=e.charge)||void 0===t?void 0:t.value)&&void 0!==n?n:0)-Math.round(o);a>0&&e.items.push(new s.ChemNodeItem(r.PeriodicTable.dict.H,new i.ChemK(a)))}},7956:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.replaceGreek=t.createComment=void 0;const o=n(2613),s=n(6414),r=n(9581);t.createComment=e=>{const t=i(e),n=d(t);return e.pos++,new s.ChemComment(n)};const i=e=>{const t=e.pos;return(0,r.scanTo)(e,'"')||e.error("Comment is not closed",{pos:t-1}),e.subStr(t)},a=(e,t,n,o)=>{let s=0,r=e;for(;s<r.length;){const e=r.indexOf(t,s);if(e<0||e===r.length)break;const i=r.indexOf(n,e+1);if(i<0)break;const a=o(r.slice(e+1,i));void 0!==a?(r=r.slice(0,e)+a+r.slice(i+1),s=e+a.length):s=e+1}return r},c=[[/\|\^/g,"↑"],[/ArrowUp/g,"↑"],[/\|v/g,"↓"],[/ArrowDown/g,"↓"],[/\^o/g,"°"]],d=e=>{let n=c.reduce(((e,[t,n])=>e.replace(t,n)),e);return n=(0,t.replaceGreek)(n),n=a(n,"`","`",(e=>{var t;return null!==(t=o.Lang.findPhrase(e))&&void 0!==t?t:e})),n};t.replaceGreek=e=>a(e,"[","]",(e=>l[e]));const l={alpha:"α",Alpha:"Α",beta:"β",Beta:"Β",gamma:"γ",Gamma:"Γ",delta:"δ",Delta:"Δ",epsilon:"ε",Epsilon:"Ε",zeta:"ζ",Zeta:"Ζ",eta:"η",Eta:"Η",theta:"θ",Theta:"Θ",iota:"ι",Iota:"Ι",kappa:"κ",Kappa:"Κ",lambda:"λ",Lambda:"Λ",mu:"μ",Mu:"Μ",nu:"ν",Nu:"Ν",xi:"ξ",Xi:"Ξ",omicron:"ο",Omicron:"Ο",pi:"π",Pi:"Π",rho:"ρ",Rho:"Ρ",sigma:"σ",Sigma:"Σ",tau:"τ",Tau:"Τ",upsilon:"υ",Upsilon:"Υ",phi:"φ",Phi:"Φ",chi:"χ",Chi:"Χ",psi:"ψ",Psi:"Ψ",omega:"ω",Omega:"Ω"}},6625:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isDigit=void 0,t.isDigit=e=>e>="0"&&e<="9"},2658:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSpace=void 0,t.isSpace=e=>" "===e||"\t"===e||"\n"===e},5762:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseNum=void 0;const n={$32:Math.sqrt(3)/2,$3:Math.sqrt(3),$3x2:2*Math.sqrt(3),$2:Math.sqrt(2),$22:Math.sqrt(2)/2,$2x2:2*Math.sqrt(2),"½":.5,"¼":1/4,"¾":3/4,"⅓":1/3,"⅔":2/3},o=(e,t,o)=>{var s;return null!==(s=n[t])&&void 0!==s?s:((e,t,n)=>{e.error("Invalid number [n]",{n:t,pos:n})})(e,t,o)};t.parseNum=(e,t,n)=>{const s=t.trim();if(!s)return 0;const r=+s;return Number.isNaN(r)?((e,t,n)=>{let s=1,r=t,i=n;return t.startsWith("-")&&(s=-1,i++,r=r.slice(1)),r.startsWith("%")?((e,t,n)=>{const s=t.indexOf(":");return s<0?((e,t,n)=>{var o;return null!==(o=e.varsDict[t])&&void 0!==o?o:e.error("Undefined variable [name]",{name:t,pos:n})})(e,t,n):((e,t,n,s)=>{t||e.error("Expected variable name",{pos:s});const r=+n,i=Number.isNaN(r)?o(e,n,s+t.length+1):r;return e.varsDict[t]=i,i})(e,t.slice(0,s),t.slice(s+1),n)})(e,r.slice(1),i+1)*s:o(e,r,i)*s})(e,s,n):r}},9217:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parsePadding=void 0;const o=n(5762);t.parsePadding=(e,t,n)=>{const s=t.split(";");let r=0;return s.map((t=>{const s=(0,o.parseNum)(e,t,r+n);return r+=t.length+1,s}))}},4724:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.prepareText=void 0;const o=n(2957);t.prepareText=e=>{const t=`${e.srcText} `,n=(0,o.mainPreProcess)(t);e.text=n,e.expr.src0=t,e.expr.src=n}},9581:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanTo=t.scan=void 0,t.scan=(e,t)=>{for(;!e.isFinish()&&t(e.curChar());)e.pos++;return!e.isFinish()},t.scanTo=(e,n)=>(0,t.scan)(e,(e=>e!==n))},3147:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanArgs=void 0,t.scanArgs=e=>{const t=e.pos;let n=t;const o=[],s=[];let r=0;const i=()=>{s.push(n),o.push(e.subStr(n)),n=e.pos+1};for(;!e.isFinish();){const t=e.curChar();if("("===t)r++;else if(")"===t){if(0===r)break;r--}else","===t&&0===r&&i();e.pos++}return e.isFinish()&&e.error("It is necessary to close the bracket",{pos:t-1}),t!==e.pos&&i(),e.pos++,{args:o,argPos:s}}},1476:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanBondSuffix=void 0;const n=[["0",e=>{e.n=0}],["o",e=>{e.n=0}],["h",e=>e.setHydrogen()],["ww",e=>{e.w0=1}],["w",e=>{e.w1=1}],["dd",e=>{e.w0=-1}],["d",e=>{e.w1=-1}],["x",e=>e.setCross()],["~",e=>{e.style="~"}],["r",e=>{e.align="r"}],["m",e=>{e.align="m"}],["l",e=>{e.align="l"}],["vvv",e=>{e.arr0=!0,e.arr1=!0}],["vv",e=>{e.arr0=!0}],["v",e=>{e.arr1=!0}]];t.scanBondSuffix=(e,t)=>{for(;;){const o=n.find((([t])=>e.isCurPosEq(t)));if(!o)break;const[s,r]=o;r(t),e.pos+=s.length}}},3074:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanCharge=void 0;const o=n(6916);t.scanCharge=(e,t="RT")=>{if(e.isFinish())return;const n=e.pos;let s;for(;;){e.pos++;const r=(0,o.createCharge)(e.subStr(n),t);if(!r){e.pos--;break}if(s=r,e.isFinish())break}return s}},4444:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanCoeff=void 0;const o=n(759),s=n(9581);t.scanCoeff=e=>{const t=()=>e.getAltFlag()?"LB":void 0;let n=e.text[e.pos];"`"===n&&(e.setAltFlag(),n=e.text[++e.pos]);const r=e.pos;if(n){if(n>="0"&&n<="9"){for(e.pos++;!(e.isFinish()||(n=e.text[e.pos],!n||n<"0"||n>"9"));)e.pos++;const s=e.subStr(r);return new o.ChemK(+s,t())}if("'"===n){e.pos++,(0,s.scanTo)(e,"'")||e.error("Abstract coefficient is not closed",{pos:r});const n=e.subStr(r+1);return e.pos++,new o.ChemK(n,t())}}}},60:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanId=t.isId=t.isIdFirstChar=void 0,t.isIdFirstChar=e=>/[A-Za-z]/.test(e);const n=e=>/[A-Z\d]/i.test(e);t.isId=e=>!(!e||!(0,t.isIdFirstChar)(e[0])||Array.from(e.slice(1)).find((e=>!n(e)))),t.scanId=e=>{const o=e.pos;if((0,t.isIdFirstChar)(e.curChar()))for(e.pos++;n(e.curChar());)e.pos++;const s=e.subStr(o);return""===s?void 0:s}},4275:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanInt=void 0;const o=n(6625);t.scanInt=e=>{const t=e.pos;for("-"===e.curChar()&&(0,o.isDigit)(e.text[t+1])&&e.pos++;(0,o.isDigit)(e.curChar());)e.pos++;return e.pos===t?void 0:+e.subStr(t)}},1896:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanOp=void 0;const o=n(2121),s=n(2658);t.scanOp=e=>{const t=o.opsList.find((t=>e.isCurPosEq(t.src)));if(t){const n=e.pos+t.src.length,o=e.text[n];if(o&&!(0,s.isSpace)(o)&&'"'!==o)return;e.pos+=t.src.length}return t}},828:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanPostItem=void 0;const o=n(4444),s=n(6445);t.scanPostItem=(e,t)=>{var n;return null!==(n=(0,s.ifDef)((0,o.scanCoeff)(e),(e=>(t(e),!0))))&&void 0!==n&&n}},1075:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.skipSpaces=void 0;const o=n(2658);t.skipSpaces=e=>{for(;e.pos<e.text.length&&(0,o.isSpace)(e.curChar());)e.pos++}},1120:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.globalMacros=t.Macros=void 0,t.Macros=class{constructor(e){this.name=e,this.body=""}},t.globalMacros={}},9953:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PreProcCtx=void 0;const o=n(4086);class s{constructor(e,t){this.src="",this.dst="",this.pos=0,this.stack=[],e instanceof s?(this.src=e.src,this.pos=e.pos):(this.src=e,void 0!==t&&(this.pos=t))}error(e,t=0){throw 0!==t&&(this.pos=t<0?this.pos+t:t),new o.ChemError(e,{pos:this.pos})}errorPar(e,t){throw new o.ChemError(e,t)}n(e=1){if(0===e)return"";this.pos+e>this.src.length&&this.error("Unexpected end of macros");const t=this.pos;return this.pos+=e,this.src.slice(t,this.pos)}search(e){const t=this.pos,n=this.src.indexOf(e,t);if(!(n<0))return this.pos=n+e.length,this.src.slice(t,n)}searchEx(e){var t;return null!==(t=this.search(e))&&void 0!==t?t:this.errorPar("Expected [cond] character in macros",{cond:e})}end(){return this.pos<this.src.length}write(e){this.dst+=e}writeFinish(){this.write(this.src.slice(this.pos)),this.pos=this.src.length}push(){this.stack.unshift(this.dst),this.dst=""}pop(){const e=this.dst;return this.dst=this.stack.shift()||"",e}clear(){this.dst=""}}t.PreProcCtx=s},4851:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.bodyPreprocess=void 0;const o=n(60),s=n(1431);t.bodyPreprocess=e=>{for(;;){const t=e.search("@");if(void 0===t){e.writeFinish();break}e.write(t);const n=e.n();if(":"===n)(0,s.defMacro)(e);else{if(!(0,o.isIdFirstChar)(n[0])){e.pos--;break}e.write(`@${n}`)}}}},1431:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defMacro=void 0;const o=n(60),s=n(4851),r=n(1120);t.defMacro=e=>{const t=e.pos,n=e.searchEx("(");(0,o.isIdFirstChar)(n[0])||e.error("Invalid macro name",t);const i=new r.Macros(n);e.push(),(0,s.bodyPreprocess)(e),i.body=e.pop();const a=e.n();"("===a?e.write(`@${n}${a}`):";"!==a&&e.error("Invalid macros end"),r.globalMacros[n]=i}},4426:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.execMacros=t.readRealParams=t.applyParamValues=void 0;const o=n(60),s=n(1120),r=n(9953),i=n(1709),a=n(6708);t.applyParamValues=(e,t,n)=>{if(0===e.names.length)return n;let o=0;t.forEach((t=>{const n=t.indexOf(":");let s=!1;if(n>=0){const o=t.slice(0,n);o in e.dict&&(e.dict[o]=t.slice(n+1),s=!0)}if(!s){const n=e.names[o++];void 0!==n&&t&&(e.dict[n]=t)}})),n.writeFinish();const s=n.dst.split("&");return s.slice(1).forEach(((t,n)=>{const o=n+1,r=e.names.reduce(((e,n)=>t.slice(0,Math.min(n.length,t.length))===n&&n.length>e.length?n:e),"");r&&(s[o]=e.dict[r]+s[o].slice(r.length))})),new r.PreProcCtx(s.join(""))},t.readRealParams=e=>{const t=[];if(")"!==e.n()){e.pos--;do{const n=e.pos,o=(0,a.scanPar)(e.src,n);o>=e.src.length&&e.error("Real params list is not closed"),t.push(e.n(o-n))}while(")"!==e.n())}return t},t.execMacros=(e,n)=>{const a=new r.PreProcCtx(e),c=(0,i.readFormalPars)(a),d=(0,t.applyParamValues)(c,n,a);for(;;){const e=d.search("@");if(void 0===e){d.writeFinish();break}d.write(e);const n=d.searchEx("(");(0,o.isId)(n)||d.errorPar("Invalid macro [name]",{name:n});const r=s.globalMacros[n];if(r){const e=(0,t.readRealParams)(d);d.write((0,t.execMacros)(r.body,e))}else d.errorPar("Macros not found: [name]",{name:n})}return d.dst}},2957:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mainPreProcess=void 0;const o=n(4851),s=n(4426),r=n(9953);t.mainPreProcess=e=>{const t=new r.PreProcCtx(e);(0,o.bodyPreprocess)(t),t.pos!==e.length&&t.error("Invalid preprocessor finish");const n=`)${t.dst}`;return(0,s.execMacros)(n,[])}},1709:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.readFormalPars=void 0;const o=n(60),s=n(6708);t.readFormalPars=e=>{const t={},n=[];if(")"!==e.n())for(e.pos--;;){const r=e.pos,i=(0,s.scanPar)(e.src,r);i>=e.src.length&&e.error("Formal params list is not closed");const a=e.n(i-r),c=a.indexOf(":"),[d,l]=c<0?[a,""]:[a.slice(0,c),a.slice(c+1)];if((0,o.isId)(d)||e.errorPar("Invalid parameter name: [name]",{name:d}),t[d]=l,n.push(d),")"===e.n())break}return{dict:t,names:n}}},6708:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanPar=void 0,t.scanPar=(e,t)=>{let n=0,o=!1,s=t;for(;s<e.length;){const t=e[s];if('"'===t)o=!o;else if("("!==t||o){if(","===t&&!o&&0===n)break;if(")"===t&&!o){if(!(n>0))break;n--}}else n++;s++}return s}},4907:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},7064:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSrcItemsForObject=void 0,t.getSrcItemsForObject=(e,t)=>{var n;return null!==(n=null==t?void 0:t.filter((({obj:t})=>e===t)))&&void 0!==n?n:[]}},7962:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,s)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),s(n(4907),t),s(n(7064),t)},5717:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateAgent=void 0;const o=n(7525),s=n(7270);t.stateAgent=e=>((0,o.createAgent)(e),e.agentMode="begin",e.setState(s.stateAgentBegin))},7270:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateAgentBegin=void 0;const o=n(6445),s=n(4444),r=n(8970),i=n(2960);t.stateAgentBegin=e=>{e.agentMode="begin";const t=e.curAgent;if(t){if("$"===e.curChar())return e.setState(i.stateFuncName,1);(0,o.ifDef)((0,s.scanCoeff)(e),(n=>{t.n=n,n&&(n.color=e.varColor),e.srcMap&&(e.addSrcMapItem(t,e.entityBegin,"agentK"),e.entityBegin=e.pos)}))}else e.error("stateAgentBegin with empty agent",{});return e.setState(r.stateAgentIn)}},8970:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateAgentIn=void 0;const o=n(5780);t.stateAgentIn=e=>(0,o.agentAnalyse)(e,(()=>e.error("Unknown element character '[C]'",{C:e.curChar(),pos:e.pos})))},9963:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateAgentMid=void 0;const o=n(5780),s=n(3289),r=n(4074);t.stateAgentMid=e=>(0,o.agentAnalyse)(e,(()=>((0,s.closeEntity)(e),e.setState(r.stateBegin))))},1309:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateAgentSpace=void 0;const o=n(1075),s=n(9963);t.stateAgentSpace=e=>((0,o.skipSpaces)(e),e.setState(s.stateAgentMid))},4074:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateBegin=void 0;const o=n(2121),s=n(1896),r=n(1075),i=n(5717),a=n(6310),c=n(1331);t.stateBegin=e=>{if((0,r.skipSpaces)(e),e.isFinish())return 0;if('"'===e.curChar())return e.setState(a.stateCommentPre,1);const t=(0,s.scanOp)(e);return null!=t?((0,o.createChemOp)(e,t),e.setState(c.stateOpEnd)):e.setState(i.stateAgent)}},1298:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateBracketBegin=void 0;const o=n(4444),s=n(6445),r=n(503),i=n(9963);t.stateBracketBegin=e=>((0,s.ifDef)((0,o.scanCoeff)(e),(t=>{(0,r.startMul)(e,t,!0)})),e.setState(i.stateAgentMid))},2048:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateCharge=void 0;const o=n(4403),s=n(3074),r=n(9963);t.stateCharge=e=>{var t,n;const{pos:i,curNode:a,curBond:c}=e,d=null!==(t=e.chargeOwner)&&void 0!==t?t:!a&&c?(0,o.openNode)(e,!0):e.error("Expected node declaration before charge",{pos:i-1}),l=e.getAltFlag(),u=e.eject("varPos");return d.charge=null!==(n=(0,s.scanCharge)(e,null!=u?u:l?"LT":"RT"))&&void 0!==n?n:e.error("Invalid charge declaration",{pos:i}),e.setState(r.stateAgentMid)}},7824:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateCommentIn=void 0;const o=n(1242),s=n(7956),r=n(9963);t.stateCommentIn=e=>((0,o.addNodeItem)(e,(0,s.createComment)(e)),e.setState(r.stateAgentMid))},6310:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateCommentPre=void 0;const o=n(7956),s=n(4074);t.stateCommentPre=e=>(e.preCommPos=e.pos-1,e.preComm=(0,o.createComment)(e),e.setState(s.stateBegin))},1999:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateCustom=void 0;const o=n(1242),s=n(5912),r=n(3042),i=n(828),a=n(9963),c=n(7548),d=n(7956),l=n(6605);t.stateCustom=e=>{var t;if("{"===e.curChar())return(0,c.openBrace)(e);const n=e.pos;e.pos=(0,l.scanMarkupEnd)(e.text,e.pos,"}")-1,"}"!==e.text[e.pos]&&e.error("Abstract element is not closed",{pos:n-1});const u=(0,d.replaceGreek)(e.subStr(n)),h=(0,o.addNodeItem)(e,null!==(t=s.ChemRadical.dict[u])&&void 0!==t?t:new r.ChemCustom(u));return e.pos++,(0,i.scanPostItem)(e,(e=>{h.n=e})),e.setState(a.stateAgentMid)}},9831:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateElement=void 0;const o=n(9581),s=n(6887),r=n(5912),i=n(1242),a=n(3404);t.stateElement=e=>{var t,n;(0,o.scan)(e,(e=>e>="a"&&e<="z"));const c=e.subStr(e.elementStartPos),d=null!==(n=null!==(t=(0,s.findElement)(c))&&void 0!==t?t:r.ChemRadical.dict[c])&&void 0!==n?n:e.error("Unknown element '[Elem]'",{pos:e.elementStartPos,Elem:c});return(0,i.addNodeItem)(e,d),e.setState(a.statePostItem)}},2960:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateFuncName=void 0;const o=n(9581),s=n(3147),r=n(6445),i=n(9963),a=n(8391),c=n(7270);t.stateFuncName=e=>{const t=e.pos;(0,o.scanTo)(e,"(")||e.error("Expected '(' after [S]",{S:"$",pos:t-1});const n=e.subStr(t);e.pos++;const{args:d,argPos:l}=(0,s.scanArgs)(e);return(0,r.ifDef)(a.funcsDict[n],(t=>t(e,d,l))),"begin"===e.agentMode?e.setState(c.stateAgentBegin):e.setState(i.stateAgentMid)}},559:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateNodeRef=void 0;const o=n(2658),s=n(1309),r=n(6887),i=n(60),a=n(9963),c=n(4275),d=n(8006),l=(e,t,n)=>e.error("Invalid node reference '[ref]'",{ref:t,pos:n}),u=e=>e.nodes.map((e=>{var t;return null!==(t=null==e?void 0:e.index)&&void 0!==t?t:""})).join(","),h=(e,t)=>{var n;const{curBond:o}=e;if(o){o.soft=!1,o.nodes[1]=t;const s=u(o),r=null===(n=e.curAgent)||void 0===n?void 0:n.bonds.find((e=>u(e)===s));r&&r!==o?(e.chainSys.setCurNode(o.nodes[1]),(0,d.mergeBonds)(e,r,o,t)):e.chainSys.bondToRef(o)}else e.chainSys.addNode(t),e.nodesBranch.onNode(t);e.curNode=t,t.fixed=!0,e.nodesBranch.onNode(t)};t.stateNodeRef=e=>{if((0,o.isSpace)(e.curChar()))return e.setState(s.stateAgentSpace);const t=e.pos,n=(0,c.scanInt)(e);if(void 0!==n)((e,t,n)=>{const{nodes:o}=e.curAgent,s=t<0?o.length+t:t-1;(s<0||s>=o.length)&&l(e,String(t),n),h(e,o[s])})(e,n,t);else{const n=(0,i.scanId)(e);n?((e,t,n)=>{const o=e.references[t];if(o)h(e,o);else{const o=(0,r.findElement)(t);o?((e,t,n)=>{var o;const{nodes:s}=e.curAgent;h(e,null!==(o=s.find((e=>((e,t)=>1===e.items.length&&e.items[0].obj===t)(e,t))))&&void 0!==o?o:l(e,t.id,n))})(e,o,n):l(e,t,n)}})(e,n,t):l(e,e.curChar(),t)}return e.setState(a.stateAgentMid)}},1331:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateOpEnd=void 0;const o=n(7956),s=n(4074);t.stateOpEnd=e=>('"'===e.curChar()&&(e.pos++,e.curOp.commentPost=(0,o.createComment)(e)),e.curOp&&e.addSrcMapItem(e.curOp,e.eject("entityBegin")),e.setState(s.stateBegin))},3404:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.statePostItem=void 0;const o=n(1297),s=n(3074),r=n(828),i=n(9963);t.statePostItem=e=>{var n;const a=null!==(n=(0,o.getLastItem)(e))&&void 0!==n?n:e.error("Invalid node",{});if((0,r.scanPostItem)(e,(e=>{a.n=e})))return e.setState(t.statePostItem);if("("===e.curChar()){const n=e.pos;e.pos++;const o=(0,s.scanCharge)(e);if(o&&")"===e.curChar())return a.charge=o,e.setState(t.statePostItem,1);e.pos=n}return e.setState(i.stateAgentMid)}},8702:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateUniBond=void 0;const o=n(8249),s=n(6380),r=n(9472),i=n(8079),a=n(5235),c=n(3147),d=n(9963);t.stateUniBond=e=>{const t=e.pos-1;switch(e.curChar()){case"(":{e.pos++;const{args:n,argPos:o}=(0,c.scanArgs)(e);(0,i.createUniversalBond)(e,n,o,t)}break;case"p":case"q":(0,o.createPolygonalBond)(e);break;case"m":(0,a.createMiddlePoint)(e);break;case"o":(0,s.createRingBond)(e,1);break;case"s":(0,r.createSplineBond)(e);break;default:(0,i.createUniversalBond)(e,[],[],t)}return e.setState(d.stateAgentMid)}},8978:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemAgent=void 0;const o=n(6315),s=n(759),r=n(4231);class i extends o.ChemObj{constructor(){super(),this.nodes=[],this.bonds=[],this.commands=[],this.n=new s.ChemK(1),this.part=0,this.stA=new r.StructAnalyzer(this)}setCoeff(e){this.n="number"==typeof e?new s.ChemK(e):e}addNode(e){return this.nodes.push(e),this.commands.push(e),e}addBond(e){this.bonds.push(e),this.commands.push(e)}walk(e){var t,n;if(null===(t=e.agentPre)||void 0===t||t.call(e,this),!e.isStop){for(const t of this.commands)if(t.walk(e),e.isStop)return;null===(n=e.agentPost)||void 0===n||n.call(e,this)}}}t.ChemAgent=i},5058:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemAtom=void 0;const o=n(5028);class s extends o.ChemSubObj{constructor(e,t,n,o){super(),this.n=e,this.id=t,this.mass=n,this.stable=void 0===o?Math.floor(this.mass)!==this.mass:o}walk(e){var t;null===(t=e.atom)||void 0===t||t.call(e,this)}}t.ChemAtom=s},7289:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createBackground=t.ChemBackground=void 0;const o=n(6315);class s extends o.ChemObj{constructor(e){super(),this.params=e}walk(){}}t.ChemBackground=s,t.createBackground=(e,t)=>{var n;return e.isAll||(e.nodes=null!==(n=e.nodes)&&void 0!==n?n:[],e.nodes.push(t)),new s(e)}},7367:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemBond=void 0;const o=n(3081),s=n(6315),r=n(5972);class i extends s.ChemObj{constructor(){super(...arguments),this.n=1,this.nodes=[void 0,void 0],this.tx="",this.slope=0,this.isText=!1,this.w0=0,this.w1=0,this.isAuto=!1,this.soft=!1,this.style="",this.arr0=!1,this.arr1=!1,this.ext="",this.brk=!1,this.isNeg=!1,this.isCorr=!1,this.isCycle=!1}calcPt(){return this.nodes[0].pt.plus(this.dir)}other(e){if(2===this.nodes.length)return this.nodes[0]===e?this.nodes[1]:this.nodes[1]===e?this.nodes[0]:void 0}walk(e){var t;null===(t=e.bond)||void 0===t||t.call(e,this)}setHydrogen(){this.style=":",this.n=0}setCross(){this.align="x"}isCross(){return"x"===this.align}checkText(){const{dir:e}=this;this.isText=!!e&&(0,o.is0)(e.y)&&(0,o.is0)(Math.abs(e.x)-1)}linearText(){if(this.isAuto){let e=this.tx;return this.isNeg&&(e=`\`${e}`),(0,o.is0)(this.n)&&(e+="0"),e}return this.tx}isHorizontal(){const{dir:e}=this;return!!e&&!(0,o.is0)(e.x)&&(0,o.is0)(e.y)}debugText(){return 2===this.nodes.length?`${null===(n=(t=this).nodes[0])||void 0===n?void 0:n.index}(${t.soft?"~":""}${null===(s=t.dir)||void 0===s?void 0:s.polarAngleDeg().toFixed(0)}`+(1!==t.n?`*${(0,o.toa)(t.n)}`:"")+")"+`${null===(r=t.nodes[1])||void 0===r?void 0:r.index}`:`${(e=this).linearText()}${e.nodes.map((e=>null==e?void 0:e.index))}`;var e,t,n,s,r}isVisible(){return!(this.isVerticalConnection()||(0,o.is0)(this.n)&&!this.style)}isVerticalConnection(){const{dir:e,nodes:t}=this;return!(!e||2!==t.length)&&!(!t[0]||(0,r.isNodeHidden)(t[0]))&&!(!t[1]||(0,r.isNodeHidden)(t[1]))&&(0,o.is0)(e.x)&&(0,o.is0)(Math.abs(e.y)-.5)}}t.ChemBond=i},1560:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getBracketsContent=t.ChemBracketEnd=t.ChemBracketBegin=t.bracketPairs=void 0;const o=n(6315),s=n(759);t.bracketPairs={"(":")","[":"]","{{":"}}"};class r extends o.ChemObj{constructor(e){super(),this.text=e,this.nodes=[void 0,void 0]}walk(e){var t;null===(t=e.bracketBegin)||void 0===t||t.call(e,this)}}t.ChemBracketBegin=r;class i extends o.ChemObj{constructor(e,t,n){super(),this.text=e,this.begin=t,this.charge=void 0,this.n=new s.ChemK(1),this.nodes=[void 0,void 0],this.nodes[0]=n}walk(e){var t;null===(t=e.bracketEnd)||void 0===t||t.call(e,this)}get nodeIn(){return this.nodes[0]}get color(){return this.begin.color}}t.ChemBracketEnd=i,t.getBracketsContent=(e,t)=>{const{end:n}=e;let o=0;for(;o<t.length&&t[o]!==e;)o++;let s=o;for(;s<t.length&&t[s]!==n;)s++;return t.slice(o+1,s)}},6916:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createCharge=t.ChemCharge=void 0;const o=n(599),s=n(1703);class r{get isLeft(){return(0,o.isLeftCoeffA)(this.pos)}constructor(e,t,n="RT",o=!1){this.text=e,this.value=t,this.pos=n,this.isRound=o}}t.ChemCharge=r;const i=/(^|(^[-+]))\d+$/,a=/^\d+[-+]$/,c=new Set(["-","--","---"]),d=new Set(["+","++","+++"]);t.createCharge=(e,t="RT")=>{if(""===e)return;const n=e.replace("–","-").replace("−","-");if(c.has(n))return new r(n,-n.length,t);if(d.has(n))return new r(n,n.length,t);if(i.test(n))return new r(n,+n,t);if(a.test(n))return new r(n,+`${n.slice(-1)}${n.slice(0,-1)}`,t);if("+o"===n)return new r("+",1,t,!0);if("-o"===n)return new r("-",-1,t,!0);const o=s.romanNum[n];return o?new r(n.toUpperCase(),o,t):void 0}},5718:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.instChemComma=t.ChemComma=void 0;const o=n(5028);class s extends o.ChemSubObj{walk(e){var t;null===(t=e.comma)||void 0===t||t.call(e,this)}}t.ChemComma=s,t.instChemComma=new s},6414:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemComment=void 0;const o=n(5028);class s extends o.ChemSubObj{constructor(e){super(),this.text=e}walk(e){var t;null===(t=e.comment)||void 0===t||t.call(e,this)}}t.ChemComment=s},3042:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemCustom=void 0;const o=n(5028);class s extends o.ChemSubObj{constructor(e){super(),this.text=e}walk(e){var t;null===(t=e.custom)||void 0===t||t.call(e,this)}}t.ChemCustom=s},4086:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorMessage=t.ChemError=void 0;const o=n(8706);class s extends Error{constructor(e,t){super(o.Lang.tr(e,t)),this.msgId=e,this.params=t}getMessage(e){return o.Lang.tr(this.msgId,this.params,e)}}t.ChemError=s,t.getErrorMessage=(e,t)=>{if(e instanceof s){if(!t)return e.getMessage();const n=o.Lang.curLang;o.Lang.curLang=t;const s=e.getMessage(t);return o.Lang.curLang=n,s}return e.message}},9701:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemExpr=void 0;const o=n(6315),s=n(8978),r=n(4086),i=n(7185),a=n(1947),c=n(4900),d=n(9059);class l extends o.ChemObj{constructor(){super(...arguments),this.src0="",this.src="",this.entities=[]}isOk(){return!this.error}getMessage(e){const{error:t}=this;return t?(0,r.getErrorMessage)(t,e):""}walk(e){var t,n;for(const o of this.entities){if(null===(t=e.entityPre)||void 0===t||t.call(e,o),e.isStop)return;if(o.walk(e),e.isStop)return;if(null===(n=e.entityPost)||void 0===n||n.call(e,o),e.isStop)return}}getAgents(){return this.entities.filter((e=>e instanceof s.ChemAgent))}mass(e=!0){return this.getAgents().map((t=>(0,i.calcMass)(t,e)))}html(){return(0,a.makeTextFormula)(this,c.rulesHtml)}isLinear(){return(0,d.isTextFormula)(this)}static createWithError(e,t){const n=new l;return n.error=e,n.src0=t,n.src=t,n}}t.ChemExpr=l},759:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemK=void 0;const o=n(3081);class s{constructor(e,t){"number"==typeof e?(this.num=e,this.text=""):(this.text=e,this.num=NaN),this.pos=t}isSpecified(){return!!this.text||1!==this.num&&!Number.isNaN(this.num)}isNumber(){return!Number.isNaN(this.num)}isAbstract(){return!this.isNumber()}isInt(){return this.num===~~this.num}equals(e){return"number"==typeof e&&this.isNumber()?this.num===e:"string"!=typeof e||this.isNumber()?e instanceof s&&(this.text?this.text===e.text:this.num===e.num):this.text===e}toString(){return this.isNumber()?(0,o.toa)(this.num):this.text}}t.ChemK=s,s.one=new s(1)},5507:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemMulEnd=t.ChemMul=void 0;const o=n(6315);class s extends o.ChemObj{constructor(e,t,n){super(),this.n=e,this.isFirst=t,this.color=n,this.nodes=[void 0,void 0]}walk(e){var t;null===(t=e.mul)||void 0===t||t.call(e,this)}}t.ChemMul=s;class r extends o.ChemObj{constructor(e){super(),this.begin=e}walk(e){var t;null===(t=e.mulEnd)||void 0===t||t.call(e,this)}}t.ChemMulEnd=r},8666:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemNode=void 0;const o=n(4018),s=n(6315);class r extends s.ChemObj{constructor(e){super(),this.charge=void 0,this.items=[],this.index=-1,this.chain=0,this.subChain=0,this.autoMode=!1,this.bonds=new Set,this.fixed=!1,this.bCenter=!1,this.pt=(null!=e?e:o.Point.zero).clone()}walk(e){var t,n;if(null===(t=e.nodePre)||void 0===t||t.call(e,this),!e.isStop){for(const t of this.items)if(t.walk(e),e.isStop)return;null===(n=e.nodePost)||void 0===n||n.call(e,this)}}addBond(e){this.bonds.add(e)}getCenterItem(){let e=0,t=0,n=null;return this.walk({itemPre(){e=0},comment(){e=1},custom(){e=2},radical(){e=4},atom(t){switch(t.id){case"H":case"D":case"T":e=3;break;case"C":e=5;break;default:e=4}},itemPost(o){o.bCenter&&(e=6),e>t&&(t=e,n=o)}}),n}}t.ChemNode=r},2390:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemNodeItem=void 0;const o=n(6315),s=n(759);class r extends o.ChemObj{constructor(e,t=s.ChemK.one){super(),this.obj=e,this.n=t}walk(e){var t,n;null===(t=e.itemPre)||void 0===t||t.call(e,this),e.isStop||this.obj.walk(e),e.isStop||null===(n=e.itemPost)||void 0===n||n.call(e,this)}}t.ChemNodeItem=r},6315:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemObj=void 0,t.ChemObj=class{walkExt(e){return this.walk(e),e}}},1429:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemOp=void 0;const o=n(6315);class s extends o.ChemObj{constructor(e,t,n){super(),this.srcText=e,this.dstText=t,this.div=n}walk(e){var t;null===(t=e.operation)||void 0===t||t.call(e,this)}}t.ChemOp=s},5912:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemRadical=void 0;const o=n(5028),s=n(7599);let r=null;const i=[[["Me"],[["C",1],["H",3]]],[["Et"],[["C",2],["H",5]]],[["Ph"],[["C",6],["H",5]]],[["Pr","n-Pr","Pr-n"],[["C",3],["H",7]]],[["iPr","i-Pr","Pr-i"],[["C",3],["H",7]]],[["Bu","nBu","n-Bu","Bu-n"],[["C",4],["H",9]]],[["t-Bu","Bu-t","tBu"],[["C",4],["H",9]]],[["i-Bu","Bu-i","iBu"],[["C",4],["H",9]]],[["s-Bu","Bu-s","sBu"],[["C",4],["H",9]]],[["Ac"],[["C",1],["H",3],["C",1],["O",1]]],[["CoA"],[["C",21],["H",35],["N",7],["O",16],["P",3]]],[["Tf"],[["C",1],["F",3],["S",1],["O",2]]]];class a extends o.ChemSubObj{constructor(e,t){super(),this.label=e,this.items=t}walk(e){var t;null===(t=e.radical)||void 0===t||t.call(e,this)}static get dict(){if(r)return r;const e={};return i.forEach((t=>{const[n,o]=t,r=new s.ElemList;o.forEach((([e,t])=>r.addElemById(e,t))),n.forEach((t=>{e[t]=new a(t,r)}))})),r=e,e}}t.ChemRadical=a},5028:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemSubObj=void 0;const o=n(6315);class s extends o.ChemObj{}t.ChemSubObj=s},7599:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ElemList=void 0;const o=n(4434),s=n(2280),r=n(6887);t.ElemList=class{constructor(){this.list=[],this.charge=0}toString(){let e=this.list.reduce(((e,t)=>`${e}${t}`),"");const t=(0,s.makeChargeText)(this.charge);return""!==t&&(e+=`^${t}`),e}findAtom(e){return e?this.list.find((t=>t.elem===e)):void 0}findById(e){return this.findAtom((0,r.findElement)(e))}findCustom(e){return this.list.find((t=>!t.elem&&t.id===e))}findKey(e){return this.list.find((t=>t.key===e))}findRec(e){if(e)return e.elem?this.findAtom(e.elem):this.findCustom(e.id)}addElemRec(e){const t=this.findRec(e);return t?t.n+=e.n:this.list.push(e),this}addElemById(e,t=1){return this.addElemRec(new o.ElemRecord(e,t,!1))}addAtom(e,t=1){return this.addElemRec(new o.ElemRecord(e,t))}addElem(e,t=1){return this.addElemRec(new o.ElemRecord(e,t))}addCustom(e,t=1){return this.addElemRec(new o.ElemRecord(e,t,!0))}addList(e){return e.list.forEach((e=>this.addElem(e))),this.charge+=e.charge,this}addRadical(e){return e?this.addList(e.items):this}scale(e){1!==e&&(this.charge*=e,this.list.forEach((t=>{t.n*=e})))}sortByHill(){return this.list.sort(((e,t)=>{const n=e.id,o=t.id;return e.elem||t.elem?e.elem?t.elem?n===o?0:"C"===n?-1:"C"===o?1:"H"===n?-1:"H"===o?1:n.localeCompare(o):-1:1:n.localeCompare(o)})),this}}},4434:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ElemRecord=void 0;const o=n(5058),s=n(6887),r=n(4241);t.ElemRecord=class{constructor(e,t=1,n=!1){"string"==typeof e?(this.id=e,this.elem=n?void 0:(0,s.findElement)(e),this.n=t):e instanceof o.ChemAtom?(this.id=e.id,this.elem=e,this.n=t):(this.id=e.id,this.elem=e.elem,this.n=t*e.n)}get key(){return this.elem?this.id:`{${this.id}}`}toString(){return`${this.key}${(0,r.k2s)(this.n)}`}}},6887:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PeriodicTable=t.findElement=void 0;const o=n(5058);let s=null,r=null,i=null,a=null;t.findElement=e=>t.PeriodicTable.dict[e]||t.PeriodicTable.isotopesDict[e],t.PeriodicTable=Object.freeze({get elements(){if(s)return s;const e=Object.freeze(Object.keys(c).map(((e,t)=>new o.ChemAtom(t+1,e,c[e]))));return s=e,e},get dict(){if(r)return r;const e={};this.elements.forEach((t=>{e[t.id]=t}));const t=Object.freeze(e);return r=t,t},get isotopes(){if(i)return i;const e=Object.freeze(d.map((([e,t,n,s])=>new o.ChemAtom(e,t,n,s))));return i=e,e},get isotopesDict(){if(a)return a;const e={};this.isotopes.forEach((t=>{e[t.id]=t}));const t=Object.freeze(e);return a=t,t}});const c={H:1.008,He:4.003,Li:6.941,Be:9.0122,B:10.811,C:12.011,N:14.007,O:15.999,F:18.998,Ne:20.179,Na:22.99,Mg:24.312,Al:26.092,Si:28.086,P:30.974,S:32.064,Cl:35.453,Ar:39.948,K:39.102,Ca:40.08,Sc:44.956,Ti:47.956,V:50.941,Cr:51.996,Mn:54.938,Fe:55.849,Co:58.933,Ni:58.7,Cu:63.546,Zn:65.37,Ga:69.72,Ge:72.59,As:74.922,Se:78.96,Br:79.904,Kr:83.8,Rb:85.468,Sr:87.62,Y:88.906,Zr:91.22,Nb:92.906,Mo:95.94,Tc:99,Ru:101.07,Rh:102.906,Pd:106.4,Ag:107.868,Cd:112.41,In:114.82,Sn:118.69,Sb:121.75,Te:127.6,I:126.905,Xe:131.3,Cs:132.905,Ba:137.34,La:138.906,Ce:140.115,Pr:140.908,Nd:144.24,Pm:145,Sm:150.4,Eu:151.96,Gd:157.25,Tb:158.926,Dy:162.5,Ho:164.93,Er:167.26,Tm:168.934,Yb:173.04,Lu:174.97,Hf:178.49,Ta:180.948,W:183.85,Re:186.207,Os:190.2,Ir:192.22,Pt:195.09,Au:196.967,Hg:200.59,Tl:204.37,Pb:207.19,Bi:208.98,Po:210,At:210,Rn:222,Fr:223,Ra:226,Ac:227,Th:232.038,Pa:231,U:238.29,Np:237,Pu:244,Am:243,Cm:247,Bk:247,Cf:251,Es:254,Fm:257,Md:258,No:259,Lr:260,Rf:261,Db:262,Sg:271,Bh:267,Hs:269,Mt:276,Ds:281,Rg:280,Cn:285,Nh:286,Fl:289,Mc:289,Lv:293,Ts:294,Og:294},d=[[1,"D",2.014101777844,!0],[1,"T",3.01604928132,!1]]},4231:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StructAnalyzer=t.bondSideSign=t.calcBondSign=t.getCycleCenter=void 0;const o=n(5927),s=n(4210),r=n(6445),i=n(4018);t.getCycleCenter=e=>{if(e.center)return e.center;const t=e.nodes.length,n=0===t?new i.Point:e.nodes.reduce(((e,t)=>e.iadd(t.pt)),new i.Point).times(1/t);return e.center=n,n};const a=(e,t)=>{const n=e.x*t.y-e.y*t.x;return 0===n?0:n<0?-1:1};t.calcBondSign=(e,n)=>{var o,s;const r=null===(o=n.nodes[0])||void 0===o?void 0:o.pt,i=null===(s=n.nodes[1])||void 0===s?void 0:s.pt;if(!r||!i)return 0;const c=(0,t.getCycleCenter)(e);return a(i.minus(r),c.minus(r))},t.bondSideSign=(e,t)=>{const n=e.nodes[t];if(!n||!e.dir)return 0;const o=Array.from(n.bonds).filter((t=>t!==e&&t.isVisible()&&t.dir));return 1!==o.length?0:a(e.dir,o[0].dir)},t.StructAnalyzer=class{constructor(e){this.agent=e,this.isInit=!1,this.cycles=[],this.bondsMap={}}analyze(){if(this.isInit)return;this.isInit=!0;const{nodes:e,bonds:t}=this.agent;if(t.length<3)return;const n=2*e.length,r=e.map((e=>({node:e,order:n}))),i=(e,t)=>{const n=[e],s={nodes:[],bonds:[]};let i;const a=new Set;for(;;){const e=n.shift();if(!e)break;a.add(e.node),e.node.bonds.forEach((o=>{const a=o.other(e.node);if(a){const c=a.index,d=r[c];t.has(c)&&(e.order+1===d.order?(n.push(d),s.bonds.push(o)):e.order===d.order&&(i=o))}}))}return i&&s.bonds.push(i),s.nodes=Array.from(a),s.nodes.sort(((e,t)=>(0,o.cmp)(e.index,t.index))),s.bonds.sort(((e,t)=>(0,o.cmp)(e.index,t.index))),s},a=(e,t)=>{if(t.order>e.order)throw new Error("Invalid order");const n=[e];t.order===e.order&&n.push(t);const o=new Set;for(;;){const e=n.shift();if(!e)break;const t=e.node.index;if(o.has(t))return i(e,o);o.add(t),e.node.bonds.forEach((t=>{const o=t.other(e.node);if(o){const t=r[o.index];t.order+1===e.order&&n.push(t)}}))}},c=e=>{if(e.order!==n)return;e.order=0;const t=[e],o=new Set;for(;;){const e=t.shift();if(!e)break;e.node.bonds.forEach((s=>{const i=s.other(e.node);if(i){const c=r[i.index],d=c.order;if(d===n)c.order=e.order+1,t.push(c);else if(d>=e.order&&!o.has(s.index)){o.add(s.index);const t=a(c,e);t&&this.cycles.push(t)}}}))}};r.forEach((e=>c(e))),this.cycles.forEach((e=>{e.bonds.forEach((t=>{const{index:n}=t;"number"==typeof n&&(0,s.getItemForced)(this.bondsMap,n,[]).push(e)}))}))}findCyclesForBond(e){var t;return this.analyze(),null!==(t=(0,r.ifDef)(e.index,(e=>this.bondsMap[e])))&&void 0!==t?t:[]}calcBondSign(e){const n=this.findCyclesForBond(e)[0];if(n)return(0,t.calcBondSign)(n,e);const o=(0,t.bondSideSign)(e,1),s=(0,t.bondSideSign)(e,0);return-1===o&&-1!==s||0===o&&1===s?-1:1===o&&1!==s||0===o&&-1===s?1:0}}},7929:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isEmptyNode=void 0,t.isEmptyNode=e=>!e.walkExt({isStop:!1,atom(){this.isStop=!0},radical(){this.isStop=!0},custom(e){this.isStop=!!e.text},comment(e){this.isStop=!!e.text}}).isStop},5972:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isNodeHidden=void 0;const o=n(7929);t.isNodeHidden=e=>e.autoMode||(0,o.isEmptyNode)(e)},1299:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isTextBracketsCached=t.isTextBrackets=void 0;const o=n(1560),s=n(9059);t.isTextBrackets=(e,t)=>!(0,o.getBracketsContent)(e,t).find((e=>!(0,s.isTextFormula)(e))),t.isTextBracketsCached=(e,n)=>{if(void 0!==e.isText)return e.isText;const o=(0,t.isTextBrackets)(e,n);return e.isText=o,o}},4241:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.k2s=void 0;const o=n(3081);t.k2s=e=>1===e?"":(0,o.toa)(e)},2280:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeChargeText=void 0;const o=n(3081);t.makeChargeText=e=>{if((0,o.is0)(e))return"";const t=Math.abs(e);let n=1===t?"":(0,o.toa)(t);return n+=e<0?"-":"+",n}},1430:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemImgProps=void 0;const o=n(5032);t.ChemImgProps=class{constructor(e,t=0,n=0,o=0){this.styles={},this.thickWidth=0,this.chiralWidth=0,this.lineSpace2=0,this.lineSpace2x=0,this.lineSpace3=0,this.subKY=.5,this.bracketSubKY=.7,this.supKY=.5,this.bracketSupKY=.7,this.hatch=0,this.dash=0,this.arrowL=0,this.arrowD=0,this.opSpace=0,this.agentKSpace=0,this.mulChar="·",this.mulRadius=.1,this.kw=40,this.flDblAlign=!0,this.nodeMargin=-1,this.bracketWidth=0,this.bracketSpace=0,this.useTextBrackets=!0,this.electronDotD=0,this.stdStyle=e,this.stdStyle.style.fill||(this.stdStyle.style.fill="black"),this.line=t,this.horizLine=n,this.lineWidth=o}init(){const e=this;e.line=e.line||1.6*(0,o.getFontHeight)(e.stdStyle.font.getFontFace());const{line:t}=e;e.lineWidth=e.lineWidth||Math.ceil(t/e.kw);const{lineWidth:n}=e;e.horizLine=e.horizLine||e.stdStyle.font.getTextWidth("+"),e.thickWidth=e.thickWidth||4*n,e.chiralWidth=e.chiralWidth||5*n,e.hatch=e.hatch||2*n,e.dash=e.dash||3*n,e.lineSpace2=e.lineSpace2||2*n,e.lineSpace2x=e.lineSpace2x||3*n,e.lineSpace3=e.lineSpace3||2*n,e.arrowL=e.arrowL||t/5,e.arrowD=e.arrowD||t/9,e.opSpace=e.opSpace||t/4,e.agentKSpace=e.agentKSpace||2*n,e.bracketWidth=e.bracketWidth||4*n,e.bracketSpace=e.bracketSpace||2*n,e.electronDotD=e.electronDotD||3*n,e.nodeMargin<0&&(e.nodeMargin=e.lineWidth||1)}getStyle(e){return this.styles[e]||this.stdStyle}getStyleColored(e,t){const n=this.getStyle(e);return t&&n.style.fill!==t?Object.assign(Object.assign({},n),{style:Object.assign(Object.assign({},n.style),{fill:t})}):n}static getIndexStyles(){return["atomNumber","bracketCharge","bracketCount","itemCount","itemMass","nodeCharge","oxidationState"]}}},3470:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlCanvasLocalFont=void 0,t.HtmlCanvasLocalFont=class{constructor(e,t){this.context=e,this.props=t}getFontFace(){return this.props.fontFace}getTextWidth(e){return this.context.font=this.props.canvasFont,this.context.measureText(e).width}drawLine(e,t,n,o){this.context.font=this.props.canvasFont,this.context.fillStyle=o.fill,this.context.fillText(n,t.x,t.y)}}},4278:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlCanvasSurface=void 0;const o=n(4018),s=n(4203),r=n(9106),i=n(3470);t.HtmlCanvasSurface=class{getCanvas(){return this.domElement}getCtx(){return this.htmlContext}constructor(e,t){this.fontCache={},this.domElement=e;const n=e.getContext("2d");if(!n)throw Error("2d context is not supported");this.htmlContext=n,this.size=new o.Point,this.fontPropsCache=null!=t?t:new r.WebFontCache}getFont(e){const t=this.fontPropsCache.getWebProps(e);let n=this.fontCache[t.hash];return n||(n=new i.HtmlCanvasLocalFont(this.getCtx(),t),this.fontCache[t.hash]=n,n)}applyStyle(e,t){var n,o,s;const{htmlContext:r}=this;t&&r.translate(t.x,t.y),r.beginPath(),r.fillStyle=null!==(n=e.fill)&&void 0!==n?n:"transparent",r.strokeStyle=null!==(o=e.stroke)&&void 0!==o?o:"transparent",r.lineWidth=null!==(s=e.strokeWidth)&&void 0!==s?s:1}drawPath(e,t,n){const{htmlContext:o}=this;o.save(),this.applyStyle(n,e);const r={onM(e){o.moveTo(e.x,e.y)},onL(e){o.lineTo(e.x,e.y)},onQ(e,t){o.quadraticCurveTo(e.x,e.y,t.x,t.y)},onC(e,t,n){o.bezierCurveTo(e.x,e.y,t.x,t.y,n.x,n.y)},onA(e,t,n,s,r){o.lineTo(r.x,r.y)}};(0,s.tracePath)(t,r),n.fill&&o.fill(),n.stroke&&o.stroke(),o.restore()}drawEllipse(e,t,n,o){const{htmlContext:s}=this;s.save(),this.applyStyle(o,e),s.ellipse(t.x,t.y,n.x,n.y,0,0,2*Math.PI),o.fill&&s.fill(),o.stroke&&s.stroke(),s.restore()}setSize(e){this.size=e,this.domElement.width=e.x,this.domElement.height=e.y}}},7429:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SvgWebLocalFont=void 0;const o=n(7236),s=n(4326),r=n(6290),i=n(3081),a=n(5410),c=n(5063);class d{constructor(e){this.webFontProps=e,this.canvas=document.createElement("canvas")}createScaled(e){const t=Object.assign({},this.webFontProps);return t.cssHeight*=e,t.fontFace=(0,a.scaleFontFace)(t.fontFace,e),t.canvasFont=(0,c.makeCanvasFontProp)(t),new d(t)}getFontFace(){return this.webFontProps.fontFace}getTextWidth(e){const t=this.canvas.getContext("2d");if(!t)throw Error("Canvas don't supported");return t.font=this.webFontProps.canvasFont,t.measureText(e).width}drawLine(e,t,n,a){if(!(e instanceof o.SvgWebSurface))throw new Error("Expected SvgWebSurface");{const{fontFace:o,cssHeight:c,bold:d,italic:l}=this.webFontProps,u={x:(0,i.toa)(t.x),y:(0,i.toa)(t.y),fill:a.fill,"font-family":o.fontFamily,"font-size":`${c}px`};d&&(u["font-weight"]="bold"),l&&(u["font-style"]="italic");const h=`${(0,s.drawTag)("text",u)}${(0,r.escapeXml)(n)}</text>`;e.addFigure(h)}}}t.SvgWebLocalFont=d},7236:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SvgWebSurface=void 0;const o=n(5315),s=n(9106),r=n(7429);class i extends o.SvgSurface{constructor(e){super(),this.fontCache={},this.fontPropsCache=null!=e?e:new s.WebFontCache}getFont(e){const t=this.fontPropsCache.getWebProps(e),n=this.fontCache[t.hash];if(n)return n;const o=new r.SvgWebLocalFont(t);return this.fontCache[t.hash]=o,o}}t.SvgWebSurface=i},9106:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WebFontCache=void 0;const o=n(8217),s=n(5063);t.WebFontCache=class{constructor(){this.cache={}}getWebProps(e){const t=(0,o.createLocalFontHash)(e);let n=this.cache[t];return n||(n=(0,s.makeWebFontProps)(e),this.cache[t]=n,n)}}},5063:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeWebFontProps=t.makeCanvasFontProp=void 0;const o=n(2490),s=n(7601),r=n(5935),i=n(8217);t.makeCanvasFontProp=e=>{const{fontFamily:t,cssHeight:n,bold:o,italic:s}=e,r=[`${n}px`,t];return o&&r.unshift("bold"),s&&r.unshift("italic"),r.join(" ")},t.makeWebFontProps=e=>{var n,a,c,d;const l=e.family,u=(0,o.webFontWeight)(e.weight),h="italic"===e.style||"oblique"===e.style,p=Math.round(e.height),m=Math.round(p/2),f=p+2*m,g=Math.round(p/2),v=m+p,b=(0,s.isBold)(u),C=(0,t.makeCanvasFontProp)({fontFamily:l,cssHeight:p,bold:b,italic:h}),y=document.createElement("canvas");y.height=f,y.width=g;const P=y.getContext("2d");if(!P)throw Error("Canvas is not supported");P.fillStyle="#FFF",P.textBaseline="alphabetic",P.font=C;const w=P.measureText("[lj"),x=P.measureText("Z"),M=P.measureText("z"),B=(e,t)=>{P.clearRect(0,0,g,f),P.fillText(e,0,v);const n=P.getImageData(0,0,g,f);if(!n)throw Error("Cant access to image data");return(0,r.traceBox)(n.data,g,f,t)||(t?0:f-1)},S=null!==(n=x.actualBoundingBoxAscent)&&void 0!==n?n:v-B("Z",!0),_=null!==(a=M.actualBoundingBoxAscent)&&void 0!==a?a:v-B("z",!0),k=null!==(c=w.actualBoundingBoxAscent)&&void 0!==c?c:v-B("l",!0),O=w.actualBoundingBoxDescent?-w.actualBoundingBoxDescent:v-B("j",!1),A=[0,0,0,0];return A[1]=w.fontBoundingBoxDescent?-w.fontBoundingBoxDescent:O,A[3]=null!==(d=w.fontBoundingBoxAscent)&&void 0!==d?d:Math.max(S,k),y.remove(),{hash:(0,i.createLocalFontHash)(e),fontFace:{fontFamily:l,fontWeight:u,fontStyle:h?"italic":"normal",xHeight:S,capHeight:_,descent:O,ascent:k,bbox:A},canvasFont:C,fontFamily:l,cssHeight:p,italic:h,bold:b}}},5935:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.traceBox=void 0,t.traceBox=(e,t,n,o)=>{const[s,r,i]=o?[0,n,1]:[n-1,-1,-1];let a=null;for(let n=0;n<t;n++)for(let c=s;c!==r;c+=i)if(e[4*(c*t+n)+3]>128){if(null!==a)if(o){if(c>a)return a}else if(c<a)return a;a=c;break}return a}},2490:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.webFontWeight=void 0;const o=n(7601);t.webFontWeight=e=>{if(!e||"all"===e)return"normal";const t=e.split(",")[0].trim();return"normal"===t||"bold"===t?t:String((0,o.fontWeightValue)(t))}},3177:(e,t,n)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.createChemImgProps=void 0;const s=n(1430),r=n(4900),i=n(411);let a;const c=(null===(o=document.defaultView)||void 0===o?void 0:o.getComputedStyle)||(e=>e.currentStyle);t.createChemImgProps=(e,t)=>{const n=document.createElement("span"),o=e=>{n.innerHTML=e;const o="<"===e[0]?n.firstChild:n;if(!(o instanceof Element))return;const s=c(o);if(!s)return;const r={family:s.fontFamily,height:+s.fontSize.slice(0,-2),weight:s.fontWeight,style:s.fontStyle,stretch:s.fontStretch};return{font:t.getFont(r),style:{fill:s.color}}};try{e.appendChild(n);const t=o("A");if(!t)throw Error("Can't access to CSS properties");const c=new s.ChemImgProps(t);return a=a||(0,i.createRulesList)(r.rulesHtml),a.forEach((([e,t])=>{const n=o(t);n&&(c.styles[e]=n)})),c.init(),c}finally{n.remove()}}},2698:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FigBSpline=void 0;const o=n(3337),s=n(4018),r=n(3698);class i extends r.Figure{constructor(e,t,n,o){super(),this.points=e,this.style=t,this.segmentLength=n,this.bDashed=o}update(){var e;this.bounds=null!==(e=this.points.slice(1,-2).reduce(((e,t)=>(0,o.updateRect)(t,e)),void 0))&&void 0!==e?e:new o.Rect}draw(e,t){const n=[],{points:o}=this,r=o.length-3;if(r<1)return;const i=o[1].equals(o[r]);let a=0;const c=[0];for(let e=1;e<r;e++){const t=o[e].dist(o[e+1]);a+=t,c[e]=t}let d=Math.floor(a/this.segmentLength+.5);this.bDashed&&(1&d?i&&d++:i||d++);const l=a/d;let u=0,h=0,p=0,m=1,f=s.Point.zero,g=s.Point.zero,v=s.Point.zero,b=s.Point.zero,C=0;for(;;u++){if(m!==p){if(m>=r)break;p=m,C=1/c[p],f=o[p].times(3),f.isub(o[p-1]),f.iadd(o[p+1].times(-3)),f.iadd(o[p+2]),f.scale(1/6),g=o[p].times(-2),g.iadd(o[p-1]).iadd(o[p+1]).scale(.5),v=o[p+1].minus(o[p-1]).scale(.5),b=o[p].times(4),b.iadd(o[p-1]).iadd(o[p+1]).scale(1/6)}const e=h*C,t=f.times(e).iadd(g).scale(e).iadd(v).scale(e).iadd(b);for(n.push({cmd:this.bDashed&&1&u||0===u?"M":"L",pt:t}),h+=l;h>=c[m];)h-=c[m],m++}i?n.push(this.bDashed?{cmd:"L",pt:n[0].pt}:{cmd:"Z"}):n.push({cmd:"L",pt:o[m]}),t.drawPath(e.plus(this.org),n,this.style)}static extendsPoints(e,t){const n=e.length;if(n<3)return;const o=e[0],s=e[1],r=e[n-1],i=e[n-2];if(t){const t=[...e];let n=r;return o.equals(r)?n=i:t.push(o),t.push(s),t.push(e[2]),t.unshift(n),t}const a=s.minus(o),c=r.minus(i),d=r.plus(c);return[o.minus(a),...e,d,d.plus(c)]}}t.FigBSpline=i},7546:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FigEllipse=void 0;const o=n(3337),s=n(3698);class r extends s.Figure{constructor(e,t,n){super(),this.radius=t,this.style=n,this.org=e,this.bounds=new o.Rect(t.neg(),t)}update(){}draw(e,t){t.drawEllipse(e,this.org,this.radius,this.style)}}t.FigEllipse=r},2218:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FigFrame=void 0;const o=n(3337),s=n(3698);class r extends s.Figure{constructor(){super(...arguments),this.figures=[]}addFigure(e,t){this.figures.push(e),t&&this.updateFigure(e)}insertFigure(e,t,n){this.figures.splice(e,0,t),n&&this.updateFigure(t)}updateFigure(e){this.bounds.unite(e.getRelativeBounds())}update(){var e;this.bounds=null!==(e=this.figures.reduce(((e,t)=>{const n=t.getRelativeBounds();return e?(e.unite(n),e):n}),void 0))&&void 0!==e?e:new o.Rect}draw(e,t){const n=e.plus(this.org);this.figures.forEach((e=>e.draw(n,t)))}}t.FigFrame=r},880:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeHashTrapezoidPath=t.FigHashTrapezoid=void 0;const o=n(3081),s=n(3337),r=n(4018),i=n(3698);class a extends i.Figure{constructor(e,t,n,o,s,r,i){super(),this.a=e,this.aWidth=t,this.b=n,this.bWidth=o,this.color=s,this.lineWidth=r,this.hatch=i}update(){const{a:e,aWidth:t,b:n,bWidth:o}=this,{dL:r,dR:i}=c(e,n),{aL:a,aR:l,bL:u,bR:h}=d(e,t,n,o,r,i);this.bounds=new s.Rect(a,l),this.bounds.updatePoint(u),this.bounds.updatePoint(h)}draw(e,n){const{a:o,b:s,aWidth:r,bWidth:i,color:a,lineWidth:c,hatch:d}=this,{segs:l,style:u}=(0,t.makeHashTrapezoidPath)(o,r,s,i,c,d,a);l.length>0&&n.drawPath(this.org.plus(e),l,u)}}t.FigHashTrapezoid=a;const c=(e,t)=>{const n=t.minus(e),s=n.length(),i=(0,o.is0)(s)?r.Point.zero:n.times(1/s),a=i.transpon(!0),c=i.transpon();return{dir:n,dirLen:s,dir1:i,dL:a,dR:c}},d=(e,t,n,o,s,r)=>{const i=t/2,a=o/2;return{aL:e.plus(s.times(i)),aR:e.plus(r.times(i)),bL:n.plus(s.times(a)),bR:n.plus(r.times(a))}};t.makeHashTrapezoidPath=(e,t,n,o,s,r,i)=>{const a=[],d={fill:i},l=t/2,u=o/2-l,{dir:h,dir1:p,dirLen:m,dL:f,dR:g}=c(e,n);if(m>=s){const t=m-s,n=s+r,o=Math.floor(t/n),i=p.times(s);for(let t=0;t<=o;t++){const n=t/o,s=e.plus(h.times(n)),r=s.plus(i),c=l+t*u/o,d=l+(t+1)*u/o,p=s.plus(f.times(c)),m=s.plus(g.times(c)),v=r.plus(f.times(d)),b=r.plus(g.times(d));a.push({cmd:"M",pt:p}),a.push({cmd:"L",pt:v}),a.push({cmd:"L",pt:b}),a.push({cmd:"L",pt:m})}}return{segs:a,style:d}}},3689:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createLine=t.FigPath=void 0;const o=n(6445),s=n(3337),r=n(4203),i=n(3698);class a extends i.Figure{constructor(e,t){super(),this.segs=e,this.style=t}update(){let e;(0,r.tracePath)(this.segs,{onM(t){e=(0,s.updateRect)(t,e)},onL(t){e=(0,s.updateRect)(t,e)},onC(t,n,o){e=(0,s.updateRect)(o,e),e.updatePoint(t),e.updatePoint(n)},onQ(t,n){e=(0,s.updateRect)(n,e),e.updatePoint(t)},onA(t,n,o,r,i){e=(0,s.updateRect)(i,e)}}),this.bounds=null!=e?e:new s.Rect,(0,o.ifDef)(this.style.strokeWidth,(e=>{this.bounds.grow(e/2)}))}draw(e,t){t.drawPath(e.plus(this.org),this.segs,this.style)}}t.FigPath=a,t.createLine=(e,t,n)=>new a([{cmd:"M",pt:e},{cmd:"L",pt:t}],n)},2294:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FigRect=void 0;const o=n(4504),s=n(3698);class r extends s.Figure{constructor(e,t,n){super(),this.style=t,this.bounds=e.clone(),this.radius=n}update(){}draw(e,t){(0,o.drawRect)(t,e.plus(this.org),this.bounds,this.style,this.radius)}}t.FigRect=r},5505:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FigText=void 0;const o=n(3698),s=n(5032);class r extends o.Figure{constructor(e,t,n){super(),this.text=e,this.font=t,this.style=n;const o=t.getFontFace(),r=(0,s.getFontHeight)(o),i=(0,s.getBaseline)(o);this.bounds.A.y=-i,this.bounds.B.y=r-i,this.bounds.B.x=t.getTextWidth(e)}update(){}draw(e,t){this.font.drawLine(t,e.plus(this.org),this.text,this.style)}}t.FigText=r},3698:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Figure=void 0;const o=n(4018),s=n(3337);t.Figure=class{constructor(){this.bounds=new s.Rect,this.org=new o.Point}getRelativeBounds(){const e=this.bounds.clone();return e.move(this.org),e}}},4504:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawRect=void 0,t.drawRect=(e,t,n,o,s)=>{if(e.drawRect)e.drawRect(t,n,o,s);else{const s=[{cmd:"M",pt:n.A},{cmd:"H",x:n.B.x},{cmd:"V",y:n.B.y},{cmd:"H",x:n.A.x},{cmd:"Z"}];e.drawPath(t,s,o)}}},8429:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderTopFrame=void 0,t.renderTopFrame=(e,t)=>{t.setSize(e.bounds.size),e.draw(e.bounds.A.neg(),t)}},6682:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.closeBrace=t.openBrace=void 0;const o=n(3337),s=n(4018),r=n(4203);t.openBrace={draw:e=>i(e,d,c,a,3,11)},t.closeBrace={draw:e=>i(e,h,u,l,11,3)};const i=(e,t,n,i,a,c)=>{const d=[],l=t.segs[0].pt,u=t.segs[t.segs.length-2].pt;if(l.y!==u.y)return d;const h=n.segs[a].pt,p=n.segs[a+1].pt;if(h.y!==p.y)return d;const m=n.segs[c].pt,f=i.segs[0].pt,g=new o.Rect,v=(e,t,n,o)=>{const s=e=>{const t=e.plus(o);return t.isZero()?(g.A.setPt(t),g.B.setPt(t)):(g.A.mini(t),g.B.maxi(t)),t};let r=t;for(;r!==n;){r<0?r=e.length-1:r===e.length&&(r=0);const t=e[r];switch(r+=1,t.cmd){case"M":d.push({cmd:0===d.length?"M":"L",pt:s(t.pt)});break;case"L":d.push({cmd:"L",pt:s(t.pt)});break;case"Q":d.push({cmd:"Q",pt:s(t.pt),cp:s(t.cp)});break;case"C":d.push({cmd:"C",pt:s(t.pt),cp1:s(t.cp1),cp2:s(t.cp2)})}}};v(t.segs,0,t.segs.length-1,new s.Point(h.x-l.x,0)),v(n.segs,a+1,c,new s.Point(0,t.height)),v(i.segs,0,i.segs.length-1,new s.Point(m.x-f.x,t.height+n.height)),v(n.segs,c+1,a,new s.Point(0,t.height));const b=e.width/g.width,C=e.height/g.height,y=e=>{e.set((e.x-g.left)*b,e.y*C)};return(0,r.tracePath)(d,{onM(e){y(e)},onL(e){y(e)},onC(e,t,n){y(e),y(t),y(n)},onQ(e,t){y(e),y(t)},onA(){throw new Error("Function not implemented.")}}),d.push({cmd:"Z"}),d},a={width:769,height:2545,segs:[{cmd:"M",pt:new s.Point(0,0)},{cmd:"L",pt:new s.Point(0,801)},{cmd:"Q",pt:new s.Point(177.5,2052.5),cp:new s.Point(0,1632)},{cmd:"Q",pt:new s.Point(769,2545),cp:new s.Point(355,2473)},{cmd:"L",pt:new s.Point(769,2450)},{cmd:"Q",pt:new s.Point(343,1986),cp:new s.Point(476,2381)},{cmd:"Q",pt:new s.Point(210,767),cp:new s.Point(210,1591)},{cmd:"L",pt:new s.Point(210,0)},{cmd:"Z"}]},c={width:637,height:4687,segs:[{cmd:"M",pt:new s.Point(209,2331)},{cmd:"Q",pt:new s.Point(485.5,2020),cp:new s.Point(350,2271)},{cmd:"Q",pt:new s.Point(637,1185),cp:new s.Point(621,1769)},{cmd:"L",pt:new s.Point(637,0)},{cmd:"L",pt:new s.Point(427,0)},{cmd:"L",pt:new s.Point(427,1359)},{cmd:"Q",pt:new s.Point(315,2041),cp:new s.Point(427,1811)},{cmd:"Q",pt:new s.Point(0,2279),cp:new s.Point(203,2271)},{cmd:"L",pt:new s.Point(0,2399)},{cmd:"Q",pt:new s.Point(313,2638),cp:new s.Point(199,2407)},{cmd:"Q",pt:new s.Point(427,3328),cp:new s.Point(427,2869)},{cmd:"L",pt:new s.Point(427,4687)},{cmd:"L",pt:new s.Point(637,4687)},{cmd:"L",pt:new s.Point(637,3502)},{cmd:"Q",pt:new s.Point(494.5,2680),cp:new s.Point(637,2945)},{cmd:"Q",pt:new s.Point(209,2356),cp:new s.Point(352,2415)},{cmd:"Z"}]},d={width:769,height:2545,segs:[{cmd:"M",pt:new s.Point(210,2545)},{cmd:"L",pt:new s.Point(210,1778)},{cmd:"Q",pt:new s.Point(343,559),cp:new s.Point(210,954)},{cmd:"Q",pt:new s.Point(769,95),cp:new s.Point(476,164)},{cmd:"L",pt:new s.Point(769,0)},{cmd:"Q",pt:new s.Point(177.5,492.5),cp:new s.Point(355,72)},{cmd:"Q",pt:new s.Point(0,1744),cp:new s.Point(0,913)},{cmd:"L",pt:new s.Point(0,2545)},{cmd:"Z"}]},l={width:769,height:2545,segs:[{cmd:"M",pt:new s.Point(559,0)},{cmd:"L",pt:new s.Point(559,767)},{cmd:"Q",pt:new s.Point(426,1986),cp:new s.Point(559,1591)},{cmd:"Q",pt:new s.Point(0,2450),cp:new s.Point(293,2381)},{cmd:"L",pt:new s.Point(0,2545)},{cmd:"Q",pt:new s.Point(591.5,2052.5),cp:new s.Point(414,2473)},{cmd:"Q",pt:new s.Point(769,801),cp:new s.Point(769,1632)},{cmd:"L",pt:new s.Point(769,0)},{cmd:"Z"}]},u={width:637,height:4687,segs:[{cmd:"M",pt:new s.Point(428,2356)},{cmd:"Q",pt:new s.Point(142.5,2680),cp:new s.Point(285,2415)},{cmd:"Q",pt:new s.Point(0,3502),cp:new s.Point(0,2945)},{cmd:"L",pt:new s.Point(0,4687)},{cmd:"L",pt:new s.Point(210,4687)},{cmd:"L",pt:new s.Point(210,3328)},{cmd:"Q",pt:new s.Point(324,2638),cp:new s.Point(210,2869)},{cmd:"Q",pt:new s.Point(637,2399),cp:new s.Point(438,2407)},{cmd:"L",pt:new s.Point(637,2279)},{cmd:"Q",pt:new s.Point(322,2041),cp:new s.Point(434,2271)},{cmd:"Q",pt:new s.Point(210,1359),cp:new s.Point(210,1811)},{cmd:"L",pt:new s.Point(210,0)},{cmd:"L",pt:new s.Point(0,0)},{cmd:"L",pt:new s.Point(0,1185)},{cmd:"Q",pt:new s.Point(151.5,2020),cp:new s.Point(16,1769)},{cmd:"Q",pt:new s.Point(428,2331),cp:new s.Point(287,2271)},{cmd:"Z"}]},h={width:769,height:2545,segs:[{cmd:"M",pt:new s.Point(769,2545)},{cmd:"L",pt:new s.Point(769,1744)},{cmd:"Q",pt:new s.Point(591.5,492.5),cp:new s.Point(769,913)},{cmd:"Q",pt:new s.Point(0,0),cp:new s.Point(414,72)},{cmd:"L",pt:new s.Point(0,95)},{cmd:"Q",pt:new s.Point(426,559),cp:new s.Point(293,164)},{cmd:"Q",pt:new s.Point(559,1778),cp:new s.Point(559,954)},{cmd:"L",pt:new s.Point(559,2545)},{cmd:"Z"}]}},8090:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.closeBracket=void 0;const o=n(4018),s=n(9160),r={width:559,height:1870,segs:[{cmd:"M",pt:new o.Point(0,1870)},{cmd:"Q",pt:new o.Point(277.5,1819),cp:new o.Point(170,1870)},{cmd:"Q",pt:new o.Point(445,1663.5),cp:new o.Point(385,1768)},{cmd:"Q",pt:new o.Point(532,1392),cp:new o.Point(505,1559)},{cmd:"Q",pt:new o.Point(559,939),cp:new o.Point(559,1225)},{cmd:"Q",pt:new o.Point(532.5,486.5),cp:new o.Point(559,655)},{cmd:"Q",pt:new o.Point(446,212),cp:new o.Point(506,318)},{cmd:"Q",pt:new o.Point(278,53),cp:new o.Point(386,106)},{cmd:"Q",pt:new o.Point(0,0),cp:new o.Point(170,0)},{cmd:"L",pt:new o.Point(0,82)},{cmd:"Q",pt:new o.Point(124,94),cp:new o.Point(70,82)},{cmd:"Q",pt:new o.Point(228,148),cp:new o.Point(185,108)},{cmd:"Q",pt:new o.Point(306,271),cp:new o.Point(276,192)},{cmd:"Q",pt:new o.Point(358,515),cp:new o.Point(341,363)},{cmd:"Q",pt:new o.Point(376,931),cp:new o.Point(376,676)},{cmd:"Q",pt:new o.Point(361,1313.5),cp:new o.Point(376,1156)},{cmd:"Q",pt:new o.Point(311,1571),cp:new o.Point(346,1471)},{cmd:"Q",pt:new o.Point(241,1702),cp:new o.Point(283,1655)},{cmd:"Q",pt:new o.Point(153,1764),cp:new o.Point(204,1743)},{cmd:"Q",pt:new o.Point(0,1788),cp:new o.Point(94,1788)},{cmd:"Z"}]};t.closeBracket={draw:e=>(0,s.scalePath)(e,r)}},4041:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawRubberFigure=void 0;const o=n(3689);t.drawRubberFigure=(e,t,n,s)=>{const r=new o.FigPath(e.draw(t,s),n);return r.update(),r}},8845:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRubberBracket=void 0;const o=n(8090),s=n(4730),r=n(4872),i=n(6682),a={"[":r.openSquareBracket,"]":r.closeSquareBracket,"(":s.openBracket,")":o.closeBracket,"{":i.openBrace,"}":i.closeBrace};t.getRubberBracket=(e,t)=>a[t]||(e?r.openSquareBracket:r.closeSquareBracket)},4730:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.openBracket=void 0;const o=n(4018),s=n(9160),r={width:559,height:1870,segs:[{cmd:"M",pt:new o.Point(559,0)},{cmd:"Q",pt:new o.Point(281.5,51),cp:new o.Point(389,0)},{cmd:"Q",pt:new o.Point(114,206.5),cp:new o.Point(174,102)},{cmd:"Q",pt:new o.Point(27,478),cp:new o.Point(54,311)},{cmd:"Q",pt:new o.Point(0,931),cp:new o.Point(0,645)},{cmd:"Q",pt:new o.Point(26.5,1383.5),cp:new o.Point(0,1215)},{cmd:"Q",pt:new o.Point(113,1658),cp:new o.Point(53,1552)},{cmd:"Q",pt:new o.Point(281,1817),cp:new o.Point(173,1764)},{cmd:"Q",pt:new o.Point(559,1870),cp:new o.Point(389,1870)},{cmd:"L",pt:new o.Point(559,1788)},{cmd:"Q",pt:new o.Point(435,1776),cp:new o.Point(489,1788)},{cmd:"Q",pt:new o.Point(331,1722),cp:new o.Point(374,1762)},{cmd:"Q",pt:new o.Point(253,1599),cp:new o.Point(283,1678)},{cmd:"Q",pt:new o.Point(201,1355),cp:new o.Point(218,1507)},{cmd:"Q",pt:new o.Point(183,939),cp:new o.Point(183,1194)},{cmd:"Q",pt:new o.Point(198,556.5),cp:new o.Point(183,714)},{cmd:"Q",pt:new o.Point(248,299),cp:new o.Point(213,399)},{cmd:"Q",pt:new o.Point(318,168),cp:new o.Point(276,215)},{cmd:"Q",pt:new o.Point(406,106),cp:new o.Point(355,127)},{cmd:"Q",pt:new o.Point(559,82),cp:new o.Point(465,82)},{cmd:"Z"}]};t.openBracket={draw:e=>(0,s.scalePath)(e,r)}},9160:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scalePath=void 0;const o=n(4018),s=n(4203);t.scalePath=(e,t)=>{const n=[],r=n=>new o.Point(n.x*e.width/t.width,n.y*e.height/t.height);return(0,s.tracePath)(t.segs,{onM(e){n.push({cmd:"M",pt:r(e)})},onL(e){n.push({cmd:"L",pt:r(e)})},onC(e,t,o){n.push({cmd:"C",pt:r(o),cp1:r(e),cp2:r(t)})},onQ(e,t){n.push({cmd:"Q",pt:r(t),cp:r(e)})},onA(){throw new Error("Function not implemented.")}}),n}},4872:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.closeSquareBracket=t.openSquareBracket=void 0;const o=n(4018),s=446;t.openSquareBracket={draw(e){const t=e.width/s,n=s*t,r=e.height,i=82*t,a=176*t;return[{cmd:"M",pt:new o.Point(n,0)},{cmd:"H",x:0},{cmd:"V",y:r},{cmd:"H",x:n},{cmd:"V",y:r-i},{cmd:"H",x:a},{cmd:"V",y:i},{cmd:"H",x:n},{cmd:"Z"}]}},t.closeSquareBracket={draw(e){const t=e.width/s,n=s*t,r=e.height,i=82*t,a=176*t;return[{cmd:"M",pt:new o.Point},{cmd:"H",x:n},{cmd:"V",y:r},{cmd:"H",x:0},{cmd:"V",y:r-i},{cmd:"H",x:n-a},{cmd:"V",y:i},{cmd:"H",x:0},{cmd:"Z"}]}}},5315:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SvgSurface=void 0;const o=n(4018),s=n(3823),r=n(4326),i=n(3081),a=n(9230),c=(e,t)=>{var n;const{stroke:o,strokeWidth:s,join:r,cap:a}=e,c={};return c.fill=null!==(n=e.fill)&&void 0!==n?n:"none",o&&(c.stroke=o),s&&(c["stroke-width"]=(0,i.toa)(s)),r&&(c["stroke-linecap"]=r),a&&(c["stroke-linecap"]=a),t&&!t.isZero()&&(c.transform=`translate(${(0,i.toa)(t.x)},${(0,i.toa)(t.y)})`),c};t.SvgSurface=class{constructor(){this.size=new o.Point,this.defs={},this.body=[]}setSize(e){this.size=e.clone(),this.clear()}drawPath(e,t,n){const o=Object.assign({d:(0,a.pathToString)(t)},c(n,e));this.body.push(`${(0,r.drawTag)("path",o,!0)}`)}drawRect(e,t,n,o){const s=Object.assign({x:(0,i.toa)(t.left),y:(0,i.toa)(t.top),width:(0,i.toa)(t.width),height:(0,i.toa)(t.height)},c(n,e));o&&(s.rx=(0,i.toa)(o.x),s.ry=(0,i.toa)(o.y)),this.body.push((0,r.drawTag)("rect",s,!0))}drawEllipse(e,t,n,o){const s=Object.assign(Object.assign({},c(o,e)),{cx:(0,i.toa)(t.x),cy:(0,i.toa)(t.y),rx:(0,i.toa)(n.x),ry:(0,i.toa)(n.y)});this.body.push(`${(0,r.drawTag)("ellipse",s,!0)}`)}addFigure(e){this.body.push(e)}addDef(e,t){this.defs[e]=t}exportText(e){return(0,s.buildSvgText)(this.size,this.defs,this.body,null!=e?e:{})}clear(){this.defs={},this.body.length=0}}},3524:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.standaloneExportOptions=void 0,t.standaloneExportOptions=Object.freeze({xml:{version:"1.0",encoding:"UTF-8",standalone:"no"},doctype:'svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"',svg:{xmlns:"http://www.w3.org/2000/svg",version:"1.1",baseProfile:"full","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:ev":"http://www.w3.org/2001/xml-events"}})},3823:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildSvgText=void 0;const o=n(4326),s=n(285);t.buildSvgText=(e,t,n,r)=>{let i="";const{xml:a,doctype:c,svg:d}=r;a&&(i+=`${(0,o.drawTag)("?xml",a,!0).replace("/>","?>")}\n`),c&&(i+=`<!DOCTYPE ${c}>\n`);const l=Object.assign({viewBox:`0 0 ${e.x} ${e.y}`},d);r.width&&(l.width=r.width),r.height&&(l.height=r.height),"xmlns"in l||(l.xmlns="http://www.w3.org/2000/svg"),i+=`${(0,o.drawTag)("svg",l)}\n`,r.excludeVerInfo||(i+=`  \x3c!-- Generated by CharChem v.${(0,s.getVersionStr)()} --\x3e\n`);const u=Object.keys(t);return u.length>0&&(i+="  <defs>\n",u.forEach((e=>{i+=`    ${t[e]}\n`})),i+="  </defs>\n"),n.forEach((e=>{i+=`  ${e}\n`})),i+="</svg>",i}},8217:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createLocalFontHash=void 0;const o=n(7601);t.createLocalFontHash=e=>{let t=`family:${e.family};height:${e.height};`;if(e.weight){const n=(0,o.fontWeightValue)(e.weight);400!==n&&(t+=`weight:${n};`)}return e.style&&"normal"!==e.style&&(t+=`style:${e.style};`),e.stretch&&"normal"!==e.stretch&&(t+=`stretch:${e.stretch};`),t}},411:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createRulesList=void 0;const o=n(759),s=n(6916),r=n(1430);t.createRulesList=e=>{const t=new o.ChemK(9),n=[["agentK",e.agentK(t)],["comment",e.comment("A")],["custom",e.custom("A")],["itemCount",e.itemCount(t)],["itemMass",e.itemMass(9)],["nodeCharge",e.nodeCharge(new s.ChemCharge("9",9))],["bracketCharge",e.bracketCharge(new s.ChemCharge("9",9))],["bracketCount",e.bracketCount(t)]],i=new Set(n.map((([e])=>e)));return r.ChemImgProps.getIndexStyles().forEach((o=>{i.has(o)||n.push([o,e.itemCount(t)])})),n}},5032:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFontHeight=t.getBaseline=void 0,t.getBaseline=({ascent:e})=>e,t.getFontHeight=({ascent:e,descent:t})=>e-t},7601:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isBold=t.fontWeightValue=void 0,t.fontWeightValue=e=>{const t=+e;return Number.isNaN(t)?"bold"===e?700:400:t},t.isBold=e=>!!e&&(0,t.fontWeightValue)(e)>=700},9230:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pathToString=void 0;const o=n(3081);t.pathToString=e=>e.map((e=>{const{cmd:t}=e;let n=e.rel?t.toLowerCase():t;const s=e=>{1!==n.length&&(n+=" "),n+=`${(0,o.toa)(e.x)} ${(0,o.toa)(e.y)}`};switch(t){case"M":case"L":case"T":s(e.pt);break;case"H":n+=(0,o.toa)(e.x);break;case"V":n+=(0,o.toa)(e.y);break;case"C":s(e.cp1),s(e.cp2),s(e.pt);break;case"S":s(e.cp2),s(e.pt);break;case"Q":s(e.cp),s(e.pt);break;case"A":s(e.r),n+=` ${(0,o.toa)(e.xRot)} ${e.largeArc} ${e.sweep}`,s(e.pt)}return n})).join("")},5410:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scaleFontFace=void 0,t.scaleFontFace=(e,t)=>{const n=Object.assign({},e);n.ascent*=t,n.descent*=t,n.capHeight*=t,n.xHeight*=t;const{bbox:o}=e;return o&&(n.bbox=o.map((e=>e*t))),n}},4203:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tracePath=void 0;const o=n(4018);t.tracePath=(e,t)=>{let n=new o.Point,s=n.clone(),r=n.clone();const i=(e,t)=>e?s.plus(t):t,a=(e,t)=>{s=e,r=null!=t?t:e},c=()=>s.times(2).minus(r);e.forEach(((e,r)=>{var d,l,u;const{cmd:h}=e;if("Z"===h)(null!==(d=t.onZ)&&void 0!==d?d:t.onL)(n),a(n);else if("M"===h){const o=i(e.rel,e.pt);t.onM(o),0===r&&(n=o),a(o)}else if("L"===h){const n=i(e.rel,e.pt);t.onL(n),a(n)}else if("H"===h){const n=new o.Point(e.rel?s.x+e.x:e.x,s.y);(null!==(l=t.onH)&&void 0!==l?l:t.onL)(n),a(n)}else if("V"===h){const n=new o.Point(s.x,e.rel?s.y+e.y:e.y);(null!==(u=t.onV)&&void 0!==u?u:t.onL)(n),a(n)}else if("C"===h){const n=i(e.rel,e.cp1),o=i(e.rel,e.cp2),s=i(e.rel,e.pt);t.onC(n,o,s),a(s,o)}else if("S"===h){const n=c(),o=i(e.rel,e.cp2),s=i(e.rel,e.pt);t.onC(n,o,s),a(s,o)}else if("Q"===h){const n=i(e.rel,e.cp),o=i(e.rel,e.pt);t.onQ(n,o),a(o,n)}else if("T"===h){const n=c(),o=i(e.rel,e.pt);t.onQ(n,o),a(o,n)}else if("A"===h){const n=i(e.rel,e.pt);t.onA(e.r,e.xRot,e.largeArc,e.sweep,n),a(n)}}))}},9046:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemEquation=void 0;const o=n(2458),s=n(8706),r=n(1172),i=n(8949),a=n(7599),c=n(2129),d=n(6445),l=n(2751),u=n(4086),h=n(730),p=n(7396),m=n(9069);let f=!1;const g=e=>({dstCol:e,refs:[]});t.ChemEquation=class{constructor(){this.state="NotSolved",this.agents=[],this.nCols=0,this.M=[],this.K=[],this.solves=[],this.srcMap=[],f||(s.Lang.addDict(l.equationDict),f=!0),this.clear()}getSolves(){return this.solves}getExpr(){return this.expr}setState(e,t,n){this.state=e,this.msgId=null!=t?t:"NotSolved"===e?"Not solved":void 0,this.params=n}getMessage(e){var t;return null!==(t=(0,d.ifDef)(this.msgId,(t=>s.Lang.tr(t,this.params,e))))&&void 0!==t?t:""}isSolved(){return"Solved"===this.state}makeError(){return new u.ChemError(this.msgId||this.state,this.params)}clear(){this.setState("NotSolved"),this.agents=[],this.expr=void 0,this.M=[],this.solves=[],this.srcMap=[]}initBySrc(e){var t;const n=(0,o.compile)(e,{srcMap:!0});this.initByExpr(n,null!==(t=n.srcMap)&&void 0!==t?t:[])}initByExpr(e,t){if(this.clear(),!e)return this.setState("Error","Invalid expression");const{error:n}=e;if(n)return n instanceof u.ChemError?this.setState("Error",n.msgId,n.params):this.setState("Error",n.message);this.expr=e,this.srcMap=t;const o=(0,r.isSuitableForEquation)(e);if(o)return this.setState("Error",o.msgId);this.agents=e.getAgents();const s=[];this.agents.forEach((e=>{const{part:t}=e,n=s[t]||new a.ElemList;n.addList((0,c.makeElemList)(e,!0)),s[t]=n}));const l=s[0],p=s[1];if(!l||!p||2!==s.length)return this.setState("Error","No separating operation");const m=(0,h.checkElementsMatching)([l,p]);if(m)return this.setState("Error",m[0],m[1]);this.nCols=this.agents.length,this.K=this.agents.map((()=>new i.Rational)),this.M=l.list.map((()=>[]));const f=l.list.reduce(((e,t,n)=>Object.assign(Object.assign({},e),{[t.id]:n})),{});return this.agents.forEach((e=>{const t=this.M.map((e=>{const t=new i.Rational;return e.push(t),t}));(0,c.makeElemList)(e,!0).list.forEach((n=>{const o=n.n*(1===e.part?-1:1);(0,d.ifDef)(f[n.id],(e=>{(0,d.ifDef)(t[e],(e=>e.set(o)))}))}))})),this.setState("NotSolved")}getMatrix(){return this.M}getMatrixStr(){return this.M.map((e=>e.join(" ")))}solve(){for(;"NotSolved"===this.state;)this.calcStep()}calcStep(){if("NotSolved"!==this.state)return;if(this.solves.length===this.nCols-1)return void this.simpleSolve();const{nRow:e,nCols:t}=this.findRowForAction();e>=0?t?this.onSimpleSolve(e,t[0],t[1]):this.deleteMatrixRow(e):this.try2RowsUnit()||this.searchKoeffs()||this.setState("Error","Balance is not found")}deleteMatrixRow(e){this.M.splice(e,1)}onSimpleSolve(e,t,n){const o=this.M[e],s=o[n].negx().divi(o[t]),r=g(t);r.refs.push({srcCol:n,k:s}),this.solves.unshift(r),this.deleteMatrixRow(e),this.M.forEach((e=>{e[n].addi(e[t].mulx(s)),e[t].set(0)}))}findRowForAction(){let e;return{nRow:this.M.findIndex((t=>{var n,o;const s=t.reduce(((e,t,n)=>t.isZero()?e:[...e,n]),[]);if(0===s.length)return!0;if(2===s.length){const r=s[0],i=s[1];if((null===(n=t[r])||void 0===n?void 0:n.sign())!==(null===(o=t[i])||void 0===o?void 0:o.sign()))return e=[r,i],!0}return!1})),nCols:e}}simpleSolve(){this.K.forEach((e=>e.set(0))),this.getUnknownIndices().forEach((e=>{var t;return null===(t=this.K[e])||void 0===t?void 0:t.set(1)})),this.calcSolves(),this.optimizeKoeffs(),this.checkKoeffs()&&this.checkBalance()?this.finalSolve():this.setState("Error","Balance is not found")}finalSolve(){this.setState("Solved","");const{expr:e,K:t,agents:n,srcMap:s}=this;if(e){const r=t.map((({x:e})=>e)),i=(0,m.makeSourceWithNewCoeffs)(r,n,e.src,s);this.expr=(0,o.compile)(i,{srcMap:!0})}}getUnknownIndices(){const e=new Array(this.nCols);e.fill(0);const t=[];this.solves.forEach((t=>{e[t.dstCol]=1}));for(let n=0;n!==this.nCols;n++)e[n]||t.push(n);return t}calcSolves(){this.solves.forEach((({dstCol:e,refs:t})=>{var n;null===(n=this.K[e])||void 0===n||n.set(0),t.forEach((t=>{var n;null===(n=this.K[e])||void 0===n||n.addi(t.k.mulx(this.K[t.srcCol]))}))}))}optimizeKoeffs(){const e=this.K.reduce(((e,{y:t})=>{const n=(0,i.calcAbsMCD)(e,t);return Math.max(e,e*t/n)}),1),t=this.K.map((t=>{const n=e/t.y;return t.x*n}));let n=t.reduce(((e,t)=>Math.max(e,t)),0),o=2;for(;o<=n;)t.findIndex((e=>e%o!=0))>=0?o++:(n/=o,t.forEach(((e,n)=>{t[n]=e/o})));this.K=t.map((e=>new i.Rational(e)))}checkKoeffs(){return!this.K.find((e=>e.x<=0))}checkBalance(){const e={};return this.agents.forEach(((t,n)=>{(0,c.makeElemList)(t,!0).list.forEach((({id:o,n:s})=>{var r,i;let a=s;t.part>0&&(a=-a),a*=null!==(i=null===(r=this.K[n])||void 0===r?void 0:r.x)&&void 0!==i?i:0,e[o]?e[o]+=a:e[o]=a}))})),Object.values(e).findIndex((e=>0!==e))<0}try2RowsUnit(){var e,t;const{nCols:n,M:o}=this,s=o.length;if(s<2)return!1;let r,a,c=0;for(r=0;;++r){if(a=r+1,a===s)return!1;const o=this.M[r];for(;a!==s;++a){const s=this.M[a];for(c=0;c!==n&&((null===(e=o[c])||void 0===e?void 0:e.isZero())||(null===(t=s[c])||void 0===t?void 0:t.isZero()));c++);if(c!==n)break}if(a!==s)break}const d=o[r],l=o[a],u=new i.Rational(-1).divi(d[c]),h=new i.Rational(-1).divi(l[c]),p=g(c);if(d.forEach(((e,t)=>{t===c||e.isZero()||p.refs.push({srcCol:t,k:e.mulx(u)})})),0===p.refs.length)return!1;this.solves.unshift(p);for(let e=0;e!==n;e++)l[e]=d[e].mulx(u).subi(l[e].mulx(h));return this.deleteMatrixRow(r),a--,this.M.forEach(((e,t)=>{if(t!==a){const t=e[c].copy();e[c].set(0),p.refs.forEach((n=>e[n.srcCol].addi(t.mulx(n.k))))}})),!0}searchKoeffs(){const e=this.getUnknownIndices(),t=e.length,n=(0,p.makeCoeffEnumerator)(t,30);if(n)for(const t of n)if(this.testKoeffs(e,t))return!0;return!1}testKoeffs(e,t){return e.forEach(((e,n)=>{var o;null===(o=this.K[e])||void 0===o||o.set(t[n])})),this.calcSolves(),!!this.checkKoeffs()&&(this.optimizeKoeffs(),!!this.checkBalance()&&(this.finalSolve(),!0))}}},730:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkElementsMatching=void 0,t.checkElementsMatching=e=>{for(let t=0;2!==t;t++){const n=e[t],o=e[1^t];if(!n||!o)return["Invalid expression",void 0];for(const e of n.list)if(!o.findRec(e)){const n=(0===t?"right":"left")+"|part";return["[E] is missing in [S] part",{E:e.id,S:n}]}}}},7396:(e,t)=>{function*n(e){for(let t=1;t<=e;t++)for(let e=1,n=t;n>0;e++,n--)yield[e,n];for(let t=2;t<=e;t++)for(let n=e,o=t;o<=e;o++,n--)yield[o,n]}function*o(e){yield[1,1,1];for(let t=2;t<=e;t++){let e=t,n=1,o=1;for(;e>1;e--,n++)yield[o,n,e];for(;n>1;o++,n--)yield[o,n,e];for(;o>1;o--,e++)yield[o,n,e]}const t=Math.floor((e-2)/2)+2;for(let n=2;n<e;n++){if(n===t)for(const t of o(e-2))yield t.map((e=>e+1));let s=e,r=n,i=1;for(;r<e;r++,s--)yield[i,r,s];for(;s>1;i++,s--)yield[i,r,s];for(;i<e;i++,r--)yield[i,r,s];for(;r>1;s++,r--)yield[i,r,s];for(;s<e;s++,i--)yield[i,r,s];for(;i>1;i--,r++)yield[i,r,s]}for(let t=1;t<e;t++){let n=e,o=e,s=t;for(;s<e;n--,s++)yield[s,o,n];for(;n<e;n++,o--)yield[s,o,n];for(;o<e;s--,o++)yield[s,o,n]}e>1&&(yield[e,e,e])}function*s(e,n){const o=new Array(e);o.fill(1),yield[...o];const s=1<<e;for(let r=2;r<=n;r++)for(let n=1;n!==s;n++){const s=[];o.fill(1);for(let t=0;t<e;t++)n&1<<t?o[t]=r:s.push(t);const i=s.length;if(r>2&&i>0){const e=(0,t.makeCoeffEnumerator)(i,r-1);for(const t of e)t.forEach(((e,t)=>{o[s[t]]=e})),yield[...o]}else yield[...o]}}Object.defineProperty(t,"__esModule",{value:!0}),t.coeffEnumeratorNd=t.coeffEnumerator3d=t.coeffEnumerator2d=t.makeCoeffEnumerator=void 0,t.makeCoeffEnumerator=(e,t)=>2===e?n(t):3===e?o(t):s(e,t),t.coeffEnumerator2d=n,t.coeffEnumerator3d=o,t.coeffEnumeratorNd=s},2751:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.equationDict=void 0,t.equationDict={ru:{"[E] is missing in [S] part":"Отсутствует элемент [E] в [S#] части уравнения","left|part":"левой","right|part":"правой","Equation not specified":"Уравнение не задано","No separating operation":"Требуется одна операция, разделяющая левую и правую часть уравнения","No solution":"Не удалось найти решение","Cant balance expression with abstract coefficients":"Невозможно балансировать уравнение с абстрактными коэффициентами","Cant balance expression with non-integer coefficients":"Невозможно балансировать уравнение с дробными коэффициентами","Cant balance expression with mineral series":"Невозможно балансировать неопределенные формулы минералов","Invalid expression":"Неподходящее выражение"},en:{"[E] is missing in [S] part":"Element [E] is missing on the [S#] side of the equation.","left|part":"left","right|part":"right","Equation not specified":"The equation is not specified","No separating operation":"Requires a single operation, separating the left and right side of the equation","No solution":"Could not find a solution","Cant balance expression with abstract coefficients":"Can't balance expression with abstract coefficients","Cant balance expression with non-integer coefficients":"Can't balance expression with non-integer coefficients","Cant balance expression with mineral series":"Can't balance expression with mineral series","Invalid expression":"Неподходящее выражение"}}},1172:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSuitableForEquation=void 0;const n="Cant balance expression with abstract coefficients";t.isSuitableForEquation=e=>e.walkExt({isStop:!1,result:void 0,itemPre({n:e}){e.isNumber()?e.isInt()||(this.result={reason:"float",msgId:"Cant balance expression with non-integer coefficients"}):this.result={reason:"abstract",msgId:n},this.isStop=!!this.result},mul({n:e}){e.isNumber()||(this.result={reason:"abstract",msgId:n})},comma(){this.result={reason:"abstract",msgId:"Cant balance expression with mineral series"}}}).result},9069:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeSourceWithNewCoeffs=void 0;const o=n(7962);t.makeSourceWithNewCoeffs=(e,t,n,s)=>{const r=[];let i=0;return t.forEach(((t,a)=>{const c=(0,o.getSrcItemsForObject)(t,s),d=c.length;if(d){const t=c[0].begin;r.push(n.slice(i,t)),i=t;const o=e[a];void 0!==o&&1!==o&&r.push(String(o)),d>1&&"agentK"===c[0].part&&(i=c[1].begin)}})),r.push(n.slice(i)),r.join("").trim()}},285:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getVersionStr=t.getVersion=void 0;const s=o(n(8412));t.getVersion=()=>s.default,t.getVersionStr=()=>(0,t.getVersion)().join(".")},5604:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calcCharge=void 0,t.calcCharge=e=>{const t=[0],n=()=>{t.unshift(0)},o=e=>{const n=t[0]*e();t.shift(),t[0]+=n};return e.walk({agentPre(){n()},agentPost(e){o((()=>e.n.num))},bracketBegin(){n()},bracketEnd(e){const{charge:n}=e;n&&(t[0]=n.value),o((()=>e.n.num))},nodePost(e){const{charge:n}=e;n&&(t[0]+=n.value)}}),t[0]}},7185:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calcMass=void 0;const o=n(6445);t.calcMass=(e,t=!0)=>{const n=[0],s=()=>{n.unshift(0)},r=e=>{const t=n[0]*e();n.shift(),n[0]+=t};return e.walk({agentPre(){s()},agentPost(e){r((()=>t?e.n.num:1))},mul(){s()},mulEnd(e){r((()=>e.begin.n.num))},bracketBegin(){s()},bracketEnd(e){r((()=>e.n.num))},nodePre(){s()},nodePost(){r((()=>1))},itemPre(){s()},itemPost(e){(0,o.ifDef)(e.mass,(e=>{n[0]=e})),r((()=>e.n.num))},atom(e){n[0]+=e.mass},radical(e){e.items.list.forEach((e=>{var t,o;n[0]+=e.n*(null!==(o=null===(t=e.elem)||void 0===t?void 0:t.mass)&&void 0!==o?o:0)}))}}),n[0]}},800:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isAbstractCoeffs=t.isAbstract=void 0,t.isAbstract=e=>{const t=new o(!0);return e.walk(t),t.isStop},t.isAbstractCoeffs=e=>{const t=new o(!1);return e.walk(t),t.isStop};const n=e=>!!e&&!e.isNumber();class o{constructor(e){this.useItems=e,this.isStop=!1}agentPre(e){this.isStop=n(e.n)}itemPre(e){this.isStop=n(e.n)}bracketEnd(e){this.isStop=n(e.n)}mul(e){this.isStop=n(e.n)}custom(e){this.useItems&&e.text&&(this.isStop=!0)}comma(){this.useItems&&(this.isStop=!0)}}},9059:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isTextFormula=void 0,t.isTextFormula=e=>!e.walkExt({isStop:!1,bond(e){this.isStop=!e.isText},itemPre(e){this.isStop=!!e.dots},bracketBegin(e){this.isStop=!!e.padding}}).isStop},3998:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.locateAtomNumber=void 0,t.locateAtomNumber=e=>{let t=0;return e.walk({atom(e){t=e.n}}),t}},7513:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeBruttoKey=void 0;const o=n(9701),s=n(2458),r=n(2129),i=n(800);t.makeBruttoKey=e=>{let t;if("string"==typeof e){const n=(0,s.compile)(e);if(!n.isOk())return"";t=n}else{if(e instanceof o.ChemExpr&&!e.isOk())return"";t=e}if((0,i.isAbstractCoeffs)(t))return"";const n=(0,r.makeElemList)(t);return n.sortByHill(),String(n)}},2129:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeElemList=void 0;const o=n(7599);t.makeElemList=(e,t=!1)=>{const n=[new o.ElemList],s=()=>{n.unshift(new o.ElemList)},r=e=>{const t=n.shift();t.scale(e),n[0].addList(t)};return e.walk({agentPre(){s()},agentPost(e){r(t?1:e.n.num)},nodePost(e){var t,o;n[0].charge+=null!==(o=null===(t=e.charge)||void 0===t?void 0:t.value)&&void 0!==o?o:0},bracketBegin(){s()},bracketEnd(e){const{charge:t}=e;t&&(n[0].charge=t.value),r(e.n.num)},mul(){s()},mulEnd(e){r(e.begin.n.num)},itemPre(){s()},itemPost(e){r(e.n.num)},atom(e){n[0].addAtom(e)},custom(e){n[0].addCustom(e.text)},radical(e){n[0].addRadical(e)}}),n[0]}},1947:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeTextFormulaSrc=t.makeTextFormula=void 0;const o=n(6445),s=n(2458),r=n(3222),i=n(3998);class a{constructor(){this.l2r=!0,this.chunks=[]}add(e){this.l2r?this.chunks.push(e):this.chunks.unshift(e)}}t.makeTextFormula=(e,t=r.rulesText)=>{const n=[new a];let s,d;const l=()=>{n.unshift(new a)},u=()=>{if(1===n.length)return;const e=n.shift(),t=n[0];t.l2r?t.chunks=[...t.chunks,...e.chunks]:t.chunks=[...e.chunks,...t.chunks]},h=(e,t)=>n[0].add({text:e,color:t}),p=()=>h(" "),m=e=>!(null==e?void 0:e.isNeg),f=(e,n,s)=>(0,o.ifDef)(e,(e=>{n===e.isLeft&&h(t.nodeCharge(e),s)}));let g=!1;for(e.walk({agentPre(e){p(),l(),e.n.isSpecified()&&h(t.agentK(e.n))},agentPost(){u()},atom(e){g||h(t.atom(e.id),null!=d?d:s)},bond(e){n[0].l2r=m(e),h(e.tx,e.color)},comma(){h(t.comma(),s)},comment(e){h(t.comment(e.text),s)},custom(e){h(t.custom(e.text),s)},itemPre(e){if(g)return;s=e.color,d=e.atomColor;const n=e.atomNum;if(n){const o=n>=0?n:(0,i.locateAtomNumber)(e);h(t.itemMassAndNum(e.mass||0,o),s)}else(0,o.ifDef)(e.mass,(e=>h(t.itemMass(e),s)))},itemPost(e){g||(e.charge&&h(t.itemCharge(e.charge),s),e.n.isSpecified()&&h(t.itemCount(e.n),s))},nodePre(e){l(),f(e.charge,!0,e.color),e.autoMode&&(g=!0)},nodePost(e){f(e.charge,!1,e.color),g=!1,u()},operation(e){p(),h(t.operation(e),e.color)},radical(e){h(t.radical(e.label),s)},bracketBegin(e){var o;if(m(e.bond))l(),f(null===(o=e.end)||void 0===o?void 0:o.charge,!0,e.color),h(e.text,e.color);else{const{color:o,end:s}=e;s&&(n[0]&&(n[0].l2r=!1),f(s.charge,!1,o),s.n.isSpecified()&&h(t.itemCount(s.n),o),h(s.text,o)),l()}},bracketEnd(e){const{begin:o}=e,{color:s}=o;m(o.bond)?(h(e.text,s),e.n.isSpecified()&&h(t.itemCount(e.n),s),f(e.charge,!1,s),u()):(u(),n[0]&&(n[0].l2r=!1),h(o.text,s),f(e.charge,!0,s))},mul(e){e.isFirst||h(t.mul(),e.color),e.n.isSpecified()&&h(t.mulK(e.n),e.color)}});n.length>1;)u();const v=c(n[0].chunks,t).trim();return t.postProcess(v)};const c=(e,t)=>e.map(((n,o)=>{let s=n.text;const{color:r}=n;if(r){const n=0===o||r!==e[o-1].color,i=o===e.length-1||r!==e[o+1].color;n&&(s=t.colorBegin(r)+s),i&&(s+=t.colorEnd())}return s})).reduce(((e,t)=>e+t),"");t.makeTextFormulaSrc=(e,n)=>{const o=(0,s.compile)(e);return o.isOk()?(0,t.makeTextFormula)(o,n):""}},2613:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Lang=void 0;const o=n(6445),s=n(4718),r=n(9592),i=n(7954);class a{static tr(e,t,n){var o;const s=(n||a.curLang).toLowerCase(),{dict:r}=a;let c=r[s];if(!c){const e=s.indexOf("-");e>=0&&(c=r[s.substring(0,e)])}const d=null!==(o=(null!=c?c:a.enDict)[e])&&void 0!==o?o:e;return(0,i.replaceLangParams)({text:d,params:t,langId:n,tr:a.tr})}static findPhrase(e){var t;return null===(t=a.dict[a.curLang])||void 0===t?void 0:t[e]}static addDict(e){const{dict:t}=a;Object.entries(e).forEach((([e,n])=>{t[e]?t[e]=Object.assign(Object.assign({},t[e]),n):t[e]=n}))}}t.Lang=a,a.curLang="en",a.navLang=void 0,a.ruDict=r.baseDictRu,a.enDict=s.baseDictEn,a.dict={en:a.enDict,ru:a.ruDict},"undefined"!=typeof window&&(a.navLang=(navigator.language||navigator.browserLanguage||navigator.userLanguage||"en").toLowerCase(),(0,o.ifDef)(a.navLang,(e=>{if(e in a.dict)a.curLang=e;else if(e.indexOf("-")>=0){const t=e.split("-")[0];t in a.dict&&(a.curLang=t)}})))},3882:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},4718:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.baseDictEn=void 0,t.baseDictEn={$Native:"English",$English:"English","Invalid version":"Formula requires CharChem version [need] instead of [cur]",H:"Hydrogen",He:"Helium",Li:"Lithium",Be:"Beryllium",B:"Boron",C:"Carbon",N:"Nitrogen",O:"Oxygen",F:"Fluorine",Ne:"Neon",Na:"Sodium",Mg:"Magnesium",Al:"Aluminium",Si:"Silicon",P:"Phosphorus",S:"Sulfur",Cl:"Chlorine",Ar:"Argon",K:"Potassium",Ca:"Calcium",Sc:"Scandium",Ti:"Titanium",V:"Vanadium",Cr:"Chromium",Mn:"Manganese",Fe:"Iron",Co:"Cobalt",Ni:"Nickel",Cu:"Copper",Zn:"Zinc",Ga:"Gallium",Ge:"Germanium",As:"Arsenic",Se:"Selenium",Br:"Bromine",Kr:"Krypton",Rb:"Rubidium",Sr:"Strontium",Y:"Yttrium",Zr:"Zirconium",Nb:"Niobium",Mo:"Molybdenum",Tc:"Technetium",Ru:"Ruthenium",Rh:"Rhodium",Pd:"Palladium",Ag:"Silver",Cd:"Cadmium",In:"Indium",Sn:"Tin",Sb:"Antimony",Te:"Tellurium",I:"Iodine",Xe:"Xenon",Cs:"Caesium",Ba:"Barium",La:"Lanthanum",Ce:"Cerium",Pr:"Praseodymium",Nd:"Neodymium",Pm:"Promethium",Sm:"Samarium",Eu:"Europium",Gd:"Gadolinium",Tb:"Terbium",Dy:"Dysprosium",Ho:"Holmium",Er:"Erbium",Tm:"Thulium",Yb:"Ytterbium",Lu:"Lutetium",Hf:"Hafnium",Ta:"Tantalum",W:"Tungsten",Re:"Rhenium",Os:"Osmium",Ir:"Iridium",Pt:"Platinum",Au:"Gold",Hg:"Mercury",Tl:"Thallium",Pb:"Lead",Bi:"Bismuth",Po:"Polonium",At:"Astatine",Rn:"Radon",Fr:"Francium",Ra:"Radium",Ac:"Actinium",Th:"Thorium",Pa:"Protactinium",U:"Uranium",Np:"Neptunium",Pu:"Plutonium",Am:"Americium",Cm:"Curium",Bk:"Berkelium",Cf:"Californium",Es:"Einsteinium",Fm:"Fermium",Md:"Mendelevium",No:"Nobelium",Lr:"Lawrencium",Rf:"Rutherfordium",Db:"Dubnium",Sg:"Seaborgium",Bh:"Bohrium",Hs:"Hassium",Mt:"Meitnerium",Ds:"Darmstadtium",Rg:"Roentgenium",Cn:"Copernicium",Nh:"Nihonium",Fl:"Flerovium",Mc:"Moscovium",Lv:"Livermorium",Ts:"Tennessine",Og:"Oganesson"}},9592:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.baseDictRu=void 0,t.baseDictRu={$Native:"Русский",$English:"Russian","Internal error: [msg]":"Внутренняя ошибка: [msg]","Formula can not be displayed as text":"Формулу нельзя отобразить в текстовом виде","Expected '(' after [S]":" Требуется '(' после [S]","Unexpected '[C]'":"Неверный символ '[C]' в позиции [pos]","Expected '[ok]' instead of '[bad]'":"Требуется '[ok]' вместо '[bad]' в позиции [pos]","Invalid character '[C]'":"Недопустимый символ '[C]' в позиции [pos]","Russian element character":"Недопустимый русский символ '[C]'. Для описания химического элемента должны использоваться только латинские символы.","Non-latin element character":"Недопустимый символ '[C]'. Для описания химического элемента должны использоваться только латинские символы.","Unknown element character '[C]'":"Недопустимый символ '[C]' описания реагента в позиции [pos]","Expected '[C]'":"Требуется '[C]' в позиции [pos]","Unknown element '[Elem]'":"Ошибочный элемент '[Elem]' в позиции [pos]","Comment is not closed":"Не закрыт комментарий, начатый в позиции [pos]","Abstract coefficient is not closed":"Не закрыт абстрактный коэффициент, начатый в позиции [pos]","Abstract element is not closed":"Не закрыт абстрактный элемент, начатый в позиции [pos]","Expected node declaration before charge":"Неизвестно, к чему нужно применить заряд в позиции [pos]","Invalid charge declaration":"Ошибка в описании заряда в позиции [pos]","It is necessary to close the bracket":"Необходимо закрыть скобку, открытую в позиции [pos]","Expected variable name":"Требуется указать имя переменной в позиции [pos]","Undefined variable [name]":"Не определена числовая переменная '[name]' в позиции [pos]","Invalid node reference '[ref]'":"Неправильная ссылка на узел '[ref]' в позиции [pos]","Invalid label":"Неправильная метка в позиции [pos]","Invalid branch close":"Нельзя закрыть ветку в позиции [pos], которая не открыта","Cant close branch before bracket":"Нельзя закрыть ветку в позиции [pos], пока не закрыта скобка в позиции [pos0]","Cant close bracket before branch":"Нельзя закрыть скобку в позиции [pos], пока не закрыта ветка в позиции [pos0]","Invalid bracket close":"Нет пары для скобки, закрытой в позиции [pos]","It is necessary to close the branch":"Необходимо закрыть ветку, открытую в позиции [pos]","Expected [must] instead of [have]":"Требуется [must] вместо [have] в позиции [pos]","Invalid middle point":"Не используется промежуточная точка","Cant create ring":"Невозможно создать кольцо","Cant close ring":"Невозможно замкнуть кольцо","Invalid version":"Для формулы требуется CharChem версии [need] вместо [cur]","Invalid number [n]":"Неверное числовое значение [n] в позиции [pos]","Periodic Table":"Периодическая система химических элементов","Table legend":"Группы химических элементов",Group:"Группа",Period:"Период",Row:"Ряд","[x]-block":"[x]-блок",Lanthanides:"Лантаноиды",Actinides:"Актиноиды","Alkali metals":"Щелочные металлы","Alkaline earth metals":"Щёлочноземельные металлы","Transition metals":"Переходные металлы","Post transition metals":"Постпереходные металлы",Metalloids:"Полуметаллы","Other nonmetals":"Неметаллы",Halogens:"Галогены","Noble gases":"Инертные газы","Unknown props":"Св-ва неизвестны","(s)":"(тв)","(l)":"(ж)","(g)":"(г)","(aq)":"(р-р)",H:"Водород",He:"Гелий",Li:"Литий",Be:"Бериллий",B:"Бор",C:"Углерод",N:"Азот",O:"Кислород",F:"Фтор",Ne:"Неон",Na:"Натрий",Mg:"Магний",Al:"Алюминий",Si:"Кремний",P:"Фосфор",S:"Сера",Cl:"Хлор",Ar:"Аргон",K:"Калий",Ca:"Кальций",Sc:"Скандий",Ti:"Титан",V:"Ванадий",Cr:"Хром",Mn:"Марганец",Fe:"Железо",Co:"Кобальт",Ni:"Никель",Cu:"Медь",Zn:"Цинк",Ga:"Галлий",Ge:"Германий",As:"Мышьяк",Se:"Селен",Br:"Бром",Kr:"Криптон",Rb:"Рубидий",Sr:"Стронций",Y:"Иттрий",Zr:"Цирконий",Nb:"Ниобий",Mo:"Молибден",Tc:"Технеций",Ru:"Рутений",Rh:"Родий",Pd:"Палладий",Ag:"Серебро",Cd:"Кадмий",In:"Индий",Sn:"Олово",Sb:"Сурьма",Te:"Теллур",I:"Йод",Xe:"Ксенон",Cs:"Цезий",Ba:"Барий",La:"Лантан",Ce:"Церий",Pr:"Празеодим",Nd:"Неодим",Pm:"Прометий",Sm:"Самарий",Eu:"Европий",Gd:"Гадолиний",Tb:"Тербий",Dy:"Диспрозий",Ho:"Гольмий",Er:"Эрбий",Tm:"Тулий",Yb:"Иттербий",Lu:"Лютеций",Hf:"Гафний",Ta:"Тантал",W:"Вольфрам",Re:"Рений",Os:"Осмий",Ir:"Иридий",Pt:"Платина",Au:"Золото",Hg:"Ртуть",Tl:"Таллий",Pb:"Свинец",Bi:"Висмут",Po:"Полоний",At:"Астат",Rn:"Радон",Fr:"Франций",Ra:"Радий",Ac:"Актиний",Th:"Торий",Pa:"Протактиний",U:"Уран",Np:"Нептуний",Pu:"Плутоний",Am:"Америций",Cm:"Кюрий",Bk:"Берклий",Cf:"Калифорний",Es:"Эйнштейний",Fm:"Фермий",Md:"Менделеевий",No:"Нобелий",Lr:"Лоуренсий",Rf:"Резерфордий",Db:"Дубний",Sg:"Сиборгий",Bh:"Борий",Hs:"Хассий",Mt:"Мейтнерий",Ds:"Дармштадтий",Rg:"Рентгений",Cn:"Коперниций",Nh:"Нихоний",Fl:"Флеровий",Mc:"Московий",Lv:"Ливерморий",Ts:"Теннессин",Og:"Оганесон"}},8706:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,s)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),s(n(2613),t),s(n(3882),t)},7954:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.replaceLangParams=void 0;const o=n(6445);t.replaceLangParams=e=>{const{text:t,params:n,langId:s,tr:r}=e;let i="",a=0;const c=e=>{var t;return null!==(t=(0,o.ifDef)(null==n?void 0:n[e],(e=>String(e))))&&void 0!==t?t:e};for(;a>=0;){const e=t.indexOf("[",a);if(e<0)break;const n=t.indexOf("]",e);if(n<0)break;i+=t.slice(a,e);const o=t.slice(e+1,n);o.endsWith("#")?i+=r(c(o.slice(0,-1)),{},s):i+=c(o),a=n+1}return i+t.slice(a)}},4018:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Point=t.pointFromDeg=t.pointFromRad=void 0;const o=n(3081),s=n(6113);t.pointFromRad=e=>new r(Math.cos(e),Math.sin(e)),t.pointFromDeg=e=>(0,t.pointFromRad)((0,s.deg2rad)(e));class r{constructor(e=0,t=0){this.x=e,this.y=t}set(e,t){this.x=e,this.y=t}setPt(e){this.x=e.x,this.y=e.y}toString(){return`(${(0,o.toa)(this.x)}, ${(0,o.toa)(this.y)})`}clone(){return new r(this.x,this.y)}equals(e){return(0,o.is0)(this.x-e.x)&&(0,o.is0)(this.y-e.y)}isZero(){return(0,o.is0)(this.x)&&(0,o.is0)(this.y)}plus(e){return new r(this.x+e.x,this.y+e.y)}add(e,t){return this.x+=e,this.y+=t,this}iadd(e){return this.x+=e.x,this.y+=e.y,this}isub(e){return this.x-=e.x,this.y-=e.y,this}minus(e){return new r(this.x-e.x,this.y-e.y)}neg(){return new r(-this.x,-this.y)}times(e){return new r(e*this.x,e*this.y)}scale(e){return this.x*=e,this.y*=e,this}mini(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y)}maxi(e){this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y)}polarAngle(){return(0,o.is0)(this.x)&&(0,o.is0)(this.y)?0:(0,o.is0)(this.x)?this.y>0?Math.PI/2:-Math.PI/2:Math.atan2(this.y,this.x)}polarAngleDeg(){return(0,s.rad2deg)(this.polarAngle())}lengthSqr(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.lengthSqr())}distSqr(e){return e.minus(this).lengthSqr()}dist(e){return Math.sqrt(this.distSqr(e))}normal(){const e=this.length();return(0,o.is0)(e)?new r:this.times(1/e)}transpon(e){return e?new r(this.y,-this.x):new r(-this.y,this.x)}static get zero(){return i}}t.Point=r;const i=Object.freeze(new r)},8949:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calcAbsMCD=t.Rational=void 0;class n{constructor(e=0,t=1){this.x=e,this.y=t}set(e){return this.x=e,this.y=1,this}toString(){const{x:e,y:t}=this;return 1===t?String(e):`${e}/${t}`}copy(){return new n(this.x,this.y)}isZero(){return 0===this.x}absLess(e){return Math.abs(this.x)*e.y<Math.abs(e.x)*this.y}sign(){return this.x<0?-1:this.x>0?1:0}negx(){return new n(-this.x,this.y)}absx(){return new n(Math.abs(this.x),this.y)}norm(){if(this.y<0&&(this.x=-this.x,this.y=-this.y),0===this.x)this.y=1;else if(this.x<1||this.x>1){const e=(0,t.calcAbsMCD)(this.x,this.y);this.x/=e,this.y/=e}return this}addi(e){return"number"==typeof e?this.x+=e*this.y:(this.y===e.y?this.x+=e.x:(this.x=this.x*e.y+e.x*this.y,this.y*=e.y),this.norm()),this}addx(e){return"number"==typeof e?new n(this.x+e*this.y,this.y):this.copy().addi(e)}subi(e){return this.addi(e.negx())}subx(e){return e.negx().addi(this)}muli(e){return"number"==typeof e?this.x*=e:(this.x*=e.x,this.y*=e.y),this.norm()}mulx(e){return"number"==typeof e?new n(this.x*e,this.y).norm():new n(this.x*e.x,this.y*e.y).norm()}divi(e){const{x:t,y:n}=e;return this.x*=n,this.y*=t,this.norm()}divx(e){return new n(this.x*e.y,this.y*e.x).norm()}}t.Rational=n,t.calcAbsMCD=(e,t)=>{let n=Math.min(Math.abs(e),Math.abs(t));for(;n>1&&(e%n!=0||t%n!=0);)n--;return n}},3337:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateRect=t.Rect=void 0;const o=n(4018),s=n(3081);class r{constructor(e,t,n,s){"number"==typeof e&&"number"==typeof t?(this.A=new o.Point(e,t),this.B=new o.Point(n,s)):e instanceof o.Point&&t instanceof o.Point?(this.A=e.clone(),this.B=t.clone()):(this.A=new o.Point,this.B=new o.Point)}get left(){return this.A.x}get top(){return this.A.y}get right(){return this.B.x}get bottom(){return this.B.y}get width(){return this.B.x-this.A.x}get height(){return this.B.y-this.A.y}get size(){return new o.Point(this.width,this.height)}get cx(){return this.left+.5*this.width}get cy(){return this.top+.5*this.height}get center(){return new o.Point(this.cx,this.cy)}toString(){return`{${(0,s.toa)(this.left)}, ${(0,s.toa)(this.top)}, ${(0,s.toa)(this.right)}, ${(0,s.toa)(this.bottom)}}`}isEmpty(){return(0,s.is0)(this.width)&&(0,s.is0)(this.height)}clone(){return new r(this.A,this.B)}updatePoint(e){this.A.x=Math.min(this.A.x,e.x),this.A.y=Math.min(this.A.y,e.y),this.B.x=Math.max(this.B.x,e.x),this.B.y=Math.max(this.B.y,e.y)}unite(e){return this.updatePoint(e.A),this.updatePoint(e.B),this}move(e){this.A.iadd(e),this.B.iadd(e)}moveXY(e,t){this.A.add(e,t),this.B.add(e,t)}contains(e){return this.A.x<=e.x&&this.B.x>=e.x&&this.A.y<=e.y&&this.B.y>=e.y}grow(e,t){const n=null!=t?t:e;return this.A.x-=e,this.B.x+=e,this.A.y-=n,this.B.y+=n,this}scale(e){this.A.scale(e),this.B.scale(e)}clip(e,t){let{x:n,y:s}=e,{x:r,y:c}=t;const{left:d,right:l,top:u,bottom:h}=this,p=(e,t)=>i(0,e<d)|i(1,t<u)|i(2,e>l)|i(3,t>h);let m=p(n,s),f=p(r,c),g=!(m|f),v=!!(m&f),b=!1;for(;!v&&!g;)0===m&&([n,r]=[r,n],[s,c]=[c,s],[m,f]=[f,m],b=!b),a(0,m)?(s+=(c-s)*(d-n)/(r-n),n=d):a(1,m)?(n+=(r-n)*(u-s)/(c-s),s=u):a(2,m)?(s+=(c-s)*(l-n)/(r-n),n=l):a(3,m)&&(n+=(r-n)*(h-s)/(c-s),s=h),m=p(n,s),g=!(m|f),v=!!(m&f);const C=new o.Point(n,s),y=new o.Point(r,c);return{inside:g,a:b?y:C,b:b?C:y}}}t.Rect=r;const i=(e,t)=>t?1<<e:0,a=(e,t)=>!!(t&1<<e);t.updateRect=(e,t)=>t?(t.updatePoint(e),t):new r(e,e)},4040:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.normalize360=void 0,t.normalize360=e=>{const t=e%360;return t<0?360+t:t}},3081:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toa=t.isClose=t.is0=void 0,t.is0=e=>Math.abs(e)<.001,t.isClose=(e,n)=>(0,t.is0)(Math.abs(e)-Math.abs(n)),t.toa=e=>e.toFixed(2).replace(/0+$/g,"").replace(/\.$/,"").replace(/^-0$/,"0")},5041:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.strMass=t.roundMass=void 0;const o=n(3081);t.roundMass=e=>Math.round(100*e)/100,t.strMass=e=>(0,o.toa)((0,t.roundMass)(e))},6113:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deg2rad=t.rad2deg=void 0,t.rad2deg=e=>180*e/Math.PI,t.deg2rad=e=>e*Math.PI/180},1268:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getNodeInfo=t.getNodeCenterPos=void 0,t.getNodeCenterPos=e=>e.res.nodeFrame.org.plus(e.res.center),t.getNodeInfo=(e,t)=>t[e.index]},2793:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyPadding=void 0;const o=n(3337);t.applyPadding=(e,t,n)=>{if(1===t.length)return e.clone().grow(t[0]*n);if(2===t.length)return e.clone().grow(t[1]*n,t[0]*n);if(3===t.length){const s=t[0]*n,r=t[1]*n,i=t[2]*n;return new o.Rect(e.left-r,e.top-s,e.right+r,e.bottom+i)}const s=t[0]*n,r=t[1]*n,i=t[2]*n,a=t[3]*n;return new o.Rect(e.left-a,e.top-s,e.right+r,e.bottom+i)}},1654:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clipLine=void 0,t.clipLine=(e,t,n)=>{const{inside:o,b:s}=e.clip(t,n);return o?s:t}},7075:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clipLineByNode=void 0;const o=n(1654),s=n(5972);t.clipLineByNode=(e,t,n,r,i)=>{if(!n||!r)return;const a=n.clone();if((0,s.isNodeHidden)(e))return a;const{nodeFrame:c,rcNodeCore:d}=t,l=d.clone();return l.grow(i),l.move(c.org),(0,o.clipLine)(l,n,r)}},248:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.doubleBond=void 0;const o=n(4018),s=n(913),r=n(1945),i=(e,t)=>{const n=e.nodes[t];return n&&n.autoMode&&n.bonds.size>1};t.doubleBond=({bond:e,frame:t,imgProps:n,p0:a,p1:c,styles:d,color:l,align:u,stA:h})=>{const p=c.minus(a).normal(),m=d[0],f=d[1],g=p.transpon(!0),v=p.transpon(),b=(0,s.getBondStyleWidth)(n,m),C=(0,s.getBondStyleWidth)(n,f);let y,P,w,x;if("x"===u){const{lineSpace2x:e}=n,t=g.times((b+e)/2),o=v.times((C+e)/2);y=a.plus(t),w=a.plus(o),P=c.plus(o),x=c.plus(t)}else{const t=((e,t,n)=>{if(!n)return t.calcBondSign(e);switch(n){case"l":return-1;case"r":return 1;default:return 0}})(e,h,u),{lineSpace2:s}=n;let r,d;t<0?(r=g.times((b+C)/2+s),d=o.Point.zero):t>0?(r=o.Point.zero,d=v.times((b+C)/2+s)):(r=g.times((b+s)/2),d=v.times((C+s)/2)),y=a.plus(r),w=a.plus(d),P=c.plus(r),x=c.plus(d),i(e,0)&&(t<0?y.iadd(p.times(s)):t>0&&w.iadd(p.times(s))),i(e,1)&&(t<0?P.isub(p.times(s)):t>0&&x.isub(p.times(s)))}(0,r.singleLine)(e,t,n,y,P,m,l),(0,r.singleLine)(e,t,n,w,x,f,l)}},6558:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawBezierBond=void 0;const o=n(1654),s=n(3689),r=n(1228),i=n(2347),a=n(5972);t.drawBezierBond=({bond:e,frame:t,props:n,middlePoints:c,res0:d,res1:l})=>{const u=Math.min(c.length-1,2);if(u<=0)return;const{line:h,lineWidth:p,nodeMargin:m}=n,f=d.rcNodeCore.clone();f.move(d.nodeFrame.org),e.nodes[0]&&!(0,a.isNodeHidden)(e.nodes[0])&&f.grow(m);const g=d.center.plus(d.nodeFrame.org),v=l.rcNodeCore.clone();v.move(l.nodeFrame.org),e.nodes[1]&&!(0,a.isNodeHidden)(e.nodes[1])&&v.grow(m);const b=l.center.plus(l.nodeFrame.org);let C=g;const y=c.slice(0,u).map((e=>{const t=e.times(h).plus(C);return C=t,t})),P=(0,o.clipLine)(f,g,y[0]);if(!P)return;const w=(0,o.clipLine)(v,b,y[u-1]);if(!w)return;const x=[{cmd:"M",pt:P},1===u?{cmd:"Q",cp:y[0],pt:w}:{cmd:"C",cp1:y[0],cp2:y[1],pt:w}],M=(0,r.getBondColor)(e,n),B=new s.FigPath(x,{stroke:M,strokeWidth:p});B.update(),t.addFigure(B,!0),e.arr0&&(0,i.drawBondArrow)(t,n,y[0],P,M),e.arr1&&(0,i.drawBondArrow)(t,n,y[u-1],w,M)}},4924:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawBond=void 0;const o=n(7944),s=n(7075),r=n(1268),i=n(8738),a=n(6558);t.drawBond=({bond:e,props:t,frame:n,nodesInfo:c,stA:d})=>{if(!e.isVisible())return;const{nodeMargin:l}=t;if(2!==e.nodes.length)return void(0,i.drawBondPoly)(e,n,t,c);const[u,h]=e.nodes;if(!u||!h)return;const{res:p}=(0,r.getNodeInfo)(u,c),{res:m}=(0,r.getNodeInfo)(h,c);let f=p.nodeFrame.org.plus(p.center);const{middlePoints:g}=e;if(g&&g.length>0)return void(0,a.drawBezierBond)({bond:e,frame:n,props:t,middlePoints:g,res0:p,res1:m});let v=m.nodeFrame.org.plus(m.center);f=(0,s.clipLineByNode)(u,p,f,v,l),f&&(v=(0,s.clipLineByNode)(h,m,v,f,l),v&&(0,o.drawBondAB)({bond:e,bondA:f,bondB:v,frame:n,imgProps:t,stA:d}))}},7944:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawBondAB=void 0;const o=n(1228),s=n(6522),r=n(1945),i=n(248),a=n(9995),c=n(2347);t.drawBondAB=({bond:e,bondA:t,bondB:n,imgProps:d,frame:l,stA:u})=>{const{n:h,style:p,w0:m,w1:f}=e,g=(0,o.getBondColor)(e,d);let v;if(m||1!==f?1!==m||f?m||-1!==f?-1!==m||f||(v=(0,a.wedgeBond)(n,t,d,g,!0)):v=(0,a.wedgeBond)(t,n,d,g,!0):v=(0,a.wedgeBond)(n,t,d,g,!1):v=(0,a.wedgeBond)(t,n,d,g,!1),v)return v.update(),void l.addFigure(v);const b=p?Array.from(p):new Array(h).fill("|");switch(b.reverse(),1===b.length&&1===e.w0&&1===e.w1&&(b[0]="I"),b.length){case 1:(0,r.singleLine)(e,l,d,t,n,b[0],g),e.arr1&&(0,c.drawBondArrow)(l,d,t,n,g),e.arr0&&(0,c.drawBondArrow)(l,d,n,t,g);break;case 2:(0,i.doubleBond)({bond:e,frame:l,imgProps:d,p0:t,p1:n,styles:b,color:g,align:e.align,stA:u});break;case 3:(0,s.tripleBond)(e,l,d,t,n,b,g)}}},2347:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawBondArrow=void 0;const o=n(3689);t.drawBondArrow=(e,t,n,s,r)=>{const{arrowL:i,arrowD:a,lineWidth:c}=t,d=n.minus(s).normal(),l=s.plus(d.times(i)),u=l.plus(d.transpon(!0).times(a)),h=[{cmd:"M",pt:l.plus(d.transpon().times(a))},{cmd:"L",pt:s},{cmd:"L",pt:u}],p={stroke:r,strokeWidth:c},m=new o.FigPath(h,p);m.update(),e.addFigure(m,!0)}},8738:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawBondPoly=void 0;const o=n(4018),s=n(7546),r=n(1268),i=n(1228),a=n(2698);t.drawBondPoly=(e,t,n,c)=>{const d=(0,i.getBondColor)(e,n),{lineWidth:l,dash:u}=n,{nodes:h}=e,p=h.filter((e=>!!e)).map((e=>(0,r.getNodeCenterPos)((0,r.getNodeInfo)(e,c))));if(p.length<2)return;const m=(e=>e.reduce(((e,t)=>e.iadd(t)),new o.Point).scale(1/e.length))(p),f={stroke:d,strokeWidth:l};if("o"===e.ext){const e=p[0],n=p[1],r=e.plus(n).times(.5),i=.7*m.minus(r).length(),a=new s.FigEllipse(m,new o.Point(i,i),f);t.addFigure(a)}else if("s"===e.ext){let n=0,o=p.length;for(e.isCycle||(n++,o--);n<o;n++){const e=p[n],t=m.minus(e);e.iadd(t.times(.2))}const s=a.FigBSpline.extendsPoints(p,e.isCycle);if(s){const n=new a.FigBSpline(s,f,u,":"===e.style);t.addFigure(n)}}}},1228:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getBondColor=void 0,t.getBondColor=(e,t)=>{var n;return null!==(n=e.color)&&void 0!==n?n:t.stdStyle.style.fill}},913:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getBondStyleWidth=void 0,t.getBondStyleWidth=(e,t)=>"I"===t?e.thickWidth:e.lineWidth},1945:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.singleLine=void 0;const o=n(4018),s=n(3689),r=n(913),i=n(880);t.singleLine=(e,t,n,o,d,l,u)=>{const h={stroke:u,strokeWidth:(0,r.getBondStyleWidth)(n,l),cap:"round"};let p;if("~"===l)p=a(e,o,d,n,h);else if(":"===l)p=c(o,d,n,h);else if(e.w0<0&&e.w0===e.w1){const{thickWidth:e,lineWidth:t,hatch:s}=n;p=new i.FigHashTrapezoid(o,e,d,e,u,t,s),p.update()}if(!p){const e=[{cmd:"M",rel:!1,pt:o},{cmd:"L",rel:!1,pt:d}];p=new s.FigPath(e,h),p.update()}t.addFigure(p)};const a=(e,t,n,r,i)=>{const a=!!e.arr0,c=!!e.arr1,{line:d,arrowL:l}=r,u=d/8,h=d/6,p=1.4*l,m=n.minus(t);let f=m.length();const g=m.normal();if(a&&(f-=p),c&&(f-=p),f<h)return;const v=a?t.plus(g.times(p)):t,b=c?n.minus(g.times(p)):n,C=Math.floor((f+h/2)/h),y=g.times(u),P=b.minus(v).times(1/C),w=[{cmd:"M",pt:t}];a&&w.push({cmd:"L",pt:v});let x=v;for(let e=0;e<C;e++){const t=x.plus(P),n=x.plus(1&e?new o.Point(-y.y,y.x):new o.Point(y.y,-y.x)),s=n.plus(P);w.push({cmd:"C",cp1:n,cp2:s,pt:t}),x=t}c&&w.push({cmd:"L",pt:n});const M=new s.FigPath(w,i);return M.update(),M},c=(e,t,n,o)=>{const r=t.minus(e),i=r.length(),{dash:a}=n;if(i<2*a)return;let c=Math.floor(i/a);1&c||c++;const d=i/c,l=[{cmd:"M",pt:e}];for(let t=0;t<c;t++){const n=r.times((t+1)*d/i).iadd(e);l.push({cmd:1&t?"M":"L",pt:n})}const u=new s.FigPath(l,o);return u.update(),u}},7508:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.softBondTemplate=void 0;const o=n(4018);t.softBondTemplate=(e,t,n)=>{var s;const r=null!==(s=e.dir)&&void 0!==s?s:new o.Point(1,0),i=r.x<0?-1:1,a=Math.abs(r.x)<.1,c=a?r:new o.Point(r.x*t.horizLine,r.y*t.line),d=a?o.Point.zero:new o.Point(i*t.nodeMargin,0),l=n.plus(d),u=l.plus(c);return{src:n,dst:u.plus(d),bondA:l,bondB:u,sign:i}}},6522:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tripleBond=void 0;const o=n(913),s=n(1945);t.tripleBond=(e,t,n,r,i,a,c)=>{const d=i.minus(r).normal(),{lineSpace3:l}=n,u=a[0],h=a[1],p=a[2],m=(0,o.getBondStyleWidth)(n,u),f=(0,o.getBondStyleWidth)(n,h),g=(0,o.getBondStyleWidth)(n,p),v=d.transpon(!0).times(l+(m+f)/2),b=d.transpon().times(l+(g+f)/2);(0,s.singleLine)(e,t,n,r.plus(v),i.plus(v),u,c),(0,s.singleLine)(e,t,n,r,i,h,c),(0,s.singleLine)(e,t,n,r.plus(b),i.plus(b),p,c)}},9995:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.wedgeBond=void 0;const o=n(880),s=n(3689);t.wedgeBond=(e,t,n,r,i)=>{const{chiralWidth:a,lineWidth:c,hatch:d}=n;if(i)return new o.FigHashTrapezoid(e,c,t,a,r,c,d);const l=t.minus(e).normal(),u=l.transpon(!0).times(a/2),h=l.transpon().times(a/2),p=t.plus(u),m=t.plus(h),f=l.transpon(!0).times(c/2),g=l.transpon().times(c/2),v=[{cmd:"M",pt:e.plus(f)},{cmd:"L",pt:p},{cmd:"L",pt:m},{cmd:"L",pt:e.plus(g)},{cmd:"Z"}];return new s.FigPath(v,{fill:r,cap:"round",strokeWidth:c})}},743:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AgentCmd=void 0,t.AgentCmd=class{canPush(e){return!1}postExec(e){}onPrevious(e,t){}}},5607:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AgentCmdBrClose=void 0;const o=n(743),s=n(6707),r=n(5846),i=n(4758);class a extends o.AgentCmd{constructor(e){super(),this.end=e}onPrevious(e){e instanceof a&&(this.srcCmd=e)}canPush(e){let t=!0;return(0,r.unwind)(e,(n=>t&&n instanceof s.AgentCmdBrOpen?((0,i.processBrackets)(e,n,this),t=!1,!0):t)),!1}}t.AgentCmdBrClose=a},6707:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AgentCmdBrOpen=void 0;const o=n(743),s=n(5607),r=n(2480),i=n(6445),a=n(1448);class c extends o.AgentCmd{constructor(e){super(),this.begin=e,this.isBridge=!1}checkRtl(e,t){(0,i.ifDef)(t,(t=>{var n,o;e.rtlNodes.add(t.index),(0,i.ifDef)(null===(o=null===(n=this.begin)||void 0===n?void 0:n.end)||void 0===o?void 0:o.nodes[0],(t=>e.rtlNodes.add(t.index)))}))}canPush(e){return this.checkRtl(e,(0,i.ifDef)(this.begin.bond,(e=>(0,i.ifDef)(e.dir,(t=>t.x<0?e.nodes[1]:void 0))))),!0}onPrevious(e,t){if(e instanceof r.AgentCmdBridge||e instanceof c)e.dstCmd=this,this.srcCmd=e;else if(e instanceof s.AgentCmdBrClose)this.begin.nodes[0]=e.end.nodes[0],(0,i.ifDef)(this.begin.nodes[0],(e=>{t.rtlNodes.has(e.index)&&this.checkRtl(t,e)})),this.isBridge=!0,this.prevBracket=e;else{if(e instanceof a.AgentCmdNode){this.prevText=!0;const{node:n}=e;if(1===n.bonds.size){const e=Array.from(n.bonds)[0];(0,i.ifDef)(e.dir,(e=>{e.x<0&&this.checkRtl(t,n)}))}}const[n,o]=this.begin.nodes;(null==n?void 0:n.subChain)!==(null==o?void 0:o.subChain)&&(this.isBridge=!0)}}}t.AgentCmdBrOpen=c},2480:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AgentCmdBridge=void 0;const o=n(743),s=n(5607),r=n(5846);class i extends o.AgentCmd{onPrevious(e){e instanceof s.AgentCmdBrClose&&(this.srcCmd=e)}canPush(e){return(0,r.unwind)(e,(e=>e instanceof i)),!0}}t.AgentCmdBridge=i},8203:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AgentCmdMul=t.createAgentCmdMul=void 0;const o=n(743),s=n(6707),r=n(1268),i=n(2678),a=n(7073);t.createAgentCmdMul=e=>e.isFirst?new c(e):new a.AgentCmdMulBridge(e);class c extends o.AgentCmd{constructor(e){super(),this.mul=e}onPrevious(e){if(e instanceof s.AgentCmdBrOpen){const{begin:t}=e;t.nodes[1]||(t.nodes[1]=this.mul.nodes[1]),e.dstCmd=this}}canPush(e){const t=this.mul.nodes[1],{n}=this.mul;if(t&&n.isSpecified()){const n=(0,r.getNodeInfo)(t,e.nodesInfo),{cluster:o}=e.clusters.findByNode(t),{frame:s}=o,a=(0,i.createCoeff)(this.mul,e.props);a.org.set(s.bounds.left-a.bounds.width,n.res.rcNodeCore.bottom+n.res.nodeFrame.org.y),s.addFigure(a,!0),this.figure=a}return!1}postExec(){}}t.AgentCmdMul=c},7073:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AgentCmdMulBridge=void 0;const o=n(2218),s=n(2480),r=n(2678),i=n(4018),a=n(5607),c=n(6707),d=n(9117);class l extends s.AgentCmdBridge{constructor(e){super(),this.mul=e}postExec(e){const{mul:t}=this,{props:n}=e;let[s]=t.nodes;const l=t.nodes[1];let u=!1;!s&&this.srcCmd instanceof a.AgentCmdBrClose&&([s]=this.srcCmd.end.nodes,u=!0);const h=this.dstCmd instanceof c.AgentCmdBrOpen;if(!s||!l)return;const p=new o.FigFrame,{font:m,style:f}=n.getStyleColored("multiplier",t.color),g=.2*n.line,v=(0,d.drawMul)(n,m,f);if(v.org.x+=g,p.addFigure(v,!0),t.n.isSpecified()){const e=(0,r.createCoeff)(t,n);e.org.set(p.bounds.right+g,0),p.addFigure(e,!0)}else p.bounds.B.x+=g;const{cluster:b,srcConn:C}=e.clusters.unite(e,{node:s,allBox:u},{node:l,allBox:h},new i.Point(p.bounds.right,0));let y=C.yBase;void 0===y&&(y=C.yMiddle+m.getFontFace().ascent/2),p.org.set(C.x,y),b.frame.addFigure(p,!0)}}t.AgentCmdMulBridge=l},1448:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AgentCmdNode=void 0;const o=n(4018),s=n(743),r=n(5607),i=n(1268),a=n(4758);class c extends s.AgentCmd{constructor(e){super(),this.node=e}canPush(e){const{prevBracket:t}=this;if(t){const n=t.end;if(n){const s=n.nodes[0],r=new o.Point;if(s){const t=(0,i.getNodeInfo)(s,e.nodesInfo);r.y=t.res.nodeFrame.org.y+t.res.center.y}const c=!!t.isRealText;(0,a.makeBridge)(e,n,!0,c)}}return!1}onPrevious(e){e instanceof r.AgentCmdBrClose&&(this.prevBracket=e)}}t.AgentCmdNode=c},1038:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AgentCmdSoftBond=void 0;const o=n(6445),s=n(4018),r=n(7944),i=n(7508),a=n(2480);class c extends a.AgentCmdBridge{constructor(e,t){super(),this.bond=e,this.agent=t}postExec(e){var t;const{bond:n,agent:{stA:a}}=this,c=e.props,{src:d,dst:l,bondA:u,bondB:h}=(0,i.softBondTemplate)(n,e.props,s.Point.zero),[p,m]=this.bond.nodes,f=l.minus(d),{cluster:g,srcConn:v,dstConn:b,srcNodeInfo:C,dstNodeInfo:y}=e.clusters.unite(e,{node:p,allBox:!!this.srcCmd},{node:m,allBox:!!this.dstCmd},f);if(n.isVisible()){const e=null!==(t=(0,o.ifDef)(v.yBase,(e=>(0,o.ifDef)(b.yBase,(()=>{var t,n;if(!C||!y)return;const o=null!==(t=C.res.rcNodeCore.height)&&void 0!==t?t:0,s=null!==(n=y.res.rcNodeCore.height)&&void 0!==n?n:0;return e-Math.min(o/2,s/2)})))))&&void 0!==t?t:v.yMiddle,i=new s.Point(v.x,e);u.iadd(i),h.iadd(i),(0,r.drawBondAB)({bond:n,bondA:u,bondB:h,frame:g.frame,imgProps:c,stA:a})}}}t.AgentCmdSoftBond=c},522:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Clusters=t.mergeClusters=t.calcOffsetAbs=t.calcOffset=t.getClusterConnection=t.insertToCluster=void 0;const o=n(4210),s=n(2218),r=n(1268),i=n(4018),a=n(3825),c=n(6445);t.insertToCluster=(e,t,n)=>{const{frame:o,nodes:s}=e;s.add(t.index);const{res:i}=(0,r.getNodeInfo)(t,n);o.addFigure(i.nodeFrame,!0)};const d=(e,t)=>{const{bounds:n}=e.frame;return{x:t?n.left:n.right,yMiddle:(n.top+n.bottom)/2}};t.getClusterConnection=(e,t,n,o)=>{const{res:s}=n;let i,a,d,l;const{nodeFrame:u,rcNodeCore:h}=s;if(h.isEmpty()?l=u.org.y:(i=h.clone(),i.A.x=u.bounds.left,i.B.x=u.bounds.right,i.move(u.org),d=i.bottom,l=d-i.height/2,a=o?i.left:i.right),e){const{bounds:e}=t.frame;a=o?e.left:e.right}else void 0===a&&(a=(0,r.getNodeCenterPos)(n).x);return o?(0,c.ifDef)(n.left,(e=>{a=e.getRelativeBounds().left})):(0,c.ifDef)(n.right,(e=>{a=e.getRelativeBounds().right})),{x:a,yMiddle:l,yBase:d}},t.calcOffset=(e,t,n)=>new i.Point(e.x-t.x+n.x,(((e,t)=>void 0!==e.yBase&&void 0!==t.yBase)(e,t)?e.yBase-t.yBase:e.yMiddle-t.yMiddle)+n.y),t.calcOffsetAbs=(e,t,n)=>{const o=n.x>=0?e.frame.bounds.right-t.frame.bounds.left:e.frame.bounds.left-t.frame.bounds.right;return new i.Point(o+n.x,n.y)},t.mergeClusters=(e,t,n)=>{(0,a.addAllSet)(e.nodes,t.nodes),t.frame.figures.forEach((t=>{t.org.iadd(n),e.frame.addFigure(t,!0)}))},t.Clusters=class{constructor(){this.clusters=[]}init(e,n){const r={};e.forEach((e=>{const i=(0,o.getItemForced)(r,e.subChain,(()=>({frame:new s.FigFrame,nodes:new Set})));(0,t.insertToCluster)(i,e,n)})),this.clusters=Object.values(r)}findByIndex(e){const t=this.clusters.findIndex((t=>t.nodes.has(e)));if(t<0)throw new Error(`Not found node with index ${e}`);return{clusterIndex:t,cluster:this.clusters[t]}}findByNode(e){return this.findByIndex(e.index)}unite(e,n,o,s,a){const{cluster:c}=this.findByNode(n.node);if(!o.node)return{cluster:c,srcConn:{x:0,yMiddle:0},dstConn:{x:0,yMiddle:0},offset:i.Point.zero};const d=(0,r.getNodeInfo)(n.node,e.nodesInfo),{cluster:l,clusterIndex:u}=this.findByNode(o.node),h=(0,r.getNodeInfo)(o.node,e.nodesInfo),p=s.x>=0;let m;const f=(0,t.getClusterConnection)(n.allBox,c,d,!p),g=(0,t.getClusterConnection)(o.allBox,l,h,p);return m=a?(0,t.calcOffsetAbs)(c,l,s):(0,t.calcOffset)(f,g,s),(0,t.mergeClusters)(c,l,m),this.clusters.splice(u,1),{cluster:c,srcConn:f,dstConn:g,offset:m,srcNodeInfo:d,dstNodeInfo:h}}uniteRest(e){const{clusters:n}=this;for(;n.length>1;){const o=n[0],s=n[1],r=(0,t.calcOffset)(d(o,!1),d(s,!0),new i.Point(e.props.horizLine,0));(0,t.mergeClusters)(o,s,r),n.splice(1,1)}}}},2295:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PAgentCtx=void 0;const o=n(2218),s=n(522);t.PAgentCtx=class{constructor(e,t){this.agent=e,this.props=t,this.nodesInfo=[],this.cmdStack=[],this.clusters=new s.Clusters,this.backs=[],this.rtlNodes=new Set,this.agentFrame=new o.FigFrame}}},4758:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.processBrackets=t.makeBridge=void 0;const o=n(599),s=n(6445),r=n(4018),i=n(3337),a=n(1560),c=n(8666),d=n(1299),l=n(2218),u=n(5505),h=n(4041),p=n(8845),m=n(5032),f=n(7873),g=n(9610),v=n(1108),b=n(1268),C=n(5607),y=n(6707),P=n(2793),w=n(8203),x=(e,t,n,o,s,r)=>{var i;r&&(0,f.drawCharge)({charge:r,frame:e,rect:t,imgProps:n,color:o,styleId:"bracketCharge",type:"bracket"}),s&&s.isSpecified()&&(0,g.drawTextNear)({frame:e,rcCore:t,text:String(s),imgProps:n,style:n.getStyleColored("bracketCount",o),pos:null!==(i=s.pos)&&void 0!==i?i:"RB",type:"bracket"}),e.update()},M=({bracket:e,contentRect:t,isOpen:n,isText:o,props:s,nodeInfo:r,n:a,charge:c})=>{const{figure:d,y:m,rect:f}=o?((e,t,n,o,s)=>{const r=t.getStyleColored("bracket",e.color),i=new l.FigFrame,a=new u.FigText(e.text,r.font,r.style);i.addFigure(a,!0);const{top:c}=i.bounds,d=(0,v.getTextInternalRect)(a);return x(i,d,t,e.color,o,s),{figure:i,y:n.top-c,rect:d}})(e,s,t,a,c):((e,t,n,o,s,r)=>{var a;const c=(0,p.getRubberBracket)(e,t.text),d=new i.Rect(0,0,n.bracketWidth,o.height),u={fill:null!==(a=t.color)&&void 0!==a?a:n.stdStyle.style.fill},m=new l.FigFrame;m.addFigure((0,h.drawRubberFigure)(c,d,u,n),!0);const f=m.bounds.clone();return x(m,f,n,t.color,s,r),{figure:m,y:o.top,rect:f}})(n,e,s,t,a,c),g=n?t.left-f.width:t.right;return d.org.set(g,m),o&&!r.node.autoMode&&(d.org.y=r.res.nodeFrame.org.y),d};t.makeBridge=(e,t,n,o)=>{var s,i;const[a,c]=t.nodes;if(a&&c){const t={node:a,allBox:n},d={node:c,allBox:!0},l=e.rtlNodes.has(a.index)?-1:1;let u=0;const h=!o;if(h){const{cluster:t}=e.clusters.findByNode(a),{cluster:n}=e.clusters.findByNode(c),o=null!==(s=t.contentRect)&&void 0!==s?s:t.frame.bounds,r=null!==(i=n.contentRect)&&void 0!==i?i:n.frame.bounds;u=o.top-r.top+(o.height-r.height)/2}e.clusters.unite(e,t,d,new r.Point(l*e.props.bracketSpace,u),h)}},t.processBrackets=(e,n,l)=>{var u,h;const{begin:p}=n,{end:f}=l,{nodesInfo:g,agent:v,clusters:x,props:B}=e,{useTextBrackets:S,line:_,lineWidth:k}=B,O=p.nodes[1],A=f.nodeIn;if(!O||!A)return;const{cluster:F}=x.findByNode(O),N=(0,b.getNodeInfo)(O,g),j=(0,b.getNodeInfo)(A,g),E=!!S&&(0,d.isTextBracketsCached)(p,v.commands),I=(0,a.getBracketsContent)(p,v.commands);let T=((e,t)=>e.reduce(((e,n)=>{if(n instanceof c.ChemNode){const o=(0,b.getNodeInfo)(n,t).res.nodeFrame.getRelativeBounds();return e?(e.unite(o),e):o}return e}),void 0))(I,g);if((!T||T.isEmpty())&&1===I.length&&I[0]instanceof c.ChemNode){const{font:e}=B.getStyle("atom"),t=e.getFontFace(),n=(0,m.getFontHeight)(t)/2,o=(0,b.getNodeCenterPos)((0,b.getNodeInfo)(I[0],g));T=new i.Rect(new r.Point(o.x-k,o.y-n),new r.Point(o.x+k,o.y+n))}const L=T;if(!L)return;const R=null!==(u=(0,s.ifDef)(p.padding,(e=>(0,P.applyPadding)(L,e,_))))&&void 0!==u?u:L,D=E&&R.height===L.height;l.isRealText=D;const $=D?0:k;if((n.dstCmd instanceof y.AgentCmdBrOpen||n.dstCmd instanceof w.AgentCmdMul)&&n.dstCmd.figure){const e=n.dstCmd.figure.getRelativeBounds();R.updatePoint(new r.Point(e.left-$,e.center.y))}if(n.srcCmd instanceof C.AgentCmdBrClose&&n.srcCmd.figure){const e=n.srcCmd.figure.getRelativeBounds();R.updatePoint(new r.Point(e.left,e.center.y))}if(l.srcCmd instanceof C.AgentCmdBrClose&&l.srcCmd.figure){const e=l.srcCmd.figure.getRelativeBounds();R.updatePoint(new r.Point(e.right+$,e.center.y))}const{charge:H,n:W}=f,K=e=>e===(null==H?void 0:H.isLeft)?H:void 0,z=e=>e===(0,o.isLeftCoeff)(W.pos)?W:void 0,Q=M({isOpen:!0,bracket:p,isText:D,props:B,contentRect:R,nodeInfo:N,n:z(!0),charge:K(!0)}),q=M({isOpen:!1,bracket:f,isText:D,props:B,contentRect:R,nodeInfo:j,n:z(!1),charge:K(!1)});if(F.frame.addFigure(Q,!0),F.frame.addFigure(q,!0),N.left=Q,j.right=q,n.figure=Q,l.figure=q,F.contentRect=R,n.isBridge){const o=D&&(!!(null===(h=null==n?void 0:n.prevBracket)||void 0===h?void 0:h.isRealText)||!!n.prevText);(0,t.makeBridge)(e,n.begin,!!n.prevBracket,o)}}},4741:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildAgentPrior=void 0;const o=n(2295),s=n(6644),r=n(132),i=n(9735),a=n(2309),c=n(5505),d=n(1108),l=n(8209);t.buildAgentPrior=(e,t)=>{const n=new o.PAgentCtx(e,t),{agentFrame:u}=n;(0,s.prepareNodes)(n),(0,r.processCommands)(n),n.clusters.uniteRest(n),(0,i.drawAllBonds)(n);const h=n.clusters.clusters.shift();h&&(h.frame.figures.forEach((e=>u.addFigure(e))),u.update()),(0,l.drawBackground)(n);const p=(0,a.findAgentCenter)(n);if(e.n.isSpecified()){const n=t.getStyleColored("agentK",e.n.color),o=new c.FigText(e.n.toString(),n.font,n.style),s=(0,d.getTextInternalRect)(o);o.org.x=u.bounds.left-o.bounds.width-t.agentKSpace,o.org.y=p.y-s.center.y,u.addFigure(o,!0)}return{agentFrame:u,ctx:n,center:p}}},9863:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createAgentCmd=void 0;const o=n(8666),s=n(7367),r=n(1560),i=n(743),a=n(5607),c=n(6707),d=n(1448),l=n(1038),u=n(5507),h=n(8203);t.createAgentCmd=(e,t)=>{if(e instanceof s.ChemBond){if(e.soft)return new l.AgentCmdSoftBond(e,t)}else{if(e instanceof r.ChemBracketBegin)return new c.AgentCmdBrOpen(e);if(e instanceof r.ChemBracketEnd)return new a.AgentCmdBrClose(e);if(e instanceof u.ChemMul)return(0,h.createAgentCmdMul)(e);if(e instanceof o.ChemNode)return new d.AgentCmdNode(e);if(e instanceof u.ChemMulEnd)return}return new i.AgentCmd}},2678:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createCoeff=void 0;const o=n(5505);t.createCoeff=(e,t)=>{const n=t.getStyleColored("multiK",e.color);return new o.FigText(String(e.n),n.font,n.style)}},9735:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawAllBonds=void 0;const o=n(7367),s=n(4924);t.drawAllBonds=e=>{const{agent:t,props:n,agentFrame:r,nodesInfo:i}=e;t.commands.forEach((e=>{e instanceof o.ChemBond&&!e.soft&&(0,s.drawBond)({bond:e,props:n,frame:r,nodesInfo:i,stA:t.stA})}))}},8209:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawBackground=t.makeBackFigure=t.calcBgRect=void 0;const o=n(4018),s=n(2218),r=n(1268),i=n(2294),a=n(7546),c=n(6445),d=n(2793);t.calcBgRect=(e,t=[])=>t.reduce(((t,n)=>{const o=(0,r.getNodeInfo)(n,e.nodesInfo).res.nodeFrame.getRelativeBounds();return t?t.unite(o):o}),void 0),t.makeBackFigure=(e,n)=>{const{nodes:l,isAll:u,padding:h,fill:p,stroke:m,strokeWidth:f,shape:g,borderRadius:v}=n,{agentFrame:b,props:C}=e;let y=u?b.bounds.clone():(0,t.calcBgRect)(e,l);if(!y)return new s.FigFrame;const P=y.clone();h&&(y=(0,d.applyPadding)(y,h,C.line));const w={};if(p&&(w.fill=p),m&&(w.stroke=m),f&&(w.strokeWidth=C.lineWidth*f),"round"===g){const t=((e,t,n)=>{const s=null!=n?n:e.agent.nodes,{center:i}=t;let a=0;return s.forEach((t=>{const n=(0,r.getNodeInfo)(t,e.nodesInfo).res.nodeFrame.getRelativeBounds(),s=n.center,c=new o.Point(s.x<i.x?n.left:n.right,s.y<i.y?n.top:n.bottom);a=Math.max(a,i.minus(c).lengthSqr())})),Math.sqrt(a)})(e,y,l),n=t+Math.min((y.width-P.width)/2,(y.height-P.height)/2);return new a.FigEllipse(y.center,new o.Point(n,n),w)}return"ellipse"===g?((e,t)=>{const n=e.center,s=e.width,r=e.height,i=(e,t)=>{const n=t*t+4*e*e,o=(-t+Math.sqrt(n))/(2*e);return{a:e/o,b:e*Math.sqrt(1-o*o)/o}};if(s>r){const{a:e,b:c}=i(s/2,r/2);return new a.FigEllipse(n,new o.Point(e,c),t)}const{a:c,b:d}=i(r/2,s/2);return new a.FigEllipse(n,new o.Point(d,c),t)})(y,w):((e,t,n)=>new i.FigRect(e,t,n))(y,w,(0,c.ifDef)(v,(e=>new o.Point(e*C.line,e*C.line))))},t.drawBackground=e=>{const{backs:n}=e;0!==n.length&&n.map((n=>(0,t.makeBackFigure)(e,n.params))).forEach(((t,n)=>e.agentFrame.insertFigure(n,t,!0)))}},9117:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawMul=void 0;const o=n(5505),s=n(7546),r=n(4018),i=n(5032);t.drawMul=(e,t,n)=>{const{mulRadius:a}=e;if(a){const e=t.getFontFace(),o=(0,i.getFontHeight)(e)*a;return new s.FigEllipse(new r.Point(o,.5*-e.capHeight),new r.Point(o,o),{fill:n.fill})}return new o.FigText(e.mulChar,t,n)}},2309:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.findDefaultY=t.calcExplicitCenter=t.findExplicitlyCentred=t.findAgentCenter=void 0;const o=n(4018),s=n(1268),r=n(6445);t.findAgentCenter=e=>{var n,o,s;return null!==(s=null!==(o=null!==(n=(0,t.calcExplicitCenter)((0,t.findExplicitlyCentred)(e.nodesInfo)))&&void 0!==n?n:i(e))&&void 0!==o?o:a(e.nodesInfo,e.agentFrame.bounds))&&void 0!==s?s:e.agentFrame.bounds.center};const i=e=>{const{agent:{stA:t},nodesInfo:n}=e;if(t.analyze(),1!==t.cycles.length)return;const r=t.cycles[0];return r.nodes.reduce(((e,t)=>e.iadd((0,s.getNodeCenterPos)((0,s.getNodeInfo)(t,n)))),new o.Point).scale(1/r.nodes.length)};t.findExplicitlyCentred=e=>e.filter((({node:e})=>e.bCenter)),t.calcExplicitCenter=e=>{const t=e.map((e=>(0,s.getNodeCenterPos)(e)));if(0!==t.length)return 1===t.length?t[0]:t.reduce(((e,t)=>e.iadd(t)),new o.Point).times(1/t.length)};const a=(e,n)=>(0,r.ifDef)((0,t.findDefaultY)(e),(e=>new o.Point(n.center.x,e)));t.findDefaultY=e=>{const t={};let n=0;e.forEach((e=>{var o;const r=Math.round(100*(0,s.getNodeCenterPos)(e).y),i=(null!==(o=t[r])&&void 0!==o?o:0)+1;t[r]=i,n=Math.max(i,n)}));let o=0,r=0;return Object.entries(t).forEach((([e,t])=>{t===n&&(o+=+e,r++)})),r?o/100/r:void 0}},6644:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.prepareNodes=void 0;const o=n(2218),s=n(4018),r=n(3337),i=n(5515);t.prepareNodes=e=>{const{agent:t,props:n}=e;t.nodes.forEach((t=>{var a;const c=null!==(a=(0,i.buildNode)(t,n))&&void 0!==a?a:{nodeFrame:new o.FigFrame,rcNodeCore:new r.Rect,center:new s.Point},d=t.pt.times(n.line),{nodeFrame:l,center:u}=c;l.org.iadd(d),l.org.isub(u),e.nodesInfo[t.index]={node:t,res:c}})),e.clusters.init(t.nodes,e.nodesInfo)}},132:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.processCommands=void 0;const o=n(7289),s=n(9863),r=n(5846);t.processCommands=e=>{let t;e.agent.commands.forEach((n=>{if(n instanceof o.ChemBackground)return void e.backs.push(n);const r=(0,s.createAgentCmd)(n,e.agent);r&&(t&&r.onPrevious(t,e),r.canPush(e)&&e.cmdStack.unshift(r),t=r)})),(0,r.unwind)(e,(()=>!0))}},5846:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unwind=void 0,t.unwind=(e,t)=>{const{cmdStack:n}=e;for(;;){const o=n.shift();if(!o)return;if(!t(o))return void n.unshift(o);o.postExec(e)}}},9442:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildExpression=void 0;const o=n(8978),s=n(1429),r=n(2218),i=n(4741),a=n(2858);t.buildExpression=(e,t)=>{const n=new r.FigFrame;let c=0;return e.entities.forEach((e=>{let r;if(e instanceof o.ChemAgent){const{agentFrame:n,center:o}=(0,i.buildAgentPrior)(e,t);r={frame:n,y:o.y}}else if(e instanceof s.ChemOp){const{frame:n,center:o}=(0,a.buildOp)(e,t);r={frame:n,y:o.y}}r&&(r.frame.org.y-=r.y,r.frame.org.x=c-r.frame.bounds.left,c+=r.frame.bounds.width+t.opSpace,n.addFigure(r.frame,!0))})),n.bounds.grow(1),{frame:n}}},3938:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildFrame=void 0;const o=n(9701),s=n(9442),r=n(4741);t.buildFrame=(e,t)=>e instanceof o.ChemExpr?(0,s.buildExpression)(e,t).frame:(0,r.buildAgentPrior)(e,t).agentFrame},8438:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildItem=void 0;const o=n(2218),s=n(654),r=n(9610),i=n(1108),a=n(5938),c=n(9444),d=n(7546),l=n(4018),u=n(3998),h=n(6445);t.buildItem=(e,t)=>{const n=new o.FigFrame;n.label="item";const{color:p}=e;let m;const{fig:f,rcCore:g}=e.walkExt({fig:void 0,rcCore:void 0,onText(e,t){const o=(0,s.drawText)(n,e,t);this.fig=o,this.rcCore=(0,i.getTextInternalRect)(o),m=t.font},onMarkup(e,o){m=o.font;const{fig:s,irc:r}=(0,a.drawTextWithMarkup)(e,t,o);n.addFigure(s,!0),this.fig=s,this.rcCore=r},atom(n){var o;this.onText(n.id,t.getStyleColored("atom",null!==(o=e.atomColor)&&void 0!==o?o:e.color))},radical(n){this.onText(n.label,t.getStyleColored("radical",e.color))},comment(n){this.onMarkup(n.text,t.getStyleColored("comment",e.color))},custom(n){this.onMarkup(n.text,t.getStyleColored("custom",e.color))},comma(){this.onText(",",t.getStyleColored("comma",e.color))}});if(g){const o=(o,s,i)=>(0,r.drawTextNear)({frame:n,rcCore:g,text:String(o),imgProps:t,style:t.getStyleColored(s,e.color),pos:i}),{atomNum:s,n:i,charge:a,mass:f,dots:v}=e;if(i.isSpecified()&&o(i.toString(),"itemCount","RB"),a&&o(a.text,"oxidationState","CU"),(0,h.ifDef)(f,(e=>o(e,"itemMass","LT"))),(0,h.ifDef)(s,(t=>o(t>=0?t:(0,u.locateAtomNumber)(e),"atomNumber","LB"))),v){const e=g.clone();m&&(e.B.y-=m.getFontFace().descent,e.B.y-=t.lineWidth);const o=t.electronDotD/2,s=new l.Point(o,o);e.grow(t.lineWidth+o),(0,c.drawLewisShell)(e,v,t,(({p:e,color:o})=>{const r=new d.FigEllipse(e,s,{fill:o||p||t.stdStyle.style.fill});r.bounds.grow(t.lineWidth),n.addFigure(r)}))}}return n.update(),{itemFrame:n,figText:f,rcCore:g}}},5515:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildNode=void 0;const o=n(2218),s=n(8438),r=n(3337),i=n(7873),a=n(7929);t.buildNode=(e,t)=>{if((e.autoMode||(0,a.isEmptyNode)(e))&&!e.charge)return;const n=new o.FigFrame;n.label="node";const c=e.getCenterItem();let d,l,u=0;if(e.autoMode){const e=.2*t.line;n.bounds=new r.Rect(0,-e,e,0)}else e.items.forEach((e=>{const{itemFrame:o,rcCore:r}=(0,s.buildItem)(e,t);if(o.org.x=u-o.bounds.left,n.addFigure(o),r){const t=r.clone();t.moveXY(o.org.x,0),e===c&&(d=t.center),l?l.unite(t):l=t.clone()}u+=o.bounds.width})),n.update();const{charge:h}=e;return l=null!=l?l:n.bounds.clone(),h&&(0,i.drawCharge)({charge:h,frame:n,rect:l,imgProps:t,color:e.color}),d=null!=d?d:l.center,{nodeFrame:n,rcNodeCore:l,center:d}}},2858:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildOp=void 0;const o=n(5505),s=n(4018),r=n(2218),i=n(1108),a=n(6445),c=n(3689),d=n(5938);t.buildOp=(e,t)=>{var n;const o=[(0,a.ifDef)(e.commentPre,(e=>f(e,t))),(0,a.ifDef)(e.commentPost,(e=>f(e,t)))],{srcText:s,dstText:i}=e,c=o.reduce(((e,t)=>Math.max(e,t?t.fig.bounds.width:0)),0),d=new r.FigFrame,l=t.getStyleColored("operation",e.color),h=null!==(n=p[s])&&void 0!==n?n:u,{figOp:g,irc:v}=h(Object.assign({srcText:s,dstText:i,props:t,commWidth:c},l));return d.addFigure(g,!0),o.forEach(((e,t)=>(0,a.ifDef)(e,(e=>m(d,v,e,0===t))))),{frame:d,center:v.center}};const l=({props:e,style:t})=>({stroke:t.fill,strokeWidth:e.lineWidth}),u=({dstText:e,font:t,style:n})=>{const s=new o.FigText(e,t,n);return{figOp:s,irc:(0,i.getTextInternalRect)(s)}},h=e=>{const{props:t,style:n,font:o,commWidth:i,srcText:a,dstText:d}=e,{arrowD:u,arrowL:h,line:p}=t,m="--|>"===a,f=Math.max(p,o.getTextWidth(d)),g=Math.max(i+2*t.opSpace,f),v=g-h,b=[{cmd:"M",pt:s.Point.zero},{cmd:"L",pt:new s.Point(m?v:g,0)}],C=new c.FigPath(b,l(e));C.update();const y=[{cmd:"M",pt:new s.Point(v,-u)},{cmd:"L",pt:new s.Point(g,0)},{cmd:"L",pt:new s.Point(v,u)}];m&&y.push({cmd:"Z"});const P=m?{fill:n.fill}:l(e);P.join="miter";const w=new c.FigPath(y,P);w.update();const x=new r.FigFrame;return x.addFigure(C,!0),x.addFigure(w,!0),{figOp:x,irc:x.bounds}},p={"--\x3e":h,"--|>":h,"<==>":e=>{const{props:t,commWidth:n}=e,{lineWidth:o,lineSpace2x:r,arrowD:i,arrowL:a,opSpace:d}=t,u=(r+o)/2,h=n+2*d,p=[{cmd:"M",pt:new s.Point(0,-u)},{cmd:"H",x:h-o},{cmd:"L",rel:!0,pt:new s.Point(-a,-i)},{cmd:"M",pt:new s.Point(h,u)},{cmd:"H",x:o},{cmd:"L",rel:!0,pt:new s.Point(a,i)}],m=new c.FigPath(p,Object.assign(Object.assign({},l(e)),{join:"miter"}));return m.update(),{figOp:m,irc:m.bounds}}},m=(e,t,n,o)=>{const{fig:s,irc:r}=n,{bounds:i}=s;s.org.set(r.left+t.width/2-r.width/2,o?-(i.bottom-r.bottom)+t.top:t.bottom-r.top),e.addFigure(s,!0)},f=(e,t,n)=>{const o=t.getStyleColored("opComment",n);return(0,d.drawTextWithMarkup)(e.text,t,o)}},7873:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawCharge=void 0;const o=n(2218),s=n(3337),r=n(9610),i=n(7546),a=n(4018),c=n(3689);t.drawCharge=({charge:e,frame:t,rect:n,imgProps:o,color:s,styleId:i="nodeCharge",type:a})=>{var c;const l=o.getStyleColored(i,s),u=null!==(c=e.pos)&&void 0!==c?c:"RT",h="+"===e.text||"-"===e.text?d({frame:t,rect:n,text:e.text,isRound:e.isRound,pos:u,style:l,imgProps:o,type:a}):(0,r.drawTextNear)({frame:t,rcCore:n,text:e.text,imgProps:o,style:l,pos:u,type:a});t.updateFigure(h)};const d=e=>{const{frame:t,rect:n,text:d,isRound:l,pos:u,style:h,imgProps:p,type:m}=e,f=h.font.getFontFace(),g=p.lineWidth,v=.9*h.font.getTextWidth("+")-("-"===d?g:0),b=v,C=-f.capHeight,y=b/2,P=(C+0)/2,w=g/2,x="-"===d?[{cmd:"M",pt:new a.Point(0,P-w)},{cmd:"H",x:b},{cmd:"V",y:g,rel:!0},{cmd:"H",x:0},{cmd:"Z"}]:[{cmd:"M",pt:new a.Point(0,P-w)},{cmd:"H",x:y-w},{cmd:"V",y:P-v/2},{cmd:"H",rel:!0,x:g},{cmd:"V",y:P-w},{cmd:"H",x:b},{cmd:"V",rel:!0,y:g},{cmd:"H",x:y+w},{cmd:"V",y:P+v/2},{cmd:"H",rel:!0,x:-g},{cmd:"V",y:P+w},{cmd:"H",x:0},{cmd:"Z"}],M=new o.FigFrame,B=new c.FigPath(x,{fill:h.style.fill});if(B.update(),B.bounds.unite(new s.Rect(0,C,b,0)),M.addFigure(B),l){const e=new s.Rect(0,C,b,0),t=.5*Math.max(e.width,e.height),n=new i.FigEllipse(e.center,new a.Point(t,t),{stroke:h.style.fill});M.addFigure(n)}M.update();const S=M.bounds.clone();return S.A.y=-f.ascent,S.B.y=-f.descent,(0,r.moveNearFigure)(M,S,u,n,p,m),t.addFigure(M),t.update(),M}},9444:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawLewisShell=void 0;const o=n(6445),s=n(4018),r=3.5,i=[e=>new s.Point(e.right,e.bottom-e.height/r),e=>new s.Point(e.right-e.width/r,e.bottom),e=>new s.Point(e.left+e.width/r,e.bottom),e=>new s.Point(e.left,e.bottom-e.height/r),e=>new s.Point(e.left,e.top+e.height/r),e=>new s.Point(e.left+e.width/r,e.top),e=>new s.Point(e.right-e.width/r,e.top),e=>new s.Point(e.right,e.top+e.height/r)];t.drawLewisShell=(e,t,n,r)=>{const a=e.center,c=e.width+e.height;t.forEach((({angle:t,pos:d,color:l,margin:u})=>{const h=e.clone();u&&h.grow(u*n.line),(0,o.ifDef)(t,(e=>{const t=(0,s.pointFromDeg)(e).times(c).plus(a),{b:n}=h.clip(a,t);r({c:a,p:n,color:l})})),(0,o.ifDef)(d,(e=>{const t=i[e];t&&r({c:a,p:t(h),color:l})}))}))}},654:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawText=void 0;const o=n(5505);t.drawText=(e,t,n)=>{const s=new o.FigText(t,n.font,n.style);return e.addFigure(s),s}},9610:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawTextNear=t.moveNearFigure=void 0;const o=n(3081),s=n(654),r=n(4018),i=(e,t,n)=>"bracket"===n?"sup"===t?e.bracketSupKY:e.bracketSubKY:"sup"===t?e.supKY:e.subKY,a=(e,t,n)=>{const o=e.clone();if("bracket"===t){const e=2*n.lineWidth;o.A.x-=e,o.B.x+=e}return o};t.moveNearFigure=(e,t,n,s,c,d)=>{const l=a(s,d,c);if("number"==typeof n){const{center:s}=l,{b:i}=l.clip(s,s.plus((0,r.pointFromDeg)(n).times(l.width+l.height)));(0,o.isClose)(i.x,l.right)?e.org.x=i.x-t.left:(0,o.isClose)(i.x,l.left)?e.org.x=i.x-t.right:e.org.x=i.x-t.left-t.width/2,(0,o.isClose)(i.y,l.top)?e.org.y=i.y-t.bottom:(0,o.isClose)(i.y,l.bottom)?e.org.y=i.y-t.top:e.org.y=i.y-t.top-t.height/2}else"R"===n[0]?e.org.x=l.right-t.left:"L"===n[0]?e.org.x=l.left-t.right:"C"===n[0]&&(e.org.x=l.cx-.5*e.bounds.width),"T"===n[1]?e.org.y=l.top+t.height*(1-i(c,"sup",d)):"B"===n[1]?e.org.y=l.bottom+t.height*i(c,"sub",d):"U"===n[1]?e.org.y=l.top-t.bottom:"D"===n[1]&&(e.org.y=l.bottom-t.top)},t.drawTextNear=({frame:e,rcCore:t,text:n,imgProps:c,style:d,pos:l,type:u})=>{const h=a(t,u,c),p=(0,s.drawText)(e,n,d),m=p.font.getFontFace();if("number"==typeof l){const{center:e}=h,{b:t}=h.clip(e,e.plus((0,r.pointFromDeg)(l).times(h.width+h.height)));(0,o.isClose)(t.x,h.right)?p.org.x=t.x:(0,o.isClose)(t.x,h.left)?p.org.x=t.x-p.font.getTextWidth(n):p.org.x=t.x-p.font.getTextWidth(n)/2,(0,o.isClose)(t.y,h.top)?p.org.y=t.y+m.descent:(0,o.isClose)(t.y,h.bottom)?p.org.y=t.y+m.ascent:p.org.y=t.y+m.ascent/2}else"R"===l[0]?p.org.x=h.right:"L"===l[0]?p.org.x=-p.bounds.width:"C"===l[0]&&(p.org.x=h.cx-.5*p.bounds.width),"T"===l[1]?p.org.y=h.top+m.ascent*(1-i(c,"sup",u)):"B"===l[1]?p.org.y=h.bottom+m.ascent*i(c,"sub",u):"U"===l[1]?p.org.y=h.top+m.descent:"D"===l[1]&&(p.org.y=h.bottom+m.ascent);return p}},5938:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawTextWithMarkup=void 0;const o=n(2218),s=n(6605),r=n(3337),i=n(5505),a=n(3081),c=({chunk:e,imgProps:t,font:n,style:s,scale:a})=>{const d=new r.Rect(0,-n.getFontFace().ascent,0,0),l=new o.FigFrame;l.label="markup";let u=0,h=0;const p=()=>{u=l.bounds.right,h=u};return e.chunks.forEach((e=>{if("string"==typeof e){const t=new i.FigText(e,n,s);return t.org.x=l.bounds.right,l.addFigure(t,!0),void p()}const{type:o,color:r}=e;if("sup"===o||"sub"===o){const r="sup"===o,i=n.createScaled?n.createScaled(a):n,p=i.getFontFace(),m=p.ascent-p.descent,f=c({chunk:e,font:i,style:s,scale:a,imgProps:t}).fig;if(r){const e=m*t.supKY;f.org.set(u,d.top+p.ascent-e),u+=f.bounds.width}else{const e=m*t.subKY;f.org.set(h,d.bottom+e),h+=f.bounds.width}return void l.addFigure(f,!0)}const m=Object.assign({},s);r&&(m.fill=r);const f=c({chunk:e,imgProps:t,font:n,style:m,scale:a});f.fig.org.x=l.bounds.right,l.addFigure(f.fig,!0),p()})),d.B.x=l.bounds.right,{fig:l,irc:d}};t.drawTextWithMarkup=(e,t,{font:n,style:o})=>{const r=t.stdStyle.font.getFontFace().ascent,i=t.getStyle("itemCount").font.getFontFace().ascent,d=(0,a.is0)(r-i)?.7:i/r,l=(0,s.parseMarkup)(e);return c({chunk:l,imgProps:t,font:n,style:o,scale:d})}},1108:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getTextInternalRect=void 0,t.getTextInternalRect=e=>{const t=e.bounds.clone();return t.A.y=-e.font.getFontFace().ascent,t.B.y=0,t}},1323:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellRender=void 0;const o=n(2613),s=n(4326),r=n(6290),i=(e,t,n,o)=>`${(0,s.drawTag)(null!=o?o:"div",Object.assign(Object.assign({},n),{class:e}))+(0,r.escapeXml)(String(t))}</div>`,a={number:(e,t)=>t("number",e.n),id:(e,t)=>t("id",e.id),name:(e,t)=>t("name",o.Lang.tr(e.id)),mass:(e,t)=>t("mass",e.mass)};t.CellRender=class{constructor(e=["number","id","name","mass"]){"string"==typeof e&&(e=e.split(",")),this.fields=e.map((e=>"function"==typeof e?e:a[e]))}draw(e){return this.fields.map((t=>t?t(e,i):"")).join("")}}},4665:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tableRulesEasyChemistry=void 0;const o=n(9871),s={tables:[{NCol:19,NRow:7},{NCol:15,NRow:2}],category:n(8).categoryBlockDLa,points:{He:[18,0],B:[13,1],Al:[13,2],Ti:[4,3],Zr:[4,4],Ce:[1,0,1],Hf:[4,5],Th:[1,1,1],Rf:[4,6]},hardNotes:[{text:"*",x:3,y:5,cls:"chem-element f_block mtbl-note"},{text:"*<br>*",x:3,y:6,cls:"chem-element f2_block mtbl-note"},{text:"*",x:0,y:0,tblN:1,cls:"chem-element f_block mtbl-note"},{text:"*<br>*",x:0,y:1,tblN:1,cls:"chem-element f2_block mtbl-note"}],drawGroups:o.fallingNumbers,groupIds:"1,2,3,,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18".split(","),groupCls:"group-id",tableCls:"mentable easy-chem-table",elementBoxCls:"element-box"};t.tableRulesEasyChemistry=Object.freeze(s)},6963:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tableRulesShort=void 0;const o=n(2613),s=n(8);t.tableRulesShort={tables:[{NCol:11,NRow:11,periodCols:2,groupRows:2},{NCol:15,NRow:2}],points:{H:[0,0],He:[10,0],Ne:[10,1],Ar:[10,2],Cu:[0,4],Kr:[10,4],Ag:[0,6],Xe:[10,6],La:[0,0,1],Hf:[3,7],Au:[0,8],Rn:[10,8],Ac:[0,1,1],Rf:[3,9],Rg:[0,10]},flLanAct:!0,notes:{La:[2,7],Ac:[2,9]},category:s.categoryBlock,categoryExt:[s.subGroup],groupIds:"I:a;b,II:a;b,III:a;b,IV:a;b,V:a;b,VI:a;b,VII:a;b,::R,VIII:b:LR,::LR,:a:L".split(","),groupCls:"chem-cell",drawGroups({cells:e,actualTables:t,rules:n}){const o=t[0],s=e[0];for(let e=0;e<o.NCol;e++){const t=n.groupIds[e].split(":"),r={cls:n.groupCls,rowspan:2,text:`${t[0]}<div class="mentable-subgroup-hd">`};if(t.length>1){const e=t[1].split(";");2===e.length?r.text+=`<span class="left">${e[0]}</span><span class="right">${e[1]}</span>`:r.text+=e[0]}t.length>2&&(t[2].indexOf("L")>=0&&(r.cls+=" noleft"),t[2].indexOf("R")>=0&&(r.cls+=" noright")),r.text+="</div>",s[o.y1-2][e+o.x1]=r,s[o.y1-1][e+o.x1]={colspan:0}}},drawPeriods({cells:e,actualTables:t}){let n=1;const o=t[0],s=e[0];for(let e=0;e<o.NRow;e++){const t=e<3||1&e?{text:String(n++),cls:"period-id"}:{colspan:0};t&&e>=3&&(t.rowspan=2),s[o.y1+e][o.x1-2]=t}for(let e=0;e<o.NRow;e++)s[o.y1+e][o.x1-1]={text:String(e+1),cls:"period-id"}},post({cells:e}){this.flGroups&&this.flPeriods&&(e[0][0][0]={text:`${o.Lang.tr("Group")}→`,cls:"mentable-text period-id",colspan:2},e[0][0][1]={colspan:0},e[0][1][0]={text:o.Lang.tr("Period"),cls:"mentable-text period-id"},e[0][1][1]={text:o.Lang.tr("Row"),cls:"mentable-text period-id"})},pre({cells:e,actualTables:t}){const n=e[0],o=t[0];for(let e=0;e<o.NRow;e++){const t=n[e+o.y1];for(let e=0;e<o.NCol;e++)t[e+o.x1]=e>6&&e<10?{cls:"chem-row"}:{cls:"chem-cell"}}}}},3341:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tableRulesStd=void 0;const o=n(9871),s={tables:[{NCol:18,NRow:7},{NCol:15,NRow:2}],category:n(8).categoryProps,points:{He:[17,0],B:[12,1],Al:[12,2],La:[0,0,1],Hf:[3,5],Ac:[0,1,1],Rf:[3,6]},notes:{La:[2,5],Ac:[2,6]},drawGroups:o.fallingNumbers,groupIds:["1A","2A","3B","4B","5B","6B","7B","┌──","─8B─","──┐","1B","2B","3A","4A","5A","6A","7A","8A"],groupCls:"group-id"};t.tableRulesStd=Object.freeze(s)},5815:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tableRulesWide=void 0;const o=n(9871),s={tables:[{NCol:32,NRow:7,ofsX:1,ofsY:1,width:33,height:8}],category:n(8).categoryProps,points:{H:[0,0],He:[31,0],B:[26,1],Al:[26,2],Sc:[16,3],Y:[16,4]},groupIds:"1A,2A,,,,,,,,,,,,,,,3B,4B,5B,6B,7B,┌──,8B,──┐,1B,2B,3A,4A,5A,6A,7A,8A".split(","),groupCls:"group-id",drawGroups:o.fallingNumbers};t.tableRulesWide=Object.freeze(s)},2559:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawPeriodicTable=void 0;const o=n(2613),s=n(6887),r=n(6445),i=n(1323),a=n(3341),c=n(4326);t.drawPeriodicTable=(e=a.tableRulesStd)=>{const{tables:t,category:n,categoryExt:d=[],points:l,notes:u,cellFields:h}=e,{cellRender:p=new i.CellRender(h)}=e,m=[],f=t.map(((t,n)=>{const{NCol:o,NRow:s,ofsX:r=0,ofsY:i=0}=t,{width:a=o,height:c=s}=t,d=Object.assign(Object.assign({},t),{width:a,height:c,ofsX:r,ofsY:i,w1:a,h1:c,x1:r,y1:i});if(0===n){const{groupRows:t=1,periodCols:n=1}=d;e.flGroups&&(d.y1+=t,d.h1+=t),e.flPeriods&&(d.x1+=n,d.w1+=n)}const l=[];for(let e=0;e<d.h1;e++)l[e]=new Array(d.w1);return m[n]=l,d}));e.pre&&e.pre({cells:m,actualTables:f,rules:e});const g=[...n?[n]:[],...d].map((e=>{const t={};return Object.entries(e).forEach((([e,n])=>{(Array.isArray(n)?n:n.split(",")).forEach((n=>{t[n]=e}))})),t}));let v=0,b=f[v],C=b.y1,y=b.x1;const P=new Array(g.length);if(s.PeriodicTable.elements.forEach((e=>{const{id:t}=e;(0,r.ifDef)(l[t],(e=>{var t;v=null!==(t=e[2])&&void 0!==t?t:0,b=f[v],y=e[0]+b.x1,C=e[1]+b.y1}));let n="chem-element";g.forEach(((e,o)=>{(0,r.ifDef)(e[t],(e=>{P[o]=e})),n+=` ${P.join(" ")}`})),m[v][C][y]={elem:e,cls:n},++y===b.x1+b.NCol&&(y=b.x1,C++)})),e.flGroups)if(e.drawGroups)e.drawGroups({cells:m,actualTables:f,rules:e});else for(y=0;y<b.NCol;y++)m[0][b.y1-1][b.x1+y]={text:String(y+1)};if(b=f[0],e.flPeriods){const{drawPeriods:t}=e;if(t)t({cells:m,actualTables:f,rules:e});else for(y=0;y<b.NRow;y++)m[0][b.y1+y][b.x1-1]={text:String(y+1),cls:"period-id"}}e.post&&e.post({cells:m,actualTables:f,rules:e});const w={La:`57-71<br>${o.Lang.tr("Lanthanides")}`,Ac:`89-103<br>${o.Lang.tr("Actinides")}`};e.flLanAct&&u&&(b=f[0],Object.entries(u).forEach((([e,t])=>{m[0][t[1]+b.y1][t[0]+b.x1]={text:w[e],cls:"chem-cell mentable-text"}}))),(0,r.ifDef)(e.hardNotes,(e=>e.forEach((({text:e,x:t,y:n,tblN:o=0,cls:s})=>{const r=f[o];m[o][n+r.y1][t+r.x1]={text:e,cls:s}}))));let x="";return m.forEach(((t,n)=>{var o;x+=null!==(o=(0,r.ifDef)(e.beginTable,(t=>t(n,e))))&&void 0!==o?o:(0,c.drawTag)("table",{class:e.tableCls||"mentable"}),t.forEach((t=>{x+="<tr>";for(const n of t)n?0!==n.colspan&&(x+=`<td class="${n.cls||"chem-element"}"`,n.colspan&&(x+=` colspan="${n.colspan}"`),n.rowspan&&(x+=` rowspan="${n.rowspan}"`),x+=">",n.elem?(e.elementBoxCls&&(x+=(0,c.drawTag)("div",{class:e.elementBoxCls})),x+=p.draw(n.elem),e.elementBoxCls&&(x+="</div>")):n.text&&(x+=n.text),x+="</td>"):x+="<td></td>";x+="</tr>"})),x+="</table>"})),x}},9871:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fallingNumbers=void 0,t.fallingNumbers=({cells:e,actualTables:t,rules:n})=>{var o,s,r,i,a,c;const d=e[0],l=t[0],u=[],h=[];let p;for(let e=0;e<l.NCol;e++){const t=l.x1+e;for(u.push(t),p=l.y1;p<d.length&&!d[p][t];)p++;h.push(p),p<d.length&&(d[p-1][t]={text:null!==(s=null===(o=n.groupIds)||void 0===o?void 0:o[e])&&void 0!==s?s:"",cls:n.groupCls})}if(p=h[7],(null!==(a=null===(i=null===(r=n.groupIds)||void 0===r?void 0:r[8])||void 0===i?void 0:i.indexOf("8B"))&&void 0!==a?a:-1)>=0&&p<d.length&&p===h[8]&&h[8]===h[9]){const e=null!==(c=u[7])&&void 0!==c?c:0;p--,d[p][e].text+=d[p][e+1].text+d[p][e+2].text,d[p][e].colspan=3,d[p][e+1].colspan=0,d[p][e+2].colspan=0}}},871:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.findCategory=void 0;const o=n(6887),s=n(6445),r=n(2613),i=new Map;t.findCategory=(e,t,n)=>{var a;if(!i.has(e)){const t={};i.set(e,t);const n=Object.entries(e).reduce(((e,[t,n])=>(n.split(",").forEach((n=>{e[n]=t})),e)),{});let r="";o.PeriodicTable.elements.forEach((({id:e})=>{(0,s.ifDef)(n[e],(e=>{r=e})),t[e]=r}))}let c=null!==(a=i.get(e)[t])&&void 0!==a?a:"";return c=c.replace(/-/g," ").replace(/_/g,"-"),c=r.Lang.tr(c,{},n),c}},8:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.subGroup=t.categoryProps=t.categoryBlockDLa=t.categoryBlock=void 0,t.categoryBlock={s_block:"H,Na,K,Rb,Cs,Fr",p_block:"B,Al,Ga,In,Tl,Nh",d_block:"Sc,Y,Hf,Rf",f_block:"La,Ac"},t.categoryBlockDLa={s_block:"H,Na,K,Rb,Cs,Fr",p_block:"B,Al,Ga,In,Tl,Nh",d_block:"Sc,Y,La,Hf,Ac,Rf",f_block:"Ce",f2_block:"Th"},t.categoryProps={"Alkali-metals":"Li,Na,K,Rb,Cs,Fr","Alkaline-earth-metals":"Be,Mg,Ca,Sr,Ba,Ra",Lanthanides:"La",Actinides:"Ac","Transition-metals":"Sc,Y,Hf,Rf,Cn","Post-transition-metals":"Al,Ga,In,Tl,Nh",Metalloids:"B,Si,Ge,Sb","Other-nonmetals":"H,C,P,Se",Halogens:"F,Cl,Br,I,At,Ts","Noble-gases":"He,Ne,Ar,Kr,Xe,Rn,Og"},t.subGroup={subgr_a:"H,Ga,In,Tl",subgr_b:"Sc,Y,La,Ac"}},6321:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RulesBase=void 0;const o=n(5041),s=n(6605);t.RulesBase=class{agentK(e){return e.toString()}atom(e){return e}comma(){return","}comment(e){return this.useMarkup(e)}custom(e){return this.useMarkup(e)}itemCount(e){return e.toString()}bracketCount(e){return this.itemCount(e)}itemMass(e){return(0,o.strMass)(e)}itemMassAndNum(e,t){return""}itemCharge(e){return""}nodeCharge(e){return e.text}bracketCharge(e){return this.nodeCharge(e)}operation(e){return`${this.opComment(e.commentPre)}${e.dstText}${this.opComment(e.commentPost)}`}opComment(e){return e?this.useMarkup(e.text):""}postProcess(e){return e}radical(e){return e}mul(){return"∙"}mulK(e){return String(e)}colorBegin(e){return""}colorEnd(){return""}markupSection(e,t){return""}useMarkup(e){const t=(0,s.parseMarkup)(e);let n="";return(0,s.markupFlat)(t,(({phase:e,chunk:t})=>{if("string"==typeof t)n+=t;else if("open"===e||"close"===e){const o="open"===e;!t.type&&t.color?n+=o?this.colorBegin(t.color):this.colorEnd():n+=this.markupSection(t.type,o)}})),n}}},4576:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dictTextRules=void 0;const o=n(3220),s=n(8869),r=n(4900),i=n(9072),a=n(7597),c=n(3222);t.dictTextRules={bb:o.rulesBB,charChem:s.rulesCharChem,html:r.rulesHtml,mhchem:i.rulesMhchem,rtf:a.rulesRTF,text:c.rulesText}},3220:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.rulesBB=void 0;const o=n(6321),s=n(5041);class r extends o.RulesBase{agentK(e){return`[b]${e}[/b]`}comment(e){return`[i]${e}[/i]`}custom(e){return`[i]${e}[/i]`}itemCount(e){return`[sub]${e}[/sub]`}itemMass(e){return`[sup]${(0,s.strMass)(e)}[/sup]`}itemMassAndNum(e,t){return`[sup]${(0,s.strMass)(e)}[/sup][sub]${t}[/sub]`}nodeCharge(e){return`[sup]${e.text}[/sup]`}colorBegin(e){return`[color=${e}]`}colorEnd(){return"[/color]"}}t.rulesBB=Object.freeze(new r)},8869:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.rulesCharChem=void 0;const o=n(6321),s=n(5041),r=e=>e.isNumber()?String(e):`'${e}'`;class i extends o.RulesBase{agentK(e){return r(e)}comment(e){return`"${e}"`}custom(e){return`{${e}}`}itemCount(e){return r(e)}itemMass(e){return`$M(${(0,s.strMass)(e)})`}itemMassAndNum(e,t){return`$nM(${(0,s.strMass)(e)},${t})`}nodeCharge(e){return`^${e.text}`}operation(e){return`${this.opComment(e.commentPre)}${e.srcText}${this.opComment(e.commentPost)}`}opComment(e){return e?this.comment(e.text):""}postProcess(e){return e.replace(/\$color\(\)\$color/g,"$color")}radical(e){return this.custom(e)}mul(){return"*"}mulK(e){return r(e)}colorBegin(e){return`$color(${e})`}colorEnd(){return"$color()"}}t.rulesCharChem=Object.freeze(new i)},4900:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.rulesHtml=t.RulesHtml=void 0;const o=n(6321),s=n(5041),r=n(4326),i=n(6290);class a extends o.RulesBase{agentK(e){return`<b${e.color?` style="color:${(0,i.escapeXml)(e.color)}"`:""}>${e}</b>`}comment(e){return`<em>${super.comment(e)}</em>`}custom(e){return`<i>${super.custom(e)}</i>`}itemCount(e){return`<sub>${e}</sub>`}itemMass(e){return`<sup>${(0,s.strMass)(e)}</sup>`}itemMassAndNum(e,t){return`${(0,r.drawTag)("span",{class:"echem-mass-and-num"})}${(0,s.strMass)(e)}<br/>${t}</span>`}itemCharge(e){return`<sup class="echem-item-charge">${e.text}</sup>`}nodeCharge(e){return`<sup>${e.text}</sup>`}operation(e){let t=(0,r.drawTag)("span",{class:"echem-op"});switch(t+=this.opComment(e.commentPre),e.srcText){case"--\x3e":t+='<span class="chem-long-arrow">→</span>';break;case"<==>":t+='<span class="chem-long-arrow">⇌</span>';break;default:t+=e.dstText}return t+=this.opComment(e.commentPost),`${t}</span>`}opComment(e){return e?`<span class="echem-opcomment">${this.useMarkup(e.text)}</span>`:""}colorBegin(e){return`<span style="color:${(0,i.escapeXml)(e)}">`}colorEnd(){return"</span>"}markupSection(e,t){var n;const o=null!==(n=c[e])&&void 0!==n?n:"span";return t?`<${o}>`:`</${o}>`}}t.RulesHtml=a;const c={sup:"sup",sub:"sub"};t.rulesHtml=Object.freeze(new a)},9072:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.rulesMhchem=void 0;const o=n(6321),s=n(5041),r={"--\x3e":"->","<=>":"<--\x3e","<==>":"<--\x3e"};class i extends o.RulesBase{agentK(e){return String(e)}itemCount(e){return`_{${e}}`}itemMass(e){return`^{${(0,s.strMass)(e)}}`}itemMassAndNum(e,t){return`^{${(0,s.strMass)(e)}}_{${t}}`}nodeCharge(e){return`^{${e.text}}`}operation(e){var t,n;let o=null!==(t=r[e.srcText])&&void 0!==t?t:e.srcText;const s=e.commentPre,i=e.commentPost;return(s||i)&&(o+=`[{${null!==(n=null==s?void 0:s.text)&&void 0!==n?n:""}}]`),i&&(o+=`[{${i.text}}]`),o}mul(){return"*"}colorBegin(e){return`\\color{${e}}{`}colorEnd(){return"}"}markupSection(e,t){const n=a[e];return n?t?`${n}{`:"}":""}}const a={sup:"^",sub:"_"};t.rulesMhchem=Object.freeze(new i)},7597:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.rulesRTF=void 0;const o=n(6321),s=n(5041),r=n(6445),i=new Set(["'","*",":","\\","_","{","|","}","~"]),a=e=>Array.from(e).reduce(((e,t)=>e+(e=>{if(i.has(e))return`\\${e}`;const t=e.charCodeAt(0);return t>127?`{\\cf2\\rtlch \\ltrch\\loch \\u${t}\\'3f}`:`${e}`})(t)),""),c=e=>`{\\sub ${a(e)}}`,d=e=>`{\\super ${a(e)}}`;class l extends o.RulesBase{agentK(e){return a(String(e))}atom(e){return e}comment(e){return a(e)}custom(e){return a(e)}itemCount(e){return c(String(e))}itemMass(e){return d((0,s.strMass)(e))}itemMassAndNum(e,t){return d((0,s.strMass)(e))+c(String(t))}nodeCharge(e){return d(e.text)}operation(e){let t="";return(0,r.ifDef)(e.commentPre,(e=>{t+=d(e.text)})),t+=a(e.dstText),(0,r.ifDef)(e.commentPost,(e=>{t+=c(e.text)})),t}radical(e){return a(e)}}t.rulesRTF=Object.freeze(new l)},3222:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.rulesText=t.RulesText=void 0;const o=n(6321);class s extends o.RulesBase{nodeCharge({isLeft:e,text:t}){return e?`${t}^`:`^${t}`}}t.RulesText=s,t.rulesText=Object.freeze(new s)},599:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isLeftCoeffA=t.isLeftCoeff=t.rxCoeffPos=void 0;const o=n(4040);t.rxCoeffPos=/^LT|RT|LB|RB|CU|CD$/,t.isLeftCoeff=e=>"L"===(null==e?void 0:e[0]),t.isLeftCoeffA=e=>{if("number"==typeof e){const t=(0,o.normalize360)(e);return t>90&&t<270}return(0,t.isLeftCoeff)(e)}},3825:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addAllSet=void 0,t.addAllSet=(e,t)=>Array.from(t).forEach((t=>e.add(t)))},5927:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cmpLess=t.cmp=void 0,t.cmp=(e,t)=>e<t?-1:t<e?1:0,t.cmpLess=e=>(t,n)=>e(t,n)?-1:e(n,t)?1:0},9825:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.delay=void 0,t.delay=e=>new Promise((t=>{setTimeout((()=>t()),e)}))},4210:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getItemForced=void 0,t.getItemForced=(e,t,n)=>{const o=e[t];if(void 0!==o)return o;const s="function"==typeof n?n():n;return e[t]=s,s}},6445:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ifDef=void 0,t.ifDef=(e,t)=>void 0===e?void 0:t(e)},267:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSubStr=void 0,t.isSubStr=(e,t,n)=>{for(let o=0;o<n.length;o++)if(e[t+o]!==n[o])return!1;return!0}},4061:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.lastItem=void 0,t.lastItem=e=>e?e[e.length-1]:void 0},4583:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.listToDict=void 0,t.listToDict=(e,t)=>e.reduce(((e,n)=>Object.assign(Object.assign({},e),{[t(n)]:n})),{})},6605:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.markupFlat=t.parseMarkup=t.scanMarkupEnd=void 0;const o=n(267);t.scanMarkupEnd=(e,t,n)=>{let o=0,s=t;for(;s<e.length;){const t=e[s++];if(t===n&&o<=0)break;"{"===t?o++:"}"===t&&o--}return s},t.parseMarkup=(e,n="",s=void 0)=>{const r=[];let i=0,a=0,c=s;const d=t=>{if(t>a){const n=e.slice(a,t);r.push(c===s?n:{type:"",color:c,chunks:[n]})}},l=n=>{if(i===e.length)return;d(i-1);const o=e[i++];if("{"===o){a=i,i=(0,t.scanMarkupEnd)(e,i,"}");const o=(0,t.parseMarkup)(e.slice(a,i-1),n);r.push(o)}else r.push({type:n,chunks:[o]});a=i},u=t=>{const n=e.indexOf("}",t);let o;return n<0?(i=t,o=void 0):(o=e.slice(t,n),i=n+1),a=i,o};for(;i<e.length;){const n=e[i++];if("^"===n)l("sup");else if("_"===n)l("sub");else if("\\"===n&&(0,o.isSubStr)(e,i,"color{")){d(i-1);const e=u(i+6);e&&(c=e)}else if("{"===n&&(0,o.isSubStr)(e,i,"\\color{")){d(i-1);const n=u(i+7);i=(0,t.scanMarkupEnd)(e,i,"}"),r.push((0,t.parseMarkup)(e.slice(a,i-1),"",n)),a=i}}d(i);const h={type:n,chunks:r};return s&&(h.color=s),h},t.markupFlat=(e,n)=>{e.chunks.forEach((o=>{"string"==typeof o?n({phase:"full",chunk:o,owner:e}):(n({phase:"open",chunk:o,owner:e}),(0,t.markupFlat)(o,n),n({phase:"close",chunk:o,owner:e}))}))}},9568:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeItem=void 0,t.removeItem=(e,t)=>{const n=e.indexOf(t);n>=0&&e.splice(n,1)}},1703:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.romanNum=void 0,t.romanNum={i:1,ii:2,iii:3,iv:4,v:5,vi:6,vii:7,viii:8}},4326:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawTag=void 0;const o=n(6290);t.drawTag=(e,t,n,s)=>{let r=`<${e}`;if(t){const e=null!=s?s:o.escapeXml;Object.keys(t).forEach((n=>{r+=` ${n}="${e(t[n])}"`}))}return n&&(r+=" /"),`${r}>`}},6290:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dec=t.hexLow=t.escapeXml=void 0;const n={"'":"apos",'"':"quot","&":"amp","<":"lt",">":"gt"};t.escapeXml=(e,t)=>Array.from(e).map((e=>{if(e in n)return`&${n[e]};`;if(!t||e>=" "&&e<="~")return e;const o=t(e.charCodeAt(0));return o?`&#${o};`:e})).join(""),t.hexLow=e=>`x${e.toString(16)}`,t.dec=e=>String(e)},8412:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=[2,0,13]}},t={};function n(o){var s=t[o];if(void 0!==s)return s.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}(()=>{const e=n(829),t=n(5256),o=n(6887);"undefined"!=typeof window&&(window.ChemSys=t.ChemSys,window.MenTblArray=o.PeriodicTable.elements,window.MenTbl=o.PeriodicTable.dict,(0,e.addAutoCompileEvent)())})()})();
//# sourceMappingURL=charchem2.js.map