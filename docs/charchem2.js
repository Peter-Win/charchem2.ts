(()=>{"use strict";var e={9769:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemSys=void 0;const n=o(7283),s=o(1053),r=o(830),i=o(7162),a=o(6410),c=o(6125),d=o(5373),l=o(3442),u=o(149),h=o(4910),p=o(9457),m=o(5983),f=o(2103),g=o(206),v=o(8784),b=o(6535),y=o(6672),C=o(4886),w=o(3268),x=o(5646),P=o(9838),M=o(7859),B=o(7004),k=o(6022),S=o(1527),_=o(8094);t.ChemSys=Object.freeze({addDict(e){d.Lang.addDict(e)},get ver(){return(0,i.getVersion)()},get verStr(){return(0,i.getVersionStr)()},compile:e=>(0,s.compile)(e),documentCompile:(e={})=>(0,p.documentCompile)(e),draw:(e,t,o)=>((0,n.renderFormulaCfg)(e,t,null!=o?o:{}),!0),makeSVG(e,t){const o="string"==typeof e?(0,s.compile)(e):e;return(0,M.makeFormulaSvgText)(o,t)},makeTextFormula(e,t){const o="string"==typeof e?(0,s.compile)(e):e;return(0,k.makeTextFormula)(o,t)},dictTextRules:S.dictTextRules,textFormula:(e,t)=>(0,_.textFormula)(e,t),get textTypesList(){return _.textTypes},makeBruttoKey:e=>(0,a.makeBruttoKey)(e),makeBrutto:e=>(0,s.compile)((0,a.makeBruttoKey)(e)),lang:(e,t,o)=>d.Lang.tr(e,t,o),get curLang(){return d.Lang.curLang},set curLang(e){d.Lang.curLang=e},get navLang(){return d.Lang.navLang},get Dict(){return d.Lang.dict},isAbstract:e=>(0,c.isAbstract)(e),calcMass:(e,t)=>(0,l.calcMass)(e,t),roundMass:e=>(0,P.roundMass)(e),calcCharge:e=>(0,x.calcCharge)(e),findElem:e=>(0,u.findElement)(e),drawTable:e=>(0,h.drawPeriodicTable)(e),findCategory:(e,t,o)=>(0,y.findCategory)(e,t,o),TblRules:{Std:m.tableRulesStd,Wide:f.tableRulesWide,Short:v.tableRulesShort,EasyChemistry:g.tableRulesEasyChemistry},TblCategory:{block:b.categoryBlock,blockDLa:b.categoryBlockDLa,props:b.categoryProps},drawTag:(e,t,o)=>void 0===o?(0,C.drawTag)(e,t,!0):`${(0,C.drawTag)(e,t)}${(0,w.escapeXml)(String(o))}</${e}>`,esc:e=>(0,w.escapeXml)(String(e)),equalize(e){const t=new B.ChemEquation;return t.initBySrc(e),t.solve(),t.isSolved()?t.getExpr():r.ChemExpr.createWithError(t.makeError(),e)}})},4061:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DrawSysIds=void 0,t.DrawSysIds={svg:!0,canvas:!0}},6094:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addClass=void 0,t.addClass=(e,t)=>{if(e.classList)e.classList.add(t);else{const o=e.getAttribute("class"),n=o?o.split(" "):[],s=new Set(n);s.add(t),e.setAttribute("class",Array.from(s).join(" "))}}},6875:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addAutoCompileEvent=t.autoCompile=t.fontPropsCache=void 0;const n=o(712),s=o(4061),r=o(9457);t.fontPropsCache=new n.WebFontCache,t.autoCompile=()=>{if(!document)return;const e=document.querySelectorAll(".easyChemConfig,.CharChemConfig,body.echem-auto-compile");if(0===e.length)return;const o=e[e.length-1],n={fontPropsCache:t.fontPropsCache},i=o.getAttribute("data-drawsys");if("string"==typeof i){const e=i.toLowerCase();e in s.DrawSysIds&&(n.drawSysId=e)}const a=o.getAttribute("data-usetext");if("string"==typeof a){const e=a.toLowerCase();n.nonText="no"===e}(0,r.documentCompile)(n)},t.addAutoCompileEvent=()=>{null===window||void 0===window||window.addEventListener("DOMContentLoaded",t.autoCompile)}},9457:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(s,r){function i(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.elementCompile=t.documentCompile=void 0;const s=o(6889),r=o(7283);t.documentCompile=e=>n(void 0,void 0,void 0,(function*(){var o;if(!document)return Promise.reject(new Error("Document expected"));try{const n=null!==(o=e.formulaSelector)&&void 0!==o?o:".echem-formula",r=document.querySelectorAll(n);let i=0,a=r[i++];for(;a;)(0,t.elementCompile)(a,e),a=r[i++],yield(0,s.delay)(1)}catch(e){return Promise.reject(e)}return Promise.resolve()})),t.elementCompile=(e,t)=>{var o;const n=null!==(o=e.textContent)&&void 0!==o?o:e.innerText;(0,r.renderFormulaCfg)(e,n,t)}},2881:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderFormulaCanvas=void 0;const n=o(7737),s=o(8704),r=o(3983),i=o(4298),a=o(6094);t.renderFormulaCanvas=(e,t,o)=>{if(!document)return;e.innerHTML="";const c=document.createElement("canvas");e.append(c);const d=new r.HtmlCanvasSurface(c,o),l=(0,n.createBrowserChemImgProps)(e,d);(0,s.renderTopFrame)((0,i.buildFrame)(t,l),d),(0,a.addClass)(e,"echem-is-canvas")}},7283:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderFormulaCfg=void 0;const n=o(1053),s=o(830),r=o(4836),i=o(2881),a=o(7859),c=o(6094),d=o(8094);t.renderFormulaCfg=(e,t,o)=>{var l;const u="string"==typeof t?(0,n.compile)(t):t;u instanceof s.ChemExpr&&!u.isOk()?(null===(l=e.classList)||void 0===l||l.add("echem-error"),e.setAttribute("title",u.getMessage())):(!o.nonText&&(0,r.isTextFormula)(u)?(e.innerHTML=(0,d.textFormula)(u,"html"),(0,c.addClass)(e,"echem-is-text")):"canvas"===o.drawSysId?(0,i.renderFormulaCanvas)(e,u,o.fontPropsCache):(0,a.renderFormulaSvg)(e,u,o.fontPropsCache),u instanceof s.ChemExpr&&e.setAttribute("data-src",u.src0.trim()))}},7859:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeFormulaSvgText=t.renderFormulaSvg=void 0;const n=o(7844),s=o(7737),r=o(8704),i=o(4298),a=o(3468),c=o(6094);t.renderFormulaSvg=(e,t,o)=>{if("undefined"==typeof document)return;const a=new n.SvgWebSurface(o),d=(0,s.createBrowserChemImgProps)(e,a),l=(0,i.buildFrame)(t,d);(0,r.renderTopFrame)(l,a);const{bounds:u}=l;e.innerHTML=a.exportText({width:`${u.width}px`,height:`${u.height}px`}),(0,c.addClass)(e,"echem-is-svg")},t.makeFormulaSvgText=(e,t)=>{if("undefined"==typeof document)return"";const o=document.createElement("div");o.setAttribute("class","echem-formula");try{document.body.append(o);const c=new n.SvgWebSurface(t),d=(0,s.createBrowserChemImgProps)(o,c),l=(0,i.buildFrame)(e,d);(0,r.renderTopFrame)(l,c);const{bounds:u}=l;return c.exportText(Object.assign(Object.assign({},a.standaloneExportOptions),{width:`${u.width}px`,height:`${u.height}px`}))}finally{o.remove()}}},9156:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChainSys=void 0;const n=o(7757);let s=1,r=1;t.ChainSys=class{constructor(e){this.chainsDict={},this.subChainsDict={},this.curChainId=0,this.curSubChainId=0,this.stack=[],this.compiler=e}getLastBond(){return this.lastBond}onBranchBegin(){this.stack.unshift(this.lastBond)}onBranchEnd(){this.lastBond=this.stack.shift()}createChain(){this.lastBond=void 0;const e=s++;return this.chainsDict[e]=new Set,e}getCurChain(){return 0===this.curChainId&&(this.curChainId=this.createChain()),this.chainsDict[this.curChainId]}createSubChain(){this.lastBond=void 0;const e=r++;return this.curSubChainId=e,this.subChainsDict[e]=[],this.getCurChain().add(e),e}getCurSubChain(){return 0===this.curSubChainId&&(this.curSubChainId=this.createSubChain()),this.subChainsDict[this.curSubChainId]}addNode(e){0===e.chain?(this.getCurSubChain().push(e),e.chain=this.curChainId,e.subChain=this.curSubChainId):(this.curChainId=e.chain,this.curSubChainId=e.subChain)}setCurNode(e){this.curChainId=e.chain,this.curSubChainId=e.subChain}addBond(e){e.soft&&this.createSubChain(),this.lastBond=e}mergeSubChains(e,t,o){if(e===t)return;const n=this.subChainsDict[t];n.forEach((t=>{t.subChain=e,t.pt.iadd(o)}));const s=this.subChainsDict[e];s&&n.forEach((e=>s.push(e))),delete this.subChainsDict[t],this.curSubChainId===t&&(this.curSubChainId=e)}mergeChains(e,t){const o=e.chain,n=t.chain;o!==n&&this.compiler.curAgent.nodes.filter((e=>e.chain===o)).forEach((e=>{e.chain=n}))}makeTransitionBond(e){e.soft=!1,e.dir=void 0;const t=e.nodes[1];t&&this.addNode(t)}bondToRef(e){const[t,o]=e.nodes;if(!t||!o)return;const n=t.subChain,s=o.subChain;if(n!==s){if(!e.soft)if(t.chain!==o.chain){this.mergeChains(t,o);const r=o.pt.minus(t.pt).minus(e.dir);this.mergeSubChains(s,n,r)}else this.makeTransitionBond(e)}else e.dir=o.pt.minus(t.pt);this.compiler.curNode=o,this.curChainId=o.chain,this.curSubChainId=o.subChain}changeBondToHard(e){var t;const o=e.nodes[0];if(o){const s=e.nodes[1];if(s){if(s.chain!==o.chain)throw Error("Different chains");this.mergeSubChains(o.subChain,s.subChain,null!==(t=e.dir)&&void 0!==t?t:new n.Point)}this.curSubChainId=o.subChain,this.curChainId=o.chain}}closeChain(){this.curChainId=0,this.curSubChainId=0,this.lastBond=void 0}closeSubChain(){this.curSubChainId=0,this.lastBond=void 0}findNode(e){return this.getCurSubChain().find((t=>t.pt.equals(e)))}}},7330:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createTestCompiler=t.ChemCompiler=void 0;const n=o(830),s=o(5679),r=o(9156),i=o(7972),a=o(5993),c=o(9922),d=o(8120),l=o(2658);class u{constructor(e,t){this.expr=new n.ChemExpr,this.text="",this.pos=0,this.curState=c.stateBegin,this.curPart=0,this.elementStartPos=0,this.chainSys=new r.ChainSys(this),this.references={},this.mulCounter=new i.MulCounter,this.varsDict={},this.curWidth=0,this.nodesBranch=new a.NodesBranch,this.bracketsCtrl=new l.BracketsCtrl,this.middlePoints=[],this.stack=[],this.altFlag=!1,this.varSlope=0,this.varLength=1,this.varPadding=[],this.centralNode=!1,this.varDots=void 0,this.varPos=void 0,this.srcText=e,this.options=null!=t?t:{},this.options.srcMap&&(this.srcMap=[],this.expr.srcMap=this.srcMap)}push(e){this.stack.unshift(e)}pop(){return this.stack.shift()}setAltFlag(){this.altFlag=!0}getAltFlag(){const e=this.altFlag;return this.altFlag=!1,e}eject(e){const t=this[e];return this[e]=void 0,t}curChar(){return this.text[this.pos]}nextChar(){return this.text[this.pos+1]}subStr(e){return this.text.slice(e,this.pos)}isFinish(){return this.pos>=this.text.length}isCurPosEq(e){return e===this.text.slice(this.pos,Math.min(this.text.length,this.pos+e.length))}error(e,t){const o=Object.assign({},t),{pos:n}=o;throw"number"==typeof n&&(o.pos=n+1),new s.ChemError(e,o)}setState(e,t=0){return this.curState=e,t}addSrcMapItem(e,t,o){const{srcMap:n,pos:s}=this;void 0!==t&&n&&n.push({begin:t,end:s,obj:e,part:o})}}t.ChemCompiler=u,t.createTestCompiler=e=>{const t=new u(e);return(0,d.prepareText)(t),t}},1053:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.compile=void 0;const n=o(7330),s=o(1541),r=o(8120);t.compile=(e,t)=>{const o=new n.ChemCompiler(e,t);try{for((0,r.prepareText)(o);!o.isFinish();){const e=o.curState(o);o.pos+=e}(0,s.closeEntity)(o)}catch(e){o.expr.error=e}return o.expr}},7172:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseBackgroundArgs=t.funcBackground=void 0;const n=o(6517),s=o(2019),r=o(8293),i=o(5458);t.funcBackground=(e,o,s)=>{var r;e.background&&(null===(r=e.curAgent)||void 0===r||r.commands.push(new n.ChemBackground(e.background))),e.background=(0,t.parseBackgroundArgs)(e,o,s)};const a=new Set(["rect","round","ellipse"]);t.parseBackgroundArgs=(e,t,o)=>{const n={};return t.forEach(((t,r)=>{const d=o[r],l=t.trim();if("*"===l)n.isAll=!0;else{const o=t.indexOf(":");if(o<0)a.has(l)?n.shape=l:n.fill||(n.fill=t);else{const r=t.slice(0,o),a=t.slice(o+1),l=d+o+1;switch(r){case"":case"to":n.nodes=c(e,a,l);break;case"fill":case"f":n.fill=a.trim();break;case"stroke":case"s":n.stroke=a.trim();break;case"width":case"w":n.strokeWidth=(0,s.parseNum)(e,a,l);break;case"padding":case"p":n.padding=(0,i.parsePadding)(e,a,l);break;case"r":n.borderRadius=(0,s.parseNum)(e,a,l)}}}})),n};const c=(e,t,o)=>{const n=t.split(";");let s=0;return n.map((t=>{const n=(0,r.findNodeEx)(e,t,s+o);return s+=t.length+1,n}))}},2331:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcC=void 0,t.funcC=e=>{e.centralNode=!0}},1401:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcAtomColor1=t.funcAtomColor=t.funcItemColor1=t.funcItemColor=t.funcColor=void 0,t.funcColor=(e,[t],o)=>{e.varColor=t},t.funcItemColor=(e,[t],o)=>{e.varItemColor=t},t.funcItemColor1=(e,[t],o)=>{e.varItemColor1=t},t.funcAtomColor=(e,[t],o)=>{e.varAtomColor=t},t.funcAtomColor1=(e,[t],o)=>{e.varAtomColor1=t}},3343:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcDblAlign=void 0;const o={r:1,R:1,l:1,L:1,m:1,M:1};t.funcDblAlign=(e,t)=>{e.varAlign=t[0]in o?t[0][0].toLowerCase():void 0}},8992:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcDots=t.parseDotsArgs=t.parseSingleDotArg=t.splitDotPositions=void 0;const n=o(2019),s=/^!?([LR][dbtu]?|[UTDB][lr]?)+$/;t.splitDotPositions=e=>{const t=[],o="!"===e[0];let n=o?1:0;const s=(o,s)=>o.indexOf(e[n])>=0&&(t.push(s),n++,!0),r=(e,o,n,r)=>{s(e,o)||s(n,r)||t.push(o,r)};for(;n<e.length;){const t=e[n++];"R"===t?r("db",0,"tu",7):"L"===t?r("db",3,"tu",4):"U"===t||"T"===t?r("l",5,"r",6):"B"!==t&&"D"!==t||r("r",1,"l",2)}if(!o)return t;const i=t.reduce(((e,t)=>(e.delete(t),e)),new Set([0,1,2,3,4,5,6,7]));return Array.from(i)},t.parseSingleDotArg=(e,o,r)=>{if(o){if(o.startsWith("c:")||o.startsWith("color:"))return{cmd:"color",color:o.slice(o.indexOf(":")+1)||void 0};if(o.startsWith("m:")||o.startsWith("margin:")){const t=o.slice(o.indexOf(":")+1);return{cmd:"margin",margin:t?(0,n.parseNum)(e,t,r):void 0}}return"!"===o||s.test(o)?{cmd:"dirs",dirs:(0,t.splitDotPositions)(o)}:{cmd:"num",num:(0,n.parseNum)(e,o,r)}}},t.parseDotsArgs=(e,o,n)=>{const s=[];let r,i;const a=()=>{const e={};return r&&(e.color=r),i&&(e.margin=i),e};return o.forEach(((o,c)=>{const d=(0,t.parseSingleDotArg)(e,o,n[c]);switch(null==d?void 0:d.cmd){case"dirs":d.dirs.forEach((e=>{return t=e,void s.push(Object.assign(Object.assign({},a()),{pos:t}));var t}));break;case"num":l=d.num,s.push(Object.assign(Object.assign({},a()),{angle:l}));break;case"color":r=d.color;break;case"margin":i=d.margin}var l})),s},t.funcDots=(e,o,n)=>{const s=(0,t.parseDotsArgs)(e,o,n);e.varDots=s}},2450:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcL=void 0;const n=o(2019);t.funcL=(e,t,o)=>{e.varLength=0===t.length?1:(0,n.parseNum)(e,t[0],o[0])}},4921:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcM=void 0;const n=o(2019);t.funcM=(e,t,o)=>{t.length>0&&(e.varMass=(0,n.parseNum)(e,t[0],o[0]))}},9775:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcPadding=void 0;const n=o(2019);t.funcPadding=(e,t,o)=>{e.varPadding=t.map(((t,s)=>(0,n.parseNum)(e,t,o[s])))}},960:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcPos=void 0;const n=o(549),s=o(2019);t.funcPos=(e,t,o)=>{const r=t[0];r&&(n.rxCoeffPos.test(r)?e.varPos=r:e.varPos=(0,s.parseNum)(e,r,o[0]))}},1705:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcSlope=void 0;const n=o(2019);t.funcSlope=(e,t,o)=>{e.varSlope=0===t.length?0:(0,n.parseNum)(e,t[0],o[0])}},1723:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcVer=t.parseVerParameter=void 0;const n=o(7162),s=o(3396),r=(e="")=>+e||0;t.parseVerParameter=e=>{var t,o;const[n,i]=e,a=(null!==(o=null!==(t=(0,s.ifDef)(n,(e=>{var t;return null!==(t=(0,s.ifDef)(i,(t=>`${e}.${t}`)))&&void 0!==t?t:n})))&&void 0!==t?t:i)&&void 0!==o?o:"0.0").split("."),c=[0===a.length?"0":a[0],a.length<2?"0":a[1]];return[r(c[0]),r(c[1])]},t.funcVer=(e,o)=>{const[s,r]=(0,t.parseVerParameter)(o),i=(0,n.getVersion)();(s>i[0]||s===i[0]&&r>i[1])&&e.error("Invalid version",{cur:`${i[0]}.${i[1]}`,need:`${s}.${r}`})}},2661:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcnM=void 0;const n=o(4921);t.funcnM=(e,t,o)=>{(0,n.funcM)(e,t,o),e.varAtomNumber=t.length>1?s(t[1]):""};const s=e=>{if(!e)return;const t=+e;return Number.isNaN(t)?void 0:t}},7151:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.funcsDict=void 0;const n=o(7172),s=o(2331),r=o(1401),i=o(3343),a=o(8992),c=o(2450),d=o(4921),l=o(2661),u=o(9775),h=o(960),p=o(1705),m=o(1723);t.funcsDict={atomColor:r.funcAtomColor,atomColor1:r.funcAtomColor1,background:n.funcBackground,bg:n.funcBackground,C:s.funcC,color:r.funcColor,dblAlign:i.funcDblAlign,dots:a.funcDots,itemColor:r.funcItemColor,itemColor1:r.funcItemColor1,L:c.funcL,M:d.funcM,nM:l.funcnM,padding:u.funcPadding,pos:h.funcPos,slope:p.funcSlope,ver:m.funcVer}},2658:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BracketsCtrl=void 0,t.BracketsCtrl=class{constructor(){this.queue=[]}clear(){this.queue.length=0}onNode(e){this.queue.forEach((t=>{t.nodes[1]=e})),this.clear()}onBracket(e){this.queue.push(e)}}},7972:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MulCounter=void 0,t.MulCounter=class{constructor(){this.bracketCounter=0}onOpenBracket(){this.mul&&++this.bracketCounter}onNode(e){const{mul:t}=this;t&&!t.nodes[1]&&(t.nodes[1]=e)}onCloseBracket(){this.mul&&--this.bracketCounter}close(){this.mul=void 0}create(e){this.mul=e}getMulForBracket(){return this.bracketCounter>0?void 0:this.mul}getMulForced(){return this.mul}}},5993:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NodesBranch=void 0,t.NodesBranch=class{constructor(){this.nbStack=[],this.nodes=[]}onBranchBegin(){const e=[...this.nodes];this.nbStack.unshift(e)}onBranchEnd(){const e=this.nbStack.shift();e&&(this.nodes=e)}onSubChain(){this.nodes.length=0}onNode(e){this.nodes.push(e)}}},8711:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StackItem=void 0,t.StackItem=class{constructor(e){this.pos=e}}},8840:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addNodeItem=void 0;const n=o(6986),s=o(1618),r=o(5757),i=o(98),a=o(3396);t.addNodeItem=(e,t)=>{(0,r.closeItem)(e);const o=new n.ChemNodeItem(t);return(0,a.ifDef)(e.varMass,(t=>{o.mass=t,e.varMass=void 0})),o.color=(0,i.getItemColor)(e),o.atomColor=(0,i.getAtomColor)(e),o.atomNum=e.varAtomNumber,o.bCenter=e.getAltFlag(),o.dots=e.varDots,e.varDots=void 0,e.varAtomNumber=void 0,(0,s.getNodeForced)(e,!1).items.push(o),o}},2393:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.finalUpdateAutoNodes=t.finalUpdateBondsForNodes=t.star=t.onCloseAgent=t.closeChain=t.createAgent=void 0;const n=o(1240),s=o(6728),r=o(1541),i=o(8840),a=o(1618),c=o(877),d=o(8602),l=o(1214),u=o(8057),h=o(8462),p=o(6517);t.createAgent=e=>{var t;let{pos:o}=e;const{preComm:s}=e;(0,r.closeEntity)(e);const a=new n.ChemAgent;return a.part=e.curPart,e.curAgent=a,(0,r.onCreateEntity)(e,a),s&&(o=null!==(t=e.eject("preCommPos"))&&void 0!==t?t:o,(0,i.addNodeItem)(e,s)),e.references={},e.varMass=void 0,e.curWidth=0,e.centralNode=!1,e.varPadding=[],e.varDots=void 0,e.nodesBranch.onSubChain(),e.bracketsCtrl.clear(),e.srcMap&&(e.entityBegin=o),a},t.closeChain=e=>{const{curBond:t}=e;t&&(2!==t.nodes.length||t.nodes[1]||(0,a.openNode)(e,!0)),e.curBond=void 0,(0,a.closeNode)(e),e.chainSys.closeChain(),e.nodesBranch.onSubChain(),e.bracketsCtrl.clear()},t.onCloseAgent=e=>{const{curAgent:o}=e;o&&((0,c.checkMul)(e),(0,u.checkMiddlePoints)(e),(0,t.closeChain)(e),e.curAgent=void 0,e.getAltFlag(),e.curBond=void 0,(0,d.checkBranch)(e),(0,t.finalUpdateBondsForNodes)(o),(0,t.finalUpdateAutoNodes)(o),e.background&&o.commands.push(new p.ChemBackground(e.background)),e.background=void 0,o.bonds.forEach(((e,t)=>{e.index=t})),e.addSrcMapItem(o,e.entityBegin),e.agentMode=void 0)},t.star=e=>{var t;return e.pos++,")"===e.curChar()?(0,d.closeBranch)(e):((0,c.checkMul)(e),(0,c.startMul)(e,null!==(t=(0,l.scanCoeff)(e))&&void 0!==t?t:new s.ChemK(1),!1),e.setState(h.stateAgentMid))},t.finalUpdateBondsForNodes=e=>{e.walk({bond(e){e.nodes.forEach((t=>null==t?void 0:t.addBond(e)))}})},t.finalUpdateAutoNodes=e=>{e.walk({nodePre(e){e.autoMode&&(0,a.updateAutoNode)(e)}})}},7824:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.agentAnalyse=void 0;const n=o(4957),s=o(2393),r=o(8362),i=o(8602),a=o(8840),c=o(7322),d=o(1618),l=o(8462),u=o(1047),h=o(6873),p=o(6436),m=o(5334),f=o(6354),g=o(4159),v=o(8299),b=o(2132),y=o(9578);t.agentAnalyse=(e,t)=>{e.agentMode="in";const o=e.curChar(),a=e.pos,c=(0,n.scanSimpleBond)(e);if(c)return(0,n.createSimpleBond)(e,c,a),e.setState(l.stateAgentMid);if(o>="A"&&o<="Z")return e.elementStartPos=e.pos,e.setState(u.stateElement,1);switch(o){case"`":return e.setAltFlag(),e.setState(l.stateAgentMid,1);case"{":return e.setState(p.stateCustom,1);case'"':return e.setState(h.stateCommentIn,1);case";":return(0,s.closeChain)(e),e.setState(m.stateAgentSpace,1);case":":return(0,r.createLabel)(e);case"#":return e.setState(f.stateNodeRef,1);case"^":return e.setState(g.stateCharge,1);case"$":return e.setState(y.stateFuncName,1);case"<":return(0,i.openBranch)(e);case">":return(0,i.closeBranch)(e);case"(":return(0,v.openParentheses)(e);case"[":return(0,v.openSquareBracket)(e);case")":case"]":case"}":return(0,v.closeBracketShort)(e);case"*":return(0,s.star)(e);case",":return C(e);case"_":return e.setState(b.stateUniBond,1);case"c":return(0,d.getNodeForced)(e,!0),e.setState(l.stateAgentMid,1);default:return t()}};const C=e=>((0,a.addNodeItem)(e,c.instChemComma),e.setState(l.stateAgentMid,1))},1825:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.autoCorrection=void 0;const n=o(3396),s=o(4957),r=o(2386),i=o(1639),a=[-60,120,0,0,60,-120],c=(e,t)=>{e.dir=(0,s.makeBondStep)((e=>a[2*(e.slope+1)+(e.isNeg?1:0)])(e),null!=t?t:e.dir.length()),e.isCorr=!0,(0,n.ifDef)(e.nodes[1],(t=>{t.pt=e.calcPt()}))},d=(e,t,o)=>{var n;if(null===(n=t.nodes[1])||void 0===n?void 0:n.fixed)return;const s=t.nodes[1];if(!s)return void c(t,o);const{subChain:r}=s,i=s.pt;c(t,o);const a=s.pt.minus(i),d=e.curAgent.nodes.slice(s.index+1).filter((e=>e.subChain===r));d.reverse(),d.forEach((e=>{e.pt.iadd(a)}))};t.autoCorrection=(e,t,o)=>{if(0!==e.varSlope)return;const n=(0,r.getLastBond)(e);if(!n)return;if(!n.isAuto)return;const{dir:s}=n;if(n.isAuto&&s&&(0,i.is0)(s.y)&&0!==o)c(t,e.varLength);else{if(0===n.slope||!n.isCorr||0===o||n.isNeg===t.isNeg)return 0===n.slope||n.isCorr||0===o||n.isNeg===t.isNeg||n.slope===t.slope?void(0!==n.slope&&!n.isCorr&&t.isHorizontal()&&d(e,n)):(d(e,n),void c(t,e.varLength));c(t,e.varLength)}}},6382:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mergeBonds=t.onOpenBond=t.getNodeForBondStart=t.findBondBetweenNodes=t.bindNodeToCurrentBond=t.bindNodeToBond=t.changeBondToHard=t.createCommonBond=void 0;const n=o(9064),s=o(5581),r=o(1618),i=o(1227),a=o(3223),c=o(8057);t.createCommonBond=e=>{const t=new n.ChemBond;return t.color=e.varColor,t},t.changeBondToHard=(e,t)=>{t.soft=!1,e.chainSys.changeBondToHard(t)},t.bindNodeToBond=(e,o,n)=>{var s;e.curNode=o,n.nodes[1]=o;const r=n.nodes[0],i=null!==(s=null==r?void 0:r.autoMode)&&void 0!==s&&s;n.soft&&(i||o.autoMode)&&(0,t.changeBondToHard)(e,n),n.soft&&(e.nodesBranch.onSubChain(),e.nodesBranch.onNode(o)),e.curBond=void 0;const{dir:a}=n;a&&r&&!n.soft&&!a.isZero()&&(o.pt=r.pt.plus(a))},t.bindNodeToCurrentBond=(e,o)=>{const{curBond:n}=e;n&&(0,t.bindNodeToBond)(e,null!=o?o:(0,r.openNode)(e,!0),n)},t.findBondBetweenNodes=(e,t,o)=>e.curAgent.bonds.find((e=>{const{nodes:n}=e;return!e.middlePoints&&2===n.length&&(n[0]===t&&n[1]===o||n[0]===o&&n[1]===t)})),t.getNodeForBondStart=(e,t)=>{const{curNode:o}=e;if(o)return o;const n=(0,i.lastItem)(e.curAgent.commands),a=n instanceof s.ChemBracketEnd?n:void 0;if(a){const{nodeIn:e}=a;if(e)return a.bond=t,e}return(0,r.openNode)(e,!0)},t.onOpenBond=(e,o,n)=>{e.srcMap&&e.srcMap.push({begin:n,end:e.pos,obj:o});const s=(0,t.getNodeForBondStart)(e,o);(0,r.closeNode)(e),(0,c.applyMiddlePoints)(e,o),2!==o.n||o.align||(o.align=e.varAlign),o.nodes[0]=s,o.isAuto&&s.autoMode&&(o.soft=!1),o.color=e.varColor,e.curAgent.addBond(o),e.curBond=o,e.chainSys.addBond(o)},t.mergeBonds=(e,t,o,n)=>{t.n+=o.n,e.curNode=n,e.curBond=t,n.fixed=!0,o.isAuto=!1,o.soft=!1,o.nodes[1]=n;const[s,r]=o.nodes;s&&r&&(o.dir=r.pt.minus(s.pt)),e.chainSys.addBond(o),(0,a.removeItem)(e.curAgent.bonds,o),(0,a.removeItem)(e.curAgent.commands,o)}},3772:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createPolygonalBond=void 0;const n=o(7917),s=o(6382),r=o(2386),i=o(895);t.createPolygonalBond=e=>{const t=e.pos-1,o=e.curChar();let a=1,c=0;"p"===o?c=1:"q"===o&&(c=-1),c||e.error("Invalid polygonal bond descriptor [c]",{c:o}),e.pos++,e.curChar()===o&&(a++,e.pos++);let d="";for(;(0,n.isDigit)(e.curChar());)d+=e.curChar(),e.pos++;const l=+d||0,u=(0,s.createCommonBond)(e);u.n=a,u.dir=(0,r.createPolygonStep)(e,c*(l||5),e.varLength),(0,i.scanBondSuffix)(e,u),u.tx=e.subStr(t),(0,s.onOpenBond)(e,u,t)}},7629:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createRingBond=t.findRingNodesEx=t.findRingNodes=void 0;const n=o(1618),s=o(6382);t.findRingNodes=e=>{const t=(0,n.getNodeForced)(e,!0),o=e.nodesBranch.nodes,s=o.slice(0,o.length-1),r=s.lastIndexOf(t);return r<0?void 0:s.slice(r)},t.findRingNodesEx=e=>{var o;return null!==(o=(0,t.findRingNodes)(e))&&void 0!==o?o:e.error("Cant close ring",{pos:e.pos-2})},t.createRingBond=(e,o)=>{e.pos+=o;const n=(0,s.createCommonBond)(e);n.nodes=(0,t.findRingNodesEx)(e),n.n=1,n.tx="o",n.ext="o",n.isCycle=!0,e.curAgent.addBond(n),e.curBond=void 0}},4957:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSimpleBond=t.scanSimpleBond=t.makeBondStep=void 0;const n=o(7757),s=o(6382),r=o(895),i=o(1825);t.makeBondStep=(e,t)=>(0,n.pointFromDeg)(e).times(0===t?1:t);class a{constructor(e,t,o,n=!1,s){this.n=e,this.angle=t,this.slope=o,this.soft=n,this.text=s}create(e,t){var o;const n=(0,s.createCommonBond)(e);return n.tx=null!==(o=this.text)&&void 0!==o?o:t,n.n=this.n,n.soft=this.soft,n.dir=this.calcDir(e,n),n.slope=this.slope,n.isAuto=!0,n.isText=0===this.angle&&0===this.slope,(0,i.autoCorrection)(e,n,this.slope),n}calcDir(e,o){let n;return 0===this.slope?n=this.angle:(o.slope=this.slope,n=(0===e.varSlope?30:e.varSlope)*this.slope),e.getAltFlag()&&(n+=180,o.isNeg=!0),(0,t.makeBondStep)(n,e.varLength)}}const c=new a(1,0,0,!0,"-"),d=new a(3,0,0,!0,"≡"),l={"-":c,"–":c,"−":c,"=":new a(2,0,0,!0),"%":d,"≡":d,"--":new a(1,0,0,!1,"-"),"==":new a(2,0,0,!1,"="),"%%":new a(3,0,0,!1,"≡"),"|":new a(1,90,0),"||":new a(2,90,0),"|||":new a(3,90,0),"/":new a(1,0,-1),"//":new a(2,0,-1),"///":new a(3,0,-1),"\\":new a(1,0,1),"\\\\":new a(2,0,1),"\\\\\\":new a(3,0,1)};t.scanSimpleBond=e=>{let t="",o=null;for(;;){const n=t+e.curChar(),s=l[n];if(!s)return null==o?void 0:o.create(e,t);t=n,o=s,e.pos++}},t.createSimpleBond=(e,t,o)=>{(0,r.scanBondSuffix)(e,t),(0,s.onOpenBond)(e,t,o)}},4598:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSplineBond=t.parseNodesListDef=void 0;const n=o(8293),s=o(7629),r=o(3396),i=o(1227),a=o(1618),c=o(3702),d=o(2386),l=o(6382),u=(e,t,o)=>{const s=(0,n.findNodeEx)(e,t[0],o),r=(0,n.findNodeEx)(e,t[1],o+t[0].length+1),i=Math.min(s.index,r.index),a=Math.max(s.index,r.index);return e.curAgent.nodes.slice(i,a+1)};t.parseNodesListDef=(e,t,o)=>{if(!t)return;const s=t.split(";");let r=o;return s.reduce(((t,o)=>{const s=o.split(":"),i=1===s.length?[...t,(0,n.findNodeEx)(e,o,r)]:[...t,...u(e,s,r)];return r+=o.length+1,i}),[])},t.createSplineBond=e=>{let o;e.pos++,(0,a.getNodeForced)(e,!0),"("!==e.curChar()?o={args:[],argPos:[]}:(e.pos++,o=(0,c.scanArgs)(e));const n=(0,d.makeParamsDict)(o.args,o.argPos),u=(0,l.createCommonBond)(e);u.isCycle=!1,u.tx="s",(0,d.setBondProperties)(e,u,n);const h=(0,r.ifDef)(n["#"],(o=>(0,t.parseNodesListDef)(e,o.value,o.valuePos))),p=h?(e=>e.length>1&&e[0]===(0,i.lastItem)(e)?{nodes:e.slice(0,e.length-1),isCycle:!0}:{nodes:e,isCycle:!1})(h):(e=>{var t;return null!==(t=(0,r.ifDef)((0,s.findRingNodes)(e),(e=>({nodes:e,isCycle:!0}))))&&void 0!==t?t:{nodes:[...e.nodesBranch.nodes],isCycle:!1}})(e);u.nodes=p.nodes,u.isCycle="o"in n||p.isCycle,u.ext="s",e.curAgent.addBond(u),e.curBond=void 0}},2386:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createUniversalBond=t.setBondProperties=t.parseStyle=t.parseBondMultiplicity=t.calcBondDirection=t.getLastBond=t.parseAxisCoordinate=t.parseRefsList=t.createPolygonStep=t.calcPolygonDir=t.makeParamsDict=void 0;const n=o(7757),s=o(6265),r=o(9409),i=o(8293),a=o(3396),c=o(2019),d=o(6382);t.makeParamsDict=(e,t)=>{const o=e.map(((e,o)=>e?{key:e[0],value:e.substring(1),valuePos:t[o]+1}:null)).filter((e=>e));return(0,r.listToDict)(o,(({key:e})=>e))},t.calcPolygonDir=(e,t)=>(0,n.pointFromRad)(e.polarAngle()+2*Math.PI/t).times(e.length()),t.createPolygonStep=(e,o,s)=>{var r,i;const c=null===(r=(0,t.getLastBond)(e))||void 0===r?void 0:r.dir;return null!==(i=(0,a.ifDef)(c,(e=>(0,t.calcPolygonDir)(e,o))))&&void 0!==i?i:new n.Point(s,0)},t.parseRefsList=(e,t,o)=>{var s;t||e.error("Invalid node reference '[ref]'",{ref:"",pos:o});let r=o;const a=t.split(";").map((t=>{const o=(0,i.findNodeEx)(e,t,r);return r+=t.length+1,o.pt})),c=a.reduce(((e,t)=>e.iadd(t)),new n.Point).times(1/a.length),d=null!==(s=e.curNode)&&void 0!==s?s:e.error("Expected node before bond",{pos:o});return c.minus(d.pt)},t.parseAxisCoordinate=(e,o,n,s)=>{if(!n.startsWith("#"))return(0,c.parseNum)(e,n,s);const r=(0,t.parseRefsList)(e,n.slice(1),s+1);return o?r.x:r.y},t.getLastBond=e=>e.chainSys.getLastBond(),t.calcBondDirection=(e,o)=>{var r,i,d,l,u;const h=()=>{const t=o.L;return t?(0,c.parseNum)(e,t.value,t.valuePos):e.varLength},p=e=>(0,n.pointFromDeg)(e).times(h()),m=null!==(u=null!==(l=null!==(d=null!==(i=null!==(r=(0,a.ifDef)(o.p,(o=>(0,t.parseRefsList)(e,o.value,o.valuePos))))&&void 0!==r?r:(0,a.ifDef)(o.P,(o=>{const n=""===o.value?5:(0,c.parseNum)(e,o.value,o.valuePos);return(0,t.createPolygonStep)(e,n||5,h())})))&&void 0!==i?i:(0,a.ifDef)(o.a,(o=>{var n,r;const i=null!==(r=(0,a.ifDef)(null===(n=(0,t.getLastBond)(e))||void 0===n?void 0:n.dir,(e=>(0,s.rad2deg)(e.polarAngle()))))&&void 0!==r?r:0;return p(i+(0,c.parseNum)(e,o.value,o.valuePos))})))&&void 0!==d?d:(0,a.ifDef)(o.A,(t=>p((0,c.parseNum)(e,t.value,t.valuePos)))))&&void 0!==l?l:(0,a.ifDef)(o.L,(()=>p(0))))&&void 0!==u?u:new n.Point(0,0);return(0,a.ifDef)(o.x,(o=>{m.x+=(0,t.parseAxisCoordinate)(e,!0,o.value,o.valuePos)})),(0,a.ifDef)(o.y,(o=>{m.y+=(0,t.parseAxisCoordinate)(e,!1,o.value,o.valuePos)})),m};const l={x:1,l:1,r:1,m:1};t.parseBondMultiplicity=(e,t,o)=>{const{value:n}=o,s=()=>n[1].toLowerCase();2===n.length&&"2"===n[0]&&s()in l?("x"===s()?t.setCross():t.align=s(),t.n=2):t.n=n?(0,c.parseNum)(e,n,o.valuePos):1};const u={m:1,l:1,r:1};t.parseStyle=(e,t)=>{t&&t[t.length-1].toLowerCase()in u?(e.align=t[t.length-1].toLowerCase(),e.style=t.slice(0,t.length-1)):e.style=t},t.setBondProperties=(e,o,n)=>{var s,r,i,c;(0,a.ifDef)(n.N,(n=>(0,t.parseBondMultiplicity)(e,o,n))),(0,a.ifDef)(n.h,(e=>{o.soft=!0;const t=e=>{o.n=0,o.dir&&0===o.dir.x&&(o.dir.x=.02*e)};"+"===e.value?t(1):"-"===e.value&&t(-1)})),(0,a.ifDef)(n.T,(e=>{o.tx=e.value})),1===o.n&&"H"in n&&o.setHydrogen(),(0,a.ifDef)(n.C,(e=>{switch(e.value){case"-":o.arr0=!0;break;case"+":o.arr0=!0,o.arr1=!0;break;default:o.arr1=!0}})),n["<"]&&(o.arr0=!0),n[">"]&&(o.arr1=!0),n["~"]&&(o.style="~"),(0,a.ifDef)(n.S,(e=>(0,t.parseStyle)(o,e.value)));const[d,l,u]=null!==(c=null!==(i=null!==(r=null!==(s=(0,a.ifDef)(n.w,(e=>[e.value,1,!1])))&&void 0!==s?s:(0,a.ifDef)(n.d,(e=>[e.value,-1,!1])))&&void 0!==r?r:(0,a.ifDef)(n.W,(e=>[e.value,1,!0])))&&void 0!==i?i:(0,a.ifDef)(n.D,(e=>[e.value,-1,!0])))&&void 0!==c?c:["",0,!1];((t,n,s)=>{const[r,i]=(()=>{switch(t){case"+":return[0,n];case"-":return[n,0];case"0":case"1":return[0,0];case"2":return[n,n];default:return[null,null]}})();o.w0=null!=r?r:e.curWidth,o.w1=null!=i?i:e.curWidth,s&&(e.curWidth=null!=i?i:e.curWidth)})(d,l,u)},t.createUniversalBond=(e,o,n,s)=>{const r=(0,d.createCommonBond)(e);e.curNode||(e.curNode=(0,d.getNodeForBondStart)(e,r));const i=(0,t.makeParamsDict)(o,n);r.dir=(0,t.calcBondDirection)(e,i),(0,t.setBondProperties)(e,r,i),(0,d.onOpenBond)(e,r,s)}},8299:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.closeBracketShort=t.closeBracket=t.getNodeForBracketEnd=t.openBrace=t.openSquareBracket=t.openParentheses=void 0;const n=o(8711),s=o(5581),r=o(8602),i=o(1618),a=o(6839),c=o(1227),d=o(3396),l=o(877),u=o(8798),h=o(8462),p=o(8722);class m extends n.StackItem{constructor(e,t){super(e),this.begin=t}msgInvalidClose(){return"It is necessary to close the bracket"}}t.openParentheses=e=>(e.pos++,"*"===e.curChar()?(0,r.openBranch)(e):(f(e,"(",e.pos-1),e.setState(p.stateBracketBegin))),t.openSquareBracket=e=>(f(e,"[",e.pos++),e.setState(p.stateBracketBegin)),t.openBrace=e=>(f(e,"{",e.pos-1),e.pos++,e.setState(p.stateBracketBegin));const f=(e,t,o)=>{const n=new s.ChemBracketBegin(t);n.color=e.varColor,e.mulCounter.onOpenBracket(),e.curAgent.commands.push(n),e.push(new m(o,n)),e.bracketsCtrl.onBracket(n),e.varPadding.length&&(n.padding=e.varPadding,e.varPadding=[]),e.curBond?(n.bond=e.curBond,n.nodes[0]=n.bond.nodes[0]):(n.nodes[0]=e.curNode,(0,i.closeNode)(e),e.chainSys.createSubChain())},g={"(":")","[":"]","{":"}"};t.getNodeForBracketEnd=e=>{const{curNode:t}=e;if(t)return t;const{commands:o}=e.curAgent;let n=(0,c.lastItem)(o);if(n instanceof a.ChemMulEnd&&(n=o[o.length-2]),n instanceof s.ChemBracketEnd){const{nodeIn:e}=n;if(e)return e}return(0,i.openNode)(e,!0)},t.closeBracket=(e,o,n)=>{var r;return null!==(r=(0,d.ifDef)(e.pop(),(r=>{var a;if(r instanceof m){const c=null!==(a=g[r.begin.text])&&void 0!==a?a:e.error("Invalid bracket pair [s]",{s:r.begin.text+o});c!==o&&e.error("Expected [must] instead of [have]",{must:c,have:o,pos:n,pos0:r.pos}),(0,l.checkMulBeforeBracket)(e),e.mulCounter.onCloseBracket();const d=new s.ChemBracketEnd(o,r.begin,(0,t.getNodeForBracketEnd)(e)),{commands:u}=e.curAgent;return u.push(d),r.begin.end=d,(0,i.closeNode)(e),e.chargeOwner=d,e.bracketsCtrl.onBracket(d),d}return e.error("Cant close bracket before branch",{pos:n,pos0:r.pos+1})})))&&void 0!==r?r:e.error("Invalid bracket close",{pos:n})},t.closeBracketShort=e=>{const o=e.curChar();let n=1;"}"===o&&"}"===e.nextChar()&&(n=2);const s=(0,t.closeBracket)(e,o,e.pos);return e.pos+=n,(0,u.scanPostItem)(e,(e=>{s.n=e})),e.setState(h.stateAgentMid)}},8602:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkBranch=t.closeBranch=t.openBranch=t.BranchDecl=void 0;const n=o(8711),s=o(1618),r=o(6382),i=o(8462);class a extends n.StackItem{constructor(e,t,o){super(e),this.node=t,this.bond=o}msgInvalidClose(){return"It is necessary to close the branch"}}t.BranchDecl=a,t.openBranch=e=>{const t=(0,r.getNodeForBondStart)(e,void 0);return e.push(new a(e.pos,t,e.curBond)),e.chainSys.onBranchBegin(),e.nodesBranch.onBranchBegin(),e.setState(i.stateAgentMid,1)},t.closeBranch=e=>{const t=e.pop();if(t){if(t instanceof a)return(0,r.bindNodeToCurrentBond)(e,e.curNode),(0,s.closeNode)(e),e.curNode=t.node,e.chainSys.onBranchEnd(),e.nodesBranch.onBranchEnd(),e.chainSys.setCurNode(t.node),e.setState(i.stateAgentMid,1);e.error("Cant close branch before bracket",{pos:e.pos,pos0:t.pos+1})}return e.error("Invalid branch close",{pos:e.pos})},t.checkBranch=e=>{const t=e.pop();t&&e.error(t.msgInvalidClose(),{pos:t.pos})}},8920:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createChemOp=t.onCloseOp=t.opsList=t.OpDef=void 0;const n=o(286),s=o(1541);class r{constructor(e,t=null,o=!1){this.src=e,this.dst=t,this.div=o}opCode(){var e;return null!==(e=this.dst)&&void 0!==e?e:this.src}}t.OpDef=r,t.opsList=[new r("+"),new r("--\x3e","—→",!0),new r("--|>","—→",!0),new r("->","→",!0),new r("®","→",!0),new r("→",null,!0),new r("=",null,!0),new r("↔",null,!0),new r("<--\x3e","←→",!0),new r("<->","↔",!0),new r("<=>","⇌",!0),new r("<==>","⇌",!0),new r("*","∙"),new r("!=","≠",!0),new r("<|--","←—",!0),new r("<--","←—",!0),new r("<-","←",!0)],t.onCloseOp=e=>{e.curOp=void 0},t.createChemOp=(e,t)=>{var o;const{preComm:r}=e;(0,s.closeEntity)(e);const i=new n.ChemOp(t.src,t.opCode(),t.div);i.color=e.varColor,i.commentPre=r,e.srcMap&&(e.entityBegin=null!==(o=e.eject("preCommPos"))&&void 0!==o?o:e.pos-t.src.length),(0,s.onCreateEntity)(e,i),e.curOp=i,t.div&&e.curPart++}},98:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getAtomColor=t.getItemColor=void 0;const n=o(3396);t.getItemColor=e=>{var t,o;return null!==(o=null!==(t=(0,n.ifDef)(e.varItemColor1,(t=>(e.varItemColor1=void 0,t))))&&void 0!==t?t:e.varItemColor)&&void 0!==o?o:e.varColor},t.getAtomColor=e=>{var t;return null!==(t=(0,n.ifDef)(e.varAtomColor1,(t=>(e.varAtomColor1=void 0,t))))&&void 0!==t?t:e.varAtomColor}},8362:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createLabel=void 0;const n=o(9154),s=o(1618),r=o(8462);t.createLabel=e=>{e.pos++;const t=(0,n.scanId)(e);return t?e.references[t]=(0,s.getNodeForced)(e,!0):e.error("Invalid label",{pos:e.pos}),e.setState(r.stateAgentMid)}},1541:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.closeEntity=t.onCreateEntity=void 0;const n=o(8920),s=o(2393);t.onCreateEntity=(e,t)=>{e.curEntity=t,e.expr.entities.push(t)},t.closeEntity=e=>{e.curEntity&&(e.curEntity=void 0,(0,s.onCloseAgent)(e),(0,n.onCloseOp)(e)),e.preComm=void 0}},8293:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.findNodeEx=t.findNode=void 0;const n=o(149);t.findNode=(e,t)=>{const{nodes:o}=e.curAgent,s=+t;if(!Number.isNaN(s))return o[s<0?s+o.length:s-1];const r=e.references[t];if(r)return r;const i=(0,n.findElement)(t);if(i){const e=o.find((e=>1===e.items.length&&e.items[0].obj===i));if(e)return e}},t.findNodeEx=(e,o,n)=>{const s=(0,t.findNode)(e,o);return s||e.error("Invalid node reference '[ref]'",{ref:o,pos:n}),s}},5757:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getLastItem=t.closeItem=void 0;const n=o(1227);t.closeItem=e=>{},t.getLastItem=e=>{var t;return(0,n.lastItem)(null===(t=e.curNode)||void 0===t?void 0:t.items)}},8057:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createMiddlePoint=t.checkMiddlePoints=t.applyMiddlePoints=void 0;const n=o(7757),s=o(1618),r=o(3702),i=o(2386);t.applyMiddlePoints=(e,t)=>{const{middlePoints:o}=e;if(0===o.length)return;const s=o.map((e=>e.pt));s.push(t.dir),t.middlePoints=s,t.dir=s.reduce(((e,t)=>e.iadd(t)),new n.Point),t.soft=!1,o.length=0},t.checkMiddlePoints=e=>{0!==e.middlePoints.length&&e.error("Invalid middle point",{pos:e.middlePoints[0].pos})},t.createMiddlePoint=e=>{const t=e.pos-1;e.pos++,"("!==e.curChar()&&e.error("Expected '(' after [S]",{pos:e.pos-1,S:"_m"}),(0,s.getNodeForced)(e,!0),e.pos++;const o=(0,r.scanArgs)(e),n=(0,i.makeParamsDict)(o.args,o.argPos),a=(0,i.calcBondDirection)(e,n);e.middlePoints.push({pt:a,pos:t})}},877:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkMul=t.checkMulBeforeBracket=t.stopMul=t.startMul=void 0;const n=o(6839),s=o(1618),r=o(3396);t.startMul=(e,t,o)=>{const i=new n.ChemMul(t,o,e.varColor),{curNode:a,curBond:c}=e;i.nodes[0]=a||(0,r.ifDef)(c,(()=>(0,s.openNode)(e,!0))),(0,s.closeNode)(e),e.chainSys.closeSubChain(),e.curAgent.commands.push(i),e.mulCounter.create(i),e.bracketsCtrl.clear()},t.stopMul=(e,t)=>{e.mulCounter.close(),e.curAgent.commands.push(new n.ChemMulEnd(t))},t.checkMulBeforeBracket=e=>{const o=e.mulCounter.getMulForBracket();o&&(0,t.stopMul)(e,o)},t.checkMul=e=>{const o=e.mulCounter.getMulForced();o&&(0,t.stopMul)(e,o)}},1618:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateAutoNode=t.getNodeForced=t.openNode=t.closeNode=void 0;const n=o(1789),s=o(6986),r=o(149),i=o(6728),a=o(8057),c=o(6382),d=o(5757),l=o(1227),u=o(5581),h=o(6517);t.closeNode=e=>{(0,d.closeItem)(e),e.curNode=void 0,e.chargeOwner=void 0},t.openNode=(e,o=!1)=>{var s;const r=e.curBond;if(r){const{dir:t}=r;if(r.soft&&o&&(0,c.changeBondToHard)(e,r),t&&!t.isZero()){if(!r.soft){const t=r.calcPt(),o=e.chainSys.findNode(t);if(o){if(e.nodesBranch.onNode(o),(!r.soft||o.autoMode)&&!r.middlePoints){o.fixed=!0;const t=r.nodes[0],n=(0,c.findBondBetweenNodes)(e,t,o);if(n)return(0,c.mergeBonds)(e,n,r,o),o}return(0,c.bindNodeToBond)(e,o,r),o}}const o=null===(s=e.curAgent)||void 0===s?void 0:s.bonds.find((({soft:e,nodes:o,dir:n})=>{var s,i;return e&&2===o.length&&(null===(s=o[0])||void 0===s?void 0:s.index)===(null===(i=r.nodes[0])||void 0===i?void 0:i.index)&&!!o[1]&&n&&t.equals(n)}));if(o){const t=o.nodes[1];return(0,c.mergeBonds)(e,o,r,t),e.chainSys.setCurNode(t),t}}}(0,t.closeNode)(e),(0,a.checkMiddlePoints)(e),(0,l.lastItem)(e.curAgent.commands)instanceof u.ChemBracketEnd&&e.chainSys.createSubChain();const i=e.curAgent.addNode(new n.ChemNode);return i.index=e.curAgent.nodes.length-1,i.autoMode=o,i.color=e.varColor,e.curNode=i,e.chargeOwner=i,e.chainSys.addNode(i),e.nodesBranch.onNode(i),e.mulCounter.onNode(i),i.bCenter=e.centralNode,e.centralNode=!1,(0,c.bindNodeToCurrentBond)(e,i),e.bracketsCtrl.onNode(i),e.background&&(e.curAgent.commands.push((0,h.createBackground)(e.background,i)),e.background=void 0),i},t.getNodeForced=(e,o)=>{var n;return null!==(n=e.curNode)&&void 0!==n?n:(0,t.openNode)(e,o)},t.updateAutoNode=e=>{var t,o;e.items.push(new s.ChemNodeItem(r.PeriodicTable.dict.C));const n=Array.from(e.bonds).reduce(((e,t)=>e+t.n),0),a=4+(null!==(o=null===(t=e.charge)||void 0===t?void 0:t.value)&&void 0!==o?o:0)-Math.round(n);a>0&&e.items.push(new s.ChemNodeItem(r.PeriodicTable.dict.H,new i.ChemK(a)))}},2185:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.specCharsB=t.replaceGreek=t.createComment=void 0;const n=o(9021),s=o(2524),r=o(3759);t.createComment=e=>{const t=i(e),o=d(t);return e.pos++,new s.ChemComment(o)};const i=e=>{const t=e.pos;return(0,r.scanTo)(e,'"')||e.error("Comment is not closed",{pos:t-1}),e.subStr(t)},a=(e,t,o,n)=>{let s=0,r=e;for(;s<r.length;){const e=r.indexOf(t,s);if(e<0||e===r.length)break;const i=r.indexOf(o,e+1);if(i<0)break;const a=n(r.slice(e+1,i));void 0!==a?(r=r.slice(0,e)+a+r.slice(i+1),s=e+a.length):s=e+1}return r},c=[[/\|\^/g,"↑"],[/ArrowUp/g,"↑"],[/\|v/g,"↓"],[/ArrowDown/g,"↓"],[/\^o/g,"°"]],d=e=>{let o=c.reduce(((e,[t,o])=>e.replace(t,o)),e);return o=(0,t.replaceGreek)(o),o=a(o,"`","`",(e=>{var t;return null!==(t=n.Lang.findPhrase(e))&&void 0!==t?t:e})),o};t.replaceGreek=e=>a(e,"[","]",(e=>t.specCharsB[e])).replace(/\\([A-Za-z][a-z]*)/g,((e,o)=>t.specCharsB[o]||e)),t.specCharsB={alpha:"α",Alpha:"Α",beta:"β",Beta:"Β",gamma:"γ",Gamma:"Γ",delta:"δ",Delta:"Δ",epsilon:"ε",Epsilon:"Ε",zeta:"ζ",Zeta:"Ζ",eta:"η",Eta:"Η",theta:"θ",Theta:"Θ",iota:"ι",Iota:"Ι",kappa:"κ",Kappa:"Κ",lambda:"λ",Lambda:"Λ",mu:"μ",Mu:"Μ",nu:"ν",Nu:"Ν",xi:"ξ",Xi:"Ξ",omicron:"ο",Omicron:"Ο",pi:"π",Pi:"Π",rho:"ρ",Rho:"Ρ",sigma:"σ",Sigma:"Σ",tau:"τ",Tau:"Τ",upsilon:"υ",Upsilon:"Υ",phi:"φ",Phi:"Φ",chi:"χ",Chi:"Χ",psi:"ψ",Psi:"Ψ",omega:"ω",Omega:"Ω"}},7917:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isDigit=void 0,t.isDigit=e=>e>="0"&&e<="9"},6662:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSpace=void 0,t.isSpace=e=>" "===e||"\t"===e||"\n"===e},2019:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseNum=void 0;const o={$32:Math.sqrt(3)/2,$3:Math.sqrt(3),$3x2:2*Math.sqrt(3),$2:Math.sqrt(2),$22:Math.sqrt(2)/2,$2x2:2*Math.sqrt(2),"½":.5,"¼":1/4,"¾":3/4,"⅓":1/3,"⅔":2/3},n=(e,t,n)=>{var s;return null!==(s=o[t])&&void 0!==s?s:((e,t,o)=>{e.error("Invalid number [n]",{n:t,pos:o})})(e,t,n)};t.parseNum=(e,t,o)=>{const s=t.trim();if(!s)return 0;const r=+s;return Number.isNaN(r)?((e,t,o)=>{let s=1,r=t,i=o;return t.startsWith("-")&&(s=-1,i++,r=r.slice(1)),r.startsWith("%")?((e,t,o)=>{const s=t.indexOf(":");return s<0?((e,t,o)=>{var n;return null!==(n=e.varsDict[t])&&void 0!==n?n:e.error("Undefined variable [name]",{name:t,pos:o})})(e,t,o):((e,t,o,s)=>{t||e.error("Expected variable name",{pos:s});const r=+o,i=Number.isNaN(r)?n(e,o,s+t.length+1):r;return e.varsDict[t]=i,i})(e,t.slice(0,s),t.slice(s+1),o)})(e,r.slice(1),i+1)*s:n(e,r,i)*s})(e,s,o):r}},5458:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parsePadding=void 0;const n=o(2019);t.parsePadding=(e,t,o)=>{const s=t.split(";");let r=0;return s.map((t=>{const s=(0,n.parseNum)(e,t,r+o);return r+=t.length+1,s}))}},8120:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.prepareText=void 0;const n=o(5779);t.prepareText=e=>{const t=`${e.srcText} `,o=(0,n.mainPreProcess)(t);e.text=o,e.expr.src0=t,e.expr.src=o}},3759:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanTo=t.scan=void 0,t.scan=(e,t)=>{for(;!e.isFinish()&&t(e.curChar());)e.pos++;return!e.isFinish()},t.scanTo=(e,o)=>(0,t.scan)(e,(e=>e!==o))},3702:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanArgs=void 0,t.scanArgs=e=>{const t=e.pos;let o=t;const n=[],s=[];let r=0;const i=()=>{s.push(o),n.push(e.subStr(o)),o=e.pos+1};for(;!e.isFinish();){const t=e.curChar();if("("===t)r++;else if(")"===t){if(0===r)break;r--}else","===t&&0===r&&i();e.pos++}return e.isFinish()&&e.error("It is necessary to close the bracket",{pos:t-1}),t!==e.pos&&i(),e.pos++,{args:n,argPos:s}}},895:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanBondSuffix=void 0;const o=[["0",e=>{e.n=0}],["o",e=>{e.n=0}],["h",e=>e.setHydrogen()],["ww",e=>{e.w0=1}],["w",e=>{e.w1=1}],["dd",e=>{e.w0=-1}],["d",e=>{e.w1=-1}],["x",e=>e.setCross()],["~",e=>{e.style="~"}],["r",e=>{e.align="r"}],["m",e=>{e.align="m"}],["l",e=>{e.align="l"}],["vvv",e=>{e.arr0=!0,e.arr1=!0}],["vv",e=>{e.arr0=!0}],["v",e=>{e.arr1=!0}]];t.scanBondSuffix=(e,t)=>{for(;;){const n=o.find((([t])=>e.isCurPosEq(t)));if(!n)break;const[s,r]=n;r(t),e.pos+=s.length}}},7823:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanCharge=void 0;const n=o(3725);t.scanCharge=(e,t="RT")=>{if(e.isFinish())return;const o=e.pos;let s;for(;;){e.pos++;const r=(0,n.createCharge)(e.subStr(o),t);if(!r){e.pos--;break}if(s=r,e.isFinish())break}return s}},1214:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanCoeff=void 0;const n=o(6728),s=o(3759);t.scanCoeff=e=>{const t=()=>e.getAltFlag()?"LB":void 0;let o=e.text[e.pos];"`"===o&&(e.setAltFlag(),o=e.text[++e.pos]);const r=e.pos;if(o){if(o>="0"&&o<="9"){for(e.pos++;!(e.isFinish()||(o=e.text[e.pos],!o||o<"0"||o>"9"));)e.pos++;const s=e.subStr(r);return new n.ChemK(+s,t())}if("'"===o){e.pos++,(0,s.scanTo)(e,"'")||e.error("Abstract coefficient is not closed",{pos:r});const o=e.subStr(r+1);return e.pos++,new n.ChemK(o,t())}}}},9154:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanId=t.isId=t.isIdFirstChar=void 0,t.isIdFirstChar=e=>/[A-Za-z]/.test(e);const o=e=>/[A-Z\d]/i.test(e);t.isId=e=>!(!e||!(0,t.isIdFirstChar)(e[0])||Array.from(e.slice(1)).find((e=>!o(e)))),t.scanId=e=>{const n=e.pos;if((0,t.isIdFirstChar)(e.curChar()))for(e.pos++;o(e.curChar());)e.pos++;const s=e.subStr(n);return""===s?void 0:s}},2830:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanInt=void 0;const n=o(7917);t.scanInt=e=>{const t=e.pos;for("-"===e.curChar()&&(0,n.isDigit)(e.text[t+1])&&e.pos++;(0,n.isDigit)(e.curChar());)e.pos++;return e.pos===t?void 0:+e.subStr(t)}},7e3:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanOp=void 0;const n=o(8920),s=o(6662);t.scanOp=e=>{const t=n.opsList.find((t=>e.isCurPosEq(t.src)));if(t){const o=e.pos+t.src.length,n=e.text[o];if(n&&!(0,s.isSpace)(n)&&'"'!==n)return;e.pos+=t.src.length}return t}},8798:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanPostItem=void 0;const n=o(1214),s=o(3396);t.scanPostItem=(e,t)=>{var o;return null!==(o=(0,s.ifDef)((0,n.scanCoeff)(e),(e=>(t(e),!0))))&&void 0!==o&&o}},4882:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.skipSpaces=void 0;const n=o(6662);t.skipSpaces=e=>{for(;e.pos<e.text.length&&(0,n.isSpace)(e.curChar());)e.pos++}},693:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.globalMacros=t.Macros=void 0,t.Macros=class{constructor(e){this.name=e,this.body=""}},t.globalMacros={}},6338:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PreProcCtx=void 0;const n=o(5679);class s{constructor(e,t){this.src="",this.dst="",this.pos=0,this.stack=[],e instanceof s?(this.src=e.src,this.pos=e.pos):(this.src=e,void 0!==t&&(this.pos=t))}error(e,t=0){throw 0!==t&&(this.pos=t<0?this.pos+t:t),new n.ChemError(e,{pos:this.pos})}errorPar(e,t){throw new n.ChemError(e,t)}n(e=1){if(0===e)return"";this.pos+e>this.src.length&&this.error("Unexpected end of macros");const t=this.pos;return this.pos+=e,this.src.slice(t,this.pos)}search(e){const t=this.pos,o=this.src.indexOf(e,t);if(!(o<0))return this.pos=o+e.length,this.src.slice(t,o)}searchEx(e){var t;return null!==(t=this.search(e))&&void 0!==t?t:this.errorPar("Expected [cond] character in macros",{cond:e})}end(){return this.pos<this.src.length}write(e){this.dst+=e}writeFinish(){this.write(this.src.slice(this.pos)),this.pos=this.src.length}push(){this.stack.unshift(this.dst),this.dst=""}pop(){const e=this.dst;return this.dst=this.stack.shift()||"",e}clear(){this.dst=""}}t.PreProcCtx=s},3134:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.bodyPreprocess=void 0;const n=o(9154),s=o(1077);t.bodyPreprocess=e=>{for(;;){const t=e.search("@");if(void 0===t){e.writeFinish();break}e.write(t);const o=e.n();if(":"===o)(0,s.defMacro)(e);else{if(!(0,n.isIdFirstChar)(o[0])){e.pos--;break}e.write(`@${o}`)}}}},1077:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defMacro=void 0;const n=o(9154),s=o(3134),r=o(693);t.defMacro=e=>{const t=e.pos,o=e.searchEx("(");(0,n.isIdFirstChar)(o[0])||e.error("Invalid macro name",t);const i=new r.Macros(o);e.push(),(0,s.bodyPreprocess)(e),i.body=e.pop();const a=e.n();"("===a?e.write(`@${o}${a}`):";"!==a&&e.error("Invalid macros end"),r.globalMacros[o]=i}},28:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.execMacros=t.readRealParams=t.applyParamValues=void 0;const n=o(9154),s=o(693),r=o(6338),i=o(8679),a=o(4870);t.applyParamValues=(e,t,o)=>{if(0===e.names.length)return o;let n=0;t.forEach((t=>{const o=t.indexOf(":");let s=!1;if(o>=0){const n=t.slice(0,o);n in e.dict&&(e.dict[n]=t.slice(o+1),s=!0)}if(!s){const o=e.names[n++];void 0!==o&&t&&(e.dict[o]=t)}})),o.writeFinish();const s=o.dst.split("&");return s.slice(1).forEach(((t,o)=>{const n=o+1,r=e.names.reduce(((e,o)=>t.slice(0,Math.min(o.length,t.length))===o&&o.length>e.length?o:e),"");r&&(s[n]=e.dict[r]+s[n].slice(r.length))})),new r.PreProcCtx(s.join(""))},t.readRealParams=e=>{const t=[];if(")"!==e.n()){e.pos--;do{const o=e.pos,n=(0,a.scanPar)(e.src,o);n>=e.src.length&&e.error("Real params list is not closed"),t.push(e.n(n-o))}while(")"!==e.n())}return t},t.execMacros=(e,o)=>{const a=new r.PreProcCtx(e),c=(0,i.readFormalPars)(a),d=(0,t.applyParamValues)(c,o,a);for(;;){const e=d.search("@");if(void 0===e){d.writeFinish();break}d.write(e);const o=d.searchEx("(");(0,n.isId)(o)||d.errorPar("Invalid macro [name]",{name:o});const r=s.globalMacros[o];if(r){const e=(0,t.readRealParams)(d);d.write((0,t.execMacros)(r.body,e))}else d.errorPar("Macros not found: [name]",{name:o})}return d.dst}},5779:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mainPreProcess=void 0;const n=o(3134),s=o(28),r=o(6338);t.mainPreProcess=e=>{const t=new r.PreProcCtx(e);(0,n.bodyPreprocess)(t),t.pos!==e.length&&t.error("Invalid preprocessor finish");const o=`)${t.dst}`;return(0,s.execMacros)(o,[])}},8679:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.readFormalPars=void 0;const n=o(9154),s=o(4870);t.readFormalPars=e=>{const t={},o=[];if(")"!==e.n())for(e.pos--;;){const r=e.pos,i=(0,s.scanPar)(e.src,r);i>=e.src.length&&e.error("Formal params list is not closed");const a=e.n(i-r),c=a.indexOf(":"),[d,l]=c<0?[a,""]:[a.slice(0,c),a.slice(c+1)];if((0,n.isId)(d)||e.errorPar("Invalid parameter name: [name]",{name:d}),t[d]=l,o.push(d),")"===e.n())break}return{dict:t,names:o}}},4870:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanPar=void 0,t.scanPar=(e,t)=>{let o=0,n=!1,s=t;for(;s<e.length;){const t=e[s];if('"'===t)n=!n;else if("("!==t||n){if(","===t&&!n&&0===o)break;if(")"===t&&!n){if(!(o>0))break;o--}}else o++;s++}return s}},8947:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},5090:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSrcItemsForObject=void 0,t.getSrcItemsForObject=(e,t)=>{var o;return null!==(o=null==t?void 0:t.filter((({obj:t})=>e===t)))&&void 0!==o?o:[]}},886:function(e,t,o){var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var s=Object.getOwnPropertyDescriptor(t,o);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,s)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),s=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||n(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),s(o(8947),t),s(o(5090),t)},4941:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateAgent=void 0;const n=o(2393),s=o(7525);t.stateAgent=e=>((0,n.createAgent)(e),e.agentMode="begin",e.setState(s.stateAgentBegin))},7525:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateAgentBegin=void 0;const n=o(3396),s=o(1214),r=o(8769),i=o(9578);t.stateAgentBegin=e=>{e.agentMode="begin";const t=e.curAgent;if(t){if("$"===e.curChar())return e.setState(i.stateFuncName,1);(0,n.ifDef)((0,s.scanCoeff)(e),(o=>{t.n=o,o&&(o.color=e.varColor),e.srcMap&&(e.addSrcMapItem(t,e.entityBegin,"agentK"),e.entityBegin=e.pos)}))}else e.error("stateAgentBegin with empty agent",{});return e.setState(r.stateAgentIn)}},8769:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateAgentIn=void 0;const n=o(7824);t.stateAgentIn=e=>(0,n.agentAnalyse)(e,(()=>e.error("Unknown element character '[C]'",{C:e.curChar(),pos:e.pos})))},8462:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateAgentMid=void 0;const n=o(7824),s=o(1541),r=o(9922);t.stateAgentMid=e=>(0,n.agentAnalyse)(e,(()=>((0,s.closeEntity)(e),e.setState(r.stateBegin))))},5334:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateAgentSpace=void 0;const n=o(4882),s=o(8462);t.stateAgentSpace=e=>((0,n.skipSpaces)(e),e.setState(s.stateAgentMid))},9922:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateBegin=void 0;const n=o(8920),s=o(7e3),r=o(4882),i=o(4941),a=o(9189),c=o(5519);t.stateBegin=e=>{if((0,r.skipSpaces)(e),e.isFinish())return 0;if('"'===e.curChar())return e.setState(a.stateCommentPre,1);const t=(0,s.scanOp)(e);return null!=t?((0,n.createChemOp)(e,t),e.setState(c.stateOpEnd)):e.setState(i.stateAgent)}},8722:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateBracketBegin=void 0;const n=o(1214),s=o(3396),r=o(877),i=o(8462);t.stateBracketBegin=e=>((0,s.ifDef)((0,n.scanCoeff)(e),(t=>{(0,r.startMul)(e,t,!0)})),e.setState(i.stateAgentMid))},4159:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateCharge=void 0;const n=o(1618),s=o(7823),r=o(8462);t.stateCharge=e=>{var t,o;const{pos:i,curNode:a,curBond:c}=e,d=null!==(t=e.chargeOwner)&&void 0!==t?t:!a&&c?(0,n.openNode)(e,!0):e.error("Expected node declaration before charge",{pos:i-1}),l=e.getAltFlag(),u=e.eject("varPos");return d.charge=null!==(o=(0,s.scanCharge)(e,null!=u?u:l?"LT":"RT"))&&void 0!==o?o:e.error("Invalid charge declaration",{pos:i}),e.setState(r.stateAgentMid)}},6873:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateCommentIn=void 0;const n=o(8840),s=o(2185),r=o(8462);t.stateCommentIn=e=>((0,n.addNodeItem)(e,(0,s.createComment)(e)),e.setState(r.stateAgentMid))},9189:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateCommentPre=void 0;const n=o(2185),s=o(9922);t.stateCommentPre=e=>(e.preCommPos=e.pos-1,e.preComm=(0,n.createComment)(e),e.setState(s.stateBegin))},6436:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateCustom=void 0;const n=o(8840),s=o(1059),r=o(5538),i=o(8798),a=o(8462),c=o(8299),d=o(2185),l=o(6644);t.stateCustom=e=>{var t;if("{"===e.curChar())return(0,c.openBrace)(e);const o=e.pos;e.pos=(0,l.scanMarkupEnd)(e.text,e.pos,"}")-1,"}"!==e.text[e.pos]&&e.error("Abstract element is not closed",{pos:o-1});const u=(0,d.replaceGreek)(e.subStr(o)),h=(0,n.addNodeItem)(e,null!==(t=s.ChemRadical.dict[u])&&void 0!==t?t:new r.ChemCustom(u));return e.pos++,(0,i.scanPostItem)(e,(e=>{h.n=e})),e.setState(a.stateAgentMid)}},1047:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateElement=void 0;const n=o(3759),s=o(149),r=o(1059),i=o(8840),a=o(2782);t.stateElement=e=>{var t,o;(0,n.scan)(e,(e=>e>="a"&&e<="z"));const c=e.subStr(e.elementStartPos),d=null!==(o=null!==(t=(0,s.findElement)(c))&&void 0!==t?t:r.ChemRadical.dict[c])&&void 0!==o?o:e.error("Unknown element '[Elem]'",{pos:e.elementStartPos,Elem:c}),l=(0,i.addNodeItem)(e,d);return e.addSrcMapItem(l,e.elementStartPos),e.setState(a.statePostItem)}},9578:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateFuncName=void 0;const n=o(3759),s=o(3702),r=o(3396),i=o(8462),a=o(7151),c=o(7525);t.stateFuncName=e=>{const t=e.pos;(0,n.scanTo)(e,"(")||e.error("Expected '(' after [S]",{S:"$",pos:t-1});const o=e.subStr(t);e.pos++;const{args:d,argPos:l}=(0,s.scanArgs)(e);return(0,r.ifDef)(a.funcsDict[o],(t=>t(e,d,l))),"begin"===e.agentMode?e.setState(c.stateAgentBegin):e.setState(i.stateAgentMid)}},6354:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateNodeRef=void 0;const n=o(6662),s=o(5334),r=o(149),i=o(9154),a=o(8462),c=o(2830),d=o(6382),l=(e,t,o)=>e.error("Invalid node reference '[ref]'",{ref:t,pos:o}),u=e=>e.nodes.map((e=>{var t;return null!==(t=null==e?void 0:e.index)&&void 0!==t?t:""})).join(","),h=(e,t)=>{var o;const{curBond:n}=e;if(n){n.soft=!1,n.nodes[1]=t;const s=u(n),r=null===(o=e.curAgent)||void 0===o?void 0:o.bonds.find((e=>u(e)===s));r&&r!==n?(e.chainSys.setCurNode(n.nodes[1]),(0,d.mergeBonds)(e,r,n,t)):e.chainSys.bondToRef(n)}else e.chainSys.addNode(t),e.nodesBranch.onNode(t);e.curNode=t,t.fixed=!0,e.nodesBranch.onNode(t)};t.stateNodeRef=e=>{if((0,n.isSpace)(e.curChar()))return e.setState(s.stateAgentSpace);const t=e.pos,o=(0,c.scanInt)(e);if(void 0!==o)((e,t,o)=>{const{nodes:n}=e.curAgent,s=t<0?n.length+t:t-1;(s<0||s>=n.length)&&l(e,String(t),o),h(e,n[s])})(e,o,t);else{const o=(0,i.scanId)(e);o?((e,t,o)=>{const n=e.references[t];if(n)h(e,n);else{const n=(0,r.findElement)(t);n?((e,t,o)=>{var n;const{nodes:s}=e.curAgent;h(e,null!==(n=s.find((e=>((e,t)=>1===e.items.length&&e.items[0].obj===t)(e,t))))&&void 0!==n?n:l(e,t.id,o))})(e,n,o):l(e,t,o)}})(e,o,t):l(e,e.curChar(),t)}return e.setState(a.stateAgentMid)}},5519:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateOpEnd=void 0;const n=o(2185),s=o(9922);t.stateOpEnd=e=>('"'===e.curChar()&&(e.pos++,e.curOp.commentPost=(0,n.createComment)(e)),e.curOp&&e.addSrcMapItem(e.curOp,e.eject("entityBegin")),e.setState(s.stateBegin))},2782:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.statePostItem=void 0;const n=o(5757),s=o(7823),r=o(8798),i=o(8462);t.statePostItem=e=>{var o;const a=null!==(o=(0,n.getLastItem)(e))&&void 0!==o?o:e.error("Invalid node",{});if((0,r.scanPostItem)(e,(e=>{a.n=e})))return e.setState(t.statePostItem);if("("===e.curChar()){const o=e.pos;e.pos++;const n=(0,s.scanCharge)(e);if(n&&")"===e.curChar())return a.charge=n,e.setState(t.statePostItem,1);e.pos=o}return e.setState(i.stateAgentMid)}},2132:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateUniBond=void 0;const n=o(3772),s=o(7629),r=o(4598),i=o(2386),a=o(8057),c=o(3702),d=o(8462);t.stateUniBond=e=>{const t=e.pos-1;switch(e.curChar()){case"(":{e.pos++;const{args:o,argPos:n}=(0,c.scanArgs)(e);(0,i.createUniversalBond)(e,o,n,t)}break;case"p":case"q":(0,n.createPolygonalBond)(e);break;case"m":(0,a.createMiddlePoint)(e);break;case"o":(0,s.createRingBond)(e,1);break;case"s":(0,r.createSplineBond)(e);break;default:(0,i.createUniversalBond)(e,[],[],t)}return e.setState(d.stateAgentMid)}},1240:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemAgent=void 0;const n=o(684),s=o(6728),r=o(1127);class i extends n.ChemObj{constructor(){super(),this.nodes=[],this.bonds=[],this.commands=[],this.n=new s.ChemK(1),this.part=0,this.stA=new r.StructAnalyzer(this)}setCoeff(e){this.n="number"==typeof e?new s.ChemK(e):e}addNode(e){return this.nodes.push(e),this.commands.push(e),e}addBond(e){this.bonds.push(e),this.commands.push(e)}walk(e){var t,o;if(null===(t=e.agentPre)||void 0===t||t.call(e,this),!e.isStop){for(const t of this.commands)if(t.walk(e),e.isStop)return;null===(o=e.agentPost)||void 0===o||o.call(e,this)}}}t.ChemAgent=i},7408:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemAtom=void 0;const n=o(3686);class s extends n.ChemSubObj{constructor(e,t,o,n){super(),this.n=e,this.id=t,this.mass=o;const{stable:s,epsilonMass:r}=null!=n?n:{};this.stable=void 0===s?Math.floor(this.mass)!==this.mass:s,this.epsilonMass=r}walk(e){var t;null===(t=e.atom)||void 0===t||t.call(e,this)}}t.ChemAtom=s},6517:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createBackground=t.ChemBackground=void 0;const n=o(684);class s extends n.ChemObj{constructor(e){super(),this.params=e}walk(){}}t.ChemBackground=s,t.createBackground=(e,t)=>{var o;return e.isAll||(e.nodes=null!==(o=e.nodes)&&void 0!==o?o:[],e.nodes.push(t)),new s(e)}},9064:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemBond=void 0;const n=o(1639),s=o(684),r=o(2724);class i extends s.ChemObj{constructor(){super(...arguments),this.n=1,this.nodes=[void 0,void 0],this.tx="",this.slope=0,this.isText=!1,this.w0=0,this.w1=0,this.isAuto=!1,this.soft=!1,this.style="",this.arr0=!1,this.arr1=!1,this.ext="",this.brk=!1,this.isNeg=!1,this.isCorr=!1,this.isCycle=!1}calcPt(){return this.nodes[0].pt.plus(this.dir)}other(e){if(2===this.nodes.length)return this.nodes[0]===e?this.nodes[1]:this.nodes[1]===e?this.nodes[0]:void 0}walk(e){var t;null===(t=e.bond)||void 0===t||t.call(e,this)}setHydrogen(){this.style=":",this.n=0}setCross(){this.align="x"}isCross(){return"x"===this.align}checkText(){const{dir:e}=this;this.isText=!!e&&(0,n.is0)(e.y)&&(0,n.is0)(Math.abs(e.x)-1)}linearText(){if(this.isAuto){let e=this.tx;return this.isNeg&&(e=`\`${e}`),(0,n.is0)(this.n)&&(e+="0"),e}return this.tx}isHorizontal(){const{dir:e}=this;return!!e&&!(0,n.is0)(e.x)&&(0,n.is0)(e.y)}debugText(){return 2===this.nodes.length?`${null===(o=(t=this).nodes[0])||void 0===o?void 0:o.index}(${t.soft?"~":""}${null===(s=t.dir)||void 0===s?void 0:s.polarAngleDeg().toFixed(0)}`+(1!==t.n?`*${(0,n.toa)(t.n)}`:"")+")"+`${null===(r=t.nodes[1])||void 0===r?void 0:r.index}`:`${(e=this).linearText()}${e.nodes.map((e=>null==e?void 0:e.index))}`;var e,t,o,s,r}isVisible(){return!(this.isVerticalConnection()||(0,n.is0)(this.n)&&!this.style)}isVerticalConnection(){const{dir:e,nodes:t}=this;return!(!e||2!==t.length)&&!(!t[0]||(0,r.isNodeHidden)(t[0]))&&!(!t[1]||(0,r.isNodeHidden)(t[1]))&&(0,n.is0)(e.x)&&(0,n.is0)(Math.abs(e.y)-.5)}}t.ChemBond=i},5581:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getBracketsContent=t.ChemBracketEnd=t.ChemBracketBegin=t.bracketPairs=void 0;const n=o(684),s=o(6728);t.bracketPairs={"(":")","[":"]","{{":"}}"};class r extends n.ChemObj{constructor(e){super(),this.text=e,this.nodes=[void 0,void 0]}walk(e){var t;null===(t=e.bracketBegin)||void 0===t||t.call(e,this)}}t.ChemBracketBegin=r;class i extends n.ChemObj{constructor(e,t,o){super(),this.text=e,this.begin=t,this.charge=void 0,this.n=new s.ChemK(1),this.nodes=[void 0,void 0],this.nodes[0]=o}walk(e){var t;null===(t=e.bracketEnd)||void 0===t||t.call(e,this)}get nodeIn(){return this.nodes[0]}get color(){return this.begin.color}}t.ChemBracketEnd=i,t.getBracketsContent=(e,t)=>{const{end:o}=e;let n=0;for(;n<t.length&&t[n]!==e;)n++;let s=n;for(;s<t.length&&t[s]!==o;)s++;return t.slice(n+1,s)}},3725:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createCharge=t.ChemCharge=void 0;const n=o(549),s=o(7827);class r{get isLeft(){return(0,n.isLeftCoeffA)(this.pos)}constructor(e,t,o="RT",n=!1){this.text=e,this.value=t,this.pos=o,this.isRound=n}}t.ChemCharge=r;const i=/(^|(^[-+]))\d+$/,a=/^\d+[-+]$/,c=new Set(["-","--","---"]),d=new Set(["+","++","+++"]);t.createCharge=(e,t="RT")=>{if(""===e)return;const o=e.replace("–","-").replace("−","-");if(c.has(o))return new r(o,-o.length,t);if(d.has(o))return new r(o,o.length,t);if(i.test(o))return new r(o,+o,t);if(a.test(o))return new r(o,+`${o.slice(-1)}${o.slice(0,-1)}`,t);if("+o"===o)return new r("+",1,t,!0);if("-o"===o)return new r("-",-1,t,!0);const n=s.romanNum[o];return n?new r(o.toUpperCase(),n,t):void 0}},7322:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.instChemComma=t.ChemComma=void 0;const n=o(3686);class s extends n.ChemSubObj{walk(e){var t;null===(t=e.comma)||void 0===t||t.call(e,this)}}t.ChemComma=s,t.instChemComma=new s},2524:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemComment=void 0;const n=o(3686);class s extends n.ChemSubObj{constructor(e){super(),this.text=e}walk(e){var t;null===(t=e.comment)||void 0===t||t.call(e,this)}}t.ChemComment=s},5538:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemCustom=void 0;const n=o(3686);class s extends n.ChemSubObj{constructor(e){super(),this.text=e}walk(e){var t;null===(t=e.custom)||void 0===t||t.call(e,this)}}t.ChemCustom=s},5679:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorMessage=t.ChemError=void 0;const n=o(5373);class s extends Error{constructor(e,t){super(n.Lang.tr(e,t)),this.msgId=e,this.params=t}getMessage(e){return n.Lang.tr(this.msgId,this.params,e)}}t.ChemError=s,t.getErrorMessage=(e,t)=>{if(e instanceof s){if(!t)return e.getMessage();const o=n.Lang.curLang;n.Lang.curLang=t;const s=e.getMessage(t);return n.Lang.curLang=o,s}return e.message}},830:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemExpr=void 0;const n=o(684),s=o(1240),r=o(5679),i=o(3442),a=o(6022),c=o(1043),d=o(4836),l=o(886);class u extends n.ChemObj{constructor(){super(...arguments),this.src0="",this.src="",this.entities=[]}isOk(){return!this.error}getMessage(e){const{error:t}=this;return t?(0,r.getErrorMessage)(t,e):""}walk(e){var t,o;for(const n of this.entities){if(null===(t=e.entityPre)||void 0===t||t.call(e,n),e.isStop)return;if(n.walk(e),e.isStop)return;if(null===(o=e.entityPost)||void 0===o||o.call(e,n),e.isStop)return}}getAgents(){return this.entities.filter((e=>e instanceof s.ChemAgent))}findMapItems(e){return(0,l.getSrcItemsForObject)(e,this.srcMap)}srcMapItemText(e){return this.src.slice(e.begin,e.end)}mass(e=!0){return this.getAgents().map((t=>(0,i.calcMass)(t,e)))}html(){return(0,a.makeTextFormula)(this,c.rulesHtml)}isLinear(){return(0,d.isTextFormula)(this)}static createWithError(e,t){const o=new u;return o.error=e,o.src0=t,o.src=t,o}}t.ChemExpr=u},6728:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemK=void 0;const n=o(1639);class s{constructor(e,t){"number"==typeof e?(this.num=e,this.text=""):(this.text=e,this.num=NaN),this.pos=t}isSpecified(){return!!this.text||1!==this.num&&!Number.isNaN(this.num)}isNumber(){return!Number.isNaN(this.num)}isAbstract(){return!this.isNumber()}isInt(){return this.num===~~this.num}equals(e){return"number"==typeof e&&this.isNumber()?this.num===e:"string"!=typeof e||this.isNumber()?e instanceof s&&(this.text?this.text===e.text:this.num===e.num):this.text===e}toString(){return this.isNumber()?(0,n.toa)(this.num):this.text}}t.ChemK=s,s.one=new s(1)},6839:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemMulEnd=t.ChemMul=void 0;const n=o(684);class s extends n.ChemObj{constructor(e,t,o){super(),this.n=e,this.isFirst=t,this.color=o,this.nodes=[void 0,void 0]}walk(e){var t;null===(t=e.mul)||void 0===t||t.call(e,this)}}t.ChemMul=s;class r extends n.ChemObj{constructor(e){super(),this.begin=e}walk(e){var t;null===(t=e.mulEnd)||void 0===t||t.call(e,this)}}t.ChemMulEnd=r},1789:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemNode=void 0;const n=o(7757),s=o(684);class r extends s.ChemObj{constructor(e){super(),this.charge=void 0,this.items=[],this.index=-1,this.chain=0,this.subChain=0,this.autoMode=!1,this.bonds=new Set,this.fixed=!1,this.bCenter=!1,this.pt=(null!=e?e:n.Point.zero).clone()}walk(e){var t,o;if(null===(t=e.nodePre)||void 0===t||t.call(e,this),!e.isStop){for(const t of this.items)if(t.walk(e),e.isStop)return;null===(o=e.nodePost)||void 0===o||o.call(e,this)}}addBond(e){this.bonds.add(e)}getCenterItem(){let e=0,t=0,o=null;return this.walk({itemPre(){e=0},comment(){e=1},custom(){e=2},radical(){e=4},atom(t){switch(t.id){case"H":case"D":case"T":e=3;break;case"C":e=5;break;default:e=4}},itemPost(n){n.bCenter&&(e=6),e>t&&(t=e,o=n)}}),o}}t.ChemNode=r},6986:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemNodeItem=void 0;const n=o(684),s=o(6728);class r extends n.ChemObj{constructor(e,t=s.ChemK.one){super(),this.obj=e,this.n=t}walk(e){var t,o;null===(t=e.itemPre)||void 0===t||t.call(e,this),e.isStop||this.obj.walk(e),e.isStop||null===(o=e.itemPost)||void 0===o||o.call(e,this)}}t.ChemNodeItem=r},684:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemObj=void 0,t.ChemObj=class{walkExt(e){return this.walk(e),e}}},286:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemOp=void 0;const n=o(684);class s extends n.ChemObj{constructor(e,t,o){super(),this.srcText=e,this.dstText=t,this.div=o}walk(e){var t;null===(t=e.operation)||void 0===t||t.call(e,this)}}t.ChemOp=s},1059:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemRadical=void 0;const n=o(3686),s=o(283);let r=null;const i=[[["Me"],[["C",1],["H",3]]],[["Et"],[["C",2],["H",5]]],[["Ph"],[["C",6],["H",5]]],[["Pr","n-Pr","Pr-n"],[["C",3],["H",7]]],[["iPr","i-Pr","Pr-i"],[["C",3],["H",7]]],[["Bu","nBu","n-Bu","Bu-n"],[["C",4],["H",9]]],[["t-Bu","Bu-t","tBu"],[["C",4],["H",9]]],[["i-Bu","Bu-i","iBu"],[["C",4],["H",9]]],[["s-Bu","Bu-s","sBu"],[["C",4],["H",9]]],[["Ac"],[["C",1],["H",3],["C",1],["O",1]]],[["CoA"],[["C",21],["H",35],["N",7],["O",16],["P",3]]],[["Tf"],[["C",1],["F",3],["S",1],["O",2]]]];class a extends n.ChemSubObj{constructor(e,t){super(),this.label=e,this.items=t}walk(e){var t;null===(t=e.radical)||void 0===t||t.call(e,this)}static get dict(){if(r)return r;const e={};return i.forEach((t=>{const[o,n]=t,r=new s.ElemList;n.forEach((([e,t])=>r.addElemById(e,t))),o.forEach((t=>{e[t]=new a(t,r)}))})),r=e,e}}t.ChemRadical=a},3686:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemSubObj=void 0;const n=o(684);class s extends n.ChemObj{}t.ChemSubObj=s},283:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ElemList=void 0;const n=o(1066),s=o(4909),r=o(149);t.ElemList=class{constructor(){this.list=[],this.charge=0}toString(){let e=this.list.reduce(((e,t)=>`${e}${t}`),"");const t=(0,s.makeChargeText)(this.charge);return""!==t&&(e+=`^${t}`),e}findAtom(e){return e?this.list.find((t=>t.elem===e)):void 0}findById(e){return this.findAtom((0,r.findElement)(e))}findCustom(e){return this.list.find((t=>!t.elem&&t.id===e))}findKey(e){return this.list.find((t=>t.key===e))}findRec(e){if(e)return e.elem?this.findAtom(e.elem):this.findCustom(e.id)}addElemRec(e){const t=this.findRec(e);return t?t.n+=e.n:this.list.push(e),this}addElemById(e,t=1){return this.addElemRec(new n.ElemRecord(e,t,!1))}addAtom(e,t=1){return this.addElemRec(new n.ElemRecord(e,t))}addElem(e,t=1){return this.addElemRec(new n.ElemRecord(e,t))}addCustom(e,t=1){return this.addElemRec(new n.ElemRecord(e,t,!0))}addList(e){return e.list.forEach((e=>this.addElem(e))),this.charge+=e.charge,this}addRadical(e){return e?this.addList(e.items):this}scale(e){1!==e&&(this.charge*=e,this.list.forEach((t=>{t.n*=e})))}sortByHill(){return this.list.sort(((e,t)=>{const o=e.id,n=t.id;return e.elem||t.elem?e.elem?t.elem?o===n?0:"C"===o?-1:"C"===n?1:"H"===o?-1:"H"===n?1:o.localeCompare(n):-1:1:o.localeCompare(n)})),this}}},1066:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ElemRecord=void 0;const n=o(7408),s=o(149),r=o(4572);t.ElemRecord=class{constructor(e,t=1,o=!1){"string"==typeof e?(this.id=e,this.elem=o?void 0:(0,s.findElement)(e),this.n=t):e instanceof n.ChemAtom?(this.id=e.id,this.elem=e,this.n=t):(this.id=e.id,this.elem=e.elem,this.n=t*e.n)}get key(){return this.elem?this.id:`{${this.id}}`}toString(){return`${this.key}${(0,r.k2s)(this.n)}`}}},149:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PeriodicTable=t.findElement=void 0;const n=o(7408);let s=null,r=null,i=null,a=null;t.findElement=e=>t.PeriodicTable.dict[e]||t.PeriodicTable.isotopesDict[e],t.PeriodicTable=Object.freeze({get elements(){if(s)return s;const e=Object.freeze(Object.keys(c).map(((e,t)=>new n.ChemAtom(t+1,e,c[e][0],{epsilonMass:c[e][1]}))));return s=e,e},get dict(){if(r)return r;const e={};this.elements.forEach((t=>{e[t.id]=t}));const t=Object.freeze(e);return r=t,t},get isotopes(){if(i)return i;const e=Object.freeze(d.map((([e,t,o,s])=>new n.ChemAtom(e,t,o,{stable:s}))));return i=e,e},get isotopesDict(){if(a)return a;const e={};this.isotopes.forEach((t=>{e[t.id]=t}));const t=Object.freeze(e);return a=t,t}});const c={H:[1.008,2e-4],He:[4.0026,1e-4],Li:[6.94,.06],Be:[9.0122,1e-4],B:[10.81,.02],C:[12.011,.002],N:[14.007,.001],O:[15.999,.001],F:[18.998,.001],Ne:[20.18,.001],Na:[22.99,.001],Mg:[24.305,.002],Al:[26.982,.001],Si:[28.085,.001],P:[30.974,.001],S:[32.06,.02],Cl:[35.45,.01],Ar:[39.95,.16],K:[39.098,.001],Ca:[40.078,.004],Sc:[44.956,.001],Ti:[47.867,.001],V:[50.942,.001],Cr:[51.996,.001],Mn:[54.938,.001],Fe:[55.845,.002],Co:[58.933,.001],Ni:[58.693,.001],Cu:[63.546,.003],Zn:[65.38,.02],Ga:[69.723,.001],Ge:[72.63,.008],As:[74.922,.001],Se:[78.971,.008],Br:[79.904,.003],Kr:[83.798,.002],Rb:[85.468,.001],Sr:[87.62,.01],Y:[88.906,.001],Zr:[91.224,.002],Nb:[92.906,.001],Mo:[95.95,.01],Tc:[97],Ru:[101.07,.02],Rh:[102.91,.01],Pd:[106.42,.01],Ag:[107.87,.01],Cd:[112.41,.01],In:[114.82,.01],Sn:[118.71,.01],Sb:[121.76,.01],Te:[127.6,.03],I:[126.9,.01],Xe:[131.29,.01],Cs:[132.91,.01],Ba:[137.33,.01],La:[138.91,.01],Ce:[140.12,.01],Pr:[140.91,.01],Nd:[144.24,.01],Pm:[145],Sm:[150.36,.02],Eu:[151.96,.01],Gd:[157.25,.03],Tb:[158.93,.01],Dy:[162.5,.01],Ho:[164.93,.01],Er:[167.26,.01],Tm:[168.93,.01],Yb:[173.05,.02],Lu:[174.97,.01],Hf:[178.49,.01],Ta:[180.95,.01],W:[183.84,.01],Re:[186.21,.01],Os:[190.23,.03],Ir:[192.22,.01],Pt:[195.08,.02],Au:[196.97,.01],Hg:[200.59,.01],Tl:[204.38,.01],Pb:[207.2,1.1],Bi:[208.98,.01],Po:[209],At:[210],Rn:[222],Fr:[223],Ra:[226],Ac:[227],Th:[232.04,.01],Pa:[231.04,.01],U:[238.03,.01],Np:[237],Pu:[244],Am:[243],Cm:[247],Bk:[247],Cf:[251],Es:[252],Fm:[257],Md:[258],No:[259],Lr:[262],Rf:[267],Db:[270],Sg:[269],Bh:[270],Hs:[270],Mt:[278],Ds:[281],Rg:[281],Cn:[285],Nh:[286],Fl:[289],Mc:[289],Lv:[293],Ts:[294],Og:[294]},d=[[1,"D",2.014101777844,!0],[1,"T",3.01604928132,!1]]},1127:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StructAnalyzer=t.bondSideSign=t.calcBondSign=t.getCycleCenter=void 0;const n=o(5918),s=o(7788),r=o(3396),i=o(7757);t.getCycleCenter=e=>{if(e.center)return e.center;const t=e.nodes.length,o=0===t?new i.Point:e.nodes.reduce(((e,t)=>e.iadd(t.pt)),new i.Point).times(1/t);return e.center=o,o};const a=(e,t)=>{const o=e.x*t.y-e.y*t.x;return 0===o?0:o<0?-1:1};t.calcBondSign=(e,o)=>{var n,s;const r=null===(n=o.nodes[0])||void 0===n?void 0:n.pt,i=null===(s=o.nodes[1])||void 0===s?void 0:s.pt;if(!r||!i)return 0;const c=(0,t.getCycleCenter)(e);return a(i.minus(r),c.minus(r))},t.bondSideSign=(e,t)=>{const o=e.nodes[t];if(!o||!e.dir)return 0;const n=Array.from(o.bonds).filter((t=>t!==e&&t.isVisible()&&t.dir));return 1!==n.length?0:a(e.dir,n[0].dir)},t.StructAnalyzer=class{constructor(e){this.agent=e,this.isInit=!1,this.cycles=[],this.bondsMap={}}analyze(){if(this.isInit)return;this.isInit=!0;const{nodes:e,bonds:t}=this.agent;if(t.length<3)return;const o=2*e.length,r=e.map((e=>({node:e,order:o}))),i=(e,t)=>{const o=[e],s={nodes:[],bonds:[]};let i;const a=new Set;for(;;){const e=o.shift();if(!e)break;a.add(e.node),e.node.bonds.forEach((n=>{const a=n.other(e.node);if(a){const c=a.index,d=r[c];t.has(c)&&(e.order+1===d.order?(o.push(d),s.bonds.push(n)):e.order===d.order&&(i=n))}}))}return i&&s.bonds.push(i),s.nodes=Array.from(a),s.nodes.sort(((e,t)=>(0,n.cmp)(e.index,t.index))),s.bonds.sort(((e,t)=>(0,n.cmp)(e.index,t.index))),s},a=(e,t)=>{if(t.order>e.order)throw new Error("Invalid order");const o=[e];t.order===e.order&&o.push(t);const n=new Set;for(;;){const e=o.shift();if(!e)break;const t=e.node.index;if(n.has(t))return i(e,n);n.add(t),e.node.bonds.forEach((t=>{const n=t.other(e.node);if(n){const t=r[n.index];t.order+1===e.order&&o.push(t)}}))}},c=e=>{if(e.order!==o)return;e.order=0;const t=[e],n=new Set;for(;;){const e=t.shift();if(!e)break;e.node.bonds.forEach((s=>{const i=s.other(e.node);if(i){const c=r[i.index],d=c.order;if(d===o)c.order=e.order+1,t.push(c);else if(d>=e.order&&!n.has(s.index)){n.add(s.index);const t=a(c,e);t&&this.cycles.push(t)}}}))}};r.forEach((e=>c(e))),this.cycles.forEach((e=>{e.bonds.forEach((t=>{const{index:o}=t;"number"==typeof o&&(0,s.getItemForced)(this.bondsMap,o,[]).push(e)}))}))}findCyclesForBond(e){var t;return this.analyze(),null!==(t=(0,r.ifDef)(e.index,(e=>this.bondsMap[e])))&&void 0!==t?t:[]}calcBondSign(e){const o=this.findCyclesForBond(e)[0];if(o)return(0,t.calcBondSign)(o,e);const n=(0,t.bondSideSign)(e,1),s=(0,t.bondSideSign)(e,0);return-1===n&&-1!==s||0===n&&1===s?-1:1===n&&1!==s||0===n&&-1===s?1:0}}},7519:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isEmptyNode=void 0,t.isEmptyNode=e=>!e.walkExt({isStop:!1,atom(){this.isStop=!0},radical(){this.isStop=!0},custom(e){this.isStop=!!e.text},comment(e){this.isStop=!!e.text}}).isStop},2724:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isNodeHidden=void 0;const n=o(7519);t.isNodeHidden=e=>e.autoMode||(0,n.isEmptyNode)(e)},4722:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isTextBracketsCached=t.isTextBrackets=void 0;const n=o(5581),s=o(4836);t.isTextBrackets=(e,t)=>!(0,n.getBracketsContent)(e,t).find((e=>!(0,s.isTextFormula)(e))),t.isTextBracketsCached=(e,o)=>{if(void 0!==e.isText)return e.isText;const n=(0,t.isTextBrackets)(e,o);return e.isText=n,n}},4572:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.k2s=void 0;const n=o(1639);t.k2s=e=>1===e?"":(0,n.toa)(e)},4909:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeChargeText=void 0;const n=o(1639);t.makeChargeText=e=>{if((0,n.is0)(e))return"";const t=Math.abs(e);let o=1===t?"":(0,n.toa)(t);return o+=e<0?"-":"+",o}},4736:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemImgProps=void 0;const n=o(9512);t.ChemImgProps=class{constructor(e,t=0,o=0,n=0){this.styles={},this.thickWidth=0,this.chiralWidth=0,this.lineSpace2=0,this.lineSpace2x=0,this.lineSpace3=0,this.subKY=.5,this.bracketSubKY=.7,this.supKY=.5,this.bracketSupKY=.7,this.hatch=0,this.dash=0,this.arrowL=0,this.arrowD=0,this.opSpace=0,this.agentKSpace=0,this.mulChar="·",this.mulRadius=.1,this.kw=40,this.flDblAlign=!0,this.nodeMargin=-1,this.bracketWidth=0,this.bracketSpace=0,this.useTextBrackets=!0,this.electronDotD=0,this.stdStyle=e,this.stdStyle.style.fill||(this.stdStyle.style.fill="black"),this.line=t,this.horizLine=o,this.lineWidth=n}init(){const e=this;e.line=e.line||1.6*(0,n.getFontHeight)(e.stdStyle.font.getFontFace());const{line:t}=e;e.lineWidth=e.lineWidth||Math.ceil(t/e.kw);const{lineWidth:o}=e;e.horizLine=e.horizLine||e.stdStyle.font.getTextWidth("+"),e.thickWidth=e.thickWidth||4*o,e.chiralWidth=e.chiralWidth||5*o,e.hatch=e.hatch||2*o,e.dash=e.dash||3*o,e.lineSpace2=e.lineSpace2||2*o,e.lineSpace2x=e.lineSpace2x||3*o,e.lineSpace3=e.lineSpace3||2*o,e.arrowL=e.arrowL||t/5,e.arrowD=e.arrowD||t/9,e.opSpace=e.opSpace||t/4,e.agentKSpace=e.agentKSpace||2*o,e.bracketWidth=e.bracketWidth||4*o,e.bracketSpace=e.bracketSpace||2*o,e.electronDotD=e.electronDotD||3*o,e.nodeMargin<0&&(e.nodeMargin=e.lineWidth||1)}getStyle(e){return this.styles[e]||this.stdStyle}getStyleColored(e,t){const o=this.getStyle(e);return t&&o.style.fill!==t?Object.assign(Object.assign({},o),{style:Object.assign(Object.assign({},o.style),{fill:t})}):o}static getIndexStyles(){return["atomNumber","bracketCharge","bracketCount","itemCount","itemMass","nodeCharge","oxidationState"]}}},1762:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlCanvasLocalFont=void 0,t.HtmlCanvasLocalFont=class{constructor(e,t){this.context=e,this.props=t}getFontFace(){return this.props.fontFace}getTextWidth(e){return this.context.font=this.props.canvasFont,this.context.measureText(e).width}drawLine(e,t,o,n){this.context.font=this.props.canvasFont,this.context.fillStyle=n.fill,this.context.fillText(o,t.x,t.y)}}},3983:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlCanvasSurface=void 0;const n=o(7757),s=o(8032),r=o(712),i=o(1762),a=o(4712);t.HtmlCanvasSurface=class{getCanvas(){return this.domElement}getCtx(){return this.htmlContext}constructor(e,t){this.fontCache={},this.domElement=e;const o=e.getContext("2d");if(!o)throw Error("2d context is not supported");this.htmlContext=o,this.size=new n.Point,this.fontPropsCache=null!=t?t:new r.WebFontCache}getFont(e){const t=this.fontPropsCache.getWebProps(e);let o=this.fontCache[t.hash];return o||(o=new i.HtmlCanvasLocalFont(this.getCtx(),t),this.fontCache[t.hash]=o,o)}applyStyle(e,t){var o,s,r;const{htmlContext:i}=this;if(t)if(t instanceof n.Point)i.translate(t.x,t.y);else if(t instanceof a.Matrix2x3){const{a:e,b:o,c:n,d:s,e:r,f:a}=t;i.transform(e,o,n,s,r,a)}i.beginPath(),i.fillStyle=null!==(o=e.fill)&&void 0!==o?o:"transparent",i.strokeStyle=null!==(s=e.stroke)&&void 0!==s?s:"transparent",i.lineWidth=null!==(r=e.strokeWidth)&&void 0!==r?r:1}drawPath(e,t,o){const{htmlContext:n}=this;n.save(),this.applyStyle(o,e);const r={onM(e){n.moveTo(e.x,e.y)},onL(e){n.lineTo(e.x,e.y)},onQ(e,t){n.quadraticCurveTo(e.x,e.y,t.x,t.y)},onC(e,t,o){n.bezierCurveTo(e.x,e.y,t.x,t.y,o.x,o.y)},onA(e,t,o,s,r){n.lineTo(r.x,r.y)}};(0,s.tracePath)(t,r),o.fill&&n.fill(),o.stroke&&n.stroke(),n.restore()}drawEllipse(e,t,o,n){const{htmlContext:s}=this;s.save(),this.applyStyle(n,e),s.ellipse(t.x,t.y,o.x,o.y,0,0,2*Math.PI),n.fill&&s.fill(),n.stroke&&s.stroke(),s.restore()}setSize(e){this.size=e,this.domElement.width=e.x,this.domElement.height=e.y}}},9601:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SvgWebLocalFont=void 0;const n=o(7844),s=o(4886),r=o(3268),i=o(1639),a=o(2256),c=o(1032);class d{constructor(e){this.webFontProps=e,this.canvas=document.createElement("canvas")}createScaled(e){const t=Object.assign({},this.webFontProps);return t.cssHeight*=e,t.fontFace=(0,a.scaleFontFace)(t.fontFace,e),t.canvasFont=(0,c.makeCanvasFontProp)(t),new d(t)}getFontFace(){return this.webFontProps.fontFace}getTextWidth(e){const t=this.canvas.getContext("2d");if(!t)throw Error("Canvas don't supported");return t.font=this.webFontProps.canvasFont,t.measureText(e).width}drawLine(e,t,o,a){if(!(e instanceof n.SvgWebSurface))throw new Error("Expected SvgWebSurface");{const{fontFace:n,cssHeight:c,bold:d,italic:l}=this.webFontProps,u={x:(0,i.toa)(t.x),y:(0,i.toa)(t.y),fill:a.fill,"font-family":n.fontFamily,"font-size":`${c}px`};d&&(u["font-weight"]="bold"),l&&(u["font-style"]="italic");const h=`${(0,s.drawTag)("text",u)}${(0,r.escapeXml)(o)}</text>`;e.addFigure(h)}}}t.SvgWebLocalFont=d},7844:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SvgWebSurface=void 0;const n=o(7892),s=o(712),r=o(9601);class i extends n.SvgSurface{constructor(e){super(),this.fontCache={},this.fontPropsCache=null!=e?e:new s.WebFontCache}getFont(e){const t=this.fontPropsCache.getWebProps(e),o=this.fontCache[t.hash];if(o)return o;const n=new r.SvgWebLocalFont(t);return this.fontCache[t.hash]=n,n}}t.SvgWebSurface=i},712:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WebFontCache=void 0;const n=o(6684),s=o(1032);t.WebFontCache=class{constructor(){this.cache={}}getWebProps(e){const t=(0,n.createLocalFontHash)(e);let o=this.cache[t];return o||(o=(0,s.makeWebFontProps)(e),this.cache[t]=o,o)}}},1032:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeWebFontProps=t.makeCanvasFontProp=void 0;const n=o(9462),s=o(5604),r=o(7147),i=o(6684);t.makeCanvasFontProp=e=>{const{fontFamily:t,cssHeight:o,bold:n,italic:s}=e,r=[`${o}px`,t];return n&&r.unshift("bold"),s&&r.unshift("italic"),r.join(" ")},t.makeWebFontProps=e=>{var o,a,c,d;const l=e.family,u=(0,n.webFontWeight)(e.weight),h="italic"===e.style||"oblique"===e.style,p=Math.round(e.height),m=Math.round(p/2),f=p+2*m,g=Math.round(p/2),v=m+p,b=(0,s.isBold)(u),y=(0,t.makeCanvasFontProp)({fontFamily:l,cssHeight:p,bold:b,italic:h}),C=document.createElement("canvas");C.height=f,C.width=g;const w=C.getContext("2d");if(!w)throw Error("Canvas is not supported");w.fillStyle="#FFF",w.textBaseline="alphabetic",w.font=y;const x=w.measureText("[lj"),P=w.measureText("Z"),M=w.measureText("z"),B=(e,t)=>{w.clearRect(0,0,g,f),w.fillText(e,0,v);const o=w.getImageData(0,0,g,f);if(!o)throw Error("Cant access to image data");return(0,r.traceBox)(o.data,g,f,t)||(t?0:f-1)},k=null!==(o=P.actualBoundingBoxAscent)&&void 0!==o?o:v-B("Z",!0),S=null!==(a=M.actualBoundingBoxAscent)&&void 0!==a?a:v-B("z",!0),_=null!==(c=x.actualBoundingBoxAscent)&&void 0!==c?c:v-B("l",!0),O=x.actualBoundingBoxDescent?-x.actualBoundingBoxDescent:v-B("j",!1),N=[0,0,0,0];return N[1]=x.fontBoundingBoxDescent?-x.fontBoundingBoxDescent:O,N[3]=null!==(d=x.fontBoundingBoxAscent)&&void 0!==d?d:Math.max(k,_),C.remove(),{hash:(0,i.createLocalFontHash)(e),fontFace:{fontFamily:l,fontWeight:u,fontStyle:h?"italic":"normal",xHeight:k,capHeight:S,descent:O,ascent:_,bbox:N},canvasFont:y,fontFamily:l,cssHeight:p,italic:h,bold:b}}},7147:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.traceBox=void 0,t.traceBox=(e,t,o,n)=>{const[s,r,i]=n?[0,o,1]:[o-1,-1,-1];let a=null;for(let o=0;o<t;o++)for(let c=s;c!==r;c+=i)if(e[4*(c*t+o)+3]>128){if(null!==a)if(n){if(c>a)return a}else if(c<a)return a;a=c;break}return a}},9462:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.webFontWeight=void 0;const n=o(5604);t.webFontWeight=e=>{if(!e||"all"===e)return"normal";const t=e.split(",")[0].trim();return"normal"===t||"bold"===t?t:String((0,n.fontWeightValue)(t))}},7737:(e,t,o)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.createBrowserChemImgProps=void 0;const s=o(4736),r=o(1043),i=o(9181);let a;const c="undefined"==typeof window?void 0:window.document,d=(null===(n=null==c?void 0:c.defaultView)||void 0===n?void 0:n.getComputedStyle)||(e=>e.currentStyle);t.createBrowserChemImgProps=(e,t)=>{const o=document.createElement("span"),n=e=>{o.innerHTML=e;const n="<"===e[0]?o.firstChild:o;if(!(n instanceof Element))return;const s=d(n);if(!s)return;const r={family:s.fontFamily,height:+s.fontSize.slice(0,-2),weight:s.fontWeight,style:s.fontStyle,stretch:s.fontStretch};return{font:t.getFont(r),style:{fill:s.color}}};try{e.appendChild(o);const t=n("A");if(!t)throw Error("Can't access to CSS properties");const c=new s.ChemImgProps(t);return a=a||(0,i.createRulesList)(r.rulesHtml),a.forEach((([e,t])=>{const o=n(t);o&&(c.styles[e]=o)})),c.init(),c}finally{o.remove()}}},5477:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FigBSpline=void 0;const n=o(3945),s=o(7757),r=o(4984);class i extends r.Figure{constructor(e,t,o,n){super(),this.points=e,this.style=t,this.segmentLength=o,this.bDashed=n}update(){var e;this.bounds=null!==(e=this.points.slice(1,-2).reduce(((e,t)=>(0,n.updateRect)(t,e)),void 0))&&void 0!==e?e:new n.Rect}draw(e,t){const o=[],{points:n}=this,r=n.length-3;if(r<1)return;const i=n[1].equals(n[r]);let a=0;const c=[0];for(let e=1;e<r;e++){const t=n[e].dist(n[e+1]);a+=t,c[e]=t}let d=Math.floor(a/this.segmentLength+.5);this.bDashed&&(1&d?i&&d++:i||d++);const l=a/d;let u=0,h=0,p=0,m=1,f=s.Point.zero,g=s.Point.zero,v=s.Point.zero,b=s.Point.zero,y=0;for(;;u++){if(m!==p){if(m>=r)break;p=m,y=1/c[p],f=n[p].times(3),f.isub(n[p-1]),f.iadd(n[p+1].times(-3)),f.iadd(n[p+2]),f.scale(1/6),g=n[p].times(-2),g.iadd(n[p-1]).iadd(n[p+1]).scale(.5),v=n[p+1].minus(n[p-1]).scale(.5),b=n[p].times(4),b.iadd(n[p-1]).iadd(n[p+1]).scale(1/6)}const e=h*y,t=f.times(e).iadd(g).scale(e).iadd(v).scale(e).iadd(b);for(o.push({cmd:this.bDashed&&1&u||0===u?"M":"L",pt:t}),h+=l;h>=c[m];)h-=c[m],m++}i?o.push(this.bDashed?{cmd:"L",pt:o[0].pt}:{cmd:"Z"}):o.push({cmd:"L",pt:n[m]}),t.drawPath(e.plus(this.org),o,this.style)}static extendsPoints(e,t){const o=e.length;if(o<3)return;const n=e[0],s=e[1],r=e[o-1],i=e[o-2];if(t){const t=[...e];let o=r;return n.equals(r)?o=i:t.push(n),t.push(s),t.push(e[2]),t.unshift(o),t}const a=s.minus(n),c=r.minus(i),d=r.plus(c);return[n.minus(a),...e,d,d.plus(c)]}}t.FigBSpline=i},7024:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FigEllipse=void 0;const n=o(3945),s=o(4984);class r extends s.Figure{constructor(e,t,o){super(),this.radius=t,this.style=o,this.org=e,this.bounds=new n.Rect(t.neg(),t)}update(){}draw(e,t){t.drawEllipse(e,this.org,this.radius,this.style)}}t.FigEllipse=r},9447:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FigFrame=void 0;const n=o(3945),s=o(4984);class r extends s.Figure{constructor(){super(...arguments),this.figures=[]}addFigure(e,t){this.figures.push(e),t&&this.updateFigure(e)}insertFigure(e,t,o){this.figures.splice(e,0,t),o&&this.updateFigure(t)}updateFigure(e){this.bounds.unite(e.getRelativeBounds())}update(){var e;this.bounds=null!==(e=this.figures.reduce(((e,t)=>{const o=t.getRelativeBounds();return e?(e.unite(o),e):o}),void 0))&&void 0!==e?e:new n.Rect}draw(e,t){const o=e.plus(this.org);this.figures.forEach((e=>e.draw(o,t)))}}t.FigFrame=r},3470:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeHashTrapezoidPath=t.FigHashTrapezoid=void 0;const n=o(1639),s=o(3945),r=o(7757),i=o(4984);class a extends i.Figure{constructor(e,t,o,n,s,r,i){super(),this.a=e,this.aWidth=t,this.b=o,this.bWidth=n,this.color=s,this.lineWidth=r,this.hatch=i}update(){const{a:e,aWidth:t,b:o,bWidth:n}=this,{dL:r,dR:i}=c(e,o),{aL:a,aR:l,bL:u,bR:h}=d(e,t,o,n,r,i);this.bounds=new s.Rect(a,l),this.bounds.updatePoint(u),this.bounds.updatePoint(h)}draw(e,o){const{a:n,b:s,aWidth:r,bWidth:i,color:a,lineWidth:c,hatch:d}=this,{segs:l,style:u}=(0,t.makeHashTrapezoidPath)(n,r,s,i,c,d,a);l.length>0&&o.drawPath(this.org.plus(e),l,u)}}t.FigHashTrapezoid=a;const c=(e,t)=>{const o=t.minus(e),s=o.length(),i=(0,n.is0)(s)?r.Point.zero:o.times(1/s),a=i.transpon(!0),c=i.transpon();return{dir:o,dirLen:s,dir1:i,dL:a,dR:c}},d=(e,t,o,n,s,r)=>{const i=t/2,a=n/2;return{aL:e.plus(s.times(i)),aR:e.plus(r.times(i)),bL:o.plus(s.times(a)),bR:o.plus(r.times(a))}};t.makeHashTrapezoidPath=(e,t,o,n,s,r,i)=>{const a=[],d={fill:i},l=t/2,u=n/2-l,{dir:h,dir1:p,dirLen:m,dL:f,dR:g}=c(e,o);if(m>=s){const t=m-s,o=s+r,n=Math.floor(t/o),i=p.times(s);for(let t=0;t<=n;t++){const o=t/n,s=e.plus(h.times(o)),r=s.plus(i),c=l+t*u/n,d=l+(t+1)*u/n,p=s.plus(f.times(c)),m=s.plus(g.times(c)),v=r.plus(f.times(d)),b=r.plus(g.times(d));a.push({cmd:"M",pt:p}),a.push({cmd:"L",pt:v}),a.push({cmd:"L",pt:b}),a.push({cmd:"L",pt:m})}}return{segs:a,style:d}}},3703:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createLine=t.FigPath=void 0;const n=o(3396),s=o(3945),r=o(8032),i=o(4984);class a extends i.Figure{constructor(e,t){super(),this.segs=e,this.style=t}update(){let e;(0,r.tracePath)(this.segs,{onM(t){e=(0,s.updateRect)(t,e)},onL(t){e=(0,s.updateRect)(t,e)},onC(t,o,n){e=(0,s.updateRect)(n,e),e.updatePoint(t),e.updatePoint(o)},onQ(t,o){e=(0,s.updateRect)(o,e),e.updatePoint(t)},onA(t,o,n,r,i){e=(0,s.updateRect)(i,e)}}),this.bounds=null!=e?e:new s.Rect,(0,n.ifDef)(this.style.strokeWidth,(e=>{this.bounds.grow(e/2)}))}draw(e,t){t.drawPath(e.plus(this.org),this.segs,this.style)}}t.FigPath=a,t.createLine=(e,t,o)=>new a([{cmd:"M",pt:e},{cmd:"L",pt:t}],o)},8550:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FigRect=void 0;const n=o(3428),s=o(4984);class r extends s.Figure{constructor(e,t,o){super(),this.style=t,this.bounds=e.clone(),this.radius=o}update(){}draw(e,t){(0,n.drawRect)(t,e.plus(this.org),this.bounds,this.style,this.radius)}}t.FigRect=r},4127:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FigText=void 0;const n=o(4984),s=o(9512);class r extends n.Figure{constructor(e,t,o){super(),this.text=e,this.font=t,this.style=o;const n=t.getFontFace(),r=(0,s.getFontHeight)(n),i=(0,s.getBaseline)(n);this.bounds.A.y=-i,this.bounds.B.y=r-i,this.bounds.B.x=t.getTextWidth(e)}update(){}draw(e,t){this.font.drawLine(t,e.plus(this.org),this.text,this.style)}}t.FigText=r},4984:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Figure=void 0;const n=o(7757),s=o(3945);t.Figure=class{constructor(){this.bounds=new s.Rect,this.org=new n.Point}getRelativeBounds(){const e=this.bounds.clone();return e.move(this.org),e}}},3428:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawRect=void 0,t.drawRect=(e,t,o,n,s)=>{if(e.drawRect)e.drawRect(t,o,n,s);else{const s=[{cmd:"M",pt:o.A},{cmd:"H",x:o.B.x},{cmd:"V",y:o.B.y},{cmd:"H",x:o.A.x},{cmd:"Z"}];e.drawPath(t,s,n)}}},8704:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderTopFrame=void 0,t.renderTopFrame=(e,t)=>{t.setSize(e.bounds.size),e.draw(e.bounds.A.neg(),t)}},3973:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.closeBrace=t.openBrace=void 0;const n=o(3945),s=o(7757),r=o(8032);t.openBrace={draw:e=>i(e,d,c,a,3,11)},t.closeBrace={draw:e=>i(e,h,u,l,11,3)};const i=(e,t,o,i,a,c)=>{const d=[],l=t.segs[0].pt,u=t.segs[t.segs.length-2].pt;if(l.y!==u.y)return d;const h=o.segs[a].pt,p=o.segs[a+1].pt;if(h.y!==p.y)return d;const m=o.segs[c].pt,f=i.segs[0].pt,g=new n.Rect,v=(e,t,o,n)=>{const s=e=>{const t=e.plus(n);return t.isZero()?(g.A.setPt(t),g.B.setPt(t)):(g.A.mini(t),g.B.maxi(t)),t};let r=t;for(;r!==o;){r<0?r=e.length-1:r===e.length&&(r=0);const t=e[r];switch(r+=1,t.cmd){case"M":d.push({cmd:0===d.length?"M":"L",pt:s(t.pt)});break;case"L":d.push({cmd:"L",pt:s(t.pt)});break;case"Q":d.push({cmd:"Q",pt:s(t.pt),cp:s(t.cp)});break;case"C":d.push({cmd:"C",pt:s(t.pt),cp1:s(t.cp1),cp2:s(t.cp2)})}}};v(t.segs,0,t.segs.length-1,new s.Point(h.x-l.x,0)),v(o.segs,a+1,c,new s.Point(0,t.height)),v(i.segs,0,i.segs.length-1,new s.Point(m.x-f.x,t.height+o.height)),v(o.segs,c+1,a,new s.Point(0,t.height));const b=e.width/g.width,y=e.height/g.height,C=e=>{e.set((e.x-g.left)*b,e.y*y)};return(0,r.tracePath)(d,{onM(e){C(e)},onL(e){C(e)},onC(e,t,o){C(e),C(t),C(o)},onQ(e,t){C(e),C(t)},onA(){throw new Error("Function not implemented.")}}),d.push({cmd:"Z"}),d},a={width:769,height:2545,segs:[{cmd:"M",pt:new s.Point(0,0)},{cmd:"L",pt:new s.Point(0,801)},{cmd:"Q",pt:new s.Point(177.5,2052.5),cp:new s.Point(0,1632)},{cmd:"Q",pt:new s.Point(769,2545),cp:new s.Point(355,2473)},{cmd:"L",pt:new s.Point(769,2450)},{cmd:"Q",pt:new s.Point(343,1986),cp:new s.Point(476,2381)},{cmd:"Q",pt:new s.Point(210,767),cp:new s.Point(210,1591)},{cmd:"L",pt:new s.Point(210,0)},{cmd:"Z"}]},c={width:637,height:4687,segs:[{cmd:"M",pt:new s.Point(209,2331)},{cmd:"Q",pt:new s.Point(485.5,2020),cp:new s.Point(350,2271)},{cmd:"Q",pt:new s.Point(637,1185),cp:new s.Point(621,1769)},{cmd:"L",pt:new s.Point(637,0)},{cmd:"L",pt:new s.Point(427,0)},{cmd:"L",pt:new s.Point(427,1359)},{cmd:"Q",pt:new s.Point(315,2041),cp:new s.Point(427,1811)},{cmd:"Q",pt:new s.Point(0,2279),cp:new s.Point(203,2271)},{cmd:"L",pt:new s.Point(0,2399)},{cmd:"Q",pt:new s.Point(313,2638),cp:new s.Point(199,2407)},{cmd:"Q",pt:new s.Point(427,3328),cp:new s.Point(427,2869)},{cmd:"L",pt:new s.Point(427,4687)},{cmd:"L",pt:new s.Point(637,4687)},{cmd:"L",pt:new s.Point(637,3502)},{cmd:"Q",pt:new s.Point(494.5,2680),cp:new s.Point(637,2945)},{cmd:"Q",pt:new s.Point(209,2356),cp:new s.Point(352,2415)},{cmd:"Z"}]},d={width:769,height:2545,segs:[{cmd:"M",pt:new s.Point(210,2545)},{cmd:"L",pt:new s.Point(210,1778)},{cmd:"Q",pt:new s.Point(343,559),cp:new s.Point(210,954)},{cmd:"Q",pt:new s.Point(769,95),cp:new s.Point(476,164)},{cmd:"L",pt:new s.Point(769,0)},{cmd:"Q",pt:new s.Point(177.5,492.5),cp:new s.Point(355,72)},{cmd:"Q",pt:new s.Point(0,1744),cp:new s.Point(0,913)},{cmd:"L",pt:new s.Point(0,2545)},{cmd:"Z"}]},l={width:769,height:2545,segs:[{cmd:"M",pt:new s.Point(559,0)},{cmd:"L",pt:new s.Point(559,767)},{cmd:"Q",pt:new s.Point(426,1986),cp:new s.Point(559,1591)},{cmd:"Q",pt:new s.Point(0,2450),cp:new s.Point(293,2381)},{cmd:"L",pt:new s.Point(0,2545)},{cmd:"Q",pt:new s.Point(591.5,2052.5),cp:new s.Point(414,2473)},{cmd:"Q",pt:new s.Point(769,801),cp:new s.Point(769,1632)},{cmd:"L",pt:new s.Point(769,0)},{cmd:"Z"}]},u={width:637,height:4687,segs:[{cmd:"M",pt:new s.Point(428,2356)},{cmd:"Q",pt:new s.Point(142.5,2680),cp:new s.Point(285,2415)},{cmd:"Q",pt:new s.Point(0,3502),cp:new s.Point(0,2945)},{cmd:"L",pt:new s.Point(0,4687)},{cmd:"L",pt:new s.Point(210,4687)},{cmd:"L",pt:new s.Point(210,3328)},{cmd:"Q",pt:new s.Point(324,2638),cp:new s.Point(210,2869)},{cmd:"Q",pt:new s.Point(637,2399),cp:new s.Point(438,2407)},{cmd:"L",pt:new s.Point(637,2279)},{cmd:"Q",pt:new s.Point(322,2041),cp:new s.Point(434,2271)},{cmd:"Q",pt:new s.Point(210,1359),cp:new s.Point(210,1811)},{cmd:"L",pt:new s.Point(210,0)},{cmd:"L",pt:new s.Point(0,0)},{cmd:"L",pt:new s.Point(0,1185)},{cmd:"Q",pt:new s.Point(151.5,2020),cp:new s.Point(16,1769)},{cmd:"Q",pt:new s.Point(428,2331),cp:new s.Point(287,2271)},{cmd:"Z"}]},h={width:769,height:2545,segs:[{cmd:"M",pt:new s.Point(769,2545)},{cmd:"L",pt:new s.Point(769,1744)},{cmd:"Q",pt:new s.Point(591.5,492.5),cp:new s.Point(769,913)},{cmd:"Q",pt:new s.Point(0,0),cp:new s.Point(414,72)},{cmd:"L",pt:new s.Point(0,95)},{cmd:"Q",pt:new s.Point(426,559),cp:new s.Point(293,164)},{cmd:"Q",pt:new s.Point(559,1778),cp:new s.Point(559,954)},{cmd:"L",pt:new s.Point(559,2545)},{cmd:"Z"}]}},309:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.closeBracket=void 0;const n=o(7757),s=o(92),r={width:559,height:1870,segs:[{cmd:"M",pt:new n.Point(0,1870)},{cmd:"Q",pt:new n.Point(277.5,1819),cp:new n.Point(170,1870)},{cmd:"Q",pt:new n.Point(445,1663.5),cp:new n.Point(385,1768)},{cmd:"Q",pt:new n.Point(532,1392),cp:new n.Point(505,1559)},{cmd:"Q",pt:new n.Point(559,939),cp:new n.Point(559,1225)},{cmd:"Q",pt:new n.Point(532.5,486.5),cp:new n.Point(559,655)},{cmd:"Q",pt:new n.Point(446,212),cp:new n.Point(506,318)},{cmd:"Q",pt:new n.Point(278,53),cp:new n.Point(386,106)},{cmd:"Q",pt:new n.Point(0,0),cp:new n.Point(170,0)},{cmd:"L",pt:new n.Point(0,82)},{cmd:"Q",pt:new n.Point(124,94),cp:new n.Point(70,82)},{cmd:"Q",pt:new n.Point(228,148),cp:new n.Point(185,108)},{cmd:"Q",pt:new n.Point(306,271),cp:new n.Point(276,192)},{cmd:"Q",pt:new n.Point(358,515),cp:new n.Point(341,363)},{cmd:"Q",pt:new n.Point(376,931),cp:new n.Point(376,676)},{cmd:"Q",pt:new n.Point(361,1313.5),cp:new n.Point(376,1156)},{cmd:"Q",pt:new n.Point(311,1571),cp:new n.Point(346,1471)},{cmd:"Q",pt:new n.Point(241,1702),cp:new n.Point(283,1655)},{cmd:"Q",pt:new n.Point(153,1764),cp:new n.Point(204,1743)},{cmd:"Q",pt:new n.Point(0,1788),cp:new n.Point(94,1788)},{cmd:"Z"}]};t.closeBracket={draw:e=>(0,s.scalePath)(e,r)}},8617:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawRubberFigure=void 0;const n=o(3703);t.drawRubberFigure=(e,t,o,s)=>{const r=new n.FigPath(e.draw(t,s),o);return r.update(),r}},1235:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRubberBracket=void 0;const n=o(309),s=o(2089),r=o(723),i=o(3973),a={"[":r.openSquareBracket,"]":r.closeSquareBracket,"(":s.openBracket,")":n.closeBracket,"{":i.openBrace,"}":i.closeBrace};t.getRubberBracket=(e,t)=>a[t]||(e?r.openSquareBracket:r.closeSquareBracket)},2089:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.openBracket=void 0;const n=o(7757),s=o(92),r={width:559,height:1870,segs:[{cmd:"M",pt:new n.Point(559,0)},{cmd:"Q",pt:new n.Point(281.5,51),cp:new n.Point(389,0)},{cmd:"Q",pt:new n.Point(114,206.5),cp:new n.Point(174,102)},{cmd:"Q",pt:new n.Point(27,478),cp:new n.Point(54,311)},{cmd:"Q",pt:new n.Point(0,931),cp:new n.Point(0,645)},{cmd:"Q",pt:new n.Point(26.5,1383.5),cp:new n.Point(0,1215)},{cmd:"Q",pt:new n.Point(113,1658),cp:new n.Point(53,1552)},{cmd:"Q",pt:new n.Point(281,1817),cp:new n.Point(173,1764)},{cmd:"Q",pt:new n.Point(559,1870),cp:new n.Point(389,1870)},{cmd:"L",pt:new n.Point(559,1788)},{cmd:"Q",pt:new n.Point(435,1776),cp:new n.Point(489,1788)},{cmd:"Q",pt:new n.Point(331,1722),cp:new n.Point(374,1762)},{cmd:"Q",pt:new n.Point(253,1599),cp:new n.Point(283,1678)},{cmd:"Q",pt:new n.Point(201,1355),cp:new n.Point(218,1507)},{cmd:"Q",pt:new n.Point(183,939),cp:new n.Point(183,1194)},{cmd:"Q",pt:new n.Point(198,556.5),cp:new n.Point(183,714)},{cmd:"Q",pt:new n.Point(248,299),cp:new n.Point(213,399)},{cmd:"Q",pt:new n.Point(318,168),cp:new n.Point(276,215)},{cmd:"Q",pt:new n.Point(406,106),cp:new n.Point(355,127)},{cmd:"Q",pt:new n.Point(559,82),cp:new n.Point(465,82)},{cmd:"Z"}]};t.openBracket={draw:e=>(0,s.scalePath)(e,r)}},92:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scalePath=void 0;const n=o(7757),s=o(8032);t.scalePath=(e,t)=>{const o=[],r=o=>new n.Point(o.x*e.width/t.width,o.y*e.height/t.height);return(0,s.tracePath)(t.segs,{onM(e){o.push({cmd:"M",pt:r(e)})},onL(e){o.push({cmd:"L",pt:r(e)})},onC(e,t,n){o.push({cmd:"C",pt:r(n),cp1:r(e),cp2:r(t)})},onQ(e,t){o.push({cmd:"Q",pt:r(t),cp:r(e)})},onA(){throw new Error("Function not implemented.")}}),o}},723:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.closeSquareBracket=t.openSquareBracket=void 0;const n=o(7757),s=446;t.openSquareBracket={draw(e){const t=e.width/s,o=s*t,r=e.height,i=82*t,a=176*t;return[{cmd:"M",pt:new n.Point(o,0)},{cmd:"H",x:0},{cmd:"V",y:r},{cmd:"H",x:o},{cmd:"V",y:r-i},{cmd:"H",x:a},{cmd:"V",y:i},{cmd:"H",x:o},{cmd:"Z"}]}},t.closeSquareBracket={draw(e){const t=e.width/s,o=s*t,r=e.height,i=82*t,a=176*t;return[{cmd:"M",pt:new n.Point},{cmd:"H",x:o},{cmd:"V",y:r},{cmd:"H",x:0},{cmd:"V",y:r-i},{cmd:"H",x:o-a},{cmd:"V",y:i},{cmd:"H",x:0},{cmd:"Z"}]}}},7892:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SvgSurface=void 0;const n=o(7757),s=o(5040),r=o(4886),i=o(1639),a=o(1515),c=o(4712),d=(e,t)=>{var o;const{stroke:s,strokeWidth:r,join:a,cap:d}=e,l={};return l.fill=null!==(o=e.fill)&&void 0!==o?o:"none",s&&(l.stroke=s),r&&(l["stroke-width"]=(0,i.toa)(r)),a&&(l["stroke-linecap"]=a),d&&(l["stroke-linecap"]=d),t&&(t instanceof n.Point&&!t.isZero()?l.transform=`translate(${(0,i.toa)(t.x)},${(0,i.toa)(t.y)})`:t instanceof c.Matrix2x3&&(l.transform=`matrix(${t.repr()})`)),l};t.SvgSurface=class{constructor(){this.size=new n.Point,this.defs={},this.body=[]}setSize(e){this.size=e.clone(),this.clear()}drawPath(e,t,o){const n=Object.assign({d:(0,a.pathToString)(t)},d(o,e));this.addFigure((0,r.drawTag)("path",n,!0))}drawRect(e,t,o,n){const s=Object.assign({x:(0,i.toa)(t.left),y:(0,i.toa)(t.top),width:(0,i.toa)(t.width),height:(0,i.toa)(t.height)},d(o,e));n&&(s.rx=(0,i.toa)(n.x),s.ry=(0,i.toa)(n.y)),this.addFigure((0,r.drawTag)("rect",s,!0))}drawEllipse(e,t,o,n){const s=Object.assign(Object.assign({},d(n,e)),{cx:(0,i.toa)(t.x),cy:(0,i.toa)(t.y),rx:(0,i.toa)(o.x),ry:(0,i.toa)(o.y)});this.addFigure(`${(0,r.drawTag)("ellipse",s,!0)}`)}addFigure(e){this.body.push(e)}addDef(e,t){this.defs[e]=t}exportText(e){return(0,s.buildSvgText)(this.size,this.defs,this.body,null!=e?e:{})}clear(){this.defs={},this.body.length=0}}},3468:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.standaloneExportOptions=void 0,t.standaloneExportOptions=Object.freeze({xml:{version:"1.0",encoding:"UTF-8",standalone:"no"},doctype:'svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"',svg:{xmlns:"http://www.w3.org/2000/svg",version:"1.1",baseProfile:"full","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:ev":"http://www.w3.org/2001/xml-events"}})},5040:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildSvgText=void 0;const n=o(4886),s=o(7162);t.buildSvgText=(e,t,o,r)=>{let i="";const{xml:a,doctype:c,svg:d}=r;a&&(i+=`${(0,n.drawTag)("?xml",a,!0).replace("/>","?>")}\n`),c&&(i+=`<!DOCTYPE ${c}>\n`);const l=Object.assign({viewBox:`0 0 ${e.x} ${e.y}`},d);r.width&&(l.width=r.width),r.height&&(l.height=r.height),"xmlns"in l||(l.xmlns="http://www.w3.org/2000/svg"),i+=`${(0,n.drawTag)("svg",l)}\n`,r.excludeVerInfo||(i+=`  \x3c!-- Generated by CharChem v.${(0,s.getVersionStr)()} --\x3e\n`);const u=Object.keys(t);return u.length>0&&(i+="  <defs>\n",u.forEach((e=>{i+=`    ${t[e]}\n`})),i+="  </defs>\n"),o.forEach((e=>{i+=`  ${e}\n`})),i+="</svg>",i}},6684:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createLocalFontHash=void 0;const n=o(5604);t.createLocalFontHash=e=>{let t=`family:${e.family};height:${e.height};`;if(e.weight){const o=(0,n.fontWeightValue)(e.weight);400!==o&&(t+=`weight:${o};`)}return e.style&&"normal"!==e.style&&(t+=`style:${e.style};`),e.stretch&&"normal"!==e.stretch&&(t+=`stretch:${e.stretch};`),t}},9181:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createRulesList=void 0;const n=o(6728),s=o(3725),r=o(4736);t.createRulesList=e=>{const t=new n.ChemK(9),o=[["agentK",e.agentK(t)],["comment",e.comment("A")],["custom",e.custom("A")],["itemCount",e.itemCount(t)],["itemMass",e.itemMass(9)],["nodeCharge",e.nodeCharge(new s.ChemCharge("9",9))],["bracketCharge",e.bracketCharge(new s.ChemCharge("9",9))],["bracketCount",e.bracketCount(t)]],i=new Set(o.map((([e])=>e)));return r.ChemImgProps.getIndexStyles().forEach((n=>{i.has(n)||o.push([n,e.itemCount(t)])})),o}},9512:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFontHeight=t.getBaseline=void 0,t.getBaseline=({ascent:e})=>e,t.getFontHeight=({ascent:e,descent:t})=>e-t},5604:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isBold=t.fontWeightValue=void 0,t.fontWeightValue=e=>{const t=+e;return Number.isNaN(t)?"bold"===e?700:400:t},t.isBold=e=>!!e&&(0,t.fontWeightValue)(e)>=700},1515:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pathToString=void 0;const n=o(1639);t.pathToString=e=>e.map((e=>{const{cmd:t}=e;let o=e.rel?t.toLowerCase():t;const s=e=>{1!==o.length&&(o+=" "),o+=`${(0,n.toa)(e.x)} ${(0,n.toa)(e.y)}`};switch(t){case"M":case"L":case"T":s(e.pt);break;case"H":o+=(0,n.toa)(e.x);break;case"V":o+=(0,n.toa)(e.y);break;case"C":s(e.cp1),s(e.cp2),s(e.pt);break;case"S":s(e.cp2),s(e.pt);break;case"Q":s(e.cp),s(e.pt);break;case"A":s(e.r),o+=` ${(0,n.toa)(e.xRot)} ${e.largeArc} ${e.sweep}`,s(e.pt)}return o})).join("")},2256:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scaleFontFace=void 0,t.scaleFontFace=(e,t)=>{const o=Object.assign({},e);o.ascent*=t,o.descent*=t,o.capHeight*=t,o.xHeight*=t;const{bbox:n}=e;return n&&(o.bbox=n.map((e=>e*t))),o}},8032:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tracePath=void 0;const n=o(7757);t.tracePath=(e,t)=>{let o=new n.Point,s=o.clone(),r=o.clone();const i=(e,t)=>e?s.plus(t):t,a=(e,t)=>{s=e,r=null!=t?t:e},c=()=>s.times(2).minus(r);e.forEach(((e,r)=>{var d,l,u;const{cmd:h}=e;if("Z"===h)(null!==(d=t.onZ)&&void 0!==d?d:t.onL)(o),a(o);else if("M"===h){const n=i(e.rel,e.pt);t.onM(n),0===r&&(o=n),a(n)}else if("L"===h){const o=i(e.rel,e.pt);t.onL(o),a(o)}else if("H"===h){const o=new n.Point(e.rel?s.x+e.x:e.x,s.y);(null!==(l=t.onH)&&void 0!==l?l:t.onL)(o),a(o)}else if("V"===h){const o=new n.Point(s.x,e.rel?s.y+e.y:e.y);(null!==(u=t.onV)&&void 0!==u?u:t.onL)(o),a(o)}else if("C"===h){const o=i(e.rel,e.cp1),n=i(e.rel,e.cp2),s=i(e.rel,e.pt);t.onC(o,n,s),a(s,n)}else if("S"===h){const o=c(),n=i(e.rel,e.cp2),s=i(e.rel,e.pt);t.onC(o,n,s),a(s,n)}else if("Q"===h){const o=i(e.rel,e.cp),n=i(e.rel,e.pt);t.onQ(o,n),a(n,o)}else if("T"===h){const o=c(),n=i(e.rel,e.pt);t.onQ(o,n),a(n,o)}else if("A"===h){const o=i(e.rel,e.pt);t.onA(e.r,e.xRot,e.largeArc,e.sweep,o),a(o)}}))}},7004:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChemEquation=void 0;const n=o(1053),s=o(5373),r=o(6053),i=o(4849),a=o(283),c=o(1826),d=o(3396),l=o(7029),u=o(5679),h=o(7921),p=o(5727),m=o(3814);let f=!1;const g=e=>({dstCol:e,refs:[]});t.ChemEquation=class{constructor(){this.state="NotSolved",this.agents=[],this.nCols=0,this.M=[],this.K=[],this.solves=[],this.srcMap=[],f||(s.Lang.addDict(l.equationDict),f=!0),this.clear()}getSolves(){return this.solves}getExpr(){return this.expr}setState(e,t,o){this.state=e,this.msgId=null!=t?t:"NotSolved"===e?"Not solved":void 0,this.params=o}getMessage(e){var t;return null!==(t=(0,d.ifDef)(this.msgId,(t=>s.Lang.tr(t,this.params,e))))&&void 0!==t?t:""}isSolved(){return"Solved"===this.state}makeError(){return new u.ChemError(this.msgId||this.state,this.params)}clear(){this.setState("NotSolved"),this.agents=[],this.expr=void 0,this.M=[],this.solves=[],this.srcMap=[]}initBySrc(e){var t;const o=(0,n.compile)(e,{srcMap:!0});this.initByExpr(o,null!==(t=o.srcMap)&&void 0!==t?t:[])}initByExpr(e,t){if(this.clear(),!e)return this.setState("Error","Invalid expression");const{error:o}=e;if(o)return o instanceof u.ChemError?this.setState("Error",o.msgId,o.params):this.setState("Error",o.message);this.expr=e,this.srcMap=t;const n=(0,r.isSuitableForEquation)(e);if(n)return this.setState("Error",n.msgId);this.agents=e.getAgents();const s=[];this.agents.forEach((e=>{const{part:t}=e,o=s[t]||new a.ElemList;o.addList((0,c.makeElemList)(e,!0)),s[t]=o}));const l=s[0],p=s[1];if(!l||!p||2!==s.length)return this.setState("Error","No separating operation");const m=(0,h.checkElementsMatching)([l,p]);if(m)return this.setState("Error",m[0],m[1]);this.nCols=this.agents.length,this.K=this.agents.map((()=>new i.Rational)),this.M=l.list.map((()=>[]));const f=l.list.reduce(((e,t,o)=>Object.assign(Object.assign({},e),{[t.id]:o})),{});return this.agents.forEach((e=>{const t=this.M.map((e=>{const t=new i.Rational;return e.push(t),t}));(0,c.makeElemList)(e,!0).list.forEach((o=>{const n=o.n*(1===e.part?-1:1);(0,d.ifDef)(f[o.id],(e=>{(0,d.ifDef)(t[e],(e=>e.set(n)))}))}))})),this.setState("NotSolved")}getMatrix(){return this.M}getMatrixStr(){return this.M.map((e=>e.join(" ")))}solve(){for(;"NotSolved"===this.state;)this.calcStep()}calcStep(){if("NotSolved"!==this.state)return;if(this.solves.length===this.nCols-1)return void this.simpleSolve();const{nRow:e,nCols:t}=this.findRowForAction();e>=0?t?this.onSimpleSolve(e,t[0],t[1]):this.deleteMatrixRow(e):this.try2RowsUnit()||this.searchKoeffs()||this.setState("Error","Balance is not found")}deleteMatrixRow(e){this.M.splice(e,1)}onSimpleSolve(e,t,o){const n=this.M[e],s=n[o].negx().divi(n[t]),r=g(t);r.refs.push({srcCol:o,k:s}),this.solves.unshift(r),this.deleteMatrixRow(e),this.M.forEach((e=>{e[o].addi(e[t].mulx(s)),e[t].set(0)}))}findRowForAction(){let e;return{nRow:this.M.findIndex((t=>{var o,n;const s=t.reduce(((e,t,o)=>t.isZero()?e:[...e,o]),[]);if(0===s.length)return!0;if(2===s.length){const r=s[0],i=s[1];if((null===(o=t[r])||void 0===o?void 0:o.sign())!==(null===(n=t[i])||void 0===n?void 0:n.sign()))return e=[r,i],!0}return!1})),nCols:e}}simpleSolve(){this.K.forEach((e=>e.set(0))),this.getUnknownIndices().forEach((e=>{var t;return null===(t=this.K[e])||void 0===t?void 0:t.set(1)})),this.calcSolves(),this.optimizeKoeffs(),this.checkKoeffs()&&this.checkBalance()?this.finalSolve():this.setState("Error","Balance is not found")}finalSolve(){this.setState("Solved","");const{expr:e,K:t,agents:o,srcMap:s}=this;if(e){const r=t.map((({x:e})=>e)),i=(0,m.makeSourceWithNewCoeffs)(r,o,e.src,s);this.expr=(0,n.compile)(i,{srcMap:!0})}}getUnknownIndices(){const e=new Array(this.nCols);e.fill(0);const t=[];this.solves.forEach((t=>{e[t.dstCol]=1}));for(let o=0;o!==this.nCols;o++)e[o]||t.push(o);return t}calcSolves(){this.solves.forEach((({dstCol:e,refs:t})=>{var o;null===(o=this.K[e])||void 0===o||o.set(0),t.forEach((t=>{var o;null===(o=this.K[e])||void 0===o||o.addi(t.k.mulx(this.K[t.srcCol]))}))}))}optimizeKoeffs(){const e=this.K.reduce(((e,{y:t})=>{const o=(0,i.calcAbsMCD)(e,t);return Math.max(e,e*t/o)}),1),t=this.K.map((t=>{const o=e/t.y;return t.x*o}));let o=t.reduce(((e,t)=>Math.max(e,t)),0),n=2;for(;n<=o;)t.findIndex((e=>e%n!=0))>=0?n++:(o/=n,t.forEach(((e,o)=>{t[o]=e/n})));this.K=t.map((e=>new i.Rational(e)))}checkKoeffs(){return!this.K.find((e=>e.x<=0))}checkBalance(){const e={};return this.agents.forEach(((t,o)=>{(0,c.makeElemList)(t,!0).list.forEach((({id:n,n:s})=>{var r,i;let a=s;t.part>0&&(a=-a),a*=null!==(i=null===(r=this.K[o])||void 0===r?void 0:r.x)&&void 0!==i?i:0,e[n]?e[n]+=a:e[n]=a}))})),Object.values(e).findIndex((e=>0!==e))<0}try2RowsUnit(){var e,t;const{nCols:o,M:n}=this,s=n.length;if(s<2)return!1;let r,a,c=0;for(r=0;;++r){if(a=r+1,a===s)return!1;const n=this.M[r];for(;a!==s;++a){const s=this.M[a];for(c=0;c!==o&&((null===(e=n[c])||void 0===e?void 0:e.isZero())||(null===(t=s[c])||void 0===t?void 0:t.isZero()));c++);if(c!==o)break}if(a!==s)break}const d=n[r],l=n[a],u=new i.Rational(-1).divi(d[c]),h=new i.Rational(-1).divi(l[c]),p=g(c);if(d.forEach(((e,t)=>{t===c||e.isZero()||p.refs.push({srcCol:t,k:e.mulx(u)})})),0===p.refs.length)return!1;this.solves.unshift(p);for(let e=0;e!==o;e++)l[e]=d[e].mulx(u).subi(l[e].mulx(h));return this.deleteMatrixRow(r),a--,this.M.forEach(((e,t)=>{if(t!==a){const t=e[c].copy();e[c].set(0),p.refs.forEach((o=>e[o.srcCol].addi(t.mulx(o.k))))}})),!0}searchKoeffs(){const e=this.getUnknownIndices(),t=e.length,o=(0,p.makeCoeffEnumerator)(t,30);if(o)for(const t of o)if(this.testKoeffs(e,t))return!0;return!1}testKoeffs(e,t){return e.forEach(((e,o)=>{var n;null===(n=this.K[e])||void 0===n||n.set(t[o])})),this.calcSolves(),!!this.checkKoeffs()&&(this.optimizeKoeffs(),!!this.checkBalance()&&(this.finalSolve(),!0))}}},7921:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkElementsMatching=void 0,t.checkElementsMatching=e=>{for(let t=0;2!==t;t++){const o=e[t],n=e[1^t];if(!o||!n)return["Invalid expression",void 0];for(const e of o.list)if(!n.findRec(e)){const o=(0===t?"right":"left")+"|part";return["[E] is missing in [S] part",{E:e.id,S:o}]}}}},5727:(e,t)=>{function*o(e){for(let t=1;t<=e;t++)for(let e=1,o=t;o>0;e++,o--)yield[e,o];for(let t=2;t<=e;t++)for(let o=e,n=t;n<=e;n++,o--)yield[n,o]}function*n(e){yield[1,1,1];for(let t=2;t<=e;t++){let e=t,o=1,n=1;for(;e>1;e--,o++)yield[n,o,e];for(;o>1;n++,o--)yield[n,o,e];for(;n>1;n--,e++)yield[n,o,e]}const t=Math.floor((e-2)/2)+2;for(let o=2;o<e;o++){if(o===t)for(const t of n(e-2))yield t.map((e=>e+1));let s=e,r=o,i=1;for(;r<e;r++,s--)yield[i,r,s];for(;s>1;i++,s--)yield[i,r,s];for(;i<e;i++,r--)yield[i,r,s];for(;r>1;s++,r--)yield[i,r,s];for(;s<e;s++,i--)yield[i,r,s];for(;i>1;i--,r++)yield[i,r,s]}for(let t=1;t<e;t++){let o=e,n=e,s=t;for(;s<e;o--,s++)yield[s,n,o];for(;o<e;o++,n--)yield[s,n,o];for(;n<e;s--,n++)yield[s,n,o]}e>1&&(yield[e,e,e])}function*s(e,o){const n=new Array(e);n.fill(1),yield[...n];const s=1<<e;for(let r=2;r<=o;r++)for(let o=1;o!==s;o++){const s=[];n.fill(1);for(let t=0;t<e;t++)o&1<<t?n[t]=r:s.push(t);const i=s.length;if(r>2&&i>0){const e=(0,t.makeCoeffEnumerator)(i,r-1);for(const t of e)t.forEach(((e,t)=>{n[s[t]]=e})),yield[...n]}else yield[...n]}}Object.defineProperty(t,"__esModule",{value:!0}),t.coeffEnumeratorNd=t.coeffEnumerator3d=t.coeffEnumerator2d=t.makeCoeffEnumerator=void 0,t.makeCoeffEnumerator=(e,t)=>2===e?o(t):3===e?n(t):s(e,t),t.coeffEnumerator2d=o,t.coeffEnumerator3d=n,t.coeffEnumeratorNd=s},7029:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.equationDict=void 0,t.equationDict={ru:{"[E] is missing in [S] part":"Отсутствует элемент [E] в [S#] части уравнения","left|part":"левой","right|part":"правой","Equation not specified":"Уравнение не задано","No separating operation":"Требуется одна операция, разделяющая левую и правую часть уравнения","No solution":"Не удалось найти решение","Cant balance expression with abstract coefficients":"Невозможно балансировать уравнение с абстрактными коэффициентами","Cant balance expression with non-integer coefficients":"Невозможно балансировать уравнение с дробными коэффициентами","Cant balance expression with mineral series":"Невозможно балансировать неопределенные формулы минералов","Invalid expression":"Неподходящее выражение"},en:{"[E] is missing in [S] part":"Element [E] is missing on the [S#] side of the equation.","left|part":"left","right|part":"right","Equation not specified":"The equation is not specified","No separating operation":"Requires a single operation, separating the left and right side of the equation","No solution":"Could not find a solution","Cant balance expression with abstract coefficients":"Can't balance expression with abstract coefficients","Cant balance expression with non-integer coefficients":"Can't balance expression with non-integer coefficients","Cant balance expression with mineral series":"Can't balance expression with mineral series","Invalid expression":"Неподходящее выражение"}}},6053:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSuitableForEquation=void 0;const o="Cant balance expression with abstract coefficients";t.isSuitableForEquation=e=>e.walkExt({isStop:!1,result:void 0,itemPre({n:e}){e.isNumber()?e.isInt()||(this.result={reason:"float",msgId:"Cant balance expression with non-integer coefficients"}):this.result={reason:"abstract",msgId:o},this.isStop=!!this.result},mul({n:e}){e.isNumber()||(this.result={reason:"abstract",msgId:o})},comma(){this.result={reason:"abstract",msgId:"Cant balance expression with mineral series"}}}).result},3814:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeSourceWithNewCoeffs=void 0;const n=o(886);t.makeSourceWithNewCoeffs=(e,t,o,s)=>{const r=[];let i=0;return t.forEach(((t,a)=>{const c=(0,n.getSrcItemsForObject)(t,s),d=c.length;if(d){const t=c[0].begin;r.push(o.slice(i,t)),i=t;const n=e[a];void 0!==n&&1!==n&&r.push(String(n)),d>1&&"agentK"===c[0].part&&(i=c[1].begin)}})),r.push(o.slice(i)),r.join("").trim()}},7162:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getVersionStr=t.getVersion=void 0;const s=n(o(5672));t.getVersion=()=>s.default,t.getVersionStr=()=>(0,t.getVersion)().join(".")},5646:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calcCharge=void 0,t.calcCharge=e=>{const t=[0],o=()=>{t.unshift(0)},n=e=>{const o=t[0]*e();t.shift(),t[0]+=o};return e.walk({agentPre(){o()},agentPost(e){n((()=>e.n.num))},bracketBegin(){o()},bracketEnd(e){const{charge:o}=e;o&&(t[0]=o.value),n((()=>e.n.num))},nodePost(e){const{charge:o}=e;o&&(t[0]+=o.value)}}),t[0]}},3442:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calcMass=void 0;const n=o(3396);t.calcMass=(e,t=!0)=>{const o=[0],s=()=>{o.unshift(0)},r=e=>{const t=o[0]*e();o.shift(),o[0]+=t};return e.walk({agentPre(){s()},agentPost(e){r((()=>t?e.n.num:1))},mul(){s()},mulEnd(e){r((()=>e.begin.n.num))},bracketBegin(){s()},bracketEnd(e){r((()=>e.n.num))},nodePre(){s()},nodePost(){r((()=>1))},itemPre(){s()},itemPost(e){(0,n.ifDef)(e.mass,(e=>{o[0]=e})),r((()=>e.n.num))},atom(e){o[0]+=e.mass},radical(e){e.items.list.forEach((e=>{var t,n;o[0]+=e.n*(null!==(n=null===(t=e.elem)||void 0===t?void 0:t.mass)&&void 0!==n?n:0)}))}}),o[0]}},6125:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isAbstractCoeffs=t.isAbstract=void 0,t.isAbstract=e=>{const t=new n(!0);return e.walk(t),t.isStop},t.isAbstractCoeffs=e=>{const t=new n(!1);return e.walk(t),t.isStop};const o=e=>!!e&&!e.isNumber();class n{constructor(e){this.useItems=e,this.isStop=!1}agentPre(e){this.isStop=o(e.n)}itemPre(e){this.isStop=o(e.n)}bracketEnd(e){this.isStop=o(e.n)}mul(e){this.isStop=o(e.n)}custom(e){this.useItems&&e.text&&(this.isStop=!0)}comma(){this.useItems&&(this.isStop=!0)}}},4836:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isTextFormula=void 0,t.isTextFormula=e=>!e.walkExt({isStop:!1,bond(e){this.isStop=!e.isText},itemPre(e){this.isStop=!!e.dots},bracketBegin(e){this.isStop=!!e.padding}}).isStop},7801:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.locateAtomNumber=void 0,t.locateAtomNumber=e=>{let t;return e.walk({atom(e){t=e.n}}),t}},6410:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeBruttoKey=void 0;const n=o(830),s=o(1053),r=o(1826),i=o(6125);t.makeBruttoKey=e=>{let t;if("string"==typeof e){const o=(0,s.compile)(e);if(!o.isOk())return"";t=o}else{if(e instanceof n.ChemExpr&&!e.isOk())return"";t=e}if((0,i.isAbstractCoeffs)(t))return"";const o=(0,r.makeElemList)(t);return o.sortByHill(),String(o)}},1826:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeElemList=void 0;const n=o(283);t.makeElemList=(e,t=!1)=>{const o=[new n.ElemList],s=()=>{o.unshift(new n.ElemList)},r=e=>{const t=o.shift();t.scale(e),o[0].addList(t)};return e.walk({agentPre(){s()},agentPost(e){r(t?1:e.n.num)},nodePost(e){var t,n;o[0].charge+=null!==(n=null===(t=e.charge)||void 0===t?void 0:t.value)&&void 0!==n?n:0},bracketBegin(){s()},bracketEnd(e){const{charge:t}=e;t&&(o[0].charge=t.value),r(e.n.num)},mul(){s()},mulEnd(e){r(e.begin.n.num)},itemPre(){s()},itemPost(e){r(e.n.num)},atom(e){o[0].addAtom(e)},custom(e){o[0].addCustom(e.text)},radical(e){o[0].addRadical(e)}}),o[0]}},6022:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeTextFormulaSrc=t.makeTextFormula=void 0;const n=o(3396),s=o(1053),r=o(145),i=o(7801);class a{constructor(){this.l2r=!0,this.chunks=[]}add(e){this.l2r?this.chunks.push(e):this.chunks.unshift(e)}}t.makeTextFormula=(e,t=r.rulesText)=>{const o=[new a];let s,d;const l=()=>{o.unshift(new a)},u=()=>{if(1===o.length)return;const e=o.shift(),t=o[0];t.l2r?t.chunks=[...t.chunks,...e.chunks]:t.chunks=[...e.chunks,...t.chunks]},h=(e,t)=>o[0].add({text:e,color:t}),p=()=>h(" "),m=e=>!(null==e?void 0:e.isNeg),f=(e,o,s)=>(0,n.ifDef)(e,(e=>{o===e.isLeft&&h(t.nodeCharge(e),s)}));let g=!1;for(e.walk({agentPre(e){p(),l(),e.n.isSpecified()&&h(t.agentK(e.n))},agentPost(){u()},atom(e){g||h(t.atom(e.id),null!=d?d:s)},bond(e){o[0].l2r=m(e),h(e.tx,e.color)},comma(){h(t.comma(),s)},comment(e){h(t.comment(e.text),s)},custom(e){h(t.custom(e.text),s)},itemPre(e){if(g)return;s=e.color,d=e.atomColor;const o=e.atomNum;if(void 0!==o){const n=""===o?(0,i.locateAtomNumber)(e):o;h(void 0===n?t.itemMass(e.mass||0):t.itemMassAndNum(e.mass||0,n),s)}else(0,n.ifDef)(e.mass,(e=>h(t.itemMass(e),s)))},itemPost(e){g||(e.charge&&h(t.itemCharge(e.charge),s),e.n.isSpecified()&&h(t.itemCount(e.n),s))},nodePre(e){l(),f(e.charge,!0,e.color),e.autoMode&&(g=!0)},nodePost(e){f(e.charge,!1,e.color),g=!1,u()},operation(e){p(),h(t.operation(e),e.color)},radical(e){h(t.radical(e.label),s)},bracketBegin(e){var n;if(m(e.bond))l(),f(null===(n=e.end)||void 0===n?void 0:n.charge,!0,e.color),h(e.text,e.color);else{const{color:n,end:s}=e;s&&(o[0]&&(o[0].l2r=!1),f(s.charge,!1,n),s.n.isSpecified()&&h(t.itemCount(s.n),n),h(s.text,n)),l()}},bracketEnd(e){const{begin:n}=e,{color:s}=n;m(n.bond)?(h(e.text,s),e.n.isSpecified()&&h(t.itemCount(e.n),s),f(e.charge,!1,s),u()):(u(),o[0]&&(o[0].l2r=!1),h(n.text,s),f(e.charge,!0,s))},mul(e){e.isFirst||h(t.mul(),e.color),e.n.isSpecified()&&h(t.mulK(e.n),e.color)}});o.length>1;)u();const v=c(o[0].chunks,t).trim();return t.postProcess(v)};const c=(e,t)=>e.map(((o,n)=>{let s=o.text;const{color:r}=o;if(r){const o=0===n||r!==e[n-1].color,i=n===e.length-1||r!==e[n+1].color;o&&(s=t.colorBegin(r)+s),i&&(s+=t.colorEnd())}return s})).reduce(((e,t)=>e+t),"");t.makeTextFormulaSrc=(e,o)=>{const n=(0,s.compile)(e);return n.isOk()?(0,t.makeTextFormula)(n,o):""}},9021:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Lang=void 0;const n=o(3396),s=o(3079),r=o(2221),i=o(2075);class a{static tr(e,t,o){var n;const s=(o||a.curLang).toLowerCase(),{dict:r}=a;let c=r[s];if(!c){const e=s.indexOf("-");e>=0&&(c=r[s.substring(0,e)])}const d=null!==(n=(null!=c?c:a.enDict)[e])&&void 0!==n?n:e;return(0,i.replaceLangParams)({text:d,params:t,langId:o,tr:a.tr})}static findPhrase(e){var t;return null===(t=a.dict[a.curLang])||void 0===t?void 0:t[e]}static addDict(e){const{dict:t}=a;Object.entries(e).forEach((([e,o])=>{t[e]?t[e]=Object.assign(Object.assign({},t[e]),o):t[e]=o}))}}t.Lang=a,a.curLang="en",a.navLang=void 0,a.ruDict=r.baseDictRu,a.enDict=s.baseDictEn,a.dict={en:a.enDict,ru:a.ruDict},"undefined"!=typeof window&&(a.navLang=(navigator.language||navigator.browserLanguage||navigator.userLanguage||"en").toLowerCase(),(0,n.ifDef)(a.navLang,(e=>{if(e in a.dict)a.curLang=e;else if(e.indexOf("-")>=0){const t=e.split("-")[0];t in a.dict&&(a.curLang=t)}})))},2396:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},3079:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.baseDictEn=void 0,t.baseDictEn={$Native:"English",$English:"English","Invalid version":"Formula requires CharChem version [need] instead of [cur]",H:"Hydrogen",He:"Helium",Li:"Lithium",Be:"Beryllium",B:"Boron",C:"Carbon",N:"Nitrogen",O:"Oxygen",F:"Fluorine",Ne:"Neon",Na:"Sodium",Mg:"Magnesium",Al:"Aluminium",Si:"Silicon",P:"Phosphorus",S:"Sulfur",Cl:"Chlorine",Ar:"Argon",K:"Potassium",Ca:"Calcium",Sc:"Scandium",Ti:"Titanium",V:"Vanadium",Cr:"Chromium",Mn:"Manganese",Fe:"Iron",Co:"Cobalt",Ni:"Nickel",Cu:"Copper",Zn:"Zinc",Ga:"Gallium",Ge:"Germanium",As:"Arsenic",Se:"Selenium",Br:"Bromine",Kr:"Krypton",Rb:"Rubidium",Sr:"Strontium",Y:"Yttrium",Zr:"Zirconium",Nb:"Niobium",Mo:"Molybdenum",Tc:"Technetium",Ru:"Ruthenium",Rh:"Rhodium",Pd:"Palladium",Ag:"Silver",Cd:"Cadmium",In:"Indium",Sn:"Tin",Sb:"Antimony",Te:"Tellurium",I:"Iodine",Xe:"Xenon",Cs:"Caesium",Ba:"Barium",La:"Lanthanum",Ce:"Cerium",Pr:"Praseodymium",Nd:"Neodymium",Pm:"Promethium",Sm:"Samarium",Eu:"Europium",Gd:"Gadolinium",Tb:"Terbium",Dy:"Dysprosium",Ho:"Holmium",Er:"Erbium",Tm:"Thulium",Yb:"Ytterbium",Lu:"Lutetium",Hf:"Hafnium",Ta:"Tantalum",W:"Tungsten",Re:"Rhenium",Os:"Osmium",Ir:"Iridium",Pt:"Platinum",Au:"Gold",Hg:"Mercury",Tl:"Thallium",Pb:"Lead",Bi:"Bismuth",Po:"Polonium",At:"Astatine",Rn:"Radon",Fr:"Francium",Ra:"Radium",Ac:"Actinium",Th:"Thorium",Pa:"Protactinium",U:"Uranium",Np:"Neptunium",Pu:"Plutonium",Am:"Americium",Cm:"Curium",Bk:"Berkelium",Cf:"Californium",Es:"Einsteinium",Fm:"Fermium",Md:"Mendelevium",No:"Nobelium",Lr:"Lawrencium",Rf:"Rutherfordium",Db:"Dubnium",Sg:"Seaborgium",Bh:"Bohrium",Hs:"Hassium",Mt:"Meitnerium",Ds:"Darmstadtium",Rg:"Roentgenium",Cn:"Copernicium",Nh:"Nihonium",Fl:"Flerovium",Mc:"Moscovium",Lv:"Livermorium",Ts:"Tennessine",Og:"Oganesson"}},2221:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.baseDictRu=void 0,t.baseDictRu={$Native:"Русский",$English:"Russian","Internal error: [msg]":"Внутренняя ошибка: [msg]","Formula can not be displayed as text":"Формулу нельзя отобразить в текстовом виде","Expected '(' after [S]":" Требуется '(' после [S]","Unexpected '[C]'":"Неверный символ '[C]' в позиции [pos]","Expected '[ok]' instead of '[bad]'":"Требуется '[ok]' вместо '[bad]' в позиции [pos]","Invalid character '[C]'":"Недопустимый символ '[C]' в позиции [pos]","Russian element character":"Недопустимый русский символ '[C]'. Для описания химического элемента должны использоваться только латинские символы.","Non-latin element character":"Недопустимый символ '[C]'. Для описания химического элемента должны использоваться только латинские символы.","Unknown element character '[C]'":"Недопустимый символ '[C]' описания реагента в позиции [pos]","Expected '[C]'":"Требуется '[C]' в позиции [pos]","Unknown element '[Elem]'":"Ошибочный элемент '[Elem]' в позиции [pos]","Comment is not closed":"Не закрыт комментарий, начатый в позиции [pos]","Abstract coefficient is not closed":"Не закрыт абстрактный коэффициент, начатый в позиции [pos]","Abstract element is not closed":"Не закрыт абстрактный элемент, начатый в позиции [pos]","Expected node declaration before charge":"Неизвестно, к чему нужно применить заряд в позиции [pos]","Invalid charge declaration":"Ошибка в описании заряда в позиции [pos]","It is necessary to close the bracket":"Необходимо закрыть скобку, открытую в позиции [pos]","Expected variable name":"Требуется указать имя переменной в позиции [pos]","Undefined variable [name]":"Не определена числовая переменная '[name]' в позиции [pos]","Invalid node reference '[ref]'":"Неправильная ссылка на узел '[ref]' в позиции [pos]","Invalid label":"Неправильная метка в позиции [pos]","Invalid branch close":"Нельзя закрыть ветку в позиции [pos], которая не открыта","Cant close branch before bracket":"Нельзя закрыть ветку в позиции [pos], пока не закрыта скобка в позиции [pos0]","Cant close bracket before branch":"Нельзя закрыть скобку в позиции [pos], пока не закрыта ветка в позиции [pos0]","Invalid bracket close":"Нет пары для скобки, закрытой в позиции [pos]","It is necessary to close the branch":"Необходимо закрыть ветку, открытую в позиции [pos]","Expected [must] instead of [have]":"Требуется [must] вместо [have] в позиции [pos]","Invalid middle point":"Не используется промежуточная точка","Cant create ring":"Невозможно создать кольцо","Cant close ring":"Невозможно замкнуть кольцо","Invalid version":"Для формулы требуется CharChem версии [need] вместо [cur]","Invalid number [n]":"Неверное числовое значение [n] в позиции [pos]","Periodic Table":"Периодическая система химических элементов","Table legend":"Группы химических элементов",Group:"Группа",Period:"Период",Row:"Ряд","[x]-block":"[x]-блок",Lanthanides:"Лантаноиды",Actinides:"Актиноиды","Alkali metals":"Щелочные металлы","Alkaline earth metals":"Щёлочноземельные металлы","Transition metals":"Переходные металлы","Post transition metals":"Постпереходные металлы",Metalloids:"Полуметаллы","Other nonmetals":"Неметаллы",Halogens:"Галогены","Noble gases":"Инертные газы","Unknown props":"Св-ва неизвестны","(s)":"(тв)","(l)":"(ж)","(g)":"(г)","(aq)":"(р-р)",H:"Водород",He:"Гелий",Li:"Литий",Be:"Бериллий",B:"Бор",C:"Углерод",N:"Азот",O:"Кислород",F:"Фтор",Ne:"Неон",Na:"Натрий",Mg:"Магний",Al:"Алюминий",Si:"Кремний",P:"Фосфор",S:"Сера",Cl:"Хлор",Ar:"Аргон",K:"Калий",Ca:"Кальций",Sc:"Скандий",Ti:"Титан",V:"Ванадий",Cr:"Хром",Mn:"Марганец",Fe:"Железо",Co:"Кобальт",Ni:"Никель",Cu:"Медь",Zn:"Цинк",Ga:"Галлий",Ge:"Германий",As:"Мышьяк",Se:"Селен",Br:"Бром",Kr:"Криптон",Rb:"Рубидий",Sr:"Стронций",Y:"Иттрий",Zr:"Цирконий",Nb:"Ниобий",Mo:"Молибден",Tc:"Технеций",Ru:"Рутений",Rh:"Родий",Pd:"Палладий",Ag:"Серебро",Cd:"Кадмий",In:"Индий",Sn:"Олово",Sb:"Сурьма",Te:"Теллур",I:"Йод",Xe:"Ксенон",Cs:"Цезий",Ba:"Барий",La:"Лантан",Ce:"Церий",Pr:"Празеодим",Nd:"Неодим",Pm:"Прометий",Sm:"Самарий",Eu:"Европий",Gd:"Гадолиний",Tb:"Тербий",Dy:"Диспрозий",Ho:"Гольмий",Er:"Эрбий",Tm:"Тулий",Yb:"Иттербий",Lu:"Лютеций",Hf:"Гафний",Ta:"Тантал",W:"Вольфрам",Re:"Рений",Os:"Осмий",Ir:"Иридий",Pt:"Платина",Au:"Золото",Hg:"Ртуть",Tl:"Таллий",Pb:"Свинец",Bi:"Висмут",Po:"Полоний",At:"Астат",Rn:"Радон",Fr:"Франций",Ra:"Радий",Ac:"Актиний",Th:"Торий",Pa:"Протактиний",U:"Уран",Np:"Нептуний",Pu:"Плутоний",Am:"Америций",Cm:"Кюрий",Bk:"Берклий",Cf:"Калифорний",Es:"Эйнштейний",Fm:"Фермий",Md:"Менделеевий",No:"Нобелий",Lr:"Лоуренсий",Rf:"Резерфордий",Db:"Дубний",Sg:"Сиборгий",Bh:"Борий",Hs:"Хассий",Mt:"Мейтнерий",Ds:"Дармштадтий",Rg:"Рентгений",Cn:"Коперниций",Nh:"Нихоний",Fl:"Флеровий",Mc:"Московий",Lv:"Ливерморий",Ts:"Теннессин",Og:"Оганесон"}},5373:function(e,t,o){var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var s=Object.getOwnPropertyDescriptor(t,o);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,s)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),s=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||n(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),s(o(9021),t),s(o(2396),t)},2075:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.replaceLangParams=void 0;const n=o(3396);t.replaceLangParams=e=>{const{text:t,params:o,langId:s,tr:r}=e;let i="",a=0;const c=e=>{var t;return null!==(t=(0,n.ifDef)(null==o?void 0:o[e],(e=>String(e))))&&void 0!==t?t:e};for(;a>=0;){const e=t.indexOf("[",a);if(e<0)break;const o=t.indexOf("]",e);if(o<0)break;i+=t.slice(a,e);const n=t.slice(e+1,o);n.endsWith("#")?i+=r(c(n.slice(0,-1)),{},s):i+=c(n),a=o+1}return i+t.slice(a)}},4712:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Matrix2x3=void 0;const n=o(1639),s=o(7757),r=o(6265);class i{constructor(e){this.m=null!=e?e:[0,0,0,0,0,0]}clone(){return new i([...this.m])}toString(){return this.m.map((e=>(0,n.toa)(e))).join(" ")}repr(e=" "){return this.m.join(e)}static createIdentity(){return new i([1,0,0,1,0,0])}static createZero(){return new i([0,0,0,0,0,0])}translate(e,t){e instanceof s.Point?(this.m[4]+=e.x,this.m[5]+=e.y):"number"==typeof e&&"number"==typeof t&&(this.m[4]+=e,this.m[5]+=t)}moveX(e){this.m[4]+=e}moveY(e){this.m[5]+=e}scale(e,t){this.m[0]*=e,this.m[3]*=null!=t?t:e,this.m[4]*=e,this.m[5]*=null!=t?t:e}scaleX(e){this.m[0]*=e}scaleY(e){this.m[3]*=e}rotate(e){const t=Math.cos(e),o=Math.sin(e);this.m[0]=t,this.m[1]=o,this.m[2]=-o,this.m[3]=t}rotateDeg(e){this.rotate((0,r.deg2rad)(e))}apply(e){return new s.Point(this.a*e.x+this.c*e.y+this.e,this.b*e.x+this.d*e.y+this.f)}get a(){return this.m[0]}set a(e){this.m[0]=e}get b(){return this.m[1]}set b(e){this.m[1]=e}get c(){return this.m[2]}set c(e){this.m[2]=e}get d(){return this.m[3]}set d(e){this.m[3]=e}get e(){return this.m[4]}set e(e){this.m[4]=e}get f(){return this.m[5]}set f(e){this.m[5]=e}}t.Matrix2x3=i},7757:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Point=t.pointFromDeg=t.pointFromRad=void 0;const n=o(1639),s=o(6265);t.pointFromRad=e=>new r(Math.cos(e),Math.sin(e)),t.pointFromDeg=e=>(0,t.pointFromRad)((0,s.deg2rad)(e));class r{constructor(e=0,t=0){this.x=e,this.y=t}set(e,t){this.x=e,this.y=t}setPt(e){this.x=e.x,this.y=e.y}toString(){return`(${(0,n.toa)(this.x)}, ${(0,n.toa)(this.y)})`}clone(){return new r(this.x,this.y)}equals(e){return(0,n.is0)(this.x-e.x)&&(0,n.is0)(this.y-e.y)}isZero(){return(0,n.is0)(this.x)&&(0,n.is0)(this.y)}plus(e){return new r(this.x+e.x,this.y+e.y)}add(e,t){return this.x+=e,this.y+=t,this}iadd(e){return this.x+=e.x,this.y+=e.y,this}isub(e){return this.x-=e.x,this.y-=e.y,this}minus(e){return new r(this.x-e.x,this.y-e.y)}neg(){return new r(-this.x,-this.y)}times(e){return new r(e*this.x,e*this.y)}scale(e){return this.x*=e,this.y*=e,this}mini(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y)}maxi(e){this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y)}polarAngle(){return(0,n.is0)(this.x)&&(0,n.is0)(this.y)?0:(0,n.is0)(this.x)?this.y>0?Math.PI/2:-Math.PI/2:Math.atan2(this.y,this.x)}polarAngleDeg(){return(0,s.rad2deg)(this.polarAngle())}lengthSqr(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.lengthSqr())}distSqr(e){return e.minus(this).lengthSqr()}dist(e){return Math.sqrt(this.distSqr(e))}normal(){const e=this.length();return(0,n.is0)(e)?new r:this.times(1/e)}transpon(e){return e?new r(this.y,-this.x):new r(-this.y,this.x)}static get zero(){return i}}t.Point=r;const i=Object.freeze(new r)},4849:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calcAbsMCD=t.Rational=void 0;class o{constructor(e=0,t=1){this.x=e,this.y=t}set(e){return this.x=e,this.y=1,this}toString(){const{x:e,y:t}=this;return 1===t?String(e):`${e}/${t}`}copy(){return new o(this.x,this.y)}isZero(){return 0===this.x}absLess(e){return Math.abs(this.x)*e.y<Math.abs(e.x)*this.y}sign(){return this.x<0?-1:this.x>0?1:0}negx(){return new o(-this.x,this.y)}absx(){return new o(Math.abs(this.x),this.y)}norm(){if(this.y<0&&(this.x=-this.x,this.y=-this.y),0===this.x)this.y=1;else if(this.x<1||this.x>1){const e=(0,t.calcAbsMCD)(this.x,this.y);this.x/=e,this.y/=e}return this}addi(e){return"number"==typeof e?this.x+=e*this.y:(this.y===e.y?this.x+=e.x:(this.x=this.x*e.y+e.x*this.y,this.y*=e.y),this.norm()),this}addx(e){return"number"==typeof e?new o(this.x+e*this.y,this.y):this.copy().addi(e)}subi(e){return this.addi(e.negx())}subx(e){return e.negx().addi(this)}muli(e){return"number"==typeof e?this.x*=e:(this.x*=e.x,this.y*=e.y),this.norm()}mulx(e){return"number"==typeof e?new o(this.x*e,this.y).norm():new o(this.x*e.x,this.y*e.y).norm()}divi(e){const{x:t,y:o}=e;return this.x*=o,this.y*=t,this.norm()}divx(e){return new o(this.x*e.y,this.y*e.x).norm()}}t.Rational=o,t.calcAbsMCD=(e,t)=>{let o=Math.min(Math.abs(e),Math.abs(t));for(;o>1&&(e%o!=0||t%o!=0);)o--;return o}},3945:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateRect=t.Rect=void 0;const n=o(7757),s=o(1639);class r{constructor(e,t,o,s){"number"==typeof e&&"number"==typeof t?(this.A=new n.Point(e,t),this.B=new n.Point(o,s)):e instanceof n.Point&&t instanceof n.Point?(this.A=e.clone(),this.B=t.clone()):(this.A=new n.Point,this.B=new n.Point)}get left(){return this.A.x}get top(){return this.A.y}get right(){return this.B.x}get bottom(){return this.B.y}get width(){return this.B.x-this.A.x}get height(){return this.B.y-this.A.y}get size(){return new n.Point(this.width,this.height)}get cx(){return this.left+.5*this.width}get cy(){return this.top+.5*this.height}get center(){return new n.Point(this.cx,this.cy)}toString(){return`{${(0,s.toa)(this.left)}, ${(0,s.toa)(this.top)}, ${(0,s.toa)(this.right)}, ${(0,s.toa)(this.bottom)}}`}isEmpty(){return(0,s.is0)(this.width)&&(0,s.is0)(this.height)}clone(){return new r(this.A,this.B)}updatePoint(e){this.A.x=Math.min(this.A.x,e.x),this.A.y=Math.min(this.A.y,e.y),this.B.x=Math.max(this.B.x,e.x),this.B.y=Math.max(this.B.y,e.y)}unite(e){return this.updatePoint(e.A),this.updatePoint(e.B),this}move(e){this.A.iadd(e),this.B.iadd(e)}moveXY(e,t){this.A.add(e,t),this.B.add(e,t)}contains(e){return this.A.x<=e.x&&this.B.x>=e.x&&this.A.y<=e.y&&this.B.y>=e.y}grow(e,t){const o=null!=t?t:e;return this.A.x-=e,this.B.x+=e,this.A.y-=o,this.B.y+=o,this}scale(e){this.A.scale(e),this.B.scale(e)}clip(e,t){let{x:o,y:s}=e,{x:r,y:c}=t;const{left:d,right:l,top:u,bottom:h}=this,p=(e,t)=>i(0,e<d)|i(1,t<u)|i(2,e>l)|i(3,t>h);let m=p(o,s),f=p(r,c),g=!(m|f),v=!!(m&f),b=!1;for(;!v&&!g;)0===m&&([o,r]=[r,o],[s,c]=[c,s],[m,f]=[f,m],b=!b),a(0,m)?(s+=(c-s)*(d-o)/(r-o),o=d):a(1,m)?(o+=(r-o)*(u-s)/(c-s),s=u):a(2,m)?(s+=(c-s)*(l-o)/(r-o),o=l):a(3,m)&&(o+=(r-o)*(h-s)/(c-s),s=h),m=p(o,s),g=!(m|f),v=!!(m&f);const y=new n.Point(o,s),C=new n.Point(r,c);return{inside:g,a:b?C:y,b:b?y:C}}}t.Rect=r;const i=(e,t)=>t?1<<e:0,a=(e,t)=>!!(t&1<<e);t.updateRect=(e,t)=>t?(t.updatePoint(e),t):new r(e,e)},9063:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.normalize360=void 0,t.normalize360=e=>{const t=e%360;return t<0?360+t:t}},1639:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toa=t.isClose=t.is0=void 0,t.is0=e=>Math.abs(e)<.001,t.isClose=(e,o)=>(0,t.is0)(Math.abs(e)-Math.abs(o)),t.toa=e=>e.toFixed(2).replace(/0+$/g,"").replace(/\.$/,"").replace(/^-0$/,"0")},9838:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.strMass=t.roundMass=void 0;const n=o(1639);t.roundMass=e=>Math.round(100*e)/100,t.strMass=e=>(0,n.toa)((0,t.roundMass)(e))},6265:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deg2rad=t.rad2deg=void 0,t.rad2deg=e=>180*e/Math.PI,t.deg2rad=e=>e*Math.PI/180},6879:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getNodeInfo=t.getNodeCenterPos=void 0,t.getNodeCenterPos=e=>e.res.nodeFrame.org.plus(e.res.center),t.getNodeInfo=(e,t)=>t[e.index]},9890:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyPadding=void 0;const n=o(3945);t.applyPadding=(e,t,o)=>{if(1===t.length)return e.clone().grow(t[0]*o);if(2===t.length)return e.clone().grow(t[1]*o,t[0]*o);if(3===t.length){const s=t[0]*o,r=t[1]*o,i=t[2]*o;return new n.Rect(e.left-r,e.top-s,e.right+r,e.bottom+i)}const s=t[0]*o,r=t[1]*o,i=t[2]*o,a=t[3]*o;return new n.Rect(e.left-a,e.top-s,e.right+r,e.bottom+i)}},4141:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clipLine=void 0,t.clipLine=(e,t,o)=>{const{inside:n,b:s}=e.clip(t,o);return n?s:t}},6840:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clipLineByNode=void 0;const n=o(4141),s=o(2724);t.clipLineByNode=(e,t,o,r,i)=>{if(!o||!r)return;const a=o.clone();if((0,s.isNodeHidden)(e))return a;const{nodeFrame:c,rcNodeCore:d}=t,l=d.clone();return l.grow(i),l.move(c.org),(0,n.clipLine)(l,o,r)}},2581:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.doubleBond=void 0;const n=o(7757),s=o(2299),r=o(6039),i=(e,t)=>{const o=e.nodes[t];return o&&o.autoMode&&o.bonds.size>1};t.doubleBond=({bond:e,frame:t,imgProps:o,p0:a,p1:c,styles:d,color:l,align:u,stA:h})=>{const p=c.minus(a).normal(),m=d[0],f=d[1],g=p.transpon(!0),v=p.transpon(),b=(0,s.getBondStyleWidth)(o,m),y=(0,s.getBondStyleWidth)(o,f);let C,w,x,P;if("x"===u){const{lineSpace2x:e}=o,t=g.times((b+e)/2),n=v.times((y+e)/2);C=a.plus(t),x=a.plus(n),w=c.plus(n),P=c.plus(t)}else{const t=((e,t,o)=>{if(!o)return t.calcBondSign(e);switch(o){case"l":return-1;case"r":return 1;default:return 0}})(e,h,u),{lineSpace2:s}=o;let r,d;t<0?(r=g.times((b+y)/2+s),d=n.Point.zero):t>0?(r=n.Point.zero,d=v.times((b+y)/2+s)):(r=g.times((b+s)/2),d=v.times((y+s)/2)),C=a.plus(r),x=a.plus(d),w=c.plus(r),P=c.plus(d),i(e,0)&&(t<0?C.iadd(p.times(s)):t>0&&x.iadd(p.times(s))),i(e,1)&&(t<0?w.isub(p.times(s)):t>0&&P.isub(p.times(s)))}(0,r.singleLine)(e,t,o,C,w,m,l),(0,r.singleLine)(e,t,o,x,P,f,l)}},1245:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawBezierBond=void 0;const n=o(4141),s=o(3703),r=o(4729),i=o(9573),a=o(2724);t.drawBezierBond=({bond:e,frame:t,props:o,middlePoints:c,res0:d,res1:l})=>{const u=Math.min(c.length-1,2);if(u<=0)return;const{line:h,lineWidth:p,nodeMargin:m}=o,f=d.rcNodeCore.clone();f.move(d.nodeFrame.org),e.nodes[0]&&!(0,a.isNodeHidden)(e.nodes[0])&&f.grow(m);const g=d.center.plus(d.nodeFrame.org),v=l.rcNodeCore.clone();v.move(l.nodeFrame.org),e.nodes[1]&&!(0,a.isNodeHidden)(e.nodes[1])&&v.grow(m);const b=l.center.plus(l.nodeFrame.org);let y=g;const C=c.slice(0,u).map((e=>{const t=e.times(h).plus(y);return y=t,t})),w=(0,n.clipLine)(f,g,C[0]);if(!w)return;const x=(0,n.clipLine)(v,b,C[u-1]);if(!x)return;const P=[{cmd:"M",pt:w},1===u?{cmd:"Q",cp:C[0],pt:x}:{cmd:"C",cp1:C[0],cp2:C[1],pt:x}],M=(0,r.getBondColor)(e,o),B=new s.FigPath(P,{stroke:M,strokeWidth:p});B.update(),t.addFigure(B,!0),e.arr0&&(0,i.drawBondArrow)(t,o,C[0],w,M),e.arr1&&(0,i.drawBondArrow)(t,o,C[u-1],x,M)}},1518:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawBond=void 0;const n=o(9585),s=o(6840),r=o(6879),i=o(4004),a=o(1245);t.drawBond=({bond:e,props:t,frame:o,nodesInfo:c,stA:d})=>{if(!e.isVisible())return;const{nodeMargin:l}=t;if(2!==e.nodes.length)return void(0,i.drawBondPoly)(e,o,t,c);const[u,h]=e.nodes;if(!u||!h)return;const{res:p}=(0,r.getNodeInfo)(u,c),{res:m}=(0,r.getNodeInfo)(h,c);let f=p.nodeFrame.org.plus(p.center);const{middlePoints:g}=e;if(g&&g.length>0)return void(0,a.drawBezierBond)({bond:e,frame:o,props:t,middlePoints:g,res0:p,res1:m});let v=m.nodeFrame.org.plus(m.center);f=(0,s.clipLineByNode)(u,p,f,v,l),f&&(v=(0,s.clipLineByNode)(h,m,v,f,l),v&&(0,n.drawBondAB)({bond:e,bondA:f,bondB:v,frame:o,imgProps:t,stA:d}))}},9585:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawBondAB=void 0;const n=o(4729),s=o(3640),r=o(6039),i=o(2581),a=o(4268),c=o(9573);t.drawBondAB=({bond:e,bondA:t,bondB:o,imgProps:d,frame:l,stA:u})=>{const{n:h,style:p,w0:m,w1:f}=e,g=(0,n.getBondColor)(e,d);let v;if(m||1!==f?1!==m||f?m||-1!==f?-1!==m||f||(v=(0,a.wedgeBond)(o,t,d,g,!0)):v=(0,a.wedgeBond)(t,o,d,g,!0):v=(0,a.wedgeBond)(o,t,d,g,!1):v=(0,a.wedgeBond)(t,o,d,g,!1),v)return v.update(),void l.addFigure(v);const b=p?Array.from(p):new Array(h).fill("|");switch(b.reverse(),1===b.length&&1===e.w0&&1===e.w1&&(b[0]="I"),b.length){case 1:(0,r.singleLine)(e,l,d,t,o,b[0],g),e.arr1&&(0,c.drawBondArrow)(l,d,t,o,g),e.arr0&&(0,c.drawBondArrow)(l,d,o,t,g);break;case 2:(0,i.doubleBond)({bond:e,frame:l,imgProps:d,p0:t,p1:o,styles:b,color:g,align:e.align,stA:u});break;case 3:(0,s.tripleBond)(e,l,d,t,o,b,g)}}},9573:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawBondArrow=void 0;const n=o(3703);t.drawBondArrow=(e,t,o,s,r)=>{const{arrowL:i,arrowD:a,lineWidth:c}=t,d=o.minus(s).normal(),l=s.plus(d.times(i)),u=l.plus(d.transpon(!0).times(a)),h=[{cmd:"M",pt:l.plus(d.transpon().times(a))},{cmd:"L",pt:s},{cmd:"L",pt:u}],p={stroke:r,strokeWidth:c},m=new n.FigPath(h,p);m.update(),e.addFigure(m,!0)}},4004:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawBondPoly=void 0;const n=o(7757),s=o(7024),r=o(6879),i=o(4729),a=o(5477);t.drawBondPoly=(e,t,o,c)=>{const d=(0,i.getBondColor)(e,o),{lineWidth:l,dash:u}=o,{nodes:h}=e,p=h.filter((e=>!!e)).map((e=>(0,r.getNodeCenterPos)((0,r.getNodeInfo)(e,c))));if(p.length<2)return;const m=(e=>e.reduce(((e,t)=>e.iadd(t)),new n.Point).scale(1/e.length))(p),f={stroke:d,strokeWidth:l};if("o"===e.ext){const e=p[0],o=p[1],r=e.plus(o).times(.5),i=.7*m.minus(r).length(),a=new s.FigEllipse(m,new n.Point(i,i),f);t.addFigure(a)}else if("s"===e.ext){let o=0,n=p.length;for(e.isCycle||(o++,n--);o<n;o++){const e=p[o],t=m.minus(e);e.iadd(t.times(.2))}const s=a.FigBSpline.extendsPoints(p,e.isCycle);if(s){const o=new a.FigBSpline(s,f,u,":"===e.style);t.addFigure(o)}}}},4729:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getBondColor=void 0,t.getBondColor=(e,t)=>{var o;return null!==(o=e.color)&&void 0!==o?o:t.stdStyle.style.fill}},2299:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getBondStyleWidth=void 0,t.getBondStyleWidth=(e,t)=>"I"===t?e.thickWidth:e.lineWidth},6039:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.singleLine=void 0;const n=o(7757),s=o(3703),r=o(2299),i=o(3470);t.singleLine=(e,t,o,n,d,l,u)=>{const h={stroke:u,strokeWidth:(0,r.getBondStyleWidth)(o,l),cap:"round"};let p;if("~"===l)p=a(e,n,d,o,h);else if(":"===l)p=c(n,d,o,h);else if(e.w0<0&&e.w0===e.w1){const{thickWidth:e,lineWidth:t,hatch:s}=o;p=new i.FigHashTrapezoid(n,e,d,e,u,t,s),p.update()}if(!p){const e=[{cmd:"M",rel:!1,pt:n},{cmd:"L",rel:!1,pt:d}];p=new s.FigPath(e,h),p.update()}t.addFigure(p)};const a=(e,t,o,r,i)=>{const a=!!e.arr0,c=!!e.arr1,{line:d,arrowL:l}=r,u=d/8,h=d/6,p=1.4*l,m=o.minus(t);let f=m.length();const g=m.normal();if(a&&(f-=p),c&&(f-=p),f<h)return;const v=a?t.plus(g.times(p)):t,b=c?o.minus(g.times(p)):o,y=Math.floor((f+h/2)/h),C=g.times(u),w=b.minus(v).times(1/y),x=[{cmd:"M",pt:t}];a&&x.push({cmd:"L",pt:v});let P=v;for(let e=0;e<y;e++){const t=P.plus(w),o=P.plus(1&e?new n.Point(-C.y,C.x):new n.Point(C.y,-C.x)),s=o.plus(w);x.push({cmd:"C",cp1:o,cp2:s,pt:t}),P=t}c&&x.push({cmd:"L",pt:o});const M=new s.FigPath(x,i);return M.update(),M},c=(e,t,o,n)=>{const r=t.minus(e),i=r.length(),{dash:a}=o;if(i<2*a)return;let c=Math.floor(i/a);1&c||c++;const d=i/c,l=[{cmd:"M",pt:e}];for(let t=0;t<c;t++){const o=r.times((t+1)*d/i).iadd(e);l.push({cmd:1&t?"M":"L",pt:o})}const u=new s.FigPath(l,n);return u.update(),u}},5686:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.softBondTemplate=void 0;const n=o(7757);t.softBondTemplate=(e,t,o)=>{var s;const r=null!==(s=e.dir)&&void 0!==s?s:new n.Point(1,0),i=r.x<0?-1:1,a=Math.abs(r.x)<.1,c=a?r:new n.Point(r.x*t.horizLine,r.y*t.line),d=a?n.Point.zero:new n.Point(i*t.nodeMargin,0),l=o.plus(d),u=l.plus(c);return{src:o,dst:u.plus(d),bondA:l,bondB:u,sign:i}}},3640:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tripleBond=void 0;const n=o(2299),s=o(6039);t.tripleBond=(e,t,o,r,i,a,c)=>{const d=i.minus(r).normal(),{lineSpace3:l}=o,u=a[0],h=a[1],p=a[2],m=(0,n.getBondStyleWidth)(o,u),f=(0,n.getBondStyleWidth)(o,h),g=(0,n.getBondStyleWidth)(o,p),v=d.transpon(!0).times(l+(m+f)/2),b=d.transpon().times(l+(g+f)/2);(0,s.singleLine)(e,t,o,r.plus(v),i.plus(v),u,c),(0,s.singleLine)(e,t,o,r,i,h,c),(0,s.singleLine)(e,t,o,r.plus(b),i.plus(b),p,c)}},4268:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.wedgeBond=void 0;const n=o(3470),s=o(3703);t.wedgeBond=(e,t,o,r,i)=>{const{chiralWidth:a,lineWidth:c,hatch:d}=o;if(i)return new n.FigHashTrapezoid(e,c,t,a,r,c,d);const l=t.minus(e).normal(),u=l.transpon(!0).times(a/2),h=l.transpon().times(a/2),p=t.plus(u),m=t.plus(h),f=l.transpon(!0).times(c/2),g=l.transpon().times(c/2),v=[{cmd:"M",pt:e.plus(f)},{cmd:"L",pt:p},{cmd:"L",pt:m},{cmd:"L",pt:e.plus(g)},{cmd:"Z"}];return new s.FigPath(v,{fill:r,cap:"round",strokeWidth:c})}},540:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AgentCmd=void 0,t.AgentCmd=class{canPush(e){return!1}postExec(e){}onPrevious(e,t){}}},1546:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AgentCmdBrClose=void 0;const n=o(540),s=o(2768),r=o(4466),i=o(45);class a extends n.AgentCmd{constructor(e){super(),this.end=e}onPrevious(e){e instanceof a&&(this.srcCmd=e)}canPush(e){let t=!0;return(0,r.unwind)(e,(o=>t&&o instanceof s.AgentCmdBrOpen?((0,i.processBrackets)(e,o,this),t=!1,!0):t)),!1}}t.AgentCmdBrClose=a},2768:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AgentCmdBrOpen=void 0;const n=o(540),s=o(1546),r=o(5825),i=o(3396),a=o(5652);class c extends n.AgentCmd{constructor(e){super(),this.begin=e,this.isBridge=!1}checkRtl(e,t){(0,i.ifDef)(t,(t=>{var o,n;e.rtlNodes.add(t.index),(0,i.ifDef)(null===(n=null===(o=this.begin)||void 0===o?void 0:o.end)||void 0===n?void 0:n.nodes[0],(t=>e.rtlNodes.add(t.index)))}))}canPush(e){return this.checkRtl(e,(0,i.ifDef)(this.begin.bond,(e=>(0,i.ifDef)(e.dir,(t=>t.x<0?e.nodes[1]:void 0))))),!0}onPrevious(e,t){if(e instanceof r.AgentCmdBridge||e instanceof c)e.dstCmd=this,this.srcCmd=e;else if(e instanceof s.AgentCmdBrClose)this.begin.nodes[0]=e.end.nodes[0],(0,i.ifDef)(this.begin.nodes[0],(e=>{t.rtlNodes.has(e.index)&&this.checkRtl(t,e)})),this.isBridge=!0,this.prevBracket=e;else{if(e instanceof a.AgentCmdNode){this.prevText=!0;const{node:o}=e;if(1===o.bonds.size){const e=Array.from(o.bonds)[0];(0,i.ifDef)(e.dir,(e=>{e.x<0&&this.checkRtl(t,o)}))}}const[o,n]=this.begin.nodes;(null==o?void 0:o.subChain)!==(null==n?void 0:n.subChain)&&(this.isBridge=!0)}}}t.AgentCmdBrOpen=c},5825:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AgentCmdBridge=void 0;const n=o(540),s=o(1546),r=o(4466);class i extends n.AgentCmd{onPrevious(e){e instanceof s.AgentCmdBrClose&&(this.srcCmd=e)}canPush(e){return(0,r.unwind)(e,(e=>e instanceof i)),!0}}t.AgentCmdBridge=i},3880:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AgentCmdMul=t.createAgentCmdMul=void 0;const n=o(540),s=o(2768),r=o(6879),i=o(3022),a=o(3925);t.createAgentCmdMul=e=>e.isFirst?new c(e):new a.AgentCmdMulBridge(e);class c extends n.AgentCmd{constructor(e){super(),this.mul=e}onPrevious(e){if(e instanceof s.AgentCmdBrOpen){const{begin:t}=e;t.nodes[1]||(t.nodes[1]=this.mul.nodes[1]),e.dstCmd=this}}canPush(e){const t=this.mul.nodes[1],{n:o}=this.mul;if(t&&o.isSpecified()){const o=(0,r.getNodeInfo)(t,e.nodesInfo),{cluster:n}=e.clusters.findByNode(t),{frame:s}=n,a=(0,i.createCoeff)(this.mul,e.props);a.org.set(s.bounds.left-a.bounds.width,o.res.rcNodeCore.bottom+o.res.nodeFrame.org.y),s.addFigure(a,!0),this.figure=a}return!1}postExec(){}}t.AgentCmdMul=c},3925:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AgentCmdMulBridge=void 0;const n=o(9447),s=o(5825),r=o(3022),i=o(7757),a=o(1546),c=o(2768),d=o(5443);class l extends s.AgentCmdBridge{constructor(e){super(),this.mul=e}postExec(e){const{mul:t}=this,{props:o}=e;let[s]=t.nodes;const l=t.nodes[1];let u=!1;!s&&this.srcCmd instanceof a.AgentCmdBrClose&&([s]=this.srcCmd.end.nodes,u=!0);const h=this.dstCmd instanceof c.AgentCmdBrOpen;if(!s||!l)return;const p=new n.FigFrame,{font:m,style:f}=o.getStyleColored("multiplier",t.color),g=.2*o.line,v=(0,d.drawMul)(o,m,f);if(v.org.x+=g,p.addFigure(v,!0),t.n.isSpecified()){const e=(0,r.createCoeff)(t,o);e.org.set(p.bounds.right+g,0),p.addFigure(e,!0)}else p.bounds.B.x+=g;const{cluster:b,srcConn:y}=e.clusters.unite(e,{node:s,allBox:u},{node:l,allBox:h},new i.Point(p.bounds.right,0));let C=y.yBase;void 0===C&&(C=y.yMiddle+m.getFontFace().ascent/2),p.org.set(y.x,C),b.frame.addFigure(p,!0)}}t.AgentCmdMulBridge=l},5652:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AgentCmdNode=void 0;const n=o(7757),s=o(540),r=o(1546),i=o(6879),a=o(45);class c extends s.AgentCmd{constructor(e){super(),this.node=e}canPush(e){const{prevBracket:t}=this;if(t){const o=t.end;if(o){const s=o.nodes[0],r=new n.Point;if(s){const t=(0,i.getNodeInfo)(s,e.nodesInfo);r.y=t.res.nodeFrame.org.y+t.res.center.y}const c=!!t.isRealText;(0,a.makeBridge)(e,o,!0,c)}}return!1}onPrevious(e){e instanceof r.AgentCmdBrClose&&(this.prevBracket=e)}}t.AgentCmdNode=c},2429:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AgentCmdSoftBond=void 0;const n=o(3396),s=o(7757),r=o(9585),i=o(5686),a=o(5825);class c extends a.AgentCmdBridge{constructor(e,t){super(),this.bond=e,this.agent=t}postExec(e){var t;const{bond:o,agent:{stA:a}}=this,c=e.props,{src:d,dst:l,bondA:u,bondB:h}=(0,i.softBondTemplate)(o,e.props,s.Point.zero),[p,m]=this.bond.nodes,f=l.minus(d),{cluster:g,srcConn:v,dstConn:b,srcNodeInfo:y,dstNodeInfo:C}=e.clusters.unite(e,{node:p,allBox:!!this.srcCmd},{node:m,allBox:!!this.dstCmd},f);if(o.isVisible()){const e=null!==(t=(0,n.ifDef)(v.yBase,(e=>(0,n.ifDef)(b.yBase,(()=>{var t,o;if(!y||!C)return;const n=null!==(t=y.res.rcNodeCore.height)&&void 0!==t?t:0,s=null!==(o=C.res.rcNodeCore.height)&&void 0!==o?o:0;return e-Math.min(n/2,s/2)})))))&&void 0!==t?t:v.yMiddle,i=new s.Point(v.x,e);u.iadd(i),h.iadd(i),(0,r.drawBondAB)({bond:o,bondA:u,bondB:h,frame:g.frame,imgProps:c,stA:a})}}}t.AgentCmdSoftBond=c},1996:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Clusters=t.mergeClusters=t.calcOffsetAbs=t.calcOffset=t.getClusterConnection=t.insertToCluster=void 0;const n=o(7788),s=o(9447),r=o(6879),i=o(7757),a=o(2012),c=o(3396);t.insertToCluster=(e,t,o)=>{const{frame:n,nodes:s}=e;s.add(t.index);const{res:i}=(0,r.getNodeInfo)(t,o);n.addFigure(i.nodeFrame,!0)};const d=(e,t)=>{const{bounds:o}=e.frame;return{x:t?o.left:o.right,yMiddle:(o.top+o.bottom)/2}};t.getClusterConnection=(e,t,o,n)=>{const{res:s}=o;let i,a,d,l;const{nodeFrame:u,rcNodeCore:h}=s;if(h.isEmpty()?l=u.org.y:(i=h.clone(),i.A.x=u.bounds.left,i.B.x=u.bounds.right,i.move(u.org),d=i.bottom,l=d-i.height/2,a=n?i.left:i.right),e){const{bounds:e}=t.frame;a=n?e.left:e.right}else void 0===a&&(a=(0,r.getNodeCenterPos)(o).x);return n?(0,c.ifDef)(o.left,(e=>{a=e.getRelativeBounds().left})):(0,c.ifDef)(o.right,(e=>{a=e.getRelativeBounds().right})),{x:a,yMiddle:l,yBase:d}},t.calcOffset=(e,t,o)=>new i.Point(e.x-t.x+o.x,(((e,t)=>void 0!==e.yBase&&void 0!==t.yBase)(e,t)?e.yBase-t.yBase:e.yMiddle-t.yMiddle)+o.y),t.calcOffsetAbs=(e,t,o)=>{const n=o.x>=0?e.frame.bounds.right-t.frame.bounds.left:e.frame.bounds.left-t.frame.bounds.right;return new i.Point(n+o.x,o.y)},t.mergeClusters=(e,t,o)=>{(0,a.addAllSet)(e.nodes,t.nodes),t.frame.figures.forEach((t=>{t.org.iadd(o),e.frame.addFigure(t,!0)}))},t.Clusters=class{constructor(){this.clusters=[]}init(e,o){const r={};e.forEach((e=>{const i=(0,n.getItemForced)(r,e.subChain,(()=>({frame:new s.FigFrame,nodes:new Set})));(0,t.insertToCluster)(i,e,o)})),this.clusters=Object.values(r)}findByIndex(e){const t=this.clusters.findIndex((t=>t.nodes.has(e)));if(t<0)throw new Error(`Not found node with index ${e}`);return{clusterIndex:t,cluster:this.clusters[t]}}findByNode(e){return this.findByIndex(e.index)}unite(e,o,n,s,a){const{cluster:c}=this.findByNode(o.node);if(!n.node)return{cluster:c,srcConn:{x:0,yMiddle:0},dstConn:{x:0,yMiddle:0},offset:i.Point.zero};const d=(0,r.getNodeInfo)(o.node,e.nodesInfo),{cluster:l,clusterIndex:u}=this.findByNode(n.node),h=(0,r.getNodeInfo)(n.node,e.nodesInfo),p=s.x>=0;let m;const f=(0,t.getClusterConnection)(o.allBox,c,d,!p),g=(0,t.getClusterConnection)(n.allBox,l,h,p);return m=a?(0,t.calcOffsetAbs)(c,l,s):(0,t.calcOffset)(f,g,s),(0,t.mergeClusters)(c,l,m),this.clusters.splice(u,1),{cluster:c,srcConn:f,dstConn:g,offset:m,srcNodeInfo:d,dstNodeInfo:h}}uniteRest(e){const{clusters:o}=this;for(;o.length>1;){const n=o[0],s=o[1],r=(0,t.calcOffset)(d(n,!1),d(s,!0),new i.Point(e.props.horizLine,0));(0,t.mergeClusters)(n,s,r),o.splice(1,1)}}}},4125:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PAgentCtx=void 0;const n=o(9447),s=o(1996);t.PAgentCtx=class{constructor(e,t){this.agent=e,this.props=t,this.nodesInfo=[],this.cmdStack=[],this.clusters=new s.Clusters,this.backs=[],this.rtlNodes=new Set,this.agentFrame=new n.FigFrame}}},45:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.processBrackets=t.makeBridge=void 0;const n=o(549),s=o(3396),r=o(7757),i=o(3945),a=o(5581),c=o(1789),d=o(4722),l=o(9447),u=o(4127),h=o(8617),p=o(1235),m=o(9512),f=o(7585),g=o(8556),v=o(9255),b=o(6879),y=o(1546),C=o(2768),w=o(9890),x=o(3880),P=(e,t,o,n,s,r)=>{var i;r&&(0,f.drawCharge)({charge:r,frame:e,rect:t,imgProps:o,color:n,styleId:"bracketCharge",type:"bracket"}),s&&s.isSpecified()&&(0,g.drawTextNear)({frame:e,rcCore:t,text:String(s),imgProps:o,style:o.getStyleColored("bracketCount",n),pos:null!==(i=s.pos)&&void 0!==i?i:"RB",type:"bracket"}),e.update()},M=({bracket:e,contentRect:t,isOpen:o,isText:n,props:s,nodeInfo:r,n:a,charge:c})=>{const{figure:d,y:m,rect:f}=n?((e,t,o,n,s)=>{const r=t.getStyleColored("bracket",e.color),i=new l.FigFrame,a=new u.FigText(e.text,r.font,r.style);i.addFigure(a,!0);const{top:c}=i.bounds,d=(0,v.getTextInternalRect)(a);return P(i,d,t,e.color,n,s),{figure:i,y:o.top-c,rect:d}})(e,s,t,a,c):((e,t,o,n,s,r)=>{var a;const c=(0,p.getRubberBracket)(e,t.text),d=new i.Rect(0,0,o.bracketWidth,n.height),u={fill:null!==(a=t.color)&&void 0!==a?a:o.stdStyle.style.fill},m=new l.FigFrame;m.addFigure((0,h.drawRubberFigure)(c,d,u,o),!0);const f=m.bounds.clone();return P(m,f,o,t.color,s,r),{figure:m,y:n.top,rect:f}})(o,e,s,t,a,c),g=o?t.left-f.width:t.right;return d.org.set(g,m),n&&!r.node.autoMode&&(d.org.y=r.res.nodeFrame.org.y),d};t.makeBridge=(e,t,o,n)=>{var s,i;const[a,c]=t.nodes;if(a&&c){const t={node:a,allBox:o},d={node:c,allBox:!0},l=e.rtlNodes.has(a.index)?-1:1;let u=0;const h=!n;if(h){const{cluster:t}=e.clusters.findByNode(a),{cluster:o}=e.clusters.findByNode(c),n=null!==(s=t.contentRect)&&void 0!==s?s:t.frame.bounds,r=null!==(i=o.contentRect)&&void 0!==i?i:o.frame.bounds;u=n.top-r.top+(n.height-r.height)/2}e.clusters.unite(e,t,d,new r.Point(l*e.props.bracketSpace,u),h)}},t.processBrackets=(e,o,l)=>{var u,h;const{begin:p}=o,{end:f}=l,{nodesInfo:g,agent:v,clusters:P,props:B}=e,{useTextBrackets:k,line:S,lineWidth:_}=B,O=p.nodes[1],N=f.nodeIn;if(!O||!N)return;const{cluster:T}=P.findByNode(O),A=(0,b.getNodeInfo)(O,g),j=(0,b.getNodeInfo)(N,g),F=!!k&&(0,d.isTextBracketsCached)(p,v.commands),E=(0,a.getBracketsContent)(p,v.commands);let R=((e,t)=>e.reduce(((e,o)=>{if(o instanceof c.ChemNode){const n=(0,b.getNodeInfo)(o,t).res.nodeFrame.getRelativeBounds();return e?(e.unite(n),e):n}return e}),void 0))(E,g);if((!R||R.isEmpty())&&1===E.length&&E[0]instanceof c.ChemNode){const{font:e}=B.getStyle("atom"),t=e.getFontFace(),o=(0,m.getFontHeight)(t)/2,n=(0,b.getNodeCenterPos)((0,b.getNodeInfo)(E[0],g));R=new i.Rect(new r.Point(n.x-_,n.y-o),new r.Point(n.x+_,n.y+o))}const L=R;if(!L)return;const I=null!==(u=(0,s.ifDef)(p.padding,(e=>(0,w.applyPadding)(L,e,S))))&&void 0!==u?u:L,D=F&&I.height===L.height;l.isRealText=D;const $=D?0:_;if((o.dstCmd instanceof C.AgentCmdBrOpen||o.dstCmd instanceof x.AgentCmdMul)&&o.dstCmd.figure){const e=o.dstCmd.figure.getRelativeBounds();I.updatePoint(new r.Point(e.left-$,e.center.y))}if(o.srcCmd instanceof y.AgentCmdBrClose&&o.srcCmd.figure){const e=o.srcCmd.figure.getRelativeBounds();I.updatePoint(new r.Point(e.left,e.center.y))}if(l.srcCmd instanceof y.AgentCmdBrClose&&l.srcCmd.figure){const e=l.srcCmd.figure.getRelativeBounds();I.updatePoint(new r.Point(e.right+$,e.center.y))}const{charge:H,n:W}=f,z=e=>e===(null==H?void 0:H.isLeft)?H:void 0,K=e=>e===(0,n.isLeftCoeff)(W.pos)?W:void 0,Q=M({isOpen:!0,bracket:p,isText:D,props:B,contentRect:I,nodeInfo:A,n:K(!0),charge:z(!0)}),q=M({isOpen:!1,bracket:f,isText:D,props:B,contentRect:I,nodeInfo:j,n:K(!1),charge:z(!1)});if(T.frame.addFigure(Q,!0),T.frame.addFigure(q,!0),A.left=Q,j.right=q,o.figure=Q,l.figure=q,T.contentRect=I,o.isBridge){const n=D&&(!!(null===(h=null==o?void 0:o.prevBracket)||void 0===h?void 0:h.isRealText)||!!o.prevText);(0,t.makeBridge)(e,o.begin,!!o.prevBracket,n)}}},9208:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildAgentPrior=void 0;const n=o(4125),s=o(5007),r=o(8436),i=o(482),a=o(7586),c=o(4127),d=o(9255),l=o(7145);t.buildAgentPrior=(e,t)=>{const o=new n.PAgentCtx(e,t),{agentFrame:u}=o;(0,s.prepareNodes)(o),(0,r.processCommands)(o),o.clusters.uniteRest(o),(0,i.drawAllBonds)(o);const h=o.clusters.clusters.shift();h&&(h.frame.figures.forEach((e=>u.addFigure(e))),u.update()),(0,l.drawBackground)(o);const p=(0,a.findAgentCenter)(o);if(e.n.isSpecified()){const o=t.getStyleColored("agentK",e.n.color),n=new c.FigText(e.n.toString(),o.font,o.style),s=(0,d.getTextInternalRect)(n);n.org.x=u.bounds.left-n.bounds.width-t.agentKSpace,n.org.y=p.y-s.center.y,u.addFigure(n,!0)}return{agentFrame:u,ctx:o,center:p}}},5920:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createAgentCmd=void 0;const n=o(1789),s=o(9064),r=o(5581),i=o(540),a=o(1546),c=o(2768),d=o(5652),l=o(2429),u=o(6839),h=o(3880);t.createAgentCmd=(e,t)=>{if(e instanceof s.ChemBond){if(e.soft)return new l.AgentCmdSoftBond(e,t)}else{if(e instanceof r.ChemBracketBegin)return new c.AgentCmdBrOpen(e);if(e instanceof r.ChemBracketEnd)return new a.AgentCmdBrClose(e);if(e instanceof u.ChemMul)return(0,h.createAgentCmdMul)(e);if(e instanceof n.ChemNode)return new d.AgentCmdNode(e);if(e instanceof u.ChemMulEnd)return}return new i.AgentCmd}},3022:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createCoeff=void 0;const n=o(4127);t.createCoeff=(e,t)=>{const o=t.getStyleColored("multiK",e.color);return new n.FigText(String(e.n),o.font,o.style)}},482:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawAllBonds=void 0;const n=o(9064),s=o(1518);t.drawAllBonds=e=>{const{agent:t,props:o,agentFrame:r,nodesInfo:i}=e;t.commands.forEach((e=>{e instanceof n.ChemBond&&!e.soft&&(0,s.drawBond)({bond:e,props:o,frame:r,nodesInfo:i,stA:t.stA})}))}},7145:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawBackground=t.makeBackFigure=t.calcBgRect=void 0;const n=o(7757),s=o(9447),r=o(6879),i=o(8550),a=o(7024),c=o(3396),d=o(9890);t.calcBgRect=(e,t=[])=>t.reduce(((t,o)=>{const n=(0,r.getNodeInfo)(o,e.nodesInfo).res.nodeFrame.getRelativeBounds();return t?t.unite(n):n}),void 0),t.makeBackFigure=(e,o)=>{const{nodes:l,isAll:u,padding:h,fill:p,stroke:m,strokeWidth:f,shape:g,borderRadius:v}=o,{agentFrame:b,props:y}=e;let C=u?b.bounds.clone():(0,t.calcBgRect)(e,l);if(!C)return new s.FigFrame;const w=C.clone();h&&(C=(0,d.applyPadding)(C,h,y.line));const x={};if(p&&(x.fill=p),m&&(x.stroke=m),f&&(x.strokeWidth=y.lineWidth*f),"round"===g){const t=((e,t,o)=>{const s=null!=o?o:e.agent.nodes,{center:i}=t;let a=0;return s.forEach((t=>{const o=(0,r.getNodeInfo)(t,e.nodesInfo).res.nodeFrame.getRelativeBounds(),s=o.center,c=new n.Point(s.x<i.x?o.left:o.right,s.y<i.y?o.top:o.bottom);a=Math.max(a,i.minus(c).lengthSqr())})),Math.sqrt(a)})(e,C,l),o=t+Math.min((C.width-w.width)/2,(C.height-w.height)/2);return new a.FigEllipse(C.center,new n.Point(o,o),x)}return"ellipse"===g?((e,t)=>{const o=e.center,s=e.width,r=e.height,i=(e,t)=>{const o=t*t+4*e*e,n=(-t+Math.sqrt(o))/(2*e);return{a:e/n,b:e*Math.sqrt(1-n*n)/n}};if(s>r){const{a:e,b:c}=i(s/2,r/2);return new a.FigEllipse(o,new n.Point(e,c),t)}const{a:c,b:d}=i(r/2,s/2);return new a.FigEllipse(o,new n.Point(d,c),t)})(C,x):((e,t,o)=>new i.FigRect(e,t,o))(C,x,(0,c.ifDef)(v,(e=>new n.Point(e*y.line,e*y.line))))},t.drawBackground=e=>{const{backs:o}=e;0!==o.length&&o.map((o=>(0,t.makeBackFigure)(e,o.params))).forEach(((t,o)=>e.agentFrame.insertFigure(o,t,!0)))}},5443:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawMul=void 0;const n=o(4127),s=o(7024),r=o(7757),i=o(9512);t.drawMul=(e,t,o)=>{const{mulRadius:a}=e;if(a){const e=t.getFontFace(),n=(0,i.getFontHeight)(e)*a;return new s.FigEllipse(new r.Point(n,.5*-e.capHeight),new r.Point(n,n),{fill:o.fill})}return new n.FigText(e.mulChar,t,o)}},7586:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.findDefaultY=t.calcExplicitCenter=t.findExplicitlyCentred=t.findAgentCenter=void 0;const n=o(7757),s=o(6879),r=o(3396);t.findAgentCenter=e=>{var o,n,s;return null!==(s=null!==(n=null!==(o=(0,t.calcExplicitCenter)((0,t.findExplicitlyCentred)(e.nodesInfo)))&&void 0!==o?o:i(e))&&void 0!==n?n:a(e.nodesInfo,e.agentFrame.bounds))&&void 0!==s?s:e.agentFrame.bounds.center};const i=e=>{const{agent:{stA:t},nodesInfo:o}=e;if(t.analyze(),1!==t.cycles.length)return;const r=t.cycles[0];return r.nodes.reduce(((e,t)=>e.iadd((0,s.getNodeCenterPos)((0,s.getNodeInfo)(t,o)))),new n.Point).scale(1/r.nodes.length)};t.findExplicitlyCentred=e=>e.filter((({node:e})=>e.bCenter)),t.calcExplicitCenter=e=>{const t=e.map((e=>(0,s.getNodeCenterPos)(e)));if(0!==t.length)return 1===t.length?t[0]:t.reduce(((e,t)=>e.iadd(t)),new n.Point).times(1/t.length)};const a=(e,o)=>(0,r.ifDef)((0,t.findDefaultY)(e),(e=>new n.Point(o.center.x,e)));t.findDefaultY=e=>{const t={};let o=0;e.forEach((e=>{var n;const r=Math.round(100*(0,s.getNodeCenterPos)(e).y),i=(null!==(n=t[r])&&void 0!==n?n:0)+1;t[r]=i,o=Math.max(i,o)}));let n=0,r=0;return Object.entries(t).forEach((([e,t])=>{t===o&&(n+=+e,r++)})),r?n/100/r:void 0}},5007:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.prepareNodes=void 0;const n=o(9447),s=o(7757),r=o(3945),i=o(8903);t.prepareNodes=e=>{const{agent:t,props:o}=e;t.nodes.forEach((t=>{var a;const c=null!==(a=(0,i.buildNode)(t,o))&&void 0!==a?a:{nodeFrame:new n.FigFrame,rcNodeCore:new r.Rect,center:new s.Point},d=t.pt.times(o.line),{nodeFrame:l,center:u}=c;l.org.iadd(d),l.org.isub(u),e.nodesInfo[t.index]={node:t,res:c}})),e.clusters.init(t.nodes,e.nodesInfo)}},8436:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.processCommands=void 0;const n=o(6517),s=o(5920),r=o(4466);t.processCommands=e=>{let t;e.agent.commands.forEach((o=>{if(o instanceof n.ChemBackground)return void e.backs.push(o);const r=(0,s.createAgentCmd)(o,e.agent);r&&(t&&r.onPrevious(t,e),r.canPush(e)&&e.cmdStack.unshift(r),t=r)})),(0,r.unwind)(e,(()=>!0))}},4466:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unwind=void 0,t.unwind=(e,t)=>{const{cmdStack:o}=e;for(;;){const n=o.shift();if(!n)return;if(!t(n))return void o.unshift(n);n.postExec(e)}}},6481:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildExpression=void 0;const n=o(1240),s=o(286),r=o(9447),i=o(9208),a=o(1420);t.buildExpression=(e,t)=>{const o=new r.FigFrame;let c=0;return e.entities.forEach((e=>{let r;if(e instanceof n.ChemAgent){const{agentFrame:o,center:n}=(0,i.buildAgentPrior)(e,t);r={frame:o,y:n.y}}else if(e instanceof s.ChemOp){const{frame:o,center:n}=(0,a.buildOp)(e,t);r={frame:o,y:n.y}}r&&(r.frame.org.y-=r.y,r.frame.org.x=c-r.frame.bounds.left,c+=r.frame.bounds.width+t.opSpace,o.addFigure(r.frame,!0))})),o.bounds.grow(1),{frame:o}}},4298:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildFrame=void 0;const n=o(830),s=o(6481),r=o(9208);t.buildFrame=(e,t)=>e instanceof n.ChemExpr?(0,s.buildExpression)(e,t).frame:(0,r.buildAgentPrior)(e,t).agentFrame},8208:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildItem=void 0;const n=o(9447),s=o(6602),r=o(8556),i=o(9255),a=o(2522),c=o(5107),d=o(7024),l=o(7757),u=o(7801),h=o(3396);t.buildItem=(e,t)=>{const o=new n.FigFrame;o.label="item";const{color:p}=e;let m;const{fig:f,rcCore:g}=e.walkExt({fig:void 0,rcCore:void 0,onText(e,t){const n=(0,s.drawText)(o,e,t);this.fig=n,this.rcCore=(0,i.getTextInternalRect)(n),m=t.font},onMarkup(e,n){m=n.font;const{fig:s,irc:r}=(0,a.drawTextWithMarkup)(e,t,n);o.addFigure(s,!0),this.fig=s,this.rcCore=r},atom(o){var n;this.onText(o.id,t.getStyleColored("atom",null!==(n=e.atomColor)&&void 0!==n?n:e.color))},radical(o){this.onText(o.label,t.getStyleColored("radical",e.color))},comment(o){this.onMarkup(o.text,t.getStyleColored("comment",e.color))},custom(o){this.onMarkup(o.text,t.getStyleColored("custom",e.color))},comma(){this.onText(",",t.getStyleColored("comma",e.color))}});if(g){const n=(n,s,i)=>(0,r.drawTextNear)({frame:o,rcCore:g,text:String(n),imgProps:t,style:t.getStyleColored(s,e.color),pos:i}),{atomNum:s,n:i,charge:a,mass:f,dots:v}=e;if(i.isSpecified()&&n(i.toString(),"itemCount","RB"),a&&n(a.text,"oxidationState","CU"),(0,h.ifDef)(f,(e=>n(e,"itemMass","LT"))),(0,h.ifDef)(s,(t=>{const o=""===t?(0,u.locateAtomNumber)(e):t;void 0!==o&&n(o,"atomNumber","LB")})),v){const e=g.clone();m&&(e.B.y-=m.getFontFace().descent,e.B.y-=t.lineWidth);const n=t.electronDotD/2,s=new l.Point(n,n);e.grow(t.lineWidth+n),(0,c.drawLewisShell)(e,v,t,(({p:e,color:n})=>{const r=new d.FigEllipse(e,s,{fill:n||p||t.stdStyle.style.fill});r.bounds.grow(t.lineWidth),o.addFigure(r)}))}}return o.update(),{itemFrame:o,figText:f,rcCore:g}}},8903:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildNode=void 0;const n=o(9447),s=o(8208),r=o(3945),i=o(7585),a=o(7519);t.buildNode=(e,t)=>{if((e.autoMode||(0,a.isEmptyNode)(e))&&!e.charge)return;const o=new n.FigFrame;o.label="node";const c=e.getCenterItem();let d,l,u=0;if(e.autoMode){const e=.2*t.line;o.bounds=new r.Rect(0,-e,e,0)}else e.items.forEach((e=>{const{itemFrame:n,rcCore:r}=(0,s.buildItem)(e,t);if(n.org.x=u-n.bounds.left,o.addFigure(n),r){const t=r.clone();t.moveXY(n.org.x,0),e===c&&(d=t.center),l?l.unite(t):l=t.clone()}u+=n.bounds.width})),o.update();const{charge:h}=e;return l=null!=l?l:o.bounds.clone(),h&&(0,i.drawCharge)({charge:h,frame:o,rect:l,imgProps:t,color:e.color}),d=null!=d?d:l.center,{nodeFrame:o,rcNodeCore:l,center:d}}},1420:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildOp=void 0;const n=o(4127),s=o(7757),r=o(9447),i=o(9255),a=o(3396),c=o(3703),d=o(2522);t.buildOp=(e,t)=>{var o;const n=[(0,a.ifDef)(e.commentPre,(o=>g(o,t,e.color))),(0,a.ifDef)(e.commentPost,(o=>g(o,t,e.color)))],{srcText:s,dstText:i}=e,c=n.reduce(((e,t)=>Math.max(e,t?t.fig.bounds.width:0)),0),d=new r.FigFrame,l=t.getStyleColored("operation",e.color),h=null!==(o=m[s])&&void 0!==o?o:u,{figOp:p,irc:v}=h(Object.assign({srcText:s,dstText:i,props:t,commWidth:c},l));return d.addFigure(p,!0),n.forEach(((e,t)=>(0,a.ifDef)(e,(e=>f(d,v,e,0===t))))),{frame:d,center:v.center}};const l=({props:e,style:t})=>({stroke:t.fill,strokeWidth:e.lineWidth}),u=({dstText:e,font:t,style:o})=>{const s=new n.FigText(e,t,o);return{figOp:s,irc:(0,i.getTextInternalRect)(s)}},h=e=>{const{props:t,style:o,font:n,commWidth:i,srcText:a,dstText:d}=e,{arrowD:u,arrowL:h,line:p}=t,m="--|>"===a,f=Math.max(p,n.getTextWidth(d)),g=Math.max(i+2*t.opSpace,f),v=g-h,b=[{cmd:"M",pt:s.Point.zero},{cmd:"L",pt:new s.Point(m?v:g,0)}],y=new c.FigPath(b,l(e));y.update();const C=[{cmd:"M",pt:new s.Point(v,-u)},{cmd:"L",pt:new s.Point(g,0)},{cmd:"L",pt:new s.Point(v,u)}];m&&C.push({cmd:"Z"});const w=m?{fill:o.fill}:l(e);w.join="miter";const x=new c.FigPath(C,w);x.update();const P=new r.FigFrame;return P.addFigure(y,!0),P.addFigure(x,!0),{figOp:P,irc:P.bounds}},p=e=>{const{props:t,style:o,font:n,commWidth:i,srcText:a,dstText:d}=e,{arrowD:u,arrowL:h,line:p}=t,m="<|--"===a,f=Math.max(p,n.getTextWidth(d)),g=Math.max(i+2*t.opSpace,f),v=[{cmd:"M",pt:new s.Point(g,0)},{cmd:"L",pt:new s.Point(m?h:0,0)}],b=new c.FigPath(v,l(e));b.update();const y=[{cmd:"M",pt:new s.Point(h,-u)},{cmd:"L",pt:new s.Point(0,0)},{cmd:"L",pt:new s.Point(h,u)}];m&&y.push({cmd:"Z"});const C=m?{fill:o.fill}:l(e);C.join="miter";const w=new c.FigPath(y,C);w.update();const x=new r.FigFrame;return x.addFigure(b,!0),x.addFigure(w,!0),{figOp:x,irc:x.bounds}},m={"--\x3e":h,"--|>":h,"<==>":e=>{const{props:t,commWidth:o}=e,{lineWidth:n,lineSpace2x:r,arrowD:i,arrowL:a,opSpace:d}=t,u=(r+n)/2,h=o+2*d,p=[{cmd:"M",pt:new s.Point(0,-u)},{cmd:"H",x:h-n},{cmd:"L",rel:!0,pt:new s.Point(-a,-i)},{cmd:"M",pt:new s.Point(h,u)},{cmd:"H",x:n},{cmd:"L",rel:!0,pt:new s.Point(a,i)}],m=new c.FigPath(p,Object.assign(Object.assign({},l(e)),{join:"miter"}));return m.update(),{figOp:m,irc:m.bounds}},"<--":p,"<|--":p,"<--\x3e":e=>{const{props:t,style:o,font:n,commWidth:i,srcText:a,dstText:d}=e,{arrowD:u,arrowL:h,line:p}=t,m="<|--|>"===a,f=Math.max(p,n.getTextWidth(d)),g=Math.max(i+2*t.opSpace,f),v=g-h,b=[{cmd:"M",pt:new s.Point(m?v:g,0)},{cmd:"L",pt:new s.Point(m?h:0,0)}],y=new c.FigPath(b,l(e));y.update();const C=[{cmd:"M",pt:new s.Point(h,-u)},{cmd:"L",pt:new s.Point(0,0)},{cmd:"L",pt:new s.Point(h,u)}];m&&C.push({cmd:"Z"});const w=m?{fill:o.fill}:l(e);w.join="miter";const x=new c.FigPath(C,w);x.update();const P=[{cmd:"M",pt:new s.Point(v,-u)},{cmd:"L",pt:new s.Point(g,0)},{cmd:"L",pt:new s.Point(v,u)}];m&&P.push({cmd:"Z"});const M=new c.FigPath(P,w);M.update();const B=new r.FigFrame;return B.addFigure(x,!0),B.addFigure(y,!0),B.addFigure(M,!0),{figOp:B,irc:B.bounds}}},f=(e,t,o,n)=>{const{fig:s,irc:r}=o,{bounds:i}=s;s.org.set(r.left+t.width/2-r.width/2,n?-(i.bottom-r.bottom)+t.top:t.bottom-r.top),e.addFigure(s,!0)},g=(e,t,o)=>{const n=t.getStyleColored("opComment",o);return(0,d.drawTextWithMarkup)(e.text,t,n)}},7585:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawCharge=void 0;const n=o(9447),s=o(3945),r=o(8556),i=o(7024),a=o(7757),c=o(3703);t.drawCharge=({charge:e,frame:t,rect:o,imgProps:n,color:s,styleId:i="nodeCharge",type:a})=>{var c;const l=n.getStyleColored(i,s),u=null!==(c=e.pos)&&void 0!==c?c:"RT",h="+"===e.text||"-"===e.text?d({frame:t,rect:o,text:e.text,isRound:e.isRound,pos:u,style:l,imgProps:n,type:a}):(0,r.drawTextNear)({frame:t,rcCore:o,text:e.text,imgProps:n,style:l,pos:u,type:a});t.updateFigure(h)};const d=e=>{const{frame:t,rect:o,text:d,isRound:l,pos:u,style:h,imgProps:p,type:m}=e,f=h.font.getFontFace(),g=p.lineWidth,v=.9*h.font.getTextWidth("+")-("-"===d?g:0),b=v,y=-f.capHeight,C=b/2,w=(y+0)/2,x=g/2,P="-"===d?[{cmd:"M",pt:new a.Point(0,w-x)},{cmd:"H",x:b},{cmd:"V",y:g,rel:!0},{cmd:"H",x:0},{cmd:"Z"}]:[{cmd:"M",pt:new a.Point(0,w-x)},{cmd:"H",x:C-x},{cmd:"V",y:w-v/2},{cmd:"H",rel:!0,x:g},{cmd:"V",y:w-x},{cmd:"H",x:b},{cmd:"V",rel:!0,y:g},{cmd:"H",x:C+x},{cmd:"V",y:w+v/2},{cmd:"H",rel:!0,x:-g},{cmd:"V",y:w+x},{cmd:"H",x:0},{cmd:"Z"}],M=new n.FigFrame,B=new c.FigPath(P,{fill:h.style.fill});if(B.update(),B.bounds.unite(new s.Rect(0,y,b,0)),M.addFigure(B),l){const e=new s.Rect(0,y,b,0),t=.5*Math.max(e.width,e.height),o=new i.FigEllipse(e.center,new a.Point(t,t),{stroke:h.style.fill});M.addFigure(o)}M.update();const k=M.bounds.clone();return k.A.y=-f.ascent,k.B.y=-f.descent,(0,r.moveNearFigure)(M,k,u,o,p,m),t.addFigure(M),t.update(),M}},5107:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawLewisShell=void 0;const n=o(3396),s=o(7757),r=3.5,i=[e=>new s.Point(e.right,e.bottom-e.height/r),e=>new s.Point(e.right-e.width/r,e.bottom),e=>new s.Point(e.left+e.width/r,e.bottom),e=>new s.Point(e.left,e.bottom-e.height/r),e=>new s.Point(e.left,e.top+e.height/r),e=>new s.Point(e.left+e.width/r,e.top),e=>new s.Point(e.right-e.width/r,e.top),e=>new s.Point(e.right,e.top+e.height/r)];t.drawLewisShell=(e,t,o,r)=>{const a=e.center,c=e.width+e.height;t.forEach((({angle:t,pos:d,color:l,margin:u})=>{const h=e.clone();u&&h.grow(u*o.line),(0,n.ifDef)(t,(e=>{const t=(0,s.pointFromDeg)(e).times(c).plus(a),{b:o}=h.clip(a,t);r({c:a,p:o,color:l})})),(0,n.ifDef)(d,(e=>{const t=i[e];t&&r({c:a,p:t(h),color:l})}))}))}},6602:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawText=void 0;const n=o(4127);t.drawText=(e,t,o)=>{const s=new n.FigText(t,o.font,o.style);return e.addFigure(s),s}},8556:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawTextNear=t.moveNearFigure=void 0;const n=o(1639),s=o(6602),r=o(7757),i=(e,t,o)=>"bracket"===o?"sup"===t?e.bracketSupKY:e.bracketSubKY:"sup"===t?e.supKY:e.subKY,a=(e,t,o)=>{const n=e.clone();if("bracket"===t){const e=2*o.lineWidth;n.A.x-=e,n.B.x+=e}return n};t.moveNearFigure=(e,t,o,s,c,d)=>{const l=a(s,d,c);if("number"==typeof o){const{center:s}=l,{b:i}=l.clip(s,s.plus((0,r.pointFromDeg)(o).times(l.width+l.height)));(0,n.isClose)(i.x,l.right)?e.org.x=i.x-t.left:(0,n.isClose)(i.x,l.left)?e.org.x=i.x-t.right:e.org.x=i.x-t.left-t.width/2,(0,n.isClose)(i.y,l.top)?e.org.y=i.y-t.bottom:(0,n.isClose)(i.y,l.bottom)?e.org.y=i.y-t.top:e.org.y=i.y-t.top-t.height/2}else"R"===o[0]?e.org.x=l.right-t.left:"L"===o[0]?e.org.x=l.left-t.right:"C"===o[0]&&(e.org.x=l.cx-.5*e.bounds.width),"T"===o[1]?e.org.y=l.top+t.height*(1-i(c,"sup",d)):"B"===o[1]?e.org.y=l.bottom+t.height*i(c,"sub",d):"U"===o[1]?e.org.y=l.top-t.bottom:"D"===o[1]&&(e.org.y=l.bottom-t.top)},t.drawTextNear=({frame:e,rcCore:t,text:o,imgProps:c,style:d,pos:l,type:u})=>{const h=a(t,u,c),p=(0,s.drawText)(e,o,d),m=p.font.getFontFace();if("number"==typeof l){const{center:e}=h,{b:t}=h.clip(e,e.plus((0,r.pointFromDeg)(l).times(h.width+h.height)));(0,n.isClose)(t.x,h.right)?p.org.x=t.x:(0,n.isClose)(t.x,h.left)?p.org.x=t.x-p.font.getTextWidth(o):p.org.x=t.x-p.font.getTextWidth(o)/2,(0,n.isClose)(t.y,h.top)?p.org.y=t.y+m.descent:(0,n.isClose)(t.y,h.bottom)?p.org.y=t.y+m.ascent:p.org.y=t.y+m.ascent/2}else"R"===l[0]?p.org.x=h.right:"L"===l[0]?p.org.x=-p.bounds.width:"C"===l[0]&&(p.org.x=h.cx-.5*p.bounds.width),"T"===l[1]?p.org.y=h.top+m.ascent*(1-i(c,"sup",u)):"B"===l[1]?p.org.y=h.bottom+m.ascent*i(c,"sub",u):"U"===l[1]?p.org.y=h.top+m.descent:"D"===l[1]&&(p.org.y=h.bottom+m.ascent);return p}},2522:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawTextWithMarkup=void 0;const n=o(9447),s=o(6644),r=o(3945),i=o(4127),a=o(1639),c=({chunk:e,imgProps:t,font:o,style:s,scale:a})=>{const d=new r.Rect(0,-o.getFontFace().ascent,0,0),l=new n.FigFrame;l.label="markup";let u=0,h=0;const p=()=>{u=l.bounds.right,h=u};return e.chunks.forEach((e=>{if("string"==typeof e){const t=new i.FigText(e,o,s);return t.org.x=l.bounds.right,l.addFigure(t,!0),void p()}const{type:n,color:r}=e;if("sup"===n||"sub"===n){const r="sup"===n,i=o.createScaled?o.createScaled(a):o,p=i.getFontFace(),m=p.ascent-p.descent,f=c({chunk:e,font:i,style:s,scale:a,imgProps:t}).fig;if(r){const e=m*t.supKY;f.org.set(u,d.top+p.ascent-e),u+=f.bounds.width}else{const e=m*t.subKY;f.org.set(h,d.bottom+e),h+=f.bounds.width}return void l.addFigure(f,!0)}const m=Object.assign({},s);r&&(m.fill=r);const f=c({chunk:e,imgProps:t,font:o,style:m,scale:a});f.fig.org.x=l.bounds.right,l.addFigure(f.fig,!0),p()})),d.B.x=l.bounds.right,{fig:l,irc:d}};t.drawTextWithMarkup=(e,t,{font:o,style:n})=>{const r=t.stdStyle.font.getFontFace().ascent,i=t.getStyle("itemCount").font.getFontFace().ascent,d=(0,a.is0)(r-i)?.7:i/r,l=(0,s.parseMarkup)(e);return c({chunk:l,imgProps:t,font:o,style:n,scale:d})}},9255:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getTextInternalRect=void 0,t.getTextInternalRect=e=>{const t=e.bounds.clone();return t.A.y=-e.font.getFontFace().ascent,t.B.y=0,t}},8583:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellRender=void 0;const n=o(9021),s=o(4886),r=o(3268),i=(e,t,o,n)=>`${(0,s.drawTag)(null!=n?n:"div",Object.assign(Object.assign({},o),{class:e}))+(0,r.escapeXml)(String(t))}</div>`,a={number:(e,t)=>t("number",e.n),id:(e,t)=>t("id",e.id),name:(e,t)=>t("name",n.Lang.tr(e.id)),mass:(e,t)=>t("mass",e.mass)};t.CellRender=class{constructor(e=["number","id","name","mass"]){"string"==typeof e&&(e=e.split(",")),this.fields=e.map((e=>"function"==typeof e?e:a[e]))}draw(e){return this.fields.map((t=>t?t(e,i):"")).join("")}}},206:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tableRulesEasyChemistry=void 0;const n=o(2380),s={tables:[{NCol:19,NRow:7},{NCol:15,NRow:2}],category:o(6535).categoryBlockDLa,points:{He:[18,0],B:[13,1],Al:[13,2],Ti:[4,3],Zr:[4,4],Ce:[1,0,1],Hf:[4,5],Th:[1,1,1],Rf:[4,6]},hardNotes:[{text:"*",x:3,y:5,cls:"chem-element f_block mtbl-note"},{text:"*<br>*",x:3,y:6,cls:"chem-element f2_block mtbl-note"},{text:"*",x:0,y:0,tblN:1,cls:"chem-element f_block mtbl-note"},{text:"*<br>*",x:0,y:1,tblN:1,cls:"chem-element f2_block mtbl-note"}],drawGroups:n.fallingNumbers,groupIds:"1,2,3,,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18".split(","),groupCls:"group-id",tableCls:"mentable easy-chem-table",elementBoxCls:"element-box"};t.tableRulesEasyChemistry=Object.freeze(s)},8784:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tableRulesShort=void 0;const n=o(9021),s=o(6535);t.tableRulesShort={tables:[{NCol:11,NRow:11,periodCols:2,groupRows:2},{NCol:15,NRow:2}],points:{H:[0,0],He:[10,0],Ne:[10,1],Ar:[10,2],Cu:[0,4],Kr:[10,4],Ag:[0,6],Xe:[10,6],La:[0,0,1],Hf:[3,7],Au:[0,8],Rn:[10,8],Ac:[0,1,1],Rf:[3,9],Rg:[0,10]},flLanAct:!0,notes:{La:[2,7],Ac:[2,9]},category:s.categoryBlock,categoryExt:[s.subGroup],groupIds:"I:a;b,II:a;b,III:a;b,IV:a;b,V:a;b,VI:a;b,VII:a;b,::R,VIII:b:LR,::LR,:a:L".split(","),groupCls:"chem-cell",drawGroups({cells:e,actualTables:t,rules:o}){const n=t[0],s=e[0];for(let e=0;e<n.NCol;e++){const t=o.groupIds[e].split(":"),r={cls:o.groupCls,rowspan:2,text:`${t[0]}<div class="mentable-subgroup-hd">`};if(t.length>1){const e=t[1].split(";");2===e.length?r.text+=`<span class="left">${e[0]}</span><span class="right">${e[1]}</span>`:r.text+=e[0]}t.length>2&&(t[2].indexOf("L")>=0&&(r.cls+=" noleft"),t[2].indexOf("R")>=0&&(r.cls+=" noright")),r.text+="</div>",s[n.y1-2][e+n.x1]=r,s[n.y1-1][e+n.x1]={colspan:0}}},drawPeriods({cells:e,actualTables:t}){let o=1;const n=t[0],s=e[0];for(let e=0;e<n.NRow;e++){const t=e<3||1&e?{text:String(o++),cls:"period-id"}:{colspan:0};t&&e>=3&&(t.rowspan=2),s[n.y1+e][n.x1-2]=t}for(let e=0;e<n.NRow;e++)s[n.y1+e][n.x1-1]={text:String(e+1),cls:"period-id"}},post({cells:e}){this.flGroups&&this.flPeriods&&(e[0][0][0]={text:`${n.Lang.tr("Group")}→`,cls:"mentable-text period-id",colspan:2},e[0][0][1]={colspan:0},e[0][1][0]={text:n.Lang.tr("Period"),cls:"mentable-text period-id"},e[0][1][1]={text:n.Lang.tr("Row"),cls:"mentable-text period-id"})},pre({cells:e,actualTables:t}){const o=e[0],n=t[0];for(let e=0;e<n.NRow;e++){const t=o[e+n.y1];for(let e=0;e<n.NCol;e++)t[e+n.x1]=e>6&&e<10?{cls:"chem-row"}:{cls:"chem-cell"}}}}},5983:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tableRulesStd=void 0;const n=o(2380),s={tables:[{NCol:18,NRow:7},{NCol:15,NRow:2}],category:o(6535).categoryProps,points:{He:[17,0],B:[12,1],Al:[12,2],La:[0,0,1],Hf:[3,5],Ac:[0,1,1],Rf:[3,6]},notes:{La:[2,5],Ac:[2,6]},drawGroups:n.fallingNumbers,groupIds:["1A","2A","3B","4B","5B","6B","7B","┌──","─8B─","──┐","1B","2B","3A","4A","5A","6A","7A","8A"],groupCls:"group-id"};t.tableRulesStd=Object.freeze(s)},2103:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tableRulesWide=void 0;const n=o(2380),s={tables:[{NCol:32,NRow:7,ofsX:1,ofsY:1,width:33,height:8}],category:o(6535).categoryProps,points:{H:[0,0],He:[31,0],B:[26,1],Al:[26,2],Sc:[16,3],Y:[16,4]},groupIds:"1A,2A,,,,,,,,,,,,,,,3B,4B,5B,6B,7B,┌──,8B,──┐,1B,2B,3A,4A,5A,6A,7A,8A".split(","),groupCls:"group-id",drawGroups:n.fallingNumbers};t.tableRulesWide=Object.freeze(s)},4910:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawPeriodicTable=void 0;const n=o(9021),s=o(149),r=o(3396),i=o(8583),a=o(5983),c=o(4886);t.drawPeriodicTable=(e=a.tableRulesStd)=>{const{tables:t,category:o,categoryExt:d=[],points:l,notes:u,cellFields:h}=e,{cellRender:p=new i.CellRender(h)}=e,m=[],f=t.map(((t,o)=>{const{NCol:n,NRow:s,ofsX:r=0,ofsY:i=0}=t,{width:a=n,height:c=s}=t,d=Object.assign(Object.assign({},t),{width:a,height:c,ofsX:r,ofsY:i,w1:a,h1:c,x1:r,y1:i});if(0===o){const{groupRows:t=1,periodCols:o=1}=d;e.flGroups&&(d.y1+=t,d.h1+=t),e.flPeriods&&(d.x1+=o,d.w1+=o)}const l=[];for(let e=0;e<d.h1;e++)l[e]=new Array(d.w1);return m[o]=l,d}));e.pre&&e.pre({cells:m,actualTables:f,rules:e});const g=[...o?[o]:[],...d].map((e=>{const t={};return Object.entries(e).forEach((([e,o])=>{(Array.isArray(o)?o:o.split(",")).forEach((o=>{t[o]=e}))})),t}));let v=0,b=f[v],y=b.y1,C=b.x1;const w=new Array(g.length);if(s.PeriodicTable.elements.forEach((e=>{const{id:t}=e;(0,r.ifDef)(l[t],(e=>{var t;v=null!==(t=e[2])&&void 0!==t?t:0,b=f[v],C=e[0]+b.x1,y=e[1]+b.y1}));let o="chem-element";g.forEach(((e,n)=>{(0,r.ifDef)(e[t],(e=>{w[n]=e})),o+=` ${w.join(" ")}`})),m[v][y][C]={elem:e,cls:o},++C===b.x1+b.NCol&&(C=b.x1,y++)})),e.flGroups)if(e.drawGroups)e.drawGroups({cells:m,actualTables:f,rules:e});else for(C=0;C<b.NCol;C++)m[0][b.y1-1][b.x1+C]={text:String(C+1)};if(b=f[0],e.flPeriods){const{drawPeriods:t}=e;if(t)t({cells:m,actualTables:f,rules:e});else for(C=0;C<b.NRow;C++)m[0][b.y1+C][b.x1-1]={text:String(C+1),cls:"period-id"}}e.post&&e.post({cells:m,actualTables:f,rules:e});const x={La:`57-71<br>${n.Lang.tr("Lanthanides")}`,Ac:`89-103<br>${n.Lang.tr("Actinides")}`};e.flLanAct&&u&&(b=f[0],Object.entries(u).forEach((([e,t])=>{m[0][t[1]+b.y1][t[0]+b.x1]={text:x[e],cls:"chem-cell mentable-text"}}))),(0,r.ifDef)(e.hardNotes,(e=>e.forEach((({text:e,x:t,y:o,tblN:n=0,cls:s})=>{const r=f[n];m[n][o+r.y1][t+r.x1]={text:e,cls:s}}))));let P="";return m.forEach(((t,o)=>{var n;P+=null!==(n=(0,r.ifDef)(e.beginTable,(t=>t(o,e))))&&void 0!==n?n:(0,c.drawTag)("table",{class:e.tableCls||"mentable"}),t.forEach((t=>{P+="<tr>";for(const o of t)o?0!==o.colspan&&(P+=`<td class="${o.cls||"chem-element"}"`,o.colspan&&(P+=` colspan="${o.colspan}"`),o.rowspan&&(P+=` rowspan="${o.rowspan}"`),P+=">",o.elem?(e.elementBoxCls&&(P+=(0,c.drawTag)("div",{class:e.elementBoxCls})),P+=p.draw(o.elem),e.elementBoxCls&&(P+="</div>")):o.text&&(P+=o.text),P+="</td>"):P+="<td></td>";P+="</tr>"})),P+="</table>"})),P}},2380:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fallingNumbers=void 0,t.fallingNumbers=({cells:e,actualTables:t,rules:o})=>{var n,s,r,i,a,c;const d=e[0],l=t[0],u=[],h=[];let p;for(let e=0;e<l.NCol;e++){const t=l.x1+e;for(u.push(t),p=l.y1;p<d.length&&!d[p][t];)p++;h.push(p),p<d.length&&(d[p-1][t]={text:null!==(s=null===(n=o.groupIds)||void 0===n?void 0:n[e])&&void 0!==s?s:"",cls:o.groupCls})}if(p=h[7],(null!==(a=null===(i=null===(r=o.groupIds)||void 0===r?void 0:r[8])||void 0===i?void 0:i.indexOf("8B"))&&void 0!==a?a:-1)>=0&&p<d.length&&p===h[8]&&h[8]===h[9]){const e=null!==(c=u[7])&&void 0!==c?c:0;p--,d[p][e].text+=d[p][e+1].text+d[p][e+2].text,d[p][e].colspan=3,d[p][e+1].colspan=0,d[p][e+2].colspan=0}}},6672:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.findCategory=void 0;const n=o(149),s=o(3396),r=o(9021),i=new Map;t.findCategory=(e,t,o)=>{var a;if(!i.has(e)){const t={};i.set(e,t);const o=Object.entries(e).reduce(((e,[t,o])=>(o.split(",").forEach((o=>{e[o]=t})),e)),{});let r="";n.PeriodicTable.elements.forEach((({id:e})=>{(0,s.ifDef)(o[e],(e=>{r=e})),t[e]=r}))}let c=null!==(a=i.get(e)[t])&&void 0!==a?a:"";return c=c.replace(/-/g," ").replace(/_/g,"-"),c=r.Lang.tr(c,{},o),c}},6535:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.subGroup=t.categoryProps=t.categoryBlockDLa=t.categoryBlock=void 0,t.categoryBlock={s_block:"H,Na,K,Rb,Cs,Fr",p_block:"B,Al,Ga,In,Tl,Nh",d_block:"Sc,Y,Hf,Rf",f_block:"La,Ac"},t.categoryBlockDLa={s_block:"H,Na,K,Rb,Cs,Fr",p_block:"B,Al,Ga,In,Tl,Nh",d_block:"Sc,Y,La,Hf,Ac,Rf",f_block:"Ce",f2_block:"Th"},t.categoryProps={"Alkali-metals":"Li,Na,K,Rb,Cs,Fr","Alkaline-earth-metals":"Be,Mg,Ca,Sr,Ba,Ra",Lanthanides:"La",Actinides:"Ac","Transition-metals":"Sc,Y,Hf,Rf,Cn","Post-transition-metals":"Al,Ga,In,Tl,Nh",Metalloids:"B,Si,Ge,Sb","Other-nonmetals":"H,C,P,Se",Halogens:"F,Cl,Br,I,At,Ts","Noble-gases":"He,Ne,Ar,Kr,Xe,Rn,Og"},t.subGroup={subgr_a:"H,Ga,In,Tl",subgr_b:"Sc,Y,La,Ac"}},7375:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},6074:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addItemProps=void 0;const n=o(7801),s=o(6728),r=o(3396);t.addItemProps=(e,t)=>{var o;const{color:i}=e;e.n.isSpecified()&&t({type:"k",k:e.n,pos:"RB",kType:"item",color:i});const a=e.atomNum;let c;if("number"==typeof a||""===a){const r=""===a?(0,n.locateAtomNumber)(e):a;c=null!==(o=e.mass)&&void 0!==o?o:0,void 0!==r&&t({type:"k",k:new s.ChemK(r),pos:"LB",kType:"item",color:i})}else c=(0,r.ifDef)(e.mass,(e=>e));void 0!==c&&t({type:"k",k:new s.ChemK(c),pos:"LT",kType:"item",color:i}),e.charge&&t({type:"charge",charge:e.charge,color:i,pos:"T"})}},2324:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildTextNodes=void 0;const n=o(549),s=o(6074),r=o(2356),i=o(7683),a=o(9771);t.buildTextNodes=e=>{const t={type:"group",groupType:"expr"},o=[t],c=(e,t)=>{var o;t.items=null!==(o=t.items)&&void 0!==o?o:[],t.items.push(e)},d=e=>c(e,o[0]),l=e=>(d(e),o.unshift(e),e),u=e=>l({type:"group",groupType:e}),h=()=>o.shift();let p,m,f,g,v,b=!1;const y=e=>{if(p){const t={type:"space",spaceType:"agentOp"};"agent"===p&&"agent"===e?t.spaceType="agentAgent":"op"===p&&"op"===e&&(t.spaceType="opOp"),d(t)}p=e};return e.walk({agentPre(e){y("agent"),u("agent"),e.n.isSpecified()&&d({type:"k",k:e.n,kType:"agent",color:e.n.color})},agentPost(){(0,a.correctBondsDirection)(o[0]),h()},atom(e){b||d({type:"atom",atom:e,color:null!=g?g:v})},bond(e){d({type:"bond",bond:e,color:e.color})},bracketBegin(e){l({type:"brackets",color:e.color}),u(),d({type:"bracket",text:e.text,begin:!0,color:e.color})},bracketEnd(e){d({type:"bracket",text:e.text,begin:!1,color:e.color}),(0,a.correctBondsDirection)(o[0]),h(),e.n.isSpecified()&&d({type:"k",k:e.n,kType:"bracket",pos:(0,n.isLeftCoeff)(e.n.pos)?"LB":"RB"}),e.charge&&d({type:"charge",charge:e.charge,pos:e.charge.isLeft?"LT":"RT"}),h()},comma(){d({type:"comma"})},comment(e){d({type:"comment",comment:e,items:[(0,i.splitRichText)(e.text,v)],color:v})},custom(e){d({type:"custom",custom:e,items:[(0,i.splitRichText)(e.text,v)],color:v})},itemPre(e){if(b)return;v=e.color,g=e.atomColor;const t=l({type:"item",item:e,color:e.color});m=m||t,f=t},itemPost(e){b||((0,s.addItemProps)(e,d),h())},mul(e){e.isFirst||d({type:"mul",color:e.color}),u(),e.n.isSpecified()&&d({type:"k",k:e.n,kType:"mul"})},mulEnd(){h()},nodePre(e){m=void 0,f=void 0,b=e.autoMode,u("node")},nodePost(e){if(h(),e.charge){const{isLeft:t}=e.charge,o=t?m:f;o&&c({type:"charge",charge:e.charge,pos:t?"LT":"RT"},o)}},operation(e){y("op"),d((0,r.createTextOp)(e))},radical(e){d({type:"radical",radical:e,color:v})}}),t}},3612:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cloneTextNode=void 0,t.cloneTextNode=e=>{var o;return Object.assign(Object.assign({},e),{items:null===(o=e.items)||void 0===o?void 0:o.map(t.cloneTextNode)})}},9771:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.correctBondsDirection=void 0,t.correctBondsDirection=e=>{var t,o;if("group"!==(null==e?void 0:e.type))return;const{items:n}=e;if(!(null==n?void 0:n.some((e=>"bond"===e.type&&e.bond.isNeg))))return;n.reverse();const s=n.length-1;if(s>0&&"bracket"===(null===(t=n[0])||void 0===t?void 0:t.type)&&"bracket"===(null===(o=n[s])||void 0===o?void 0:o.type)){const e=n[0];n[0]=n[s],n[s]=e}}},2356:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createTextOp=void 0;const n=o(7683);t.createTextOp=e=>{const t={type:"op",op:e,color:e.color},{commentPre:o,commentPost:s}=e;if(!o&&!s)return t;const r=[t],i={type:"column",columnType:"op",color:e.color,items:r};return o&&r.push(Object.assign(Object.assign({},(0,n.splitRichText)(o.text,e.color)),{pos:"T"})),s&&r.push(Object.assign(Object.assign({},(0,n.splitRichText)(s.text,e.color)),{pos:"B"})),i}},1756:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dictKeys=void 0,t.dictKeys=e=>Object.entries(e).filter((([,e])=>void 0!==e)).map((([e])=>e)).sort().join(",")},4678:function(e,t,o){var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var s=Object.getOwnPropertyDescriptor(t,o);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,s)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),s=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||n(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),s(o(2324),t),s(o(7375),t)},3899:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.optimizeColors=void 0,t.optimizeColors=(e,o)=>{const n=o(e);if(!n)return;const{color:s}=e;n.forEach((e=>(0,t.optimizeColors)(e,o)));const r=new Set;n.forEach((e=>{var t;return r.add(null!==(t=e.color)&&void 0!==t?t:"")}));const i=Array.from(r).sort();1===i.length&&i[0]?(e.color=i[0],n.forEach((e=>{delete e.color}))):2!==i.length||i[0]||i[1]!==e.color?s&&r.has(s)&&n.forEach((e=>{e.color===s&&delete e.color})):n.forEach((e=>{delete e.color}))}},1252:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.splitColumn=void 0,t.splitColumn=(e=[])=>{const t={};return e.forEach((e=>{var o;const{pos:n}=e,s="T"===n||"B"===n?n:"C";t[s]=[...null!==(o=t[s])&&void 0!==o?o:[],e]})),t}},7683:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.splitRichText=void 0;const n=o(6644);t.splitRichText=(e,t)=>{const o=(e,t)=>{var n;if("string"==typeof e)return{type:"text",text:e,color:t};const s=null!==(n=e.color)&&void 0!==n?n:t,r={type:"richText",items:e.chunks.map((e=>o(e,s))),color:s};return"sub"===e.type?r.pos="RB":"sup"===e.type&&(r.pos="RT"),r};return o(s((0,n.parseMarkup)(e)),t)};const s=e=>{const{chunks:t}=e,o=[[]];t.forEach((e=>{("string"==typeof e||"sub"!==e.type&&"sup"!==e.type)&&o.unshift([]),o[0].push(e)})),o.reverse();const n=o.filter((e=>e.length>0)).map((e=>1===e.length?e[0]:{type:"",chunks:e}));return Object.assign(Object.assign({},e),{chunks:n})}},1480:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.splitScripts=void 0;const n=o(3396),s={C:"C",T:"C",B:"C",LT:"LT",RT:"RT",LB:"LB",RB:"RB"};t.splitScripts=(e=[])=>{const t={};return e.forEach((e=>{var o,r;const{pos:i}=e,a=null!==(o=(0,n.ifDef)(i,(e=>s[e])))&&void 0!==o?o:"C";t[a]=[...null!==(r=t[a])&&void 0!==r?r:[],e]})),t}},6996:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.htmlRichCls=void 0,t.htmlRichCls=e=>(Array.isArray(e)?e:[e]).map((e=>`cch-${e}`)).join(" ")},5494:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildHtmlRich=void 0;const n=o(3612),s=o(9225);t.buildHtmlRich=(e,t)=>{const o=(0,n.cloneTextNode)(e),r={options:t};(null==t?void 0:t.srcMap)&&(r.srcMap={});const i={nodes:(0,s.createHtmlRichNodes)(o,r)};return r.srcMap&&(i.srcMap=r.srcMap),i}},2150:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cchOperation=void 0;const n=o(4393);t.cchOperation=(e,t,o)=>{const r=s(e,t,o),i=["op"],a=[];return r&&(i.push("op-arrow"),a.push(r)),(0,n.makeCchTag)({ctx:e,srcNode:t,cls:i,attrs:{"data-op":o.srcText},content:[...a,(0,n.makeCchTag)({ctx:e,srcNode:void 0,cls:"op-code",content:o.dstText})]})};const s=(e,t,o)=>{const{srcText:s}=o;return"--\x3e"===s||"--\x3e"===s?i(e):"<--"===s||"<|--"===s?a(e):"<==>"===s?(0,n.makeCchTag)({ctx:e,srcNode:t,cls:"arrow-both",content:[c(e),d(e)]}):"<--\x3e"===s||"<|--|>"===s?(0,n.makeCchTag)({ctx:e,srcNode:t,cls:["arrow-bidir"],content:[a(e),i(e)]}):void 0},r=({ctx:e,width:t,height:o,d:s,cls:r})=>{const i={width:t/1e3+"em",height:o/1e3+"em",viewBox:`0 0 ${t} ${o}`,preserveAspectRatio:"xMaxYMin slice",fill:"currentColor"};return(0,n.makeCchTag)({ctx:e,srcNode:void 0,cls:r,content:[{tag:"svg",attrs:i,content:[{tag:"path",attrs:{d:s}}]}]})},i=e=>r({ctx:e,cls:"arrow-fwd",width:4e5,height:522,d:"M0 241v40h399891c-47.3 35.3-84 78-110 128\n-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20\n  11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7\n  39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85\n-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5\n-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67\n  151.7 139 205zm0 0v40h399900v-40z"}),a=e=>r({ctx:e,width:4e5,height:522,cls:"arrow-bkwd",d:"M400000 241H110l3-3c68.7-52.7 113.7-120\n 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8\n-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247\nc-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208\n 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3\n 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202\n l-3-3h399890zM100 241v40h399900v-40z"}),c=e=>r({ctx:e,width:4e5,height:901,cls:"arrow-both-left",d:"M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202\nc4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5\nc-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130\ns-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47\n121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6\ns2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11\nc0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z\nM100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z"}),d=e=>r({ctx:e,width:4e5,height:901,cls:"arrow-both-right",d:"M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32\n  -27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0\n  13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39\n  -84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5\n  -119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5\n  -12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67\n  151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z"})},9225:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createHtmlRichNodes=void 0;const n=o(6518),s=o(1252),r=o(1480),i=o(6996),a=o(9538),c=o(4393),d=o(2150),l=o(6713);t.createHtmlRichNodes=(e,t)=>{var o;const n=(o,n)=>[(0,c.makeCchTag)({ctx:t,srcNode:e,content:o,cls:n})];switch(e.type){case"atom":return n(e.atom.id);case"bond":return n(null!==(o=u[e.bond.tx])&&void 0!==o?o:e.bond.tx);case"bracket":return n(e.text);case"brackets":return v(e,t,(e=>h(e,t)));case"charge":return y(e,e.charge.text,t);case"column":return"op"===e.columnType?M(e,t):[];case"comma":return n(",");case"comment":case"richText":return w(e,t);case"custom":return[(0,c.makeCchTag)({ctx:t,srcNode:e,cls:"symbols",content:h(e.items,t)})];case"group":return"node"!==e.groupType&&e.groupType?m(e,e.groupType,t):h(e.items,t);case"item":return g(e,t);case"k":return n(e.k.toString(),"agent"===e.kType?"agent-k":void 0);case"mul":return n("∙","mul");case"op":return[(0,d.cchOperation)(t,e,e.op)];case"radical":return n(e.radical.label);case"space":return[];case"text":return n((0,l.textInsideTag)(e.text))}return[]};const u={"-":"–"},h=(e,o)=>(null!=e?e:[]).map((e=>(0,t.createHtmlRichNodes)(e,o))).flatMap((e=>e)),p=e=>{var t,o;return"item"===e.type?(null!==(t=e.items)&&void 0!==t?t:[]).some((e=>"T"===e.pos)):(null!==(o=e.items)&&void 0!==o?o:[]).some(p)},m=(e,t,o)=>{let n;return"expr"===t?n="expr":"agent"===t&&(n=["agent"],p(e)&&n.push("has-over")),[(0,c.makeCchTag)({ctx:o,srcNode:e,cls:n,content:()=>h(e.items,o)})]},f=(e,t,o)=>{let n;if(1===(null==e?void 0:e.length)){const o=h(e,t);1===o.length&&(n=o[0])}return n||(n=(0,c.makeCchTag)({ctx:t,srcNode:void 0,content:()=>h(e,t)})),o&&(0,a.addClassToXmlNode)(n,(0,i.htmlRichCls)(o)),n},g=(e,t)=>{const o=()=>v(e,t,(e=>b((0,s.splitColumn)(e),t)));return t.srcMap?[(0,c.makeCchTag)({ctx:t,srcNode:e,content:o,cls:"node-item"})]:o()},v=(e,t,o)=>{const{items:s=[]}=e,i=[],a=(0,r.splitScripts)(s),d=(e,o,n)=>{i.push((0,c.makeCchTag)({ctx:t,srcNode:void 0,cls:n?["supsub","supsub-left"]:"supsub",content:()=>[f(e,t),f(o,t)]}))};return(a.LT||a.LB)&&d(a.LT,a.LB,!0),a.C&&(0,n.addAll)(i,o(a.C)),(a.RT||a.RB)&&d(a.RT,a.RB,!1),i},b=(e,t)=>{if(!e.T&&!e.B)return h(e.C,t);const o=[f(e.C,t)];let n;return e.T&&(n="over",o.push(f(e.T,t))),[(0,c.makeCchTag)({ctx:t,srcNode:void 0,cls:n,content:o})]},y=(e,t,o)=>{const n=e=>"-"===e?(0,c.makeCchTag)({ctx:o,srcNode:void 0,cls:"minus",content:"–"}):(0,c.makeCchTag)({ctx:o,content:e,srcNode:void 0});return[(0,c.makeCchTag)({ctx:o,srcNode:e,cls:"charge",content:t.includes("-")?()=>C(t,n):t})]},C=(e,t)=>e.split(/(-)/).filter((e=>!!e)).map(t),w=(e,t)=>{var o;const n=(0,r.splitScripts)(null!==(o=e.items)&&void 0!==o?o:[]);return n.RB||n.RT?[(0,c.makeCchTag)({ctx:t,srcNode:e,cls:"symbols",content:()=>[...h(n.C,t),(0,c.makeCchTag)({ctx:t,srcNode:void 0,cls:"supsub",content:()=>[f(n.RT,t),f(n.RB,t)]})]})]:h(n.C,t)},x=(e,t)=>(0,c.makeCchTag)({ctx:e,srcNode:void 0,cls:"op-comment",content:()=>h(t,e)}),P=(e,t,o,n)=>[(0,c.makeCchTag)({ctx:e,srcNode:t,cls:o,content:n})],M=(e,t)=>{var o;const{C:n,T:r,B:i}=(0,s.splitColumn)(null!==(o=e.items)&&void 0!==o?o:[]),a=()=>f(n,t,"op-code");return r&&i?P(t,e,"op-both",(()=>[x(t,r),a(),x(t,i)])):r?P(t,e,"op-head",(()=>[x(t,r),a()])):i?P(t,e,"op-footer",(()=>[a(),x(t,i)])):[]}},4393:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeCchTag=void 0;const n=o(6996);t.makeCchTag=e=>{var t;const{content:o,ctx:s,srcNode:r,cls:i}=e,a={tag:"span"};e.attrs&&(a.attrs=e.attrs),(null==r?void 0:r.color)&&(a.color=r.color);const c=(e,t)=>{let{attrs:o}=a;o||(o={},a.attrs=o),o[e]=t};if(null===(t=s.options)||void 0===t?void 0:t.idGen){const e=s.options.idGen(r);e&&(c("id",e),s.srcMap&&r&&(s.srcMap[e]={txtNode:r}))}return i&&c("class",(0,n.htmlRichCls)(i)),o&&(a.content="function"==typeof o?o():o),a}},5842:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mathMLRootAttrs=void 0,t.mathMLRootAttrs=e=>{const t={};let o=null==e?void 0:e.namespace;return void 0!==o&&!0!==o||(o="http://www.w3.org/1998/Math/MathML"),o&&(t.xmlns=o),t}},5510:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildMathML=void 0;const n=o(3396),s=o(2955),r=o(3642),i=o(5842);t.buildMathML=(e,t)=>{const o={tag:"math",attrs:(0,i.mathMLRootAttrs)(t),content:(0,n.ifDef)((0,r.createMathMLNode)(e,{}),(e=>[e]))};return(0,s.optimizeXmlColors)(o),o}},3642:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stdOp=t.stdOpsDict=t.createMathMLNode=void 0;const n=o(6713),s=o(1252),r=o(2007),i=o(3706),a=o(7290),c=o(2384),d=o(5167),l=o(8866),u=o(6121);t.createMathMLNode=(e,o)=>{var h,p,m;let f;const g=e=>(0,t.createMathMLNode)(e,o),{color:v}=e;switch(e.type){case"atom":f=(0,i.mathItem)(e.atom.id,v);break;case"charge":f=(0,l.mathText)(Object.assign(Object.assign({},o),{textMode:"charge"}),e.charge.text,v);break;case"column":f=(0,r.mathColumn)((0,s.splitColumn)(null!==(h=e.items)&&void 0!==h?h:[]),g);break;case"comma":f={tag:"mo",content:",",color:v};break;case"custom":f=((e,o)=>{var n;const s=Object.assign(Object.assign({},o),{textMode:"custom"});return(0,a.mathOptRow)(null!==(n=e.items)&&void 0!==n?n:[],(e=>(0,t.createMathMLNode)(e,s)))})(e,o);break;case"bond":{const{tx:t}=e.bond;f={tag:"mo",content:"-"===t?"–":t,color:v,attrs:{lspace:"0",rspace:"0"}}}break;case"bracket":f={tag:"mo",content:e.text,color:v};break;case"brackets":f=(0,d.mathScripted)(null!==(p=e.items)&&void 0!==p?p:[],g);break;case"item":f=(0,u.onNodeItem)(e,g);break;case"k":f={tag:e.k.isNumber()?"mn":"mi",content:e.k.toString(),color:v};break;case"mul":f={tag:"mo",content:"⋅",color:v};break;case"op":f={tag:"mo",content:(0,t.stdOp)(e.op.srcText,e.op.dstText)};break;case"radical":f=(0,i.mathItem)(e.radical.label,v);break;case"richText":f=(0,c.mathRichText)(e,g);break;case"space":f="agentOp"===e.spaceType?void 0:{tag:"mspace",attrs:{width:"0.5em"}};break;case"text":f=(0,l.mathText)(o,(0,n.textInsideTag)(e.text),v);break;default:f=(0,a.mathOptRow)(null!==(m=e.items)&&void 0!==m?m:[],g)}return f},t.stdOpsDict={"--\x3e":"⟶","--|>":"→","->":"→","®":"→","<->":"↔","<--\x3e":"↔","<=>":"⇌","<==>":"⇌","!=":"≠","<-":"←","<--":"←","<|--":"←"},t.stdOp=(e,o)=>{var n;return null!==(n=t.stdOpsDict[e])&&void 0!==n?n:o}},2007:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mathColumn=void 0;const n=o(1756),s=o(7290),r=o(3396);t.mathColumn=(e,t)=>{const o=(0,n.dictKeys)(e),{C:i=[],T:a,B:c}=e,d="tag"in i?i:(0,s.mathOptRow)(i,t);if("C"===o||""===o)return d;let l="";const u=(0,r.ifDef)(c,(e=>(0,s.mathOptRow)(e,t))),h=(0,r.ifDef)(a,(e=>(0,s.mathOptRow)(e,t)));let p=[];return u&&h?(l="munderover",p=[d,u,h]):u?(l="munder",p=[d,u]):h&&(l="mover",p=[d,h]),l?{tag:l,content:p}:void 0}},3706:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mathItem=void 0,t.mathItem=(e,t)=>{const o={tag:"mi",color:t,content:e};return 1===e.length&&(o.attrs={mathvariant:"normal"}),o}},7290:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mathOptRow=void 0,t.mathOptRow=(e,t)=>{const o=e.map(t).filter((e=>!!e));return 0===o.length?{tag:"mrow"}:1===o.length?o[0]:{tag:"mrow",content:o}}},2384:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mathRichText=void 0;const n=o(5167);t.mathRichText=(e,t)=>{var o;return(0,n.mathScripted)(null!==(o=e.items)&&void 0!==o?o:[],t)}},5167:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mathScripted=void 0;const n=o(1480),s=o(1756),r=o(7290);t.mathScripted=(e,t,o)=>{const i=(0,n.splitScripts)(e),{C:a=[],RT:c,RB:d,LT:l,LB:u}=i,h=(0,s.dictKeys)(i);if("C"===h)return(0,r.mathOptRow)(a,t);let p="",m=[];return d&&"C,RB"===h?(p="msub",m=[a,d]):c&&"C,RT"===h?(p="msup",m=[a,c]):d&&c&&"C,RB,RT"===h?(p="msubsup",m=[a,d,c]):(p="mmultiscripts",m=[a,d,c,"mprescripts",u,l]),{tag:p,content:m.map(((e,n)=>{var s;if(!e)return{tag:"mrow"};if("string"==typeof e)return{tag:e};const i=n?t:null!=o?o:t;return null!==(s=(0,r.mathOptRow)(e,i))&&void 0!==s?s:{tag:"mrow"}}))}}},8866:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mathText=void 0;const n=o(3706);t.mathText=(e,t,o)=>/^\d+$/.test(t)?{tag:"mn",content:t,color:o}:"custom"===e.textMode?(0,n.mathItem)(t,o):{tag:"mtext",content:t,color:o}},6121:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.onNodeItem=void 0;const n=o(1252),s=o(2007),r=o(5167);t.onNodeItem=(e,t)=>{const{items:o}=e;if(!o)return;const i=(0,n.splitColumn)(o),{C:a,B:c,T:d}=i;if(!a)return;const l=(0,r.mathScripted)(a,t);return(0,s.mathColumn)({C:l,B:c,T:d},t)}},4950:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stdOp=t.mhchemOpsDict=t.getTexColor=t.createTexFromNode=t.buildTeX=void 0;const n=o(3396),s=o(9991),r=o(2916),i=o(3612),a=o(3899),c=o(1252),d=o(1480),l=o(8422),u=o(3310);t.buildTeX=(e,o)=>{const n=(0,i.cloneTextNode)(e);(0,a.optimizeColors)(n,(({items:e})=>e));const s=(0,t.createTexFromNode)(n,Object.assign(Object.assign({},o),{extOp:!1}));return(null==o?void 0:o.noMhchem)?`\\mathrm{${s}}`:`\\ce{${s}}`},t.createTexFromNode=(e,o)=>{var n;switch(e.type){case"atom":return p(e.atom.id,e.color,o);case"bond":return p(e.bond.tx,e.color,o);case"bracket":return p(e.text.replace(/([{}])/g,"\\$1"),e.color,o);case"brackets":return p(f((0,d.splitScripts)(null!==(n=e.items)&&void 0!==n?n:[]),e.color,o),e.color,o);case"charge":return p(e.charge.text,e.color,o);case"column":return"op"===e.columnType?y(e,o):v(e,e.color,o);case"comma":return",";case"comment":return C(e,e.comment.text,o);case"custom":return C(e,e.custom.text,o);case"group":return m(e.items,e.color,o);case"item":return b(e,o);case"k":return h(e.k.toString(),e.kType,e.color,o);case"mul":return o.noMhchem?" \\cdot ":"*";case"op":return(0,t.stdOp)(e.op.srcText,e.op.srcText,o);case"radical":return p(x(e.radical.label),e.color,o);case"richText":return w(e,o);case"space":return" ";case"text":return p((0,u.replaceSpecialTeXSymbols)(x(e.text)),e.color,o)}return""};const h=(e,t,o,n)=>{let s=p(e,o,n);return n.noMhchem&&"agent"===t&&(s+="\\,"),s};t.getTexColor=(e,t)=>{if(!e)return"";let o=e;const n="predefined"===(null==t?void 0:t.colors);if("dvips"===(null==t?void 0:t.colors)||n){const t=(0,s.parseColorCss)(e);if(t){const e=(0,r.getRgbSamples)(t);if(e){const t=(0,l.findNearestColor)(e.r,e.g,e.b,n);o=l.texColors[t][0],n&&(o=o.toLowerCase())}}}return o};const p=(e,o,n)=>{const s=(0,t.getTexColor)(o,n);return s?`{\\color{${s}}${e}}`:e},m=(e,o,n)=>{var s;return p(null!==(s=null==e?void 0:e.map((e=>(0,t.createTexFromNode)(e,n))).join(""))&&void 0!==s?s:"",o,n)},f=(e,t,o)=>{let n="";const s=(s,r)=>{e[r]&&(n+=((e,t,o)=>o.scripts&&"optimal"!==o.scripts||1!==t.length?`${e}{${t}}`:`${e}${t}`)(s,m(e[r],t,o),o))};return s("^","LT"),s("_","LB"),n+=m(e.C,t,o),s("^","RT"),s("_","RB"),n},g=(e,t,o,n,s)=>{const r=e=>Array.isArray(e)?m(e,n,s):e,i=(e,t,o)=>`\\${e}{${r(t)}}{${r(o)}}`,a=null!=e?e:"";return t&&o?i("overset",t,i("underset",o,a)):t?i("overset",t,a):o?i("underset",o,a):r(a)},v=(e,t,o)=>{var n;const s=(0,c.splitColumn)(null!==(n=e.items)&&void 0!==n?n:[]);return g(s.C,s.T,s.B,t,o)},b=(e,t)=>{var o,n;const s=(0,c.splitColumn)(null!==(o=e.items)&&void 0!==o?o:[]),r=f((0,d.splitScripts)(null!==(n=s.C)&&void 0!==n?n:[]),void 0,t);return p(g(r,s.T,s.B,void 0,t),e.color,t)},y=(e,t)=>{var o,n,s,r;const i=Object.assign({},t),a=(0,c.splitColumn)(null!==(o=e.items)&&void 0!==o?o:[]),d=B(a.C),l=!t.noMhchem;let u,h;d&&!l&&(i.extOp=!0);const p=null===(n=e.items)||void 0===n?void 0:n.find((({type:e})=>"op"===e));if("op"===(null==p?void 0:p.type)&&"TeX"===t.comments){const{op:e}=p;u=null===(s=e.commentPre)||void 0===s?void 0:s.text,h=null===(r=e.commentPost)||void 0===r?void 0:r.text}else u=m(a.T,e.color,i),h=m(a.B,e.color,i);let f=m(a.C,e.color,i);return l?((u||h)&&(f+=`[${u||""}]`),h&&(f+=`[${h}]`)):d&&(h&&(f+=`[${h}]`),f+=`{${u||""}}`),f},C=(e,t,o)=>"TeX"===o.comments?(0,u.replaceSpecialTeXSymbols)(t):m(e.items,e.color,o),w=(e,t)=>{var o;const n=(0,d.splitScripts)(null!==(o=e.items)&&void 0!==o?o:[]);return f(n,e.color,t)},x=e=>e.replace(/\\/g,"\\backslash ").replace(/([{}\[\]])/g,"\\$1");t.mhchemOpsDict={"--\x3e":"->","--|>":"->","->":"->","®":"→","<->":"<->","<--\x3e":"<->","<=>":"⇌","<==>":"<--\x3e","!=":"\\ne","<-":"<-","<--":"<-","<|--":"<-"},t.stdOp=(e,o,s)=>{var r,i;if(!s.noMhchem)return null!==(r=t.mhchemOpsDict[e])&&void 0!==r?r:o;if(s.extOp){const t=M[e];if(t)return`\\${t}`}return null!==(i=(0,n.ifDef)(P[e],(e=>`\\${e}`)))&&void 0!==i?i:o};const P={"->":"rightarrow","--\x3e":"longrightarrow","--|>":"longrightarrow","®":"rightarrow","<->":"leftrightarrow","<--\x3e":"longleftrightarrow","<=>":"rightleftarrows","<==>":"rightleftarrows","!=":"ne","<-":"leftarrow","<--":"longleftarrow","<|--":"longleftarrow"},M={"->":"xrightarrow","®":"xrightarrow","--\x3e":"xrightarrow","--|>":"xrightarrow","<->":"xleftrightarrow","<--\x3e":"xleftrightarrow","<=>":"xrightleftharpoons","<==>":"xrightleftharpoons","<-":"xleftarrow","<--":"xleftarrow","<|--":"xleftarrow"},B=e=>{if(1!==(null==e?void 0:e.length)||!e[0])return!1;const[t]=e;return"op"===t.type&&!!M[t.op.srcText]}},3310:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.replaceSpecialTeXSymbols=void 0;const n=o(3396),s=o(2185);let r;t.replaceSpecialTeXSymbols=e=>{const{regEx:t,dict:o}=a();return e.replace(t,(e=>{var t;return null!==(t=(0,n.ifDef)(o[e],(e=>`\\${e} `)))&&void 0!==t?t:e}))};let i=/([↑])/g;const a=()=>{if(!r){const e={"↑":"uparrow","↓":"downarrow"};Object.entries(s.specCharsB).forEach((([t,o])=>{e[o]=t})),r=e;const t=Object.keys(e).join("");i=new RegExp(`([${t}])`,"g")}return{dict:r,regEx:i}}},8422:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.findNearestColor=t.texColors=void 0,t.texColors=[["Apricot",251,185,130],["Aquamarine",0,181,190],["Bittersweet",192,79,23],["Black",34,30,31,!0],["Blue",45,47,146,!0],["BlueGreen",0,179,184],["BlueViolet",71,57,146],["BrickRed",182,50,28],["Brown",121,37,0,!0],["BurntOrange",247,146,29],["CadetBlue",116,114,154],["CarnationPink",242,130,180],["Cerulean",0,162,227],["CornflowerBlue",65,176,228],["Cyan",0,174,239,!0],["Dandelion",253,188,66],["DarkOrchid",164,83,138],["Emerald",0,169,157],["ForestGreen",0,155,85],["Fuchsia",140,54,140],["Goldenrod",255,223,66],["Gray",148,150,152,!0],["Green",0,166,79,!0],["GreenYellow",223,230,116],["JungleGreen",0,169,154],["Lavender",244,158,196],["LimeGreen",141,199,62],["Magenta",236,0,140,!0],["Mahogany",169,52,31],["Maroon",175,50,53],["Melon",248,158,123],["MidnightBlue",0,103,149],["Mulberry",169,60,147],["NavyBlue",0,110,184],["OliveGreen",60,128,49],["Orange",245,129,55,!0],["OrangeRed",237,19,90],["Orchid",175,114,176],["Peach",247,150,90],["Periwinkle",121,119,184],["PineGreen",0,139,114],["Plum",146,38,143],["ProcessBlue",0,176,240],["Purple",153,71,155,!0],["RawSienna",151,64,6],["Red",237,27,35,!0],["RedOrange",242,96,53],["RedViolet",161,36,107],["Rhodamine",239,85,159],["RoyalBlue",0,113,188],["RoyalPurple",97,63,153],["RubineRed",237,1,125],["Salmon",246,146,137],["SeaGreen",63,188,157],["Sepia",103,24,0],["SkyBlue",70,197,221],["SpringGreen",198,220,103],["Tan",218,157,118],["TealBlue",0,174,179],["Thistle",216,131,183],["Turquoise",0,180,206],["Violet",88,66,155,!0],["VioletRed",239,88,160],["White",255,255,255,!0],["WildStrawberry",238,41,103],["Yellow",255,242,0,!0],["YellowGreen",152,204,112],["YellowOrange",250,162,26]],t.findNearestColor=(e,o,n,s)=>{let r=Number.MAX_SAFE_INTEGER,i=0;for(let a=0;a<t.texColors.length;a++){const[,c,d,l,u]=t.texColors[a];if(s&&!u)continue;const h=e-c,p=o-d,m=n-l,f=h*h+p*p+m*m;f<r&&(i=a,r=f)}return i}},8094:function(e,t,o){var n=this&&this.__rest||function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(o[n[s]]=e[n[s]])}return o};Object.defineProperty(t,"__esModule",{value:!0}),t.textFormula=t.textTypes=void 0;const s=o(830),r=o(1053),i=o(4678),a=o(5494),c=o(1033),d=o(4950),l=o(5510),u=o(6221);t.textTypes=["html","text","MathML","TeX"],t.textFormula=(e,t)=>{var o,h;const p="string"==typeof e?(0,r.compile)(e):e;if(p instanceof s.ChemExpr&&!p.isOk())return p.getMessage();const m="string"==typeof t?{type:t}:t,f=(0,i.buildTextNodes)(p);switch(m.type){case"html":{const e=null!==(o=m.options)&&void 0!==o?o:{},{indent:t}=e,s=n(e,["indent"]);return(0,u.renderXmlNodes)((0,a.buildHtmlRich)(f,s).nodes,{indent:t,noSelfClosed:!0})}case"text":return(0,c.buildTextFormat)(f,m.options);case"TeX":return(0,d.buildTeX)(f,m.options);case"MathML":{const e=null!==(h=m.options)&&void 0!==h?h:{},{indent:t}=e,o=n(e,["indent"]);return(0,u.renderXmlNode)((0,l.buildMathML)(f,o),{indent:t})}}return""}},1033:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildTextFormat=void 0;const n=o(3612),s=o(3899),r=o(1252),i=o(1480);t.buildTextFormat=(e,t)=>{const o=(0,n.cloneTextNode)(e);return(0,s.optimizeColors)(o,(({items:e})=>e)),a(o,t)};const a=(e,t)=>{var o;switch(e.type){case"atom":return e.atom.id;case"bond":return e.bond.tx;case"bracket":case"text":return e.text;case"brackets":return f((0,i.splitScripts)(e.items),void 0,t);case"charge":return e.charge.text;case"column":return u(e,t);case"comma":return",";case"comment":case"custom":case"group":return c(e.items,t);case"item":return p(e,t);case"k":return e.k.toString();case"mul":return null!==(o=null==t?void 0:t.mul)&&void 0!==o?o:"*";case"op":return d(e.op.dstText,t);case"radical":return e.radical.label;case"richText":return h(e.items,t);case"space":return" "}return""},c=(e,t,o="")=>(null!=e?e:[]).map((e=>"string"==typeof e?e:a(e,t))).join(o),d=(e,t)=>{var o;let n;return"ascii"===(null!==(o=null==t?void 0:t.operations)&&void 0!==o?o:"ascii")&&(n=l[e]),null!=n?n:e},l={"→":"->","—→":"->","↔":"<->","←→":"<->","⇌":"<=>","∙":"*","≠":"=/=","←—":"<-","←":"<-"},u=(e,t)=>{var o,n;const s=(0,r.splitColumn)(e.items);let i=null!==(o=s.C)&&void 0!==o?o:[];const a=null!==(n=null==t?void 0:t.opComments)&&void 0!==n?n:"text",d=(e,t)=>"quoted"===a?`"${e}"`:"function"==typeof a?a(e,t):e;if("ignore"!==a){if(s.B){const e=c(s.B,t);i=[...i,d(e,"below")]}s.T&&(i=[d(c(s.T,t),"above"),...i])}return c(i,t)},h=(e,t)=>{const o=(0,i.splitScripts)(e),n=c(o.C,t);return f(o,n,t)},p=(e,t)=>{var o,n,s,a;const d=(0,r.splitColumn)(null!==(o=e.items)&&void 0!==o?o:[]),l=(0,i.splitScripts)(null!==(n=d.C)&&void 0!==n?n:[]),u=null!==(s=l.C)&&void 0!==s?s:[],h=null==t?void 0:t.oxidationState;let p;if(d.T&&h)if("function"==typeof h)p=h(c(u,t),c(d.T,t,null==t?void 0:t.scriptDivider));else{const e="sup"===h?"*RT":h,t=m[e];if(t){const o=null!==(a=l[t])&&void 0!==a?a:[],n="*"===e[0]?[...d.T,...o]:[...o,...d.T];l[t]=n}}return p=null!=p?p:c(u,t),f(l,p,t)},m={"*RT":"RT","RT*":"RT","*RB":"RB","RB*":"RB","*LT":"LT","LT*":"LT","*LB":"LB","LB*":"LB"},f=(e,t,o)=>[g(e.LT,o,!0),v(e.LB,o,!0),null!=t?t:c(e.C,o),v(e.RB,o),g(e.RT,o)].join(""),g=(e,t,o)=>{var n;let s=c(e,t,null==t?void 0:t.scriptDivider);if(s){const e=null!==(n=null==t?void 0:t.sup)&&void 0!==n?n:"withHat";"withHat"===e?s=`^${s}`:"function"==typeof e&&(s=e(s,o))}return s},v=(e,t,o)=>{let n=c(e,t,null==t?void 0:t.scriptDivider);if(n){const e=null==t?void 0:t.sub;"withUnderscore"===e?n=`_${n}`:"function"==typeof e&&(n=e(n,o))}return n}},9538:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addClassToXmlNode=void 0,t.addClassToXmlNode=(e,t)=>{var o,n,s;const r=("string"==typeof t?t:t.join(" ")).split(" ").filter((e=>e)),i=new Set(null!==(s=null===(n=null===(o=e.attrs)||void 0===o?void 0:o.class)||void 0===n?void 0:n.split(" "))&&void 0!==s?s:[]);r.forEach((e=>i.add(e))),e.attrs=e.attrs||{},e.attrs.class=Array.from(i).join(" ")}},2955:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.optimizeXmlColors=void 0;const n=o(3899);t.optimizeXmlColors=e=>(0,n.optimizeColors)(e,(({content:e})=>Array.isArray(e)?e:void 0))},6221:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderXmlNodes=t.renderXmlNode=void 0;const n=o(4886),s=o(3268);t.renderXmlNode=({tag:e,attrs:o,color:r,content:i},a,c=0)=>{var d;const l=null!==(d=null==a?void 0:a.indent)&&void 0!==d?d:"",u=!(null==a?void 0:a.noSelfClosed),h=r?Object.assign(Object.assign({},o),{style:`color: ${r};`}):o;let p="";const m=(e,t)=>{l&&(p+=l.repeat(t)),p+=e,l&&(p+="\n")};if(!i||Array.isArray(i)&&0===i.length)m(u?(0,n.drawTag)(e,h,!0):`${(0,n.drawTag)(e,h)}</${e}>`,c);else{if(m((0,n.drawTag)(e,h,!i),c),"string"==typeof i&&i.trim()){const t=(0,s.escapeXml)(i);if(!(t.length>40))return l&&(p=p.slice(0,-1)),p+=t,m(`</${e}>`,0),p;m(t,c+1)}else Array.isArray(i)&&i.forEach((e=>{p+=(0,t.renderXmlNode)(e,a,c+1)}));i&&m(`</${e}>`,c)}return p},t.renderXmlNodes=(e,o,n=0)=>(null!=e?e:[]).map((e=>(0,t.renderXmlNode)(e,o,n))).join("")},3955:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RulesBase=void 0;const n=o(9838),s=o(6644);t.RulesBase=class{agentK(e){return e.toString()}atom(e){return e}comma(){return","}comment(e){return this.useMarkup(e)}custom(e){return this.useMarkup(e)}itemCount(e){return e.toString()}bracketCount(e){return this.itemCount(e)}itemMass(e){return(0,n.strMass)(e)}itemMassAndNum(e,t){return""}itemCharge(e){return""}nodeCharge(e){return e.text}bracketCharge(e){return this.nodeCharge(e)}operation(e){return`${this.opComment(e.commentPre)}${e.dstText}${this.opComment(e.commentPost)}`}opComment(e){return e?this.useMarkup(e.text):""}postProcess(e){return e}radical(e){return e}mul(){return"∙"}mulK(e){return String(e)}colorBegin(e){return""}colorEnd(){return""}markupSection(e,t){return""}useMarkup(e){const t=(0,s.parseMarkup)(e);let o="";return(0,s.markupFlat)(t,(({phase:e,chunk:t})=>{if("string"==typeof t)o+=t;else if("open"===e||"close"===e){const n="open"===e;!t.type&&t.color?o+=n?this.colorBegin(t.color):this.colorEnd():o+=this.markupSection(t.type,n)}})),o}}},1527:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dictTextRules=void 0;const n=o(9246),s=o(9043),r=o(1043),i=o(8666),a=o(9388),c=o(145);t.dictTextRules={bb:n.rulesBB,charChem:s.rulesCharChem,html:r.rulesHtml,mhchem:i.rulesMhchem,rtf:a.rulesRTF,text:c.rulesText}},9246:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.rulesBB=void 0;const n=o(3955),s=o(9838);class r extends n.RulesBase{agentK(e){return`[b]${e}[/b]`}comment(e){return`[i]${e}[/i]`}custom(e){return`[i]${e}[/i]`}itemCount(e){return`[sub]${e}[/sub]`}itemMass(e){return`[sup]${(0,s.strMass)(e)}[/sup]`}itemMassAndNum(e,t){return`[sup]${(0,s.strMass)(e)}[/sup][sub]${t}[/sub]`}nodeCharge(e){return`[sup]${e.text}[/sup]`}colorBegin(e){return`[color=${e}]`}colorEnd(){return"[/color]"}}t.rulesBB=Object.freeze(new r)},9043:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.rulesCharChem=void 0;const n=o(3955),s=o(9838),r=e=>e.isNumber()?String(e):`'${e}'`;class i extends n.RulesBase{agentK(e){return r(e)}comment(e){return`"${e}"`}custom(e){return`{${e}}`}itemCount(e){return r(e)}itemMass(e){return`$M(${(0,s.strMass)(e)})`}itemMassAndNum(e,t){return`$nM(${(0,s.strMass)(e)},${t})`}nodeCharge(e){return`^${e.text}`}operation(e){return`${this.opComment(e.commentPre)}${e.srcText}${this.opComment(e.commentPost)}`}opComment(e){return e?this.comment(e.text):""}postProcess(e){return e.replace(/\$color\(\)\$color/g,"$color")}radical(e){return this.custom(e)}mul(){return"*"}mulK(e){return r(e)}colorBegin(e){return`$color(${e})`}colorEnd(){return"$color()"}}t.rulesCharChem=Object.freeze(new i)},1043:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.rulesHtml=t.RulesHtml=void 0;const n=o(3955),s=o(9838),r=o(4886),i=o(3268);class a extends n.RulesBase{agentK(e){return`<b${e.color?` style="color:${(0,i.escapeXml)(e.color)}"`:""}>${e}</b>`}comment(e){return`<em>${super.comment(e)}</em>`}custom(e){return`<i>${super.custom(e)}</i>`}itemCount(e){return`<sub>${e}</sub>`}itemMass(e){return`<sup>${(0,s.strMass)(e)}</sup>`}itemMassAndNum(e,t){return`${(0,r.drawTag)("span",{class:"echem-mass-and-num"})}${(0,s.strMass)(e)}<br/>${t}</span>`}itemCharge(e){return`<sup class="echem-item-charge">${e.text}</sup>`}nodeCharge(e){return`<sup>${e.text}</sup>`}operation(e){let t=(0,r.drawTag)("span",{class:"echem-op"});switch(t+=this.opComment(e.commentPre),e.srcText){case"--\x3e":t+='<span class="chem-long-arrow">→</span>';break;case"<==>":t+='<span class="chem-long-arrow">⇌</span>';break;default:t+=e.dstText}return t+=this.opComment(e.commentPost),`${t}</span>`}opComment(e){return e?`<span class="echem-opcomment">${this.useMarkup(e.text)}</span>`:""}colorBegin(e){return`<span style="color:${(0,i.escapeXml)(e)}">`}colorEnd(){return"</span>"}markupSection(e,t){var o;const n=null!==(o=c[e])&&void 0!==o?o:"span";return t?`<${n}>`:`</${n}>`}}t.RulesHtml=a;const c={sup:"sup",sub:"sub"};t.rulesHtml=Object.freeze(new a)},8666:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.rulesMhchem=void 0;const n=o(3955),s=o(9838),r={"--\x3e":"->","<=>":"<--\x3e","<==>":"<--\x3e"};class i extends n.RulesBase{agentK(e){return String(e)}itemCount(e){return`_{${e}}`}itemMass(e){return`^{${(0,s.strMass)(e)}}`}itemMassAndNum(e,t){return`^{${(0,s.strMass)(e)}}_{${t}}`}nodeCharge(e){return`^{${e.text}}`}operation(e){var t,o;let n=null!==(t=r[e.srcText])&&void 0!==t?t:e.srcText;const s=e.commentPre,i=e.commentPost;return(s||i)&&(n+=`[{${null!==(o=null==s?void 0:s.text)&&void 0!==o?o:""}}]`),i&&(n+=`[{${i.text}}]`),n}mul(){return"*"}colorBegin(e){return`\\color{${e}}{`}colorEnd(){return"}"}markupSection(e,t){const o=a[e];return o?t?`${o}{`:"}":""}}const a={sup:"^",sub:"_"};t.rulesMhchem=Object.freeze(new i)},9388:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.rulesRTF=void 0;const n=o(3955),s=o(9838),r=o(3396),i=new Set(["'","*",":","\\","_","{","|","}","~"]),a=e=>Array.from(e).reduce(((e,t)=>e+(e=>{if(i.has(e))return`\\${e}`;const t=e.charCodeAt(0);return t>127?`{\\cf2\\rtlch \\ltrch\\loch \\u${t}\\'3f}`:`${e}`})(t)),""),c=e=>`{\\sub ${a(e)}}`,d=e=>`{\\super ${a(e)}}`;class l extends n.RulesBase{agentK(e){return a(String(e))}atom(e){return e}comment(e){return a(e)}custom(e){return a(e)}itemCount(e){return c(String(e))}itemMass(e){return d((0,s.strMass)(e))}itemMassAndNum(e,t){return d((0,s.strMass)(e))+c(String(t))}nodeCharge(e){return d(e.text)}operation(e){let t="";return(0,r.ifDef)(e.commentPre,(e=>{t+=d(e.text)})),t+=a(e.dstText),(0,r.ifDef)(e.commentPost,(e=>{t+=c(e.text)})),t}radical(e){return a(e)}}t.rulesRTF=Object.freeze(new l)},145:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.rulesText=t.RulesText=void 0;const n=o(3955);class s extends n.RulesBase{nodeCharge({isLeft:e,text:t}){return e?`${t}^`:`^${t}`}}t.RulesText=s,t.rulesText=Object.freeze(new s)},549:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isLeftCoeffA=t.isLeftCoeff=t.rxCoeffPos=void 0;const n=o(9063);t.rxCoeffPos=/^LT|RT|LB|RB|CU|CD$/,t.isLeftCoeff=e=>"L"===(null==e?void 0:e[0]),t.isLeftCoeffA=e=>{if("number"==typeof e){const t=(0,n.normalize360)(e);return t>90&&t<270}return(0,t.isLeftCoeff)(e)}},6518:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addAll=void 0,t.addAll=(e,t)=>t.forEach((t=>e.push(t)))},2012:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addAllSet=void 0,t.addAllSet=(e,t)=>Array.from(t).forEach((t=>e.add(t)))},5918:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cmpLess=t.cmp=void 0,t.cmp=(e,t)=>e<t?-1:t<e?1:0,t.cmpLess=e=>(t,o)=>e(t,o)?-1:e(o,t)?1:0},300:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.colorHexSamples=t.colorHexWithAlpha=t.colorHexIsShort=t.isColorHex=t.withoutSharp=void 0,t.withoutSharp=e=>"#"===e[0]?e.slice(1):e,t.isColorHex=(e,t)=>(!0!==t||"#"===e[0])&&(!1!==t||"#"!==e[0])&&/^#?([\dA-F]{3,4}|[\dA-F]{6}|[\dA-F]{8})$/i.test(e),t.colorHexIsShort=e=>{const{length:o}=(0,t.withoutSharp)(e);return 3===o||4===o},t.colorHexWithAlpha=e=>{const{length:o}=(0,t.withoutSharp)(e);return 4===o||8===o},t.colorHexSamples=e=>{if(!e)return;const o=(0,t.withoutSharp)(e);let n;switch(o.length){case 3:case 4:n=o.split("").map((e=>e+e));break;case 6:n=[0,2,4].map((e=>o.slice(e,e+2)));break;case 8:n=[0,2,4,6].map((e=>o.slice(e,e+2)))}if(!n)return;const s=n.map((e=>parseInt(e,16)));return s.findIndex((e=>Number.isNaN(e)))>=0?void 0:{r:s[0],g:s[1],b:s[2],a:s[3]}}},8759:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.findColorByName=t.colorNamesMap=void 0,t.colorNamesMap={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},t.findColorByName=e=>t.colorNamesMap[e.toLowerCase()]},3954:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.colorRgbParse=t.isColorRgba=t.isColorRgb=void 0,t.isColorRgb=e=>/^rgb\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*\)$/i.test(e),t.isColorRgba=e=>/^rgba\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*(1|0|0?\.\d+)\s*\)$/i.test(e),t.colorRgbParse=e=>{const o=e.split(/[\(\),]/);let n=[];if((0,t.isColorRgb)(e))n=o.slice(1,4);else{if(!(0,t.isColorRgba)(e))return;n=o.slice(1,5)}const s=n.map((e=>+e));if(s.some((e=>Number.isNaN(e))))return;const r={type:"rgb",r:s[0],g:s[1],b:s[2],a:s[3]};return r.a&&(r.a*=255),r}},2916:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRgbSamples=void 0;const n=o(300),s=o(8759),r=o(136);t.getRgbSamples=e=>(0,r.traceColor)(e,{name:e=>(0,n.colorHexSamples)((0,s.findColorByName)(e.name)),hex:e=>(0,n.colorHexSamples)(e.value),rgb:({r:e,g:t,b:o,a:n})=>({r:e,g:t,b:o,a:n})})},9991:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseColorCss=void 0;const n=o(300),s=o(8759),r=o(3954);t.parseColorCss=e=>{if(e)return(0,s.findColorByName)(e)?{type:"name",name:e}:(0,n.isColorHex)(e,!0)?{type:"hex",value:e}:(0,r.colorRgbParse)(e)}},136:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.traceColor=void 0,t.traceColor=(e,t)=>{switch(e.type){case"name":return t.name(e);case"hex":return t.hex(e);case"rgb":return t.rgb(e)}throw Error(`Invalid color = ${JSON.stringify(e)}`)}},6889:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.delay=void 0,t.delay=e=>new Promise((t=>{setTimeout((()=>t()),e)}))},7788:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getItemForced=void 0,t.getItemForced=(e,t,o)=>{const n=e[t];if(void 0!==n)return n;const s="function"==typeof o?o():o;return e[t]=s,s}},3396:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ifDef=void 0,t.ifDef=(e,t)=>void 0===e?void 0:t(e)},8017:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSubStr=void 0,t.isSubStr=(e,t,o)=>{for(let n=0;n<o.length;n++)if(e[t+n]!==o[n])return!1;return!0}},1227:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.lastItem=void 0,t.lastItem=e=>e?e[e.length-1]:void 0},9409:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.listToDict=void 0,t.listToDict=(e,t)=>e.reduce(((e,o)=>Object.assign(Object.assign({},e),{[t(o)]:o})),{})},6644:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.markupFlat=t.parseMarkup=t.scanMarkupEnd=void 0;const n=o(8017);t.scanMarkupEnd=(e,t,o)=>{let n=0,s=t;for(;s<e.length;){const t=e[s++];if(t===o&&n<=0)break;"{"===t?n++:"}"===t&&n--}return s},t.parseMarkup=(e,o="",s=void 0)=>{const r=[];let i=0,a=0,c=s;const d=t=>{if(t>a){const o=e.slice(a,t);r.push(c===s?o:{type:"",color:c,chunks:[o]})}},l=o=>{if(i===e.length)return;d(i-1);const n=e[i++];if("{"===n){a=i,i=(0,t.scanMarkupEnd)(e,i,"}");const n=(0,t.parseMarkup)(e.slice(a,i-1),o);r.push(n)}else r.push({type:o,chunks:[n]});a=i},u=t=>{const o=e.indexOf("}",t);let n;return o<0?(i=t,n=void 0):(n=e.slice(t,o),i=o+1),a=i,n};for(;i<e.length;){const o=e[i++];if("^"===o)l("sup");else if("_"===o)l("sub");else if("\\"===o&&(0,n.isSubStr)(e,i,"color{")){d(i-1);const e=u(i+6);e&&(c=e)}else if("{"===o&&(0,n.isSubStr)(e,i,"\\color{")){d(i-1);const o=u(i+7);i=(0,t.scanMarkupEnd)(e,i,"}"),r.push((0,t.parseMarkup)(e.slice(a,i-1),"",o)),a=i}}d(i);const h={type:o,chunks:r};return s&&(h.color=s),h},t.markupFlat=(e,o)=>{e.chunks.forEach((n=>{"string"==typeof n?o({phase:"full",chunk:n,owner:e}):(o({phase:"open",chunk:n,owner:e}),(0,t.markupFlat)(n,o),o({phase:"close",chunk:n,owner:e}))}))}},3223:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeItem=void 0,t.removeItem=(e,t)=>{const o=e.indexOf(t);o>=0&&e.splice(o,1)}},7827:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.romanNum=void 0,t.romanNum={i:1,ii:2,iii:3,iv:4,v:5,vi:6,vii:7,viii:8}},4886:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawTag=void 0;const n=o(3268);t.drawTag=(e,t,o,s)=>{let r=`<${e}`;if(t){const e=null!=s?s:n.escapeXml;Object.keys(t).forEach((o=>{r+=` ${o}="${e(t[o])}"`}))}return o&&(r+=" /"),`${r}>`}},3268:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dec=t.hexLow=t.escapeXml=void 0;const o={"'":"apos",'"':"quot","&":"amp","<":"lt",">":"gt"," ":"nbsp"};t.escapeXml=(e,t)=>Array.from(e).map((e=>{if(e in o)return`&${o[e]};`;if(!t||e>=" "&&e<="~")return e;const n=t(e.charCodeAt(0));return n?`&#${n};`:e})).join(""),t.hexLow=e=>`x${e.toString(16)}`,t.dec=e=>String(e)},6713:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.textInsideTag=void 0,t.textInsideTag=e=>e.replace(/\s+/g," ").replace(/(^ )|( $)/g," ")},5672:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=[2,2,0]}},t={};function o(n){var s=t[n];if(void 0!==s)return s.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,o),r.exports}(()=>{const e=o(6875),t=o(9769),n=o(149);"undefined"!=typeof window&&(window.ChemSys=t.ChemSys,window.MenTblArray=n.PeriodicTable.elements,window.MenTbl=n.PeriodicTable.dict,(0,e.addAutoCompileEvent)())})()})();
//# sourceMappingURL=charchem2.js.map